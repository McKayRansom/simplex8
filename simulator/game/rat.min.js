/*


 Rat Game Engine

 http://www.wahoo.com/rat/

 Copyright 2013-2017 Wahoo Studios, Inc. and Steven H. Taylor.
 Released under the MIT license
 http://www.wahoo.com/rat/license/

*/
"undefined"!==typeof WinJS&&(window.WinJS.Binding.optimizeBindingReferences=!0);var rat=rat||{};rat.loaded=!1;rat.getGlobalApp=function(){if("undefined"!==typeof app)return app};
rat.console={output:[],saveOutputToLocalStorage:!1,copyToSystem:!0,logRemotely:!1,remoteURL:!1,maxLogLines:150,onceRecord:{},lastText:"",repeat:0,log:function(a){var d=rat.console,c=d.output;a===d.lastText?(d.repeat+=1,c[c.length-1]="|(X"+d.repeat+") "+d.lastText):(d.lastText=a,d.repeat=1,c.push("| "+a),c.length>d.maxLogLines&&c.splice(0,1));rat.console.saveOutputToLocalStorage&&rat.system.has.localStorage&&rat.system.getLocalStorage().setItem("RAT_LOG",JSON.stringify(c));d.copyToSystem&&(c="|"+a,
console.log("|"+a),(rat.system.has.xboxLE||rat.system.has.xbox)&&Debug.writeln(c));d.logRemotely&&d.remoteURL&&(c=new XMLHttpRequest,c.open("GET",d.remoteURL+a,!0),c.send())}};rat.system={has:{},onPlatform:"",applyCacheBuster:!1};rat.events={queued:{}};
rat.detectPlatform=function(){if(!rat.detectPlatform.detected){rat.detectPlatform.detected=!0;rat.console.log("rat detecting platform...");rat.system.has.pointer=!0;"undefined"!==typeof Windows&&"undefined"!==typeof winJS?(rat.system.has.windows8=!0,rat.system.has.winJS=!0,void 0!==window.Windows.Xbox?(rat.system.has.xbox=!0,rat.system.has.pointer=!1):rat.system.has.realWindows8=!0):"undefined"!==typeof XboxJS&&(rat.system.has.xboxLE=!0,rat.system.has.pointer=!1);"undefined"!==typeof Wraith&&(Wraith&&
Wraith.w_isNative)&&(rat.system.has.Wraith=!0,rat.system.onPlatform=Wraith.w_onPlatform);var a=navigator;rat.system.has.gamepadAPI=!!a.getGamepads||!!a.gamepads||!!a.mozGetGamepads||!!a.mozGamepads||!!a.webkitGetGamepads||!!a.webkitGamepads;rat.system.has.gamepadAPI&&rat.system.has.xboxLE&&(rat.system.has.gamepadAPI=!1);rat.system.has.gamepadAPIEvent=rat.system.has.gamepadAPI&&-1!==navigator.userAgent.indexOf("Firefox/")&&!rat.system.has.Wraith;rat.system.has.iOSBrowser=a&&(0<=a.userAgent.search("iPad")||
0<=a.userAgent.search("iPod")||0<=a.userAgent.search("iPhone"))?!0:!1;rat.system.has.PS4Browser=a&&0<=a.userAgent.search("PlayStation 4")?!0:!1;if(a&&0<=a.userAgent.search("Chrome")){rat.system.has.chromeBrowser=!0;var d=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);rat.system.has.chromeVersion=d?parseInt(d[2],10):0}else rat.system.has.chromeBrowser=!1;a&&(0<=a.userAgent.search("MSIE")||0<=a.userAgent.search("Edge"))?(rat.system.has.IEBrowser=!0,rat.system.has.IEVersion=a&&0<=a.userAgent.search("Edge/12")?
12:a&&0<=a.userAgent.search("like Gecko")?11:a&&0<=a.userAgent.search("MSIE 10")?10:a&&0<=a.userAgent.search("MSIE 9")?9:0):rat.system.has.IEBrowser=!1;rat.system.has.firefoxBrowser=a&&-1!==a.userAgent.indexOf("Firefox/")?!0:!1;rat.system.has.geckoBrowser=a&&-1!==a.userAgent.indexOf("Gecko/")?!0:!1;"undefined"!==typeof chrome&&(chrome.app&&chrome.app.runtime)&&(rat.system.has.chromeApp=!0);rat.system.has.cpuClass=a&&a.cpuClass?a.cpuClass:"unknown";"undefined"!==typeof QUnit&&(rat.system.has.QUnit=
!0,rat.system.has.unitTest=!0);var c;try{c=window.localStorage}catch(b){c=null}c?(rat.system.has.localStorage=!0,rat.system.localStorageObject=c):(rat.system.has.localStorage=!1,rat.system.localStorageObject=null)}};rat.system.getLocalStorage=function(){return rat.system.localStorageObject};(function(a){if(window.location){var d=window.location.href;a.system.baseURL=d.slice(0,d.indexOf("?"));a.system.URLVars={};d.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,b,e){a.system.URLVars[b]=e})}})(rat);
rat.system.fixPath=function(a){if(0===a.length)return a;var d=-1<a.search(/^http/);if(!d){rat.system.rootFolder&&(a=rat.system.rootFolder+a,rat.utils.cleanPath&&(a=rat.utils.cleanPath(a)));rat.system.ratAltFolder&&"rat/"===a.substring(0,4)&&(a=rat.system.ratAltFolder+a.substring(4));rat.system.rootSubFolder&&(a="../"+a);if(rat.system.has.xboxLE||rat.system.applyCacheBuster)a=a+"?_="+Math.random();rat.system.has.xboxLE&&(a=window.adParams._projectBase+a)}return a};
if(void 0!==window.WinJS){var activation;window.Windows&&window.Windows.ApplicationModel&&(activation=window.Windows.ApplicationModel.Activation);activation||(activation={});activation.ActivationKind||(activation.ActivationKind={});activation.ApplicationExecutionState||(activation.ApplicationExecutionState={});window.WinJS.Application.onactivated=function(a){var d={};switch(a.detail.kind){case activation.ActivationKind.launch:d.kind="launched";break;case activation.ActivationKind.search:d.kind="searchWith";
break;case activation.ActivationKind.shareTarget:d.kind="shareTarget";break;case activation.ActivationKind.file:d.kind="file";break;case activation.ActivationKind.protocol:d.kind="protocol";break;case activation.ActivationKind.fileOpenPicker:d.kind="fileOpenPicker";break;case activation.ActivationKind.fileSavePicker:d.kind="fileSavePicker";break;case activation.ActivationKind.cachedFileUpdater:d.kind="cachedFileUpdater";break;case activation.ActivationKind.ContactPicker:d.kind="contactPicker";break;
case activation.ActivationKind.device:d.kind="autoplay";break;case activation.ActivationKind.printTaskSettings:d.kind="print";break;case activation.ActivationKind.cameraSettings:d.kind="camera";break;case activation.ActivationKind.restrictedLaunch:d.kind="launched-restricted";break;case activation.ActivationKind.appointmentsProvider:d.kind="appointmentsProvider";break;case activation.ActivationKind.Contact:d.kind="contact";break;case activation.ActivationKind.lockScreenCall:d.kind="launch-locked";
break;default:d.kind="unknown"}switch(a.detail.previousExecutionState){case activation.ApplicationExecutionState.notRunning:d.prevState="notRunning";break;case activation.ApplicationExecutionState.running:d.prevState="running";break;case activation.ApplicationExecutionState.suspended:d.prevState="suspended";break;case activation.ApplicationExecutionState.terminated:d.prevState="terminated";break;case activation.ApplicationExecutionState.closedByUser:d.prevState="closed";break;default:d.prevState=
"unknown"}d.sessionState=(window.WinJS.Application.sessionState||{}).savedState;a.setPromise(window.WinJS.UI.processAll().then(function(){rat.events.queued.activated=["activated",d];"terminated"===d.prevState&&(rat.events.queued.resumeFromTerminated=["resumeFromTerminated",d])}))};window.WinJS.Application.start()}else rat.events.queued.activated=["activated",{kind:"launched",prevState:"notRunning",sessionState:void 0}];
window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)};window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;rat.utils={loadedScripts:{length:0}};
(function(a){a.utils.dumpException=function(d,c){if(c){a.console.log("=======================================================");a.console.log("ERROR!  "+d);a.console.log("->   Got Exception "+c.name+"("+(c.number||"???")+")");a.console.log("->   "+c.description||c.message);delete c.message;delete c.description;delete c.name;delete c.number;for(var b=JSON.stringify(c).split("\\n"),e=0;e<b.length;++e)a.console.log("->"+b[e])}else a.console.log("Unable to dump undefined exception")};a.utils.loadResources=
function(d,c,b){function e(a,b){if(a){if(a.loaded)return;a.loaded=!0;a.callback&&a.callback(b)}--h;f&&f({left:h,loaded:g-h,of:g});0>=h&&c&&c()}Array.isArray(d)||(d=[d]);b=b||{};void 0===b.async&&(b.async=!0);var f=b.update,g=d.length,h=d.length,j,k;j=0;for(k=d.length;j!==k;++j)"string"===typeof d[j]&&(d[j]={source:d[j]}),d[j].loaded=!1;f&&f({left:g,loaded:0,of:g});if(0>=h)c&&c();else{var l;j=0;for(k=d.length;j!==k;++j){l=d[j];if(void 0===l.type){var m=l.source.lastIndexOf(".");l.type=-1===m?"UNKNOWN":
l.source.substr(m+1).toUpperCase()}"JS"===l.type&&!a.utils.loadedScripts[l.source]&&(a.utils.loadedScripts[l.source]="pending",++a.utils.loadedScripts.length)}j=0;for(k=d.length;j!==k;++j)switch(l=d[j],l.type){case "JS":a.utils.loadScriptWithCallback(l.source,!!b.async,e.bind(void 0,l));break;case "JSON":b.async?a.utils.loadJSON(l.source,e.bind(void 0,l)):a.console.log("ERROR!  Unable to load JSON files synchronously");break;default:a.console.log("WARNING! Attempting to load unrecognized resource "+
l.source),e(l,void 0)}}};a.utils.loadResourcesSync=function(d,c,b){function e(){++f;if(!b.update||!b.update({index:f,list:d,startAgain:e}))if(f>=d.length)c&&c();else{var g=d[f];b.verbose&&a.console.log("Sync load of list item "+f+":"+JSON.stringify(g));a.utils.loadResources(g,e,{async:!1})}}"string"===typeof d&&(d=[d]);d=d||[];var f=-1;b=b||{};e()};a.utils.loadScriptWithCallback=function(d,c,b,e){function f(c){if(c&&("load"===c.type||"complete"===c.readyState))a.utils.loadedScripts[d]="loaded",b&&
b(d)}void 0!==a.utils.loadedScripts[d]&&"pending"!==a.utils.loadedScripts[d]&&(a.console.log("WARNING:  File "+d+" is getting loaded twice!"),d+=Math.random());a.utils.loadedScripts[d]||++a.utils.loadedScripts.length;a.utils.loadedScripts[d]="downloading";var g=a.system.fixPath(d);if(a.system.has.Wraith)Wraith.LoadScript({src:g,async:c,complete:f});else{var h=document.createElement("script");h.async=c||!1;h.type="text/javascript";h.onreadystateChange=f;h.onload=f;h.onerror=function(){a.utils.loadedScripts[d]=
"error";a.console.log("Failed to load file "+g);e&&e(d)};h.src=g;document.getElementsByTagName("head")[0].appendChild(h)}};a.utils.loadQUnit=function(d){function c(){function a(b){var e=document.createElement("div");e.id=b;f.insertBefore(e,c)}if(b&&e){var c=document.getElementsByTagName("canvas")[0],f=document.getElementsByTagName("body")[0];f.style.overflow="visible";a("qunit");a("qunit-fixture");d()}}var b=!1,e=!1;a.utils.loadScriptWithCallback("http://code.jquery.com/qunit/qunit-1.20.0.js",!0,
function(){e=!0;c()});var f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("type","text/css");f.onload=function(){b=!0;c()};f.setAttribute("href","http://code.jquery.com/qunit/qunit-1.20.0.css");document.getElementsByTagName("head")[0].appendChild(f)}})(rat);
(function(a){function d(a){a=a.replace(/\./g,"/");return a+".js"}function c(b,e){var h=[],j,k;if(Array.isArray(b)){for(j=0;j!==b.length;++j)k=c(b[j],e),h=h.concat(k);return h}if("object"===typeof b){if(!a.modules.checkPlatformDep(b.platform))return[];b=b.name}if(".js"===b.substr(-3).toLowerCase())j=b;else{if(a.modules.byName[b])return[];(j=a.modules.moduleFileLookup[b])||(j=d(b))}k=j.toLowerCase();if(!a.modules.missingFiles.byPath[k]&&!a.utils.loadedScripts[j]){if(!e||!e.justGenFileList)a.modules.missingFiles.byPath[k]=
!0,a.modules.missingFiles.list[a.modules.missingFiles.list.length]=k;h[h.length]=j;if((k=a.modules.moduleRequiresList[b])&&k.length)k=c(k,e),h.concat(k)}return j}function b(b,c){if(!b)return[];var e;e=b;c=c||{};"string"===typeof b&&(e=a.modules.byName[b]);e=e.requires;for(var d=[],k=0;k!==e.length;++k){var l=e[k];if(a.modules.checkPlatformDep(l.platform)&&(c.forFiles||!l.fileOnly))d[d.length]=l.name}return d}a.modules={};a.modules.byName={};a.modules.length=0;a.modules.pending=[];a.modules.moduleFileLookup=
{};a.modules.moduleRequiresList={};a.modules.addModulesToFileLookup=function(b){for(var c in b)b.hasOwnProperty(c)&&(a.modules.moduleFileLookup[c]&&a.modules.moduleFileLookup[c]!==b[c]?a.console.log("Module name "+c+" duplicated. in file lookup for "+a.modules.moduleFileLookup[c]+"/"+b[c]):a.modules.moduleFileLookup[c]=b[c])};a.modules.addModulesToRequiresLookup=function(b){for(var c in b)b.hasOwnProperty(c)&&(a.modules.moduleRequiresList[c]?a.console.log("Module name "+c+" duplicated. in requires lookup"):
a.modules.moduleRequiresList[c]=b[c])};a.modules.missingFiles={list:[],byPath:{}};a.modules.checkPlatformDep=function(b){return!b||!b.length?!0:"!"==b[0]?void 0==a.system.has[b.substring(1)]:a.system.has[b]?!0:!1};var e=["rat.os.r_system","rat.os.r_events","rat.debug.r_console","rat.debug.r_profiler","rat.utils.r_utils","rat.math.r_math","rat.math.r_vector","rat.math.r_matrix",{name:"rat.test.r_qunit",platform:"QUnit"}];a.modules.add=function(e,g,h){e="object"!==typeof e?{name:e,requires:g,code:h}:
e;e.name||(a.console.log("ERROR: Modules must be given a name"),e.name="_"+(1E4*Math.random()|0));e.hasBeenProcessed=!1;e.requires?Array.isArray(e.requires)||(e.requires=[e.requires]):e.requires=[];for(g=0;g!==e.requires.length;++g)h=e.requires[g],h.name||(h={name:h,platform:void 0,processBefore:!1,fileOnly:!0}),void 0!==h.processBefore?h.fileOnly=!h.processBefore:void 0!==h.fileOnly?h.processBefore=!h.fileOnly:(h.fileOnly=!0,h.processBefore=!1),e.requires[g]=h;a.modules.byName[e.name]?a.console.log("ERROR: Attempting to re-define module "+
e.name):(a.modules.byName[e.name]=e,a.modules.pending[a.modules.pending.length]=e,++a.modules.length,g=b(e,{forFiles:!0}),c(g),e=d(e.name).toLowerCase(),g=a.modules.missingFiles.list.indexOf(e),0<=g&&(a.modules.missingFiles.list.splice(g,1),delete a.modules.missingFiles.byPath[e]))};a.modules.isReadyToProcess=function(c,e){if(!c)return!1;e=e||[];var d=a.modules.byName;if(!c)return a.console.log("Testing if undefined module is ready to process"),!1;if(c.hasBeenProcessed)return!1;for(var j=b(c),k=0;k!==
j.length;++k){var l=j[k],l=d[l];if(!l||!l.fileOnly)l?l.hasBeenProcessed||e.push(l):e.push({name:j[k],hasBeenProcessed:!1,isMissing:!0})}return 0===e.length};a.modules.process=function(b){b=b||{};for(var c=b.maxToCall||0,e=!!b.noError,d=a.modules.pending;0<d.length;){++a.modules.process.passes;for(var k=d.length-1,l=d.length;0<=k;){var m=d[k];if(a.modules.isReadyToProcess(m)){b.verbose&&a.console.log("rat module processing : "+m.name);if(m.code)try{m.code(a,a.getGlobalApp())}catch(n){throw a.utils.dumpException("Failed to process module "+
m.name+".",n),n;}b.verbose&&a.console.log("done with : "+m.name);m.hasBeenProcessed=!0;d.splice(k,1);if(0<c&&0<d.length&&(--c,0>=c))return"HIT_LIMIT"}--k}if(d.length===l){if(e)return"PENDING";a.console.log("ERROR! BAD REQUIRES TREE!  Unable to process "+d.length+" modules.  (circular or missing dependencies?)");for(k=0;k!==d.length;++k){a.console.log(">"+d[k].name);b=[];a.modules.isReadyToProcess(d[k],b);for(c=0;c!==b.length;++c)a.console.log("  >"+b[c].name+(b[c].isMissing?" MISSING!":""))}return"ERROR"}}};
a.modules.process.passes=0;a.load=function(b){function d(){if(!a.load.failed){var e;++v;if(x){if(!A){if("ERROR"===a.modules.process({maxToCall:a.system.has.Wraith&&b.async?1:0,verbose:b.verbose})){a.load.failed=!0;return}0>=a.modules.pending.length&&(A=!0,y=void 0,l("rat.modules.process finished.  Took "+a.modules.process.passes+" passes."));e=100*((a.modules.length-a.modules.pending.length)/a.modules.length)}}else e=100*(w/a.utils.loadedScripts.length);e!==y&&(y=e,v=0);if(6E3<=v)if(v=0,x)a.console.log('How did we go "idle" while trying to process files?!?  Modules left to proccess: '+
a.modules.pending.length);else{a.console.log('Went "idle" waiting for '+t+" of "+a.utils.loadedScripts.length+" file(s) to load.");for(var g in a.utils.loadedScripts)("pending"===a.utils.loadedScripts[g]||"downloading"===a.utils.loadedScripts[g])&&a.console.log("---\x3e"+g)}b.update&&b.update({load:{done:w,left:t,total:a.utils.loadedScripts.length,isDone:x},process:{done:a.modules.length-a.modules.pending.length,left:a.modules.pending.length,total:a.modules.length,isDone:A}});if(x&&A){if(!z)if(z=
!0,n.length){l("Starting sync load of "+n.length+" files.");e=c(n,{justGenFileList:!0});var k=function(b){if(0<a.modules.missingFiles.list.length)return k.paused?a.console.log("Keep sync loading paused.  More missing files..."):(k.paused=!0,a.console.log("Pause sync loading after "+b.index+" of "+b.list.length+" files...")),j(function(){k(b)},{logTag:"paused sync"}),"abort";a.modules.process({noError:!0});k.paused&&(a.console.log("Resume sync loading "+(b.list.length-(b.index+1))+" of "+b.list.length+
" files..."),k.paused=!1,b.startAgain());return!1};k.paused=!1;a.utils.loadResourcesSync(e,function(){B=!0},{update:k,verbose:b.verbose})}else B=!0;B?(a.modules.process(),a.loaded=!0,u&&(window.cancelAnimationFrame(u),u=0),b.done&&b.done(a,a.getGlobalApp())):u||(u=window.requestAnimationFrame(h))}else u||(u=window.requestAnimationFrame(h))}}function h(){u=0;d()}function j(b,c){c=c||{};c.logTag=c.logTag||"";++a.load.numLoadPasses;var e=a.modules.missingFiles.list;a.modules.missingFiles.list=[];a.modules.missingFiles.byPath=
{};l("WARNING!  Another "+c.logTag+" load phase ("+a.load.numLoadPasses+") is needed to get "+e.length+" required file(s).");for(var d=0;d!==e.length;++d)l("--\x3e"+e[d]);a.utils.loadResources(e,b,{update:c.update})}function k(){0<a.modules.missingFiles.list.length?j(k,{update:function(b){t=b.left;w=a.utils.loadedScripts.length-b.left;d()}}):(l("File load finished.  "+a.modules.pending.length+" Modules to process."),x=!0,b.async||d())}a.console.log("rat.load Verbose="+!!b.verbose);a.load.numLoadPasses=
0;var l=function(c){b.verbose&&a.console.log(c)};b=b||{};b.async=void 0!==b.async&&!b.async?!1:!0;var m=b.addAsync||[],n=b.addSync||[],p=[m,n];a.detectPlatform();for(var q=0;q!==p.length;++q)for(var r=p[q],s=r.length-1;0<=s;--s)r[s]?r[s].name||(r[s]={name:r[s]}):r.splice(s,1);p="object"===typeof Wraith;!a.system.has.Wraith&&a.load.addWraith&&!b.skipLoad&&(p||c("rat/wraithjs/web/wraith_core.js"),c(["rat/wraithjs/web/wraith_dom.js","rat/wraithjs/web/wraith_canvas.js"]));var t,w,v=0,y=void 0,x=!1,A=
!1,u,z=!1,B=!1;if(b.skipLoad)w=t=0,B=z=x=!0;else{c(e);c(m);l("Initial file pass selected the following "+a.modules.missingFiles.list.length+" files to load:");for(m=0;m<a.modules.missingFiles.list.length;++m)l("--\x3e"+a.modules.missingFiles.list[m])}m=a.modules.missingFiles.list;a.modules.missingFiles.list=[];a.modules.missingFiles.byPath={};b.skipLoad?(b.async&&(u=window.requestAnimationFrame(h)),k()):b.async?(u=window.requestAnimationFrame(h),l("Starting async file load..."),++a.load.numLoadPasses,
a.utils.loadResources(m,k,{update:function(b){t=b.left;w=a.utils.loadedScripts.length-b.left;d()}}),l("... Load Started.")):(l("Starting synchronous file load..."),a.utils.loadResources(m,k,{async:!1}))};a.simpleLoad=function(b,c){a.load({addSync:b,done:c})};a.simpleload=a.simpleLoad;a.load.setEntryPoint=function(a,b){"object"===typeof Wraith&&Wraith.SetEntryPoint?Wraith.SetEntryPoint(a,b):(b&&(a=a.bind(b)),window.onload=a)};a.ExternalEntryPoint=function(){if(window.onload)window.onload(null)}})(rat);
(function(a){a.unitTest={enabled:!0,group:function(){},test:function(d,c){a.unitTest.enabled&&a.unitTest._test&&a.unitTest._test(d,c)},testGroup:function(d,c,b){a.unitTest.group(d,function(){a.unitTest.test(c,b)})}}})(rat);rat.system.has.minified=!0;
rat.modules.add("rat.os.r_system",["rat.graphics.r_graphics","rat.debug.r_console","rat.debug.r_profiler","rat.os.r_events","rat.math.r_math",{name:"rat.os.r_le_core",platform:"xboxLE"}],function(a){function d(){return a.system.has.Wraith?0:window.performance?window.performance.now()/1E3:(new Date).getTime()/1E3}function c(b){a.console.log("JS ERROR! "+JSON.stringify(b));a.events&&a.events.fire&&a.events.fire("error",{sysEvent:b});b=new window.Windows.UI.Popups.MessageDialog(b.detail.errorUrl+"\n\tLine:\t"+
b.detail.errorLine+"\tCharacter:\t"+b.detail.errorCharacter+"\nMessage: "+(b.detail.message||b.detail.errorMessage),"error"===b.type?"Unhanded Error!":b.type);b.cancelCommandIndex=0;b.defaultCommandIndex=0;b.showAsync();return!0}function b(b){b={sysEvent:b};a.events&&a.events.fire&&a.events.fire("resume",b)}function e(b){function c(){++f;1===f&&a.system.has.winJS&&d.setPromise(new window.WinJS.Promise(function(a){g=a}))}function e(){0>=f||(--f,0===f&&g&&g("Done"))}var d=b,f=0,g,j={};c();b={store:function(a){j=
a},setBusy:c,setDone:e,sysEvent:d};a.events&&a.events.fire&&a.events.fire("suspend",b);a.system.has.winJS&&(window.WinJS.Application.sessionState.savedState=j);e()}a.paused=!1;a.system.debugDrawTiming=!1;a.system.debugDrawStats=!1;a.system.debugDrawFramerateGraph=!1;a.system.debugDrawMemoryGraph=!1;a.system.debugFramerateGraphSettings={bounds:{}};a.system.debugDrawConsole=!1;a.system.load=null;a.system.commandHandler=null;a.system.hasFocus=!0;window.hasFocus?a.system.hasFocus=window.hasFocus():document.hasFocus&&
(a.system.hasFocus=document.hasFocus());a.preLoadTimer=null;a.mousePos={x:-1,y:-1};a.init=function(b){a.console.log("Initalizing Rat...");a.system.load&&a.system.load();b=b||"canvas";a.detectPlatform();a.profiler.init();a.graphics.init(b);a.particle&&a.particle.init();a.audio&&a.audio.init();a.clipboard&&a.clipboard.init();window.requestAnimationFrame(a.system.cycle);a.input&&(a.input.init(),a.input.autoHandleEvents());a.console.registerCommand("showMemory",function(){a.system.debugDrawMemoryGraph=
!a.system.debugDrawMemoryGraph},["showMemory","memory"])};a.preLoadImages=function(b,c){a.postLoadFunction=c;a.graphics.preLoadImages(b);a.preLoadTimer=setInterval(a.processPreLoad,1E3/60)};a.processPreLoad=function(){a.graphics.isCacheLoaded()&&(a.console.log("rat preload done."),clearInterval(a.preLoadTimer),a.preLoadTimer=null,"undefined"!==typeof a.postLoadFunction&&a.postLoadFunction())};a.setDraw=function(b){a.draw=b};a.setPostUIDraw=function(b){a.postUIDraw=b};a.setUpdate=function(b){a.update=
b};a.system.lastCycleTime=0;a.system.cycle=function(){a.graphics.beginFrame();a.profiler.pushPerfMark("Rat.System.Cycle");window.requestAnimationFrame(a.system.cycle);a.profiler.pushPerfMark("updateDeltaTime");a.system.updateDeltaTime();a.profiler.popPerfMark("updateDeltaTime");a.update&&(a.profiler.pushPerfMark("GameUpdate"),a.update(a.deltaTime),a.profiler.popPerfMark("GameUpdate"));a.input&&(a.profiler.pushPerfMark("input.update"),a.input.update(a.deltaTime),a.profiler.popPerfMark("input.update"));
a.ui&&(a.profiler.pushPerfMark("ui.updateAnimators"),a.ui.updateAnimators(a.deltaTime),a.profiler.popPerfMark("ui.updateAnimators"));a.profiler.pushPerfMark("updateScreens");a.screenManager.updateScreens();a.profiler.popPerfMark("updateScreens");a.audio.update&&a.audio.update(a.deltaTime);a.cycleUpdate&&(a.profiler.pushPerfMark("cycleupdate"),a.cycleUpdate.updateAll(a.deltaTime),a.profiler.popPerfMark("cycleupdate"));a.timerUpdater&&(a.profiler.pushPerfMark("timerUpdate"),a.timerUpdater.updateAll(a.deltaTime),
a.profiler.popPerfMark("timerUpdate"));a.Rumble&&a.Rumble.supported&&a.Rumble.frameUpdate(a.deltaTime);var b=a.graphics.getContext();a.profiler.pushPerfMark("Rendering");a.graphics.save();a.graphics.setupMatrixForRendering();a.graphics.autoClearCanvas&&(a.profiler.pushPerfMark("Clearing Canvas"),a.graphics.clearCanvas(),a.profiler.popPerfMark("Clearing Canvas"));a.graphics.canvas.style&&(a.graphics.canvas.style.backgroundImage&&a.system.has.Wraith)&&a.graphics.canvas.style.backgroundImage.drawTiled(a.graphics.canvas.width,
a.graphics.canvas.height);a.beforeDraw&&(a.profiler.pushPerfMark("BEFORE draw"),a.beforeDraw(b),a.profiler.popPerfMark("BEFORE draw"));a.draw&&(a.profiler.pushPerfMark("rat.draw"),a.draw(b),a.profiler.popPerfMark("rat.draw"));a.screenManager&&(a.profiler.pushPerfMark("screen draw"),a.screenManager.drawScreens(),a.profiler.popPerfMark("screen draw"),a.postUIDraw&&(a.profiler.pushPerfMark("post UI draw"),a.postUIDraw(b),a.profiler.popPerfMark("post UI draw")));a.profiler.pushPerfMark("Debug Rendering");
a.console.drawConsole();a.system.debugDrawTiming&&a.system.drawDebugTiming();a.system.debugDrawStats&&a.system.drawDebugStats();a.system.debugDrawFramerateGraph&&a.system.drawDebugFramerateGraph();a.system.debugDrawMemoryGraph&&a.system.drawDebugMemoryGraph();a.system.debugDrawConsole&&a.console.drawLog();a.profiler&&a.profiler.displayStats&&(a.profiler.pushPerfMark("Profiler draw"),a.profiler.displayStats(),a.profiler.popPerfMark("Profiler draw"));a.profiler.popPerfMark("Debug Rendering");a.graphics.restore();
a.profiler.popPerfMark("Rendering");a.afterDraw&&(a.profiler.pushPerfMark("After Draw"),a.afterDraw(b),a.profiler.popPerfMark("After Draw"));a.profiler.popPerfMark("Rat.System.Cycle");a.graphics.endFrame()};a.deltaTimeRaw=1/60;a.deltaTimeRawSmoothed=a.deltaTimeRaw;a.deltaTimeMod=1;a.deltaTimeUnsmoothed=a.deltaTime;a.deltaTime=a.deltaTimeRaw;a.runningFpsUnsmoothed=1/a.deltaTimeUnsmoothed;a.runningFps=1/a.deltaTime;a.runningTime=0;var f=d(),g=[];a.SMOOTHING_SAMPLE_SIZE=25;var h=0,j=[],k=[],l=100;a.system.FPS_RECORD_SIZE=
l;var m=0,n,p=0;a.system.updateDeltaTime=function(){0>=a.deltaTimeMod&&(a.deltaTimeMod=1E-10);var b;a.system.has.Wraith?a.deltaTimeRaw=Wraith.getDeltaTime():(b=d(),a.deltaTimeRaw=b-f,f=b);a.paused&&(a.deltaTimeRaw=0);0.1<a.deltaTimeRaw&&!a.paused&&(a.deltaTimeRaw=0.1);a.deltaTimeUnsmoothed=a.deltaTimeRaw*a.deltaTimeMod;a.runningFpsUnsmoothed=1/a.deltaTimeUnsmoothed;b=0;g[h]=a.deltaTimeRaw;h=(h+1)%a.SMOOTHING_SAMPLE_SIZE;for(var c=g.length<a.SMOOTHING_SAMPLE_SIZE?g.length:a.SMOOTHING_SAMPLE_SIZE,e=
0;e!==c;++e)b+=g[e];a.deltaTimeRawSmoothed=b/c;a.deltaTime=a.deltaTimeRawSmoothed*a.deltaTimeMod;a.runningFps=1/a.deltaTime;j[m]=a.deltaTimeRaw;k[m]=a.deltaTimeRawSmoothed;m=(m+1)%l;a.runningTime+=a.deltaTimeRaw;if(void 0===n||2<(p+=a.deltaTimeRaw)||n<a.deltaTimeRaw)n=a.deltaTimeRaw,p=0};a.system.drawDebugTiming=function(){var b=a.math.floor(a.runningFps),c=a.math.floor(1E3*a.deltaTime)/1E3,e=a.graphics.getContext();e.fillStyle="#F08030";var d=a.math.floor(12/a.graphics.globalScale.x);e.font="bold "+
d+"px monospace";e.fillText("fps: "+b+"  DT: "+c,30,a.graphics.SCREEN_HEIGHT-d)};a.system.drawDebugStats=function(){var b=a.graphics.getContext();b.fillStyle="#F08030";var c=a.math.floor(12/a.graphics.globalScale.x);b.font="bold "+c+"px monospace";var e=a.graphics.SCREEN_HEIGHT-3*c;if(a.particle){var d=a.particle.getSystemCount(),f=a.particle.getAllEmitterCount(),g=a.particle.getAllParticleCount(),j=a.particle.State.cacheSize,h=a.particle.State.count;a.particle.stateCaching.enabled&&(b.fillText("   states(cached): "+
h+"("+j+")",30,e),e-=c);b.fillText("P: sys: "+d+"  em: "+f+"  p: "+g,30,e);e-=c}a.graphics&&(a.graphics.frameStats&&a.ui)&&(b.fillText("UI: elem: "+a.graphics.frameStats.totalElementsDrawn+", mcalls "+a.ui.mouseMoveCallCount+", ucalls "+a.ui.updateCallCount,30,e),e-=c);a.graphics&&(a.graphics.Image&&a.graphics.Image.perFrameDrawCount)&&(b.fillText("Images: "+a.graphics.Image.perFrameDrawCount,30,e),e-=c);if(a.xuijs){var d=0,k;for(k in a.xuijs.XuiElementsDrawnThisFrame)d+=a.xuijs.XuiElementsDrawnThisFrame[k],
b.fillText("   "+k+": "+a.xuijs.XuiElementsDrawnThisFrame[k]+(a.xuijs.XuiElementsSkippedThisFrame[k]?" (/"+a.xuijs.XuiElementsSkippedThisFrame[k]+")":""),30,e),e-=c;b.fillText("XUI Elem: "+d,30,e);a.xuijs.XuiElementsDrawnThisFrame={};a.xuijs.XuiElementsSkippedThisFrame={}}};a.system.drawDebugMemoryGraph=function(){a.system.debugMemoryGraphSettings||(a.system.debugMemoryGraphSettings={bounds:{},history:[]});var b=a.system.debugMemoryGraphSettings,c=a.graphics.getContext(),e=a.graphics.SCREEN_WIDTH,
d=a.graphics.SCREEN_HEIGHT;if(!b.bounds||!b.bounds.x)b.bounds={},b.bounds.w=e/4,b.bounds.h=d/8,b.bounds.x=0.9*e-b.bounds.w,b.bounds.y=0.95*d-2*b.bounds.h-16;e=b.bounds;c.save();c.fillStyle="white";c.translate(e.x,e.y);d=a.math.floor(12/a.graphics.globalScale.x);c.font="bold "+d+"px monospace";for(var f,g,d=0;3>d;++d)c.lineWidth=1,c.strokeStyle=["red","yellow","blue"][d],c.beginPath(),g=d/2*e.h,c.moveTo(0,g),c.lineTo(e.w,g),c.stroke();if(!window.performance||!window.performance.memory)c.textAlign=
"start",c.textBaseline="hanging",c.fillText("Memory unavailable.",0,e.h+1);else{var d=window.performance.memory.totalJSHeapSize||1,j=window.performance.memory.usedJSHeapSize||0;f=100*(j/d);b.history.push(j);b.history.length>a.system.FPS_RECORD_SIZE&&b.history.shift();c.textAlign="start";c.textBaseline="hanging";c.fillText("Memory: "+f.toFixed(2)+"% of "+(d/1024/1024).toFixed(2)+"MB",0,e.h+1);c.strokeStyle="green";c.save();c.beginPath();for(j=0;j<b.history.length&&j<a.system.FPS_RECORD_SIZE;++j)f=
j,b.history.length<a.system.FPS_RECORD_SIZE&&(f+=a.system.FPS_RECORD_SIZE-b.history.length),g=b.history[j],f=e.w*(f/(a.system.FPS_RECORD_SIZE-1)),g=e.h*(1-g/d),0==j?c.moveTo(f,g):c.lineTo(f,g);c.stroke();c.restore()}c.restore()};a.system.drawDebugFramerateGraph=function(){function b(a,e){c.beginPath();for(var d=0,j=0,h=a.length,k=f.bounds.w/(l-1),m=0;m!==h;++m)j=a[(m+e)%h],j=1/j/g,j=f.bounds.h-j*f.bounds.h,0===m?c.moveTo(d,j):c.lineTo(d,j),d+=k;c.stroke()}if(!(1>=j.length)){var c=a.graphics.getContext(),
e=a.graphics.SCREEN_WIDTH,d=a.graphics.SCREEN_HEIGHT,f=a.system.debugFramerateGraphSettings;if(!f||!f.bounds||!f.bounds.x)f={bounds:{}},f.bounds.w=e/4,f.bounds.h=d/8,f.bounds.x=0.9*e-f.bounds.w,f.bounds.y=0.95*d-f.bounds.h;c.translate(f.bounds.x,f.bounds.y);c.lineWidth=1;c.strokeStyle="#F02040";c.beginPath();c.moveTo(0,0);c.lineTo(f.bounds.w,0);c.stroke();c.beginPath();c.moveTo(0,f.bounds.h/2);c.lineTo(f.bounds.w,f.bounds.h/2);c.stroke();c.beginPath();c.moveTo(0,f.bounds.h);c.lineTo(f.bounds.w,f.bounds.h);
c.stroke();var g=120;c.lineWidth=2;var h;if(0<a.profiler.perfmarkers.length){c.save();for(var e=a.profiler.perfmarkers,d=a.graphics.frameIndex,p,q=0;q!==e.length;++q)p=e[q],h=1-(d-p.frame)/l,c.strokeStyle=p.color,c.beginPath(),h*=f.bounds.w,c.moveTo(h,0),c.lineTo(h,f.bounds.h),c.stroke();c.restore()}c.strokeStyle="#808000";b(j,m);c.strokeStyle="#8080FF";b(k,m);e=a.math.floor(12/a.graphics.globalScale.x);d=(100*a.runningFps|0)/100;q=(1E3*a.deltaTime|0)/1E3;h=1/n;c.fillStyle="#F0F0F0";c.font="bold "+
e+"px monospace";c.textBaseline="hanging";c.TextAlign="left";d=""+d.toFixed(2);q=""+q.toFixed(3);h=""+h.toFixed(2);d="     ".substr(0,5-d.length)+d;q="     ".substr(0,5-q.length)+q;c.fillText("fps: "+d+" (low "+h+")  DT: "+q,0,f.bounds.h);c.translate(-f.bounds.x,-f.bounds.y)}};a.dispatchCommand=function(b,c){if(a.screenManager)for(var e=a.screenManager.screenStack.length-1;0<=e;e--){var d=a.screenManager.screenStack[e];if("undefined"!==typeof d.handleCommand&&d.handleCommand(b,c))return}a.system.commandHandler&&
a.system.commandHandler(b,c)};a.addOSEventListener=function(a,b,c,e){if(a&&a.addEventListener)return a.addEventListener(b,c,!!e);if(a&&a.attachEvent)return a.attachEvent(b,c);if("undefined"!==typeof window&&window.addEventListener)return window.addEventListener(b,c,!!e)};a.removeOSEventListener=function(a,b,c,e){a.removeEventListener?a.removeEventListener(b,c,!!e):a.detachEvent?a.detachEvent(b,c):"undefined"!==typeof window&&window.removeEventListener&&window.removeEventListener(b,c,!!e)};a.addOSKeyEventListener=
function(b,c,e,d){a.addOSEventListener(b,c,function(b){a.input&&a.input.standardizeKeyEvent(b);e(b)},d)};var q=!1;if((q=a.detectPlatform.detected?a.system.has.winJS:!!window.Windows)&&window.WinJS)window.WinJS.Application.onerror=c,window.WinJS.Application.oncheckpoint=e,window.Windows.UI.WebUI.WebUIApplication.addEventListener("resuming",b,!1);var q=function(b){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};b=b||window.event;(b=b.type in
c?c[b.type]:this[r]?"hidden":"visible")&&(a.events&&a.events.fire)&&a.events.fire("visibility",b)},r="hidden";r in document?document.addEventListener("visibilitychange",q):(r="mozHidden")in document?document.addEventListener("mozvisibilitychange",q):(r="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",q):(r="msHidden")in document?document.addEventListener("msvisibilitychange",q):"onfocusin"in document?document.onfocusin=document.onfocusout=q:window.onpageshow=window.onpagehide=
window.onfocus=window.onblur=q;a.addOSEventListener(window,"focus",function(){a.system.hasFocus||(a.system.hasFocus=!0,a.events&&a.events.fire&&a.events.fire("focus"))});a.addOSEventListener(window,"blur",function(){a.system.hasFocus&&(a.system.hasFocus=!1,a.events&&a.events.fire&&a.events.fire("blur"))})});
rat.modules.add("rat.os.r_events",[],function(a){a.events=a.events||{};a.events.registered={};a.events.firing={};a.events.queued=a.events.queued||{};a.addEventListener=function(d,c,b){c&&(a.events.registered[d]=a.events.registered[d]||[],a.events.registered[d].push({func:c,ctx:b}),a.events.queued[d]&&(a.events.fire.apply(a.events,a.events.queued[d]),a.events.queued[d]=void 0))};a.removeEventListener=function(d,c,b){if(!c)return!1;var e=a.events.registered[d];if(!e)return!1;d=a.events.firing[d];for(var f,
g=0;g!==e.length;++g)if(f=e[g],f.func===c&&f.ctx===b)return d&&(d.index<=g&&--d.index,--d.stopAt),e.splice(g,1),!0;return!1};a.events.queueEvent=function(d){var c=Array.prototype.slice.call(arguments),b=a.events.registered[d];b&&b.length?a.events.fire.apply(a.events,c):a.events.queued[d]=c};a.events.fire=function(d){var c=a.events.registered[d];if(!c||0===c.length)return!1;var b=Array.prototype.slice.call(arguments,1),e=a.events.firing[d];a.events.firing[d]={index:0,stopAt:c.length};for(var f=a.events.firing[d],
g,h;f.index!==f.stopAt;++f.index)g=c[f.index],h=g.func,g=g.ctx,h.apply(g,b);a.events.firing[d]=e}});
rat.modules.add("rat.debug.r_console",["rat.os.r_system","rat.math.r_math","rat.graphics.r_graphics","rat.utils.r_utils","rat.input.r_input"],function(a){function d(c,e,d){b.currentCommand=c;b.cursorPos=a.math.min(a.math.max(0,b.cursorPos),b.currentCommand.length);e&&(b.commandHistoryIndex=-1);d&&(b.autoComplete=[],b.accessingAutoComplete=-1)}function c(b){return a.utils.get(this,b)}a.console.config={bounds:{x:0,y:0,w:{fromParent:!0,val:0},h:{percent:!0,val:0.5}},textColor:"#90B090",textSize:12,logLineHeight:14,
bgColor:"rgba(0,0,0,0.5)"};a.console.configChanged={};a.console.state={consoleAllowed:!1,consoleActive:!1,cursorPos:0,pulseTimer:0,currentCommand:"",nextCommandID:0,commandList:[],commandHistory:[],commandHistoryIndex:-1,commandHistoryMax:100,autoComplete:[],accessingAutoComplete:-1,logOffset:0,consoleKey:"/"};var b=a.console.state,e=a.system.getLocalStorage();if(e){var f=e.getItem("rat_commandHistory");f&&(a.console.state.commandHistory=JSON.parse(f));if(e=e.getItem("rat_consoleConfig")){var e=JSON.parse(e),
g;for(g in e)a.console.config[g]&&(a.console.config[g]=e[g],a.console.configChanged[g]=!0)}}a.console.writeConfig=function(b){Array.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++)a.console.configChanged[b[c]]=!0;if(a.system.localStorageObject){b={};for(var e in a.console.configChanged)b[e]=a.console.config[e];a.system.localStorageObject.setItem("rat_consoleConfig",JSON.stringify(b))}};a.console.clearConfig=function(){a.system.localStorageObject&&a.system.localStorageObject.removeItem("rat_consoleConfig");
a.console.configChanged={}};a.console.setBounds=function(b,c,e,d){a.console.config.bounds.x=b;a.console.config.bounds.y=c;a.console.config.bounds.w=e;a.console.config.bounds.h=d};a.console.setTextSize=function(b,c){a.console.config.textSize=b;c||(c=Math.floor(1.1*b));a.console.config.logLineHeight=c};a.console.allow=function(b){void 0===b&&(b=!0);a.console.state.consoleAllowed=!!b};a.console.activate=function(b){void 0===b&&(b=!0);a.console.state.consoleActive=!!b};a.console.logOnce=function(b,c,
e){c||(c=b);e||(e=1);a.console.onceRecord[c]||(a.console.onceRecord[c]=0);a.console.onceRecord[c]++;a.console.onceRecord[c]<=e&&a.console.log(b)};a.console.drawConsole=function(){if(a.console.state.consoleAllowed&&a.console.state.consoleActive){var c=a.console.config.bounds;a.ui&&(a.ui.data&&a.ui.data.calcBounds)&&(c=a.ui.data.calcBounds({bounds:c},{x:0,y:0,w:a.graphics.SCREEN_WIDTH,h:a.graphics.SCREEN_HEIGHT}));a.graphics.drawRect(c,{fill:!0,color:a.console.config.bgColor});a.graphics.drawRect(c,
{color:a.console.config.bgColor,lineWidth:2});var e=a.utils.copyObject(c);e.h-=a.console.config.logLineHeight+10;a.console.drawLog(e);e.y=e.h;e.h=c.h-e.h;a.graphics.drawRect(e,{color:a.console.config.bgColor,lineWidth:2});e.x+=4;e.y+=4;var c=a.runningTime||0,d=c/60/60|0,c=c-3600*d,f=c/60|0,c=""+d+":"+f+":"+(c-60*f|0),d=a.graphics.ctx.measureText(c);void 0!==d.width&&(d=d.width);a.graphics.drawText(c,e.x+e.w-d-8,e.y);a.graphics.drawText("> "+b.currentCommand,e.x,e.y);b.pulseTimer+=a.deltaTime;0.6<
b.pulseTimer&&(b.pulseTimer=0);0.3>b.pulseTimer&&(c=b.currentCommand.slice(0,b.cursorPos),d=a.graphics.ctx.measureText("> "+c),d=d.width||d,e.x+=d,a.graphics.ctx.fillStyle="white",a.graphics.ctx.font=" bold"+a.graphics.ctx.font,a.graphics.drawText("|",e.x,e.y))}};a.console.drawLog=function(b){b=b||a.console.config.bounds;var c=a.console.output,e=a.graphics.ctx,d=a.console.config.logLineHeight,f=b.x,g=b.y,p=b.w,q=b.h;0>p&&(p=a.graphics.SCREEN_WIDTH-f-10);0>q&&(q=a.graphics.SCREEN_HEIGHT-g-10);e.font=
""+a.console.config.textSize+"px Arial";e.textAlign="left";e.fillStyle=a.console.config.textColor;b=q-0-d*c.length;q+=g;b+=(a.console.state.logOffset-1)*d;e.textBaseline="top";for(var r=0;r<c.length&&!(b+d>g&&e.fillText(c[r],f,b,p),b+=d,b+d>=q&&0<a.console.state.logOffset&&(e.fillText("...",f,b,p),b+=d),b>=q);r++);};a.console.handleEvent=function(e){if("keydown"!==e.eventType&&"keypress"!==e.eventType)return!1;if("keydown"===e.eventType){if(e.which===a.keys.f12)return!1;if(e.which===a.keys[b.consoleKey]&&
!e.sysEvent.altKey&&!e.sysEvent.ctrlKey&&!e.sysEvent.shiftKey||e.which===a.keys.esc&&a.console.state.consoleActive)return a.console.state.consoleActive=!a.console.state.consoleActive,!0;if(a.console.state.consoleActive)e.allowBrowserDefault=!0;else return!1;if(e.which===a.keys.enter)e.sysEvent.preventDefault(),b.currentCommand=b.currentCommand.trim(),b.currentCommand&&b.commandHistory[b.commandHistory.length]!==b.currentCommand&&(b.commandHistory.unshift(b.currentCommand),b.commandHistory.length>
b.commandHistoryMax&&b.commandHistory.pop(),a.system.localStorageObject&&a.system.localStorageObject.setItem("rat_commandHistory",JSON.stringify(b.commandHistory))),b.currentCommand&&a.console.parseCommand(b.currentCommand.trim()),d("",!0,!0);else if(e.which===a.keys.backspace)e.sysEvent.preventDefault(),0<b.cursorPos&&(--b.cursorPos,d(b.currentCommand.slice(0,b.cursorPos)+b.currentCommand.slice(b.cursorPos+1),!1,!0));else if(e.which===a.keys.del)e.sysEvent.preventDefault(),b.cursorPos<b.currentCommand.length&&
d(b.currentCommand.slice(0,b.cursorPos)+b.currentCommand.slice(b.cursorPos+1),!1,!0);else if(e.sysEvent.shiftKey&&(e.which===a.keys.upArrow||e.which===a.keys.downArrow)){var f=a.console.config.textSize;e.which===a.keys.upArrow?f+=2:e.which===a.keys.downArrow&&(f-=2,4>f&&(f=4));a.console.setTextSize(f);a.console.writeConfig(["textSize","logLineHeight"])}else if(e.which===a.keys.upArrow||e.which===a.keys.downArrow)e.sysEvent.preventDefault(),d(b.currentCommand.trim(),!1,!1),e.which===a.keys.upArrow?
++b.commandHistoryIndex:--b.commandHistoryIndex,-1>b.commandHistoryIndex?b.commandHistoryIndex=-1:0===b.commandHistoryIndex&&0===b.commandHistory.length?d("",!0,!0):b.commandHistoryIndex>=b.commandHistory.length?(b.commandHistoryIndex=b.commandHistory.length-1,d(b.commandHistory[b.commandHistoryIndex],!1,!1)):-1===b.commandHistoryIndex?d("",!1,!1):(d(b.commandHistory[b.commandHistoryIndex],!1,!0),b.cursorPos=b.currentCommand.length);else if(e.which===a.keys.leftArrow||e.which===a.keys.rightArrow)e.sysEvent.preventDefault(),
e.which===a.keys.leftArrow?--b.cursorPos:++b.cursorPos,b.cursorPos=a.math.max(0,b.cursorPos),b.cursorPos=a.math.min(b.cursorPos,b.currentCommand.length);else if(e.which===a.keys.home)e.sysEvent.preventDefault(),b.cursorPos=0;else if(e.which===a.keys.end)e.sysEvent.preventDefault(),b.cursorPos=b.currentCommand.length;else if(e.which===a.keys.tab){e.sysEvent.preventDefault();if(-1===b.accessingAutoComplete){d(b.currentCommand.trim(),!1,!1);e=b.currentCommand;b.autoComplete=[];for(var g=e.toUpperCase(),
l=b.commandList.length,m=0;m!==l;++m){var n=b.commandList[m];if(n.name.slice(0,g.length)===g)b.autoComplete.push(n.name);else for(var p=n.alias.length,q=0;q!==p;++q)n.alias[q].slice(0,g.length)===g&&b.autoComplete.push(n.alias[q])}if(0>=b.autoComplete.length&&(l=e.lastIndexOf("."),1<l&&(g=e.substring(0,l),e=e.substring(l+1),l=c(g),void 0!==l)))for(f in l)f&&!(e&&f.substring(0,e.length)!==e)&&b.autoComplete.push(g+"."+f);b.autoComplete.sort();b.accessingAutoComplete=0}0<b.autoComplete.length&&(d(b.autoComplete[b.accessingAutoComplete],
!0,!1),b.cursorPos=b.currentCommand.length,a.input.keyboard.isKeyDown(a.keys.shift)?(b.accessingAutoComplete--,0>b.accessingAutoComplete&&(b.accessingAutoComplete=b.autoComplete.length-1)):(b.accessingAutoComplete++,b.accessingAutoComplete>=b.autoComplete.length&&(b.accessingAutoComplete=0)))}else if(e.which===a.keys.pageUp||e.which===a.keys.pageDown)e.sysEvent.preventDefault(),e.which===a.keys.pageUp?++a.console.state.logOffset:--a.console.state.logOffset,a.console.state.logOffset>=a.console.output.length&&
(a.console.state.logOffset=a.console.output.length-1),0>a.console.state.logOffset&&(a.console.state.logOffset=0)}else if("keypress"===e.eventType){if(!a.console.state.consoleActive)return!1;f=e.sysEvent.char;if(32>f.charCodeAt(0))return!1;b.consoleActive&&("\n"!==f&&"\t"!==f&&f!==b.consoleKey)&&(b.currentCommand=b.cursorPos===b.currentCommand.length?b.currentCommand+f:0===b.cursorPos?f+b.currentCommand:b.currentCommand.slice(0,b.cursorPos)+f+b.currentCommand.slice(b.cursorPos),b.cursorPos++,b.autoComplete=
[],b.accessingAutoComplete=-1)}return!0};a.console.registerCommand=function(a,c,e){var d={};d.name=a.toUpperCase();d.func=c;d.id=b.nextCommandID++;d.alias=e||[];a=d.alias.length;for(c=0;c<a;c++)d.alias[c]=d.alias[c].toUpperCase();b.commandList.push(d);return d.id};a.console.unregisterCommand=function(a){for(var c=b.commandList.length,e=0;e<c;e++)if(b.commandList[e].id===a)return b.commandList.splice(e,1),!0;return!1};a.console.getCommand=function(a){a=a.toUpperCase();for(var c=b.commandList.length,
e=0;e!==c;++e){var d=b.commandList[e];if(d.name===a)return d;for(var f=0;f!==d.alias.length;++f)if(d.alias[f]===a)return d}};a.console.parseCommand=function(b){var e=b,d=b.split(/\s/);b=d[0];d.splice(0,1);var f=a.console.getCommand(b);if(f)f.func(b,d);else if(b=c(e),d=e+"=",void 0!==b){switch(typeof b){case "object":if(null===b)d+="NULL";else{a.console.log(d+"OBJECT:");var d=void 0,e=0,f=[],g;for(g in b)"parentClass"!==g&&("parentConstructor"!==g&&"parent"!==g&&"parentPrototype"!==g&&"constructor"!==
g)&&(f.push(g),g.length>e&&(e=g.length));f.sort();for(var n=0;n<f.length;++n){g=f[n];for(var p=typeof b[g];g.length<e;)g+=" ";a.console.log(g+"="+p)}}break;case "boolean":d+=b.toString();break;case "number":d+=b.toString();break;case "string":d+=b.toString();break;case "function":d+="function"}d&&a.console.log(d)}else try{a.console.log(e),eval(e)}catch(q){a.console.log("ERROR: Execution of JS Failed: "+q.description)}return!0};a.console.listCommands=function(){for(var c=b.commandList.length,e=0;e!==
c;++e){var d=b.commandList[e],f="    "+d.name;if(d.alias.length){for(var f=f+"  (",g=0;g!==d.alias.length;++g)f+=d.alias[g]+" ";f+=")"}a.console.log(f)}};a.console.registerCommand("help",function(){a.console.log("-------------------------------------");a.console.log("rat console help:");a.console.log("* up/down arrows navigate command history");a.console.log("* shift up/down arrows change font size");a.console.log("* commands:");a.console.listCommands()},["?"]);a.console.registerCommand("log",function(b,
c){a.console.log(c.join(" "))});a.console.registerCommand("saveLog",function(){a.console.saveOutputToLocalStorage=!a.console.saveOutputToLocalStorage;a.console.log("Log will "+(a.console.saveOutputToLocalStorage?"":" not ")+" save.")});a.console.registerCommand("restoreLog",function(){if(a.system.localStorageObject){var b=JSON.parse(a.system.localStorageObject.getItem("RAT_LOG"));b&&Array.isArray(b)?(a.console.output=b,a.console.log("Log restored")):a.console.log("Failed to restore log")}else a.console.log("ERROR! localStorage not supported")});
a.console.registerCommand("clear",function(){a.console.output=[]},["cls","clearLog"]);a.console.registerCommand("Alias",function(b,c){var e=c[0];if(e){c.splice(0,1);a.console.registerCommand(e,function(b,c){var e=a.console.getCommand(b);a.console.parseCommand(e.aliasedTo+" "+c.join(" "))});var d=a.console.getCommand(e);d.aliasedTo=c.join(" ");a.console.log("Added alias "+e+"="+d.aliasedTo)}});a.console.registerCommand("frames",function(){a.dframe()},["showFrames","dframe"]);a.console.registerCommand("dtree",
function(){a.dtree()},["dumpTree"]);a.console.registerCommand("showFPSGraph",function(){var b=a.system.debugDrawFramerateGraph;a.system.debugDrawFramerateGraph=!b;a.system.debugDrawTiming=!b},["showFPS","fps"]);a.console.registerCommand("showStats",function(){a.system.debugDrawStats=!a.system.debugDrawStats},["stats"]);a.dframe=function(){if(a.screenManager){var b=a.screenManager.getTopScreen();b&&b.frameAllRandom()}};a.dtree=function(){if(a.screenManager){var b=a.screenManager.getTopScreen();if(b){for(var b=
b.dumpTree(),c=0;c<b.lines.length;c++)a.console.log(b.lines[c]);a.console.log("total:"+b.totalCount+" (vis: "+(b.totalCount-b.hiddenCount)+", hid: "+b.hiddenCount+")")}else a.console.log("no top screen in stack to dump.")}}});
rat.modules.add("rat.debug.r_profiler",["rat.debug.r_console","rat.os.r_system","rat.graphics.r_graphics","rat.input.r_input"],function(a){function d(){}function c(a,b){this._stats={name:a,parent:b,time:0,lastTick:void 0,calls:0,hasChildren:!1};this._children={}}function b(b){a.profiler.curNode._stats.abortProfilerForFrame||(a.profiler.curNode=a.profiler.curNode.getChild(b),a.profiler.curNode.storeTick(),++a.profiler.curNode._stats.calls)}function e(b){a.profiler.curNode._stats.abortProfilerForFrame||
(a.profiler.curNode._stats.name!==b||void 0===a.profiler.curNode._stats.parent?(a.console.log("ERROR!  profiler.push does not match profiler.pop"),a.profiler.curNode=a.profiler.profileTrees[0],a.profiler.curNode._stats.abortProfilerForFrame=!0):(a.profiler.curNode.updateElapsed(),a.profiler.curNode=a.profiler.curNode._stats.parent))}function f(b,c,e){e=e||0;c=c||0;for(var d=a.graphics.ctx;e--;)b=a.profiler.displayInfo.tab+b;c>=a.profiler.displayInfo.cols.length&&(c=a.profiler.displayInfo.cols.length-
1);d.fillText(b,a.profiler.displayInfo.atX+a.profiler.displayInfo.cols[c],a.profiler.displayInfo.curY)}function g(){a.profiler.displayInfo.curY+=a.profiler.displayInfo.lineHeight}function h(a,b){return(100*(a/b)).toFixed(2)+"%"}function j(b){for(var c=1;c<a.profiler.selectedNode.length;++c)b=b.getChild(a.profiler.selectedNode[c]);return b}function k(){if(a.profiler.enableStatsDisplay){var b=a.graphics.ctx;if(b){b.save();b.font=a.profiler.displayInfo.font;b.fillStyle=a.profiler.displayInfo.color;a.profiler.displayInfo.curY=
a.profiler.displayInfo.atY;var c=a.profiler.profileTrees[1];if(c._stats.abortProfilerForFrame)f("***ERROR WITH PROFILER USAGE***",0);else if(c._stats.built){var e=j(c),d=e._stats.parent,k=0;f("NAME",0,2);f("% Parent",1,2);f("% Total",2,2);f("MS Total",3,2);f("MS/call",4,2);f("calls",5,2);g();d?(f("-"+e._stats.name,0),f(h(e._stats.time,d._stats.time),1)):f(" "+e._stats.name,0);f(h(e._stats.time,c._stats.time),2);f(e._stats.time.toFixed(4),3);e._stats.calls&&(f((e._stats.time/e._stats.calls).toFixed(4),
4),f(e._stats.calls,5));g();for(var l in e._children){a.profiler.highlightedNode||(a.profiler.highlightedNode=l);d=e._children[l];l===a.profiler.highlightedNode&&(b.fillStyle=a.profiler.displayInfo.highlightColor);var m=" ";d._stats.hasChildren&&(m="+");f(m+d._stats.name,0,1);f(h(d._stats.time,e._stats.time),1);f(h(d._stats.time,c._stats.time),2);f(d._stats.time.toFixed(4),3);e._stats.calls&&(f((d._stats.time/d._stats.calls).toFixed(4),4),f(d._stats.calls,5));g();l===a.profiler.highlightedNode&&(b.fillStyle=
a.profiler.displayInfo.color);k+=d._stats.time}g();f(" MISSING TIME",0,1);k=e._stats.time-k;f(h(k,e._stats.time),1);f(h(k,c._stats.time),2);f(k.toFixed(4),3)}else f("***STATS PENDING***",0);b.restore()}}}function l(b){var c;if("keydown"===b.eventType){if(a.profiler.enableStatsDisplay){if(b.which===a.keys.j)return 1<a.profiler.selectedNode.length&&(a.profiler.highlightedNode=a.profiler.selectedNode.splice(a.profiler.selectedNode.length-1,1)[0]),!0;if(b.which===a.keys.l)return b=j(a.profiler.profileTrees[1]),
b._children[a.profiler.highlightedNode]&&b._children[a.profiler.highlightedNode]._stats.hasChildren&&(a.profiler.selectedNode.push(a.profiler.highlightedNode),a.profiler.highlightedNode=void 0),!0;if(b.which===a.keys.i){b=j(a.profiler.profileTrees[1]);var e="";for(c in b._children){if(c===a.profiler.highlightedNode){a.profiler.highlightedNode=e;break}e=c}return!0}if(b.which===a.keys.k){e=!1;b=j(a.profiler.profileTrees[1]);for(c in b._children)if(c===a.profiler.highlightedNode)e=!0;else if(e){a.profiler.highlightedNode=
c;break}return!0}}if(b.which===a.keys.p)return a.profiler.enableStatsDisplay=!a.profiler.enableStatsDisplay,!0}return!1}a.profiler={enableProfiler:!1,usingRatProfiler:!1,profileTrees:[void 0,void 0],curNode:void 0,enableStatsDisplay:!1,selectedNode:["ROOT"],displayInfo:{atX:64,atY:64,lineHeight:22,tab:"  ",font:"12px arial",color:void 0,highlightColor:void 0,shadowColor:"black",curY:0,cols:[0,150,225,300,375,450]},highlightedNode:void 0,perfmarkers:[]};var m=a.profiler.perfmarkers,n={last:void 0,
name:void 0};c.prototype.getChild=function(a){this._children[a]||(this._children[a]=new c(a,this),this._stats.hasChildren=!0);return this._children[a]};c.prototype.clear=function(){this._stats.time=0;this._stats.calls=0;for(var a in this._children)this._children[a].clear()};c.prototype.getTick=function(){return a.profiler.usingRatProfiler?window.performance.now():0};c.prototype.storeTick=function(){this._stats.lastTick=this.getTick()};c.prototype.updateElapsed=function(){this._stats.time+=(this.getTick()-
this._stats.lastTick)/1E3;this._stats.lastTick=void 0};a.profiler.addPerfMarker=function(b,c){a.system.debugDrawFramerateGraph&&a.graphics&&a.graphics&&m.unshift({name:b,color:c.toString(),frame:a.graphics.frameIndex})};a.profiler.init=function(){var f=a.profiler;if(a.profiler.enableProfiler)if(a.system.has.Wraith)a.console.log("Using Wraith Profiler"),f.pushPerfMark=Wraith.PushPerfMark,f.popPerfMark=Wraith.PopPerfMark;else if(window.performance&&window.performance.now){a.console.log("Using RAT Profiler");
f.pushPerfMark=b;f.popPerfMark=e;var g=f.beginFrame,j=f.endFrame;f.beginFrame=function(){g()};f.endFrame=function(){j();a.profiler.curNode.parent&&(a.console.log("ERROR!  profiler.push does not match profiler.pop"),a.profiler.curNode=a.profiler.profileTrees[0],a.profiler.curNode._stats.abortProfilerForFrame=!0);a.profiler.curNode._stats.abortProfilerForFrame||void 0!==a.profiler.curNode._stats.lastTick&&a.profiler.curNode.updateElapsed();var b=a.profiler.profileTrees[0];a.profiler.profileTrees[0]=
a.profiler.profileTrees[1];a.profiler.profileTrees[1]=b;a.profiler.curNode=a.profiler.profileTrees[0];a.profiler.curNode.clear();a.profiler.curNode.storeTick();++a.profiler.curNode._stats.calls;a.profiler.curNode._stats.abortProfilerForFrame=!1;b._stats.built=!0};f.displayStats=k;for(f=0;f<a.profiler.profileTrees.length;++f)a.profiler.profileTrees[f]=new c("ROOT",void 0);a.profiler.curNode=a.profiler.profileTrees[0];a.profiler.displayInfo.color=a.profiler.displayInfo.color||a.graphics.white;a.profiler.displayInfo.highlightColor=
a.profiler.displayInfo.highlightColor||a.graphics.yellow;a.input.registerEventHandler(l);a.profiler.usingRatProfiler=!0}else a.console.log("No Profiler"),f.pushPerfMark=d,f.popPerfMark=d;else f.pushPerfMark=d,f.popPerfMark=d};a.profiler.beginFrame=function(){if(a.system.debugDrawFramerateGraph&&a.graphics&&m.length){for(var b=a.graphics.frameIndex-a.system.FPS_RECORD_SIZE,c=m.length,e=m.length-1;0<=e;--e)if(m[e].frame<b)c=e;else break;c<m.length&&m.splice(c)}};a.profiler.endFrame=function(){};a.profiler.push=
function(b){n={name:b,last:n};a.profiler.pushPerfMark(b)};a.profiler.pop=function(){var b=n.name;n=n.last;a.profiler.popPerfMark(b)};a.profiler.perf=function(b,c,e){a.profiler.pushPerfMark(b);c=e?c.call(e):c();a.profiler.popPerfMark(b);return c}});
rat.modules.add("rat.utils.r_utils",[{name:"rat.math.r_math",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.os.r_user",{name:"rat.utils.r_utils_test",platform:"unitTest"}],function(a){function d(){}a.utils.inheritClassFrom=function(c,b){if(void 0===b){a.console.log("Error inheriting from undefined...");var e=c.toString(),e=e.substring(0,1E3);a.console.log(e)}d.prototype=b.prototype;c.prototype=new d;c.prototype.constructor=c;c.prototype.parentClass=b;c.prototype.parentConstructor=
b;c.prototype.parent=b.prototype;c.prototype.parentPrototype=b.prototype;return c};a.utils.extendClassWith=function(c,b){a.utils.extendObject(c.prototype,[b.prototype],!0)};a.utils.loadXMLDoc=function(c){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a.system.fixPath(c),!1);b.send();return b.responseXML};a.utils.loadJSONObject=function(c){var b={},b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a.system.fixPath(c),
!1);b.send();return b=JSON.parse(b.responseText)};a.utils.loadJSONObjectAsync=function(c,b){var e;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onload=function(){if(4===e.readyState&&(200===e.status||0===e.status&&""===e.statusText)){var d=JSON.parse(e.responseText);b(!0,d)}else a.console.log("error loading "+c+" : "+e.statusText),b(!1,null)};e.open("GET",a.system.fixPath(c),!0);e.send()};a.utils.loadCSS=function(a,b){if(!document.getElementById(b)){var e=document.createElement("link");
e.setAttribute("id",b);e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",a);e.setAttribute("media","all");document.getElementsByTagName("head")[0].appendChild(e)}};a.utils.unloadCSS=function(a){(a=document.getElementById(a))&&a.parentNode.removeChild(a)};a.utils.isCSSLoaded=function(a){return!!document.getElementById(a)};a.utils.copyObject=function(c,b){if("object"!==typeof c||null===c)return c;b=b||!1;var e;e=Array.isArray(c)?[]:{};var d,g;for(g in c)d=c[g],
void 0!==d&&c.hasOwnProperty(g)&&(e[g]=b&&"object"===typeof d?a.utils.copyObject(d,!0):d);return e};a.utils.deepCopy=function(c){return a.utils.copyObject(c,!0)};a.utils.extendObject=function(c,b,e){e=e||!1;!1===Array.isArray(b)&&(b=[b]);for(var d,g,h=0,j=b.length;h!==j;++h)if(g=b[h],void 0!==g&&g!==c)if(void 0===c||null===c)c=a.utils.copyObject(g,e);else for(var k in g)d=g[k],void 0!==d&&(void 0===c[k]?c[k]="object"===typeof d&&e?a.utils.copyObject(d,!0):d:"object"===typeof c[k]&&"object"===typeof d&&
a.utils.extendObject(c[k],[d],e));return c};a.utils.deepSet=function(c,b,e){if(!("object"!==typeof c||null===c))for(var d in c)c.hasOwnProperty(d)&&("object"===typeof c[d]?a.utils.deepSet(c[d],b,e):d===b&&(c[d]=e))};a.utils.searchArrayFor=function(a,b){for(var e=0;e<a.length;++e)if(b(a[e]))return e;return-1};a.utils.addProp=function(c,b,e,d,g){g=a.utils.extendObject(g||{},{enumerable:!0,configurable:!1});e&&(g.set=e);d&&(g.get=d);Object.defineProperty(c||{},b,g);return c};a.utils.objectToString=function(c,
b,e,d){function g(){for(var a=0;a<d;a++)e+="\t"}function h(b,c){if("undefined"!==typeof b)if(g(),""!==c&&(e+=""+c+" : "),Array.isArray(b)){e+="[\n";d++;for(var j=0;j<b.length;j++)h(b[j],"");d--;g();e+="],\n"}else null===b?e+="null,\n":"function"===typeof b?e+="/*function*/,\n":"object"===typeof b?(e+="{\n",e=a.utils.objectToString(b,"",e,d),g(),e+="},\n"):e="string"===typeof b?e+("'"+b.toString()+"',\n"):"undefined"===typeof b?e+"x_x_undefined,\n":e+(b.toString()+",\n")}"undefined"===typeof e&&(e=
"");d||(d=0);""!==b&&(g(),e+=b+" = {\n");d++;for(var j in c)c.hasOwnProperty(j)&&h(c[j],j);d--;""!==b&&(g(),e+="};\n");return e};a.utils.get=function(a,b){b=b.split(".");for(var e=0,d=b.length;e<d-1;e++)if(a=a[b[e]],"undefined"===typeof a)return a;return a[b[d-1]]};a.utils.set=function(a,b,e){b=b.split(".");for(var d=0,g=b.length;d<g-1;d++){var h=a[b[d]];if("undefined"===typeof h||null===h)h=a[b[d]]={};a=h}a[b[g-1]]=e};a.utils.interpolate=function(a,b,e){return b*e+(1-e)*a};a.utils.interpolateClamped=
function(a,b,e){0>e&&(e=0);1<e&&(e=1);return b*e+(1-e)*a};a.utils.interpolatePos=function(a,b,e){return{x:b.x*e+(1-e)*a.x,y:b.y*e+(1-e)*a.y}};a.utils.limit=function(a,b,e){return a<b?b:a>e?e:a};a.utils.randomizeList=function(a,b){b||(b=Math);for(var e=0;e<a.length;e++){var d=Math.floor(b.random()*a.length),g=a[e];a[e]=a[d];a[d]=g}return a};a.utils.randomInList=function(a,b){if(void 0===b){var e=Math.floor(Math.random()*a.length);return a[e]}!1===Array.isArray(b)&&(b=[b]);b.sort(function(a,b){return b-
a});for(var e=a.length-b.length,e=Math.floor(Math.random()*e),d=0;d!==b.length;++d)b[d]<=e&&++e;return a[e]};a.utils.randomInRange=function(a,b){return Math.random()*(b-a)+a};a.utils.randomIntInRange=function(a,b){return Math.round(Math.random()*(b-a))+a};a.utils.makeID=function(a){for(var b="",e=0;e<a;e++)b+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(62*Math.random()));return b};a.utils.encodeID=function(a){var b="";do{var e=a%62;a=a/62|0;b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(e)+
b}while(a);return b};a.utils.getWindowSize=function(){var a=window,b=document,e=b.documentElement;!e&&b.getDocumentElement&&(e=b.getDocumentElement());var d={};b.getElementsByTagName&&(d=b.getElementsByTagName("body")[0]);b=a.innerWidth||e.clientWidth||d.clientWidth;a=a.innerHeight||e.clientHeight||d.clientHeight;return{x:b,y:a,w:b,h:a}};a.utils.loadScripts=function(c,b,e){b||(b=void 0);Array.isArray(c)||(c=[c]);var d=!0;e&&void 0!==e.async&&(d=e.async||!1);var g=e=a.utils.scripts.length,h;for(h=
0;h<c.length;h++)0<=a.utils.scriptIndex(c[h])?a.console.log("warning:  already loaded script "+c[h]):a.utils.scripts[g++]={filename:c[h],state:"none",type:"script",clientCallback:b};for(h=e;h<g;h++)a.utils.loadScriptWithCallback(a.utils.scripts[h].filename,d,a.utils.dynamicLoadCompleteCallback)};a.utils.scripts=[];a.utils.scriptsLoadedCount=0;a.utils.loadJSON=function(c,b){a.utils.getResource(c,function(a){a=a?JSON.parse(a):{};b(a)},"json")};a.utils.loadXML=function(c,b){a.utils.getResource(c,b,"xml")};
a.utils.getResource=function(c,b,e){a.utils.scripts[a.utils.scripts.length]={filename:c,state:"none",type:e};var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(a.utils.dynamicLoadCompleteCallback(c),b(d.responseText))};d.open("GET",a.system.fixPath(c),!0);try{d.send()}catch(g){}};a.utils.scriptIndex=function(c){for(var b=0;b<a.utils.scripts.length;b++)if(a.utils.scripts[b].filename===c)return b;return-1};a.utils.dynamicLoadCompleteCallback=function(c){var b=a.utils.scriptIndex(c);
0<=b&&(b=a.utils.scripts[b],"done"!==b.state&&(b.state="done",a.utils.scriptsLoadedCount++,b.clientCallback&&b.clientCallback(c)))};a.utils.allScriptsAreLoaded=function(){return a.utils.scriptsLoadedCount===a.utils.scripts.length?!0:!1};a.utils.launchSystemHelpUI=function(c){a.system.has.xbox&&(a.console.log("Launching system help ui for the Xbox"),(c=a.user.getUser(c))&&window.Windows.Xbox.ApplicationModel.Help.show(c.rawData))};a.utils.stripPath=function(a){var b=a.lastIndexOf("/"),e=a.lastIndexOf("\\");
e>b&&(b=e);return 0>b?a:a.substring(b+1)};a.utils.getPath=function(a,b){void 0===b&&(b=!0);var e=a.lastIndexOf("/"),d=a.lastIndexOf("\\");d>e&&(e=d);if(0>e)return"";b&&e++;return a.substring(0,e)};a.utils.cleanPath=function(a){var b;do{b=!1;var e=a.indexOf("/../");if(0<e){b=a.substring(0,e);if("."===b.charAt(0))break;var d=b.lastIndexOf("/");d++;a=b.substring(0,d)+a.substring(e+4);b=!0}}while(b);return a};a.utils.secondsToText=function(a){var b=a/60|0;a=a-60*b|0;return""+b+":"+(10>a?"0"+a:a)};a.utils.dateToTimeText=
function(a,b,e){var d=a.getHours(),g=a.getMinutes();a=a.getSeconds();var h="";b||(12<=d?(d-=12,h=" pm"):h=" am");b=10>d?"0"+d:""+d;b=10>g?b+(":0"+g):b+(":"+g);e&&(b=10>a?b+(":0"+a):b+(":"+a));return b+h}});
rat.modules.add("rat.math.r_math",[],function(a){a.math={};a.math.PI=Math.PI;a.math.PI2=2*Math.PI;a.math.TAU=2*Math.PI;a.math.HALFPI=Math.PI/2;a.math.E=Math.E;a.math.MAX_NUMBER=Number.MAX_VALUE;a.math.MIN_NUMBER=Number.MIN_VALUE;a.math.DegreesToRadians=a.math.PI/180;a.math.RadiansToDegrees=180/a.math.PI;a.math.abs=Math.abs;a.math.min=Math.min;a.math.max=Math.max;a.math.ceil=Math.ceil;a.math.floor=Math.floor;a.math.round=Math.round;a.math.cos=Math.cos;a.math.sin=Math.sin;a.math.tan=Math.tan;a.math.acos=
Math.acos;a.math.asin=Math.asin;a.math.atan=Math.atan;a.math.atan2=Math.atan2;a.math.random=Math.random;a.math.sqrt=Math.sqrt;a.math.log=Math.log;a.math.exp=Math.exp;a.math.pow=Math.pow;a.math.randomRange=function(d,c){return a.math.random()*(c-d)+d};a.math.clamp=function(a,c,b){return a<c?c:a>b?b:a};a.math.interp=function(a,c,b){return c*b+a*(1-b)};a.math.signOf=function(a){return 0<a?1:1>a?-1:0};a.math.randomVariance=function(d){return!d?0:2*d*a.math.random()-d};a.math.findCircleCenterFromTwoPoints=
function(a,c,b,e,f,g,h){var j=b-a,k=e-c,l=Math.sqrt(j*j+k*k);a=0.5*(b+a);c=0.5*(e+c);f=Math.sqrt(f*f-0.25*l*l);e=k;b=-j;0>e*g-b*h&&(e=-k,b=j);return{x:a+f*e/l,y:c+f*b/l}};a.math.findAngleOnCircle=function(d,c,b,e){return a.math.atan2(c-e,d-b)};a.math.findArcOnCircle=function(d,c,b,e,f,g,h){var j=0<(f-d)*(e-c)-(g-c)*(e-d);d=a.math.findAngleOnCircle(d,c,f,g);b=a.math.findAngleOnCircle(b,e,f,g);return{type:"arc",center:{x:f,y:g},radius:h,startAngle:d,endAngle:b,anticlockwise:j}};a.math.findArcFromTwoPoints=
function(d,c,b,e,f,g,h){g=a.math.findCircleCenterFromTwoPoints(d,c,b,e,f,g,h);return a.math.findArcOnCircle(d,c,b,e,g.x,g.y,f)};a.math.findPerpendicularBisector=function(a,c,b,e){var f=e-c,g=0.5*(b+a);if(0===f)return{a:1,b:0,c:g};a=-(b-a)/f;return{a:-a,b:1,c:-a*g+0.5*(e+c)}};a.math.findCircleFromThreePoints=function(d,c,b,e,f,g){b=a.math.findPerpendicularBisector(d,c,b,e);g=a.math.findPerpendicularBisector(d,c,f,g);f=void 0;0===b.b?f=b:0===g.b?f=g:(f=-b.b/g.b,f={a:b.a+g.a*f,c:b.c+g.c*f});if(0===f.a)return!1;
f=f.c/f.a;b=0!==b.b?(b.c-b.a*f)/b.b:(g.c-g.a*f)/g.b;d-=f;c-=b;c=a.math.sqrt(d*d+c*c);return{center:{x:f,y:b},radius:c}};a.math.findArcFromThreePoints=function(d,c,b,e,f,g){b=a.math.findCircleFromThreePoints(d,c,b,e,f,g);return!b?{type:"seg",point1:{x:d,y:c},point2:{x:f,y:g}}:a.math.findArcOnCircle(d,c,f,g,b.center.x,b.center.y,b.radius)}});
rat.modules.add("rat.math.r_vector",[{name:"rat.math.r_math",processBefore:!0}],function(a){a.Vector=function(a,c){void 0!==a&&void 0!==a.x&&(c=a.y,a=a.x);this.x=a||0;this.y=c||0};a.Vector.prototype.copy=function(){var d=new a.Vector;d.x=this.x;d.y=this.y;return d};a.Vector.prototype.set=function(a,c){void 0!==a.x&&(c=a.y,a=a.x);this.x=a;this.y=c};a.Vector.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y};a.Vector.prototype.length=function(){return a.math.sqrt(this.x*this.x+this.y*this.y)};a.Vector.prototype.lengthSq=
function(){return this.x*this.x+this.y*this.y};a.Vector.prototype.distanceSqFrom=function(a){var c=a.x-this.x;a=a.y-this.y;return c*c+a*a};a.Vector.prototype.distanceFrom=function(d){return a.math.sqrt(this.distanceSqFrom(d))};a.Vector.prototype.deltaTo=function(d,c){c=c||new a.Vector;c.set(d.x-this.x,d.y-this.y);return c};a.Vector.prototype.normalize=function(){var a=this.length();this.x/=a;this.y/=a};a.Vector.prototype.scale=function(a){this.x*=a;this.y*=a};a.Vector.prototype.setLength=function(a){this.normalize();
this.scale(a)};a.Vector.prototype.add=function(a){this.x+=a.x;this.y+=a.y};a.Vector.prototype.addScaled=function(a,c){this.x+=a.x*c;this.y+=a.y*c};a.Vector.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y};a.Vector.prototype.setFromAngle=function(d){var c=a.math.cos(d);d=a.math.sin(d);this.x=c;this.y=d};a.Vector.dot=function(a,c){return a.x*c.x+a.y*c.y};a.Vector.cross=function(a,c){return a.x*c.y-a.y*c.x};a.Vector.prototype.toString=function(){return"("+this.x+", "+this.y+")"};a.Vector.prototype.limitToRect=
function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.x>a.x+a.w&&(this.x=a.x+a.w);this.y>a.y+a.h&&(this.y=a.y+a.h)};a.Angle=function(a){this.angle=a||0};a.Angle.prototype.copy=function(){var d=new a.Angle;d.angle=this.angle;return d};a.Angle.prototype.setFromVector=function(d){this.angle=a.math.atan2(d.y,d.x);return this};a.Angle.prototype.setFromSourceTarget=function(d,c){this.angle=a.math.atan2(c.y-d.y,c.x-d.x);return this};a.Angle.prototype.rotateVectorInPlace=function(d){var c=a.math.cos(this.angle),
b=a.math.sin(this.angle),e=d.x*b+d.y*c;d.x=d.x*c-d.y*b;d.y=e;return d};a.Angle.prototype.rotateVector=function(d,c){c?(c.x=d.x,c.y=d.y):c=new a.Vector(d);return this.rotateVectorInPlace(c)};a.Position=function(d,c,b){this.pos=new a.Vector(d,c);this.rot=new a.Angle(b)}});
rat.modules.add("rat.math.r_matrix",[{name:"rat.math.r_math",processBefore:!0}],function(a){var d=a.math,c=[[],[],[]];a.Matrix=function(a){this.m=[[],[],[]];a&&a.m?this.set(a.m):a?this.set(a):this.loadIdent()};a.Matrix.prototype.loadIdent=function(){this.m[0][0]=1;this.m[0][1]=0;this.m[0][2]=0;this.m[1][0]=0;this.m[1][1]=1;this.m[1][2]=0;this.m[2][0]=0;this.m[2][1]=0;this.m[2][2]=1};a.Matrix.prototype.translateSelf=function(a,c){var d=this.m;d[0][2]=d[0][0]*a+d[0][1]*c+d[0][2];d[1][2]=d[1][0]*a+d[1][1]*
c+d[1][2];d[2][2]=d[2][0]*a+d[2][1]*c+d[2][2]};a.Matrix.prototype.rotateSelf=function(a){var c=d.cos(a);a=d.sin(a);var f=-a,g=this.m,h=g[0][0]*f+g[0][1]*c,j=g[1][0]*c+g[1][1]*a,k=g[1][0]*f+g[1][1]*c,l=g[2][0]*c+g[2][1]*a,f=g[2][0]*f+g[2][1]*c;g[0][0]=g[0][0]*c+g[0][1]*a;g[0][1]=h;g[1][0]=j;g[1][1]=k;g[2][0]=l;g[2][1]=f};a.Matrix.prototype.scaleSelf=function(a,c){var d=this.m;d[0][0]*=a;d[0][1]*=c;d[1][0]*=a;d[1][1]*=c;d[2][0]*=a;d[2][1]*=c};a.Matrix.prototype.multSelf=function(a){a.m&&(a=a.m);var e=
this.m;c[0][0]=e[0][0]*a[0][0]+e[0][1]*a[1][0]+e[0][2]*a[2][0];c[0][1]=e[0][0]*a[0][1]+e[0][1]*a[1][1]+e[0][2]*a[2][1];c[0][2]=e[0][0]*a[0][2]+e[0][1]*a[1][2]+e[0][2]*a[2][2];c[1][0]=e[1][0]*a[0][0]+e[1][1]*a[1][0]+e[1][2]*a[2][0];c[1][1]=e[1][0]*a[0][1]+e[1][1]*a[1][1]+e[1][2]*a[2][1];c[1][2]=e[1][0]*a[0][2]+e[1][1]*a[1][2]+e[1][2]*a[2][2];c[2][0]=e[2][0]*a[0][0]+e[2][1]*a[1][0]+e[2][2]*a[2][0];c[2][1]=e[2][0]*a[0][1]+e[2][1]*a[1][1]+e[2][2]*a[2][1];c[2][2]=e[2][0]*a[0][2]+e[2][1]*a[1][2]+e[2][2]*
a[2][2];a=this.m;this.m=c;c=a};a.Matrix.prototype.inverseSelf=function(){var a=this.m,e=a[0][0]*a[1][1]*a[2][2]-a[0][0]*a[1][2]*a[2][1]-a[0][1]*a[1][0]*a[2][2]+a[0][1]*a[1][2]*a[2][0]+a[0][2]*a[1][0]*a[2][1]-a[0][2]*a[1][1]*a[2][0];if(0===e)return!1;e=1/e;c[0][0]=e*(a[1][1]*a[2][2]-a[1][2]*a[2][1]);c[0][1]=e*(a[0][2]*a[2][1]-a[0][1]*a[2][2]);c[0][2]=e*(a[0][1]*a[1][2]-a[0][2]*a[1][1]);c[1][0]=e*(a[1][2]*a[2][0]-a[1][0]*a[2][2]);c[1][1]=e*(a[0][0]*a[2][2]-a[0][2]*a[2][0]);c[1][2]=e*(a[0][2]*a[1][0]-
a[0][0]*a[1][2]);c[2][0]=e*(a[1][0]*a[2][1]-a[1][1]*a[2][0]);c[2][1]=e*(a[0][1]*a[2][0]-a[0][0]*a[2][1]);c[2][2]=e*(a[0][0]*a[1][1]-a[0][1]*a[1][0]);a=this.m;this.m=c;c=a;return!0};a.Matrix.prototype.set=function(a){a.m&&(a=a.m);var c=this.m;c[0][0]=a[0][0];c[0][1]=a[0][1];c[0][2]=a[0][2];c[1][0]=a[1][0];c[1][1]=a[1][1];c[1][2]=a[1][2];c[2][0]=a[2][0];c[2][1]=a[2][1];c[2][2]=a[2][2]};a.Matrix.prototype.transformPointSelf=function(a){var c=this.m,d=a.x,g=a.y;a.x=c[0][0]*d+(c[0][1]*g+c[0][2]);a.y=c[1][0]*
d+(c[1][1]*g+c[1][2]);return a};a.Matrix.prototype.transformPoint=function(b,c){c?(c.x=b.x,c.y=b.y):c=new a.Vector(b);return this.transformPointSelf(c)};a.Matrix.matMult=function(b,c,d){d?d.set(b):d=new a.Matrix(b);d.multSelf(c);return d};a.Matrix.prototype.inverse=function(b){b?b.set(this):b=new a.Matrix(this);b.inverseSelf();return b}});
rat.modules.add("rat.graphics.r_video",[{name:"rat.graphics.r_graphics",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.os.r_events","rat.math.r_math"],function(a){var d=0,c={MP4:{type:"mp4",ext:"mp4"},WebM:{type:"webm",ext:"wemb"},Ogg:{type:"ogg",ext:"ogg"}},b=function(a){a=a||{};var b=a.file,c=a.foreground;this._isPlaying=this._pauseOnDoneBuffering=this._pauseOnLoad=this._playOnLoad=!1;this._isLoading=!0;this._isMuted=this._isBuffering=!1;this.events={};this._loadingDoneWaitingForBufferedData=
!1;this._lastBufferingCheckTime=this._accredBufferingCheck=0;this.runningEvents=[];this.addEventListener("load",a.onLoad||a.onload);this.addEventListener("destroy",a.onDestroy||a.ondestroy);this.addEventListener("startbuffering",a.onStartBuffering||a.onstartbuffering);this.addEventListener("endbuffering",a.onEndBuffering||a.onendbuffering);this.addEventListener("end",a.onEnd||a.onend);this._isForeground=c||!1;this.htmlTagID=++d;this.mSrc="";this.mVolume=1;this.createHTMLTag();this.setFile(b||"");
this.buffered=[];void 0!==a.volume&&this.setVolume(a.volume)};b.prototype.disabled=!1;b.numberOfActiveBGVideos=0;b.prototype.addEventListener=function(a,b,c){a&&b&&(this.events[a]||(this.events[a]=[]),this.events[a].push({cb:b,context:c}))};b.prototype.removeEventListener=function(a,b,c){if(a&&b&&this.events[a]){for(var e=this.events[a],d,l=0;l<e.length;++l)if(d=e[l],d.cb===b&&d.context===c){for(c=0;c<this.runningEvents.length;++c)b=this.runningEvents[c],b.type==a&&(b.onIndex>=c&&--b.onIndex,--b.endIndex);
e.splice(l,1);break}0>=e.length&&(this.events[a]=void 0)}};b.prototype.fireEvent=function(a,b){if(a&&this.events[a]){var c=Array.prototype.slice.call(arguments);c.unshift(this);var e=this.events[a],d={type:a,onIndex:0,endIndex:e.length-1};this.runningEvents.push(d);for(var l;d.onIndex<=d.endIndex;++d.onIndex)l=e[d.onIndex],l.cb.apply(l.context,c);this.runningEvents.pop()}};b.prototype.isPlaying=function(){return this.isLoading()?this._playOnLoad:this._isPlaying};b.prototype.isPaused=function(){return!this.isPlaying()?
!1:this.isLoading()?this._pauseOnLoad:this.isBuffering()?this._pauseOnDoneBuffering:this.htmlTag.paused};b.prototype.isLoading=function(){return this._isLoading};b.prototype.isBuffering=function(){return this._isBuffering};b.prototype.destroy=function(){this.fireEvent("destroy");this.stop();this.htmlTag.pause();this.htmlTag.src="";this.htmlTag.parentNode.removeChild(this.htmlTag);this.htmlTag=void 0};b.prototype.getFile=function(){return this.mSrc};b.prototype.setFile=function(b){if(b!==this.mSrc){this.mSrc=
b;var e;if(b){var d=this.htmlTag;if(!c.queried){for(var j in c)c[j].supported=!!d.canPlayType("video/"+c[j].type);c.queried=!0}for(var k in c)if(c[k].supported){e=c[k].ext;break}e||(a.console.log("Unable to find supported video file format.  Defaulting to .mp4"),e=c.MP4.ext);j=b.lastIndexOf(".");0>j&&(j=b.length);var l;b:{k=b.slice(j);"."===k[0]&&(k=k.slice(1));if(k)for(l in c)if(c[l].ext===k){l=c[l];break b}l={supported:!1}}l.supported||(b=b.slice(0,j)+"."+e);e=a.system.fixPath(b)}else e=b;this.mFullFile=
e;this.htmlTag.src=this.mFullFile;this._isLoading=!0;this.htmlTag.load()}this.stop()};b.prototype.createHTMLTag=function(){if(!this.disabled){this.htmlTag=document.createElement("video");this.htmlTag.id=this.htmlTagID;this.htmlTag.style.position="absolute";var b=a.graphics.canvas;b.parentNode.appendChild(this.htmlTag);!b.style.zIndex&&0!==b.style.zIndex&&(b.style.zIndex=0);this.htmlTag.style.zIndex=this._isForeground?b.style.zIndex+(100-this.htmlTagID):b.style.zIndex-(100-this.htmlTagID);this.htmlTag.style.backgroundColor=
a.graphics.autoClearColor;this.htmlTag.style.objectFit="contain";this.onResize();a.addEventListener("resize",this.onResize.bind(this));this.htmlTag.preload="auto";this.htmlTag.oncanplaythrough=this.onLoaded.bind(this);this.htmlTag.onended=this.onEnded.bind(this)}};b.prototype.onLoaded=function(){this.isLoading()&&(this._loadingDoneWaitingForBufferedData=!0)};b.prototype.onEnded=function(){this.stop();this.fireEvent("end")};b.prototype.play=function(b){if(b)this.setFile(b);else if(this.isPlaying())return;
this.mSrc?this.isLoading()?this._playOnLoad=!0:(this.activateVideo(),this.htmlTag.play(),this._isPlaying=!0):a.console.log("Attempting to play a video with no source")};b.prototype.stop=function(){this.isPlaying()&&(this.isLoading()?this._playOnLoad=!1:(this.deactivateVideo(),this.htmlTag.pause(),this._isPlaying=!1,this.isBuffering()&&this.fireEvent("endbuffering"),this._isBuffering=!1,this.htmlTag.currentTime=0))};b.prototype.pause=function(){this.isPlaying()&&!this.isPaused()&&(this.isLoading()?
this._pauseOnLoad=!0:this.isBuffering()?this._pauseOnDoneBuffering=!0:(this._pauseOnLoad=this._pauseOnDoneBuffering=!1,this.htmlTag.pause()))};b.prototype.resume=function(){this.isPlaying()&&this.isPaused()&&(this.isLoading()?this._pauseOnLoad=!1:this.htmlTag.play())};b.prototype.activateVideo=function(){this._isForeground||++b.numberOfActiveBGVideos};b.prototype.deactivateVideo=function(){this._isForeground||--b.numberOfActiveBGVideos};b.prototype.onResize=function(){var b=a.graphics.canvas;this.htmlTag.width=
b.width;this.htmlTag.height=b.height;this.htmlTag.style.left=b.style.left;this.htmlTag.style.top=b.style.top};b.prototype.update=function(a){if(this.mSrc&&(this.buffered=[],this.htmlTag.buffered.length))for(var b=0;b<this.htmlTag.buffered.length;++b){var c={start:this.htmlTag.buffered.start(b),end:this.htmlTag.buffered.end(b)};this.buffered.push(c)}this._loadingDoneWaitingForBufferedData?0<this.htmlTag.buffered.length&&0.1<this.htmlTag.buffered.end(0)&&(this._loadingDoneWaitingForBufferedData=!1,
this.htmlTag.buffered.start(0),this.htmlTag.buffered.end(0),this._isLoading=!1,this.fireEvent("load"),this._playOnLoad&&this.play(),this._pauseOnLoad&&this.pause(),this._pauseOnLoad=this._playOnLoad=!1):this.isLoading()||this._updateBuffering(a)};var e=void 0;b.prototype._updateBuffering=function(b){this._accredBufferingCheck+=b;b=!1;b=this.getCurrentTime({useRaw:!0});e!==a.math.floor(b)&&(e=a.math.floor(b));if(this.htmlTag.paused)this._accredBufferingCheck=0,this._lastBufferingCheckTime=this.getCurrentTime({useRaw:!0}),
b=!1;else if(0.2<this._accredBufferingCheck){b=this._lastBufferingCheckTime;var c=this.getCurrentTime({useRaw:!0});this._lastBufferingCheckTime=c;b=c-b<this._accredBufferingCheck-0.1;this._accredBufferingCheck=0}else b=this.isBuffering();this.isLoading()||this.isPaused()&&!this._pauseOnDoneBuffering||!this.isPlaying()?!this._pauseOnDoneBuffering&&this.isBuffering()&&(this.fireEvent("endbuffering"),this._isBuffering=!1):this.isBuffering()!==b&&(this._isBuffering=b,this.isBuffering()?this.fireEvent("startbuffering"):
(this._pauseOnDoneBuffering&&(this._pauseOnDoneBuffering=!1,this.pause()),this.fireEvent("endbuffering")))};b.prototype.getDurration=function(){return this.isLoading()?-1:this.htmlTag.duration};b.prototype.getCurrentTime=function(a){return!this.isLoading()||a&&a.useRaw?this.htmlTag.currentTime:0};b.prototype.setCurrentTime=function(b){0>b||b>this.htmlTag.duration?a.console.log("Unable to seek to invalid time "+b):this.isLoading()?a.console.log("Unable to seek to time "+b+" while loading..."):(this.isBuffering()||
(this._isBuffering=!0,this.isBuffering()&&this.fireEvent("startbuffering"),this._lastBufferingCheckTime=b,this._accredBufferingCheck=0),this.htmlTag.currentTime=b)};b.prototype.setVolume=function(a){0>a?a=0:1<a&&(a=1);this.getVolume()!==a&&(this.mVolume=a,this.isMuted()||(this.htmlTag.volume=a))};b.prototype.getVolume=function(){return this.mVolume};b.prototype.isMuted=function(){return this._isMuted};b.prototype.mute=function(a){void 0===a&&(a=!0);a!==this.isMuted()&&(this._isMuted=a,this.htmlTag.volume=
this.isMuted()?0:this.mVolume)};a.system.has.Wraith&&(a.console.log("r_video not yet ported for wraith support!"),b.prototype.disabled=!0);a.graphics.Video=b});rat.modules.add("rat.test.r_test",[],function(a){a.test={tests:[],update:function(d){if(a.test.tests)for(var c=0;c<a.test.tests.length;c++)a.test.tests[c].update&&a.test.tests[c].update(d,a.test.tests[c])}}});
rat.modules.add("rat.test.r_audio_test_screen",[{name:"rat.audio.r_audio",processBefore:!0},"rat.math.r_math","rat.ui.r_screen","rat.ui.r_ui_button","rat.ui.r_ui_shape","rat.ui.r_ui_textbox","rat.ui.r_screenmanager","rat.graphics.r_graphics","rat.input.r_input"],function(a){a.audio.initTestScreen=function(){a.audio.testScreen||(a.audio.testScreen=new a.ui.Screen,a.audio.testScreen.modal=!0,a.audio.testScreen.fullOpaque=!0,a.audio.testScreen.name="<ui>Home",a.audio.rememberDefaultClick=a.ui.Button.defaultClickSound,
a.ui.Button.defaultClickSound=null,a.audio.buildTestScreenUI(),a.screenManager.pushScreen(a.audio.testScreen))};a.audio.killTestScreen=function(){a.ui.Button.defaultClickSound=a.audio.rememberDefaultClick;a.screenManager.popScreen();a.audio.testScreen=null};a.audio.buildTestScreenUI=function(){function d(){var b=a.audio.getSoundIDByIndex(e.curIndex),c=a.audio.getSoundInfo(b),d=c.source;d||(d="[Load was never triggered]");var f=a.math.floor(100*c.volume)/100;e.curText.setTextValue("#"+(e.curIndex+
1)+"/"+e.soundCount+": "+b+"\nsource: "+d+"\nduration: "+c.duration+"\nvolume: "+f+"\nloaded: "+a.audio.isSoundLoaded(b)+"\ncurrent time: "+c.currentPos+"\nready State: "+c.readyState+"\nerror: "+c.errorCode)}function c(b,c,d,f,g){var h=a.ui.makeCheapButton(null,new a.graphics.Color(150,150,200));h.setTextValue(b);h.setSize(90,20);h.setPos(c,d);h.setCallback(g,f);b=new a.ui.TextBox("[current]");b.setPos(50,100);b.setSize(a.graphics.SCREEN_WIDTH-100,200);b.setFont("Arial");b.setFontSize(18);b.setColor(a.graphics.white);
e.appendSubElement(h)}function b(){var a=g+45;g+=110;return a}var e=a.audio.testScreen;e.removeAllSubElements();e.setPos(0,0);e.setSize(a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT);var f=new a.ui.Shape(a.ui.squareShape);f.setPos(0,0);f.setSize(a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT);f.setColor(new a.graphics.Color(50,0,0));e.appendSubElement(f);f=new a.ui.TextBox("Audio Test");f.setPos(0,0);f.setSize(a.graphics.SCREEN_WIDTH,40);f.setFont("Arial");f.setFontSize(24);f.setColor(a.graphics.yellow);
f.centerText();e.appendSubElement(f);f=new a.ui.TextBox("[current]");f.setPos(50,40);f.setSize(a.graphics.SCREEN_WIDTH-100,200);f.setFont("Arial");f.setFontSize(18);f.setColor(a.graphics.white);e.appendSubElement(f);e.curText=f;e.curIndex=0;e.soundCount=a.audio.getSoundCount();d();e.update=function(){d()};e.keyDown=function(b){if(b.keyCode===a.keys.leftArrow)e.prevSound();else if(b.keyCode===a.keys.rightArrow)e.nextSound();else if(b.keyCode===a.keys[" "])e.playSound();else return!1;return!0};e.prevSound=
function(){e.curIndex--;0>e.curIndex&&(e.curIndex=e.soundCount-1);d()};e.nextSound=function(){e.curIndex++;e.curIndex>=e.soundCount&&(e.curIndex=0);d()};e.playSound=function(){var b=a.audio.getSoundIDByIndex(e.curIndex);a.audio.playSound(b)};var g=30,h,f=a.graphics.SCREEN_HEIGHT-76;c("Prev",b(),f,"prev",function(){e.prevSound()});c("Next",b(),f,"next",function(){e.nextSound()});c("Play",b(),f,"play",function(){e.playSound()});c("Pause",b(),f,"pause",function(){var b=a.audio.getSoundIDByIndex(e.curIndex);
a.audio.pauseSound(b)});c("Stop",b(),f,"stop",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.pauseSound(h);a.audio.resetSound(h)});c("Done",b(),f,"done",function(){a.audio.killTestScreen()});g=30;f-=34;c("|<",b(),f,"tostart",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.pauseSound(h);a.audio.seekSound(h,0);a.audio.playSound(h)});c("1/4",b(),f,"toonefourth",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.pauseSound(h);a.audio.seekSound(h,0.25,!0);a.audio.playSound(h)});
c("2/4",b(),f,"tohalf",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.pauseSound(h);a.audio.seekSound(h,0.5,!0);a.audio.playSound(h)});c("3/4",b(),f,"tothreefourths",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.pauseSound(h);a.audio.seekSound(h,0.75,!0);a.audio.playSound(h)});c(">|",b(),f,"toend",function(){h=a.audio.getSoundIDByIndex(e.curIndex);a.audio.seekSound(h,1,!0)});g=30;f-=34;c("< vol",b(),f,"voldown",function(){h=a.audio.getSoundIDByIndex(e.curIndex);var b=a.audio.getSoundVolume(h),
b=b-0.1;0>b&&(b=0);a.audio.setSoundVolume(h,b)});c("vol >",b(),f,"volup",function(){h=a.audio.getSoundIDByIndex(e.curIndex);var b=a.audio.getSoundVolume(h),b=b+0.1;1<b&&(b=1);a.audio.setSoundVolume(h,b)})}});
rat.modules.add("rat.test.r_test_ui",[{name:"rat.test.r_test",processBefore:!0},"rat.debug.r_console","rat.graphics.r_graphics","rat.ui.r_screen","rat.ui.r_ui","rat.ui.r_ui_textbox","rat.ui.r_ui_animator","rat.ui.r_ui_shape","rat.ui.r_ui_button","rat.ui.r_ui_sprite","rat.ui.r_ui_scrollview","rat.ui.r_screenmanager"],function(a){a.test.setupUITest=function(){var d=a.graphics.SCREEN_WIDTH,c=a.graphics.SCREEN_HEIGHT,b=new a.ui.Screen;b.setPos(0,0);b.setSize(d,c);a.screenManager.setUIRoot(b);var e=new a.ui.TextBox("Test: Main UI");
e.setFont("arial bold");e.setFontSize(20);e.setPos(0,12);e.setSize(d,30);e.setAlign(a.ui.TextBox.alignCenter);e.setFrame(1,a.graphics.yellow);e.setColor(new a.graphics.Color(180,180,210));b.appendSubElement(e);var f=new a.ui.Screen;f.setPos(40,40);f.setSize(d-80,c-80);f.setBackground(new a.graphics.Color(100,50,50,0.8));f.setBackgroundFrame(1,new a.graphics.Color(250,250,250,1));a.screenManager.pushScreen(f);d=new a.ui.TextBox("Test: Subscreen");d.setFont("arial");d.setFontSize(18);d.setPos(30,4);
d.setSize(200,20);d.setAlign(a.ui.TextBox.alignLeft);d.setColor(new a.graphics.Color(180,180,210));f.appendSubElement(d);var g=new a.ui.TextBox("(tip)");g.setFont("arial");g.setFontSize(18);g.setPos(200,80);g.setSize(60,60);g.setColor(new a.graphics.Color(180,180,210));g.setFrame(1,a.graphics.white);f.appendSubElement(g);g.setCallback(function(b,c){a.console.log("tip click");var e="none topLeft top topRight bottomLeft bottom bottomRight rightHigh".split(" ");c=(c+1)%e.length;g.positionToolTip(e[c],
{x:0,y:0},!0);g.setCallbackInfo(c)},-1);d=g.addTextToolTip("this is a\nmulti-line\ntooltip test",a.graphics.gray,a.graphics.black,f);d.textBox.setFontStyle("italic");g.setToolTip(d.container,f,"topRight",{x:-5,y:-5},!1);d=new a.ui.TextBox("(tip 2)");d.setFont("arial");d.setFontSize(18);d.setPos(250,120);d.setSize(60,60);d.setColor(new a.graphics.Color(180,180,210));d.setFrame(1,a.graphics.white);f.appendSubElement(d);c=new a.ui.Shape(a.ui.circleShape);c.setSize(40,40);c.setColor(new a.graphics.Color(250,
250,90));c.setFrame(1,new a.graphics.Color(250,250,250,1));d.setToolTip(c,f,"bottom");d=new a.ui.TextBox("...");d.setFont("arial");d.setFontSize(14);d.setPos(10,40);d.setSize(200,100);d.setAlign(a.ui.TextBox.alignRight);d.setBaseline(a.ui.TextBox.baselineMiddle);d.setColor(new a.graphics.Color(280,280,210));d.setFrame(1,a.graphics.white);f.appendSubElement(d);c=new a.ui.TextBox("...");c.setAutoWrap(!0);c.setFont("calibri");c.setFontStyle("italic");c.setFontSize(17);c.setPos(10,150);c.setSize(200,
110);c.setAlign(a.ui.TextBox.alignLeft);c.setBaseline(a.ui.TextBox.baselineTop);c.setColor(new a.graphics.Color(280,280,210));c.setFrame(1,a.graphics.white);f.appendSubElement(c);b=new a.ui.TextBox("...");b.setAutoWrap(!0);b.setFont("arial");b.setFontSize(14);b.setPos(360,140);b.setSize(200,40);b.setAlign(a.ui.TextBox.alignRight);b.setBaseline(a.ui.TextBox.baselineMiddle);b.setColor(new a.graphics.Color(280,280,210));b.setFrame(1,a.graphics.white);f.appendSubElement(b);e=new a.ui.ButtonScrollView;
e.setPos(10,270);e.setSize(200,200);e.setContentSize(1200,400);e.setFrame(1,a.graphics.white);f.appendSubElement(e);var h=new a.ui.Shape(a.ui.squareShape);h.setColor(new a.graphics.Color(50,150,50));h.setPos(10,10);h.setSize(1180,380);h.setFrame(5,a.graphics.green);e.appendSubElement(h);for(h=20;1200>h;h+=40){var j=new a.ui.Shape(a.ui.squareShape);j.setPos(h,20);j.setSize(30,30);var k=new a.graphics.Color(50+Math.floor(200*Math.random()),50+Math.floor(200*Math.random()),50+Math.floor(200*Math.random()));
j.setColor(k);j.addTextToolTip("thing "+k.toString(),a.graphics.cyan,a.graphics.darkGray,f);e.appendSubElement(j)}h=a.ui.makeCheapButton(null,new a.graphics.Color(200,150,150));h.setPos(10,80);h.setSize(100,40);h.setTextValue("me");e.appendSubElement(h);h.addTextToolTip("test button inside scrollview");h.setCallback(function(){a.console.log("HIT BUTTON IN SCROLLVIEW")});h=a.ui.makeCheapButton(null,a.graphics.gray);h.setPos(230,12);h.setSize(100,40);h.setTextValue("button\ntest");f.appendSubElement(h);
h.addTextToolTip("Funky button color testing",a.graphics.cyan,a.graphics.darkGray,f);h.setCallback(function(){a.console.log("HIT")});h.setTextColors("#FFFF80","rgb(255,255,255)",new a.graphics.Color(255,255,255,0.5),void 0);e=a.ui.Element;j=[{state:e.enabledFlag,color:"#A08080",frameColor:"#F0A0A0"},{state:e.enabledFlag|e.highlightedFlag,color:"#A0A080",frameColor:"#FFFF80"},{state:e.enabledFlag|e.pressedFlag,color:"#A04040",frameColor:"#802080"},{state:e.enabledFlag|e.toggledFlag,color:"#8080A0",
frameColor:"#A0A0F0"},{state:e.enabledFlag|e.toggledFlag|e.highlightedFlag,color:"#80A0F0",frameColor:"#A0F0F0"},{state:e.enabledFlag|e.toggledFlag|e.pressedFlag,color:"#6040A0",frameColor:"#6020F0"}];h.setStateColors(j);h.setStateFrameColors(j);h.setToggles(!0);h=a.ui.makeCheapButton(null,new a.graphics.Color(90,180,90));h.setPos(350,12);h.setSize(100,40);h.setTextValue("Close");f.appendSubElement(h);h.addTextToolTip("simple tooltip 2",a.graphics.cyan,a.graphics.darkGray,f);h.setCallback(function(){a.screenManager.popScreen()});
h=a.ui.makeSpriteButton("res/images/love.png","res/images/love2.png","res/images/love3.png");h.setPos(280,90);h.setSize(16,16);h.setScale(2,2);f.appendSubElement(h);h.addTextToolTip("scaled sprite button",a.graphics.cyan,a.graphics.darkGray,f);h.setFrame(1,a.graphics.red);h=new a.ui.Button(a.ui.Button.bubbleType,"res/images/bubblebox_normal.png","res/images/bubblebox_high.png","res/images/bubblebox_low.png");h.setPos(240,200);h.setSize(186.3,69);f.appendSubElement(h);h.addTextToolTip("bubble button",
a.graphics.cyan,a.graphics.darkGray,f);h.setTextValue("Flip Global Scale");h.setCallback(function(){a.graphics.hasGlobalScale()?a.graphics.clearGlobalScale():a.graphics.setGlobalScale(1.5,1.5)});var l=new a.ui.Sprite(["res/images/love.png","res/images/love2.png","res/images/love3.png"]);l.setPos(200,15);l.imageRef.animSpeed=10;f.appendSubElement(l);l.autoCenter();h=new a.ui.Button(a.ui.Button.bubbleType,"res/images/bubblebox_normal.png","res/images/bubblebox_high.png","res/images/bubblebox_low.png");
h.setPos(260,300);h.setSize(140,50);h.setScale(1.25,1.25);f.appendSubElement(h);h.addTextToolTip("bubble button",a.graphics.cyan,a.graphics.darkGray,f);h.setTextValue("Animate");h.setCallback(function(){var b=new a.ui.Animator(a.ui.Animator.rotator,f);b.setTimer(1);b.setStartEnd(0,Math.PI/8);b.setAutoDie();b=new a.ui.Animator(a.ui.Animator.rotator,f);b.setDelay(1);b.setTimer(1);b.setStartEnd(Math.PI/8,0);b.setAutoDie()});h=new a.ui.Button(a.ui.Button.bubbleType,"res/images/bubblebox_normal.png","res/images/bubblebox_high.png",
"res/images/bubblebox_low.png");h.setPos(440,200);h.setSize(140,50);h.setTextColors(a.graphics.gray,a.graphics.yellow,a.graphics.red);f.appendSubElement(h);h.addTextToolTip("click to animate me",a.graphics.cyan,a.graphics.darkGray,f);h.setTextValue("Animate Me");h.setCallback(function(b){var c=new a.ui.Animator(a.ui.Animator.scaler,b);c.setTimer(1);c.setStartEnd(1,2);c.setAutoDie();c=new a.ui.Animator(a.ui.Animator.scaler,b);c.setDelay(1);c.setTimer(1);c.setStartEnd(2,1);c.setAutoDie();c=new a.ui.Animator(a.ui.Animator.rotator,
l);c.setTimer(2);c.setStartEnd(0,4*Math.PI);c.setAutoDie()});j=[{state:e.enabledFlag,resource:["res/images/bubblebox_normal_f1.png","res/images/bubblebox_normal_f2.png","res/images/bubblebox_normal_f3.png"]},{state:e.enabledFlag|e.highlightedFlag,imageRef:a.graphics.makeImage("res/images/bubblebox_high.png")},{state:e.enabledFlag|e.pressedFlag,resource:"res/images/bubblebox_low.png"}];h.setStateImages(j);if(e=h.getMatchingState(e.enabledFlag))e.imageRef.setAnimSpeed(8),e.imageRef.setAnimOneShot(!0);
j=new a.ui.Screen;j.setPos(450,300);j.setSize(100,100);j.setScale(1.5,1.5);j.setFrame(1,a.graphics.yellow);f.appendSubElement(j);e=new a.ui.TextBox("123");e.setFont("arial bold");e.setFontSize(20);e.setPos(0,80);e.setSize(100,20);e.autoCenter();e.setAlign(a.ui.TextBox.alignCenter);e.setFrame(1,a.graphics.green);e.setColor(new a.graphics.Color(180,180,210));j.appendSubElement(e);h=a.ui.makeCheapButton(null,a.graphics.gray);h.setPos(20,20);h.setSize(100,20);h.setScale(1.2,1.5);h.setTextValue("in scaled box");
j.appendSubElement(h);h.addTextToolTip("Test buttons inside scaled containers",a.graphics.cyan,a.graphics.darkGray,f);h.setCallback(function(){a.console.log("SSUB hit")});e=new a.ui.EditText("Editable Text");e.setFont("Impact");e.setFontSize(20);e.setPos(570,32);e.setSize(180,24);e.autoCenter();e.setColor(new a.graphics.Color(220,180,180));f.appendSubElement(e);e.addTextToolTip("Editable Text",a.graphics.cyan,a.graphics.darkGray,f);e=new a.ui.EditText("");e.setFont("arial");e.setFontSize(30);e.setPos(570,
72);e.setSize(180,34);e.autoCenter();e.setColor(new a.graphics.Color(180,180,220));f.appendSubElement(e);e.addTextToolTip("Editable Text 2",a.graphics.cyan,a.graphics.darkGray,f);f.autoBuildInputMap();e=new a.ui.Animator(a.ui.Animator.mover,f);e.setTimer(0.5);e.setStartEndVectors({x:-200,y:-100},{x:40,y:40});e.setAutoDie();e=new a.ui.Animator(a.ui.Animator.scaler,f);e.setTimer(0.5);e.setStartEndVectors({x:0.1,y:0.1},{x:1,y:1});e.setAutoDie();e=new a.ui.Animator(a.ui.Animator.rotator,f);e.setTimer(0.5);
e.setStartEnd(-Math.PI,0);e.setAutoDie();a.test.tests.push({update:a.test.updateUITest,wrapTest1:{tbox:d,timer:0,pos:0,fullText:"This is a test\nof CR handling, especially\nwhen the text is changing\nover time\n..."},wrapTest2:{tbox:c,timer:0,pos:0,fullText:"\u501f\u52a9\u7159\u9727\u5f48\u96b1\u8eab\uff0c\u96b1\u53bb\u4f60. ?\u7684\u8e64\u8de1\u4e26\u5728\u6575\u4eba\u9593\u7a7f\u884c\u3002\u6bcf\u6b21\u4f7f\u7528\u53ef\u7372\u5f97POWERUP_XP_GAIN\u9ede\u7d93\u9a57\u3002\u6bcf\u5c40\u904a\u6232\u6700\u591a\u53ef\u4f7f\u7528ITEM_CAPACITY\u6b21\u3002"},
wrapTest3:{tbox:b,timer:0,pos:0,fullText:"Some text which will squish when it's just barely too long, vertically.  But if it's way too long, it just eventually adds a line."}})};a.test.updateUITest=function(a,c){function b(b){b.timer+=a;if(0.1<b.timer){b.timer=0;b.pos++;var c=b.fullText.slice(0,b.pos);b.tbox.setTextValue(c);b.pos===b.fullText.length&&(b.pos=0)}}b(c.wrapTest1);b(c.wrapTest2);b(c.wrapTest3)}});
rat.modules.add("rat.test.r_test_special_ui",[{name:"rat.test.r_test",processBefore:!0},"rat.graphics.r_graphics","rat.ui.r_screen","rat.ui.r_screenmanager","rat.ui.r_ui_textbox","rat.ui.r_ui_fillbar","rat.ui.r_ui_spiderchart","rat.ui.r_ui_treeview","rat.ui.r_ui"],function(a){a.test.setupSpecialUITest=function(){var d=a.graphics.SCREEN_WIDTH,c=a.graphics.SCREEN_HEIGHT,b=new a.ui.Screen;b.setPos(0,0);b.setSize(d,c);a.screenManager.setUIRoot(b);c=new a.ui.TextBox("Test: Special UI");c.setFont("arial bold");
c.setFontSize(20);c.setPos(0,12);c.setSize(d,30);c.setAlign(a.ui.TextBox.alignCenter);c.setFrame(1,a.graphics.yellow);c.setColor(new a.graphics.Color(180,180,210));b.appendSubElement(c);d=new a.ui.FillBar;d.setPos(20,70);d.setSize(200,20);d.setFill(25,100);d.setColors(a.graphics.green,a.graphics.yellow,a.graphics.red);b.appendSubElement(d);d=new a.ui.SpiderChart;d.setPos(20,100);d.setSize(200,200);d.setData({normalize:!0,normalizeScale:0.9,drawAxes:{color:a.graphics.gray,scale:0.95,hashColor:new a.graphics.Color(160,
160,160,0.3),hashCount:5,hashLines:!0},sets:[{fillColor:new a.graphics.Color(128,128,255,0.3),strokeColor:a.graphics.blue,strokeWidth:2,points:[4,5,2,3,4,6]},{fillColor:new a.graphics.Color(255,128,128,0.3),strokeColor:a.graphics.red,strokeWidth:2,points:[3,6,4,4,3,4]}]});b.appendSubElement(d);b=new a.ui.TreeView(b);b.setPos(260,100);b.setSize(200,200);b.setTreeValues({label:"root",children:[{label:"1 - one"},{label:"2 - two",children:[{label:"2a"},{label:"2b"}]},{label:"3 - three"}]});a.test.tests.push({update:a.test.updateSpecialUITest,
data1:{data:null}})};a.test.updateSpecialUITest=function(){}});
rat.modules.add("rat.test.r_test_video",[{name:"rat.test.r_test",processBefore:!0},"rat.graphics.r_graphics","rat.graphics.r_video","rat.ui.r_screen","rat.ui.r_screenmanager","rat.ui.r_ui_textbox"],function(a){function d(a){if(e){var b="Test: Video\n---------";f.push(a);25<f.length&&f.shift();for(a=0;a<f.length;++a)b+="\n",b+=f[a];e.setTextValue(b)}}var c,b=0,e,f=[],g=!1;a.test.video={gotEvent:function(a,b,c){d("Got on"+(b||c)+" event..")},setup:function(){c&&c.destroy();g||(a.test.tests.push({update:a.test.video.update}),
g=!0);c=new a.graphics.Video({foreground:!1,volume:1,onload:a.test.video.gotEvent,onend:a.test.video.gotEvent,ondestroy:a.test.video.gotEvent,onstartbuffering:a.test.video.gotEvent,onendbuffering:a.test.video.gotEvent});c.play("res/video/small");var b=a.graphics.SCREEN_WIDTH,f=a.graphics.SCREEN_HEIGHT,k=new a.ui.Screen;k.setPos(0,0);k.setSize(b,f);a.screenManager.setUIRoot(k);e=new a.ui.TextBox("Test: Video");e.setFont("arial bold");e.setFontSize(20);e.setPos(32,32);e.setSize(b,30);e.setAlign(a.ui.TextBox.alignLeft);
e.setBaseline(a.ui.TextBox.baseLineTop);e.setColor(new a.graphics.Color(180,180,210));k.appendSubElement(e);d("Test Setup")},update:function(e){function f(a){return g<a&&b>=a}c&&c.update(e);var g=b;b+=e;f(1)?(d("Destroyed"),c.destroy(),c=void 0):f(2)?(d("Created low vol"),c=new a.graphics.Video({file:"res/video/small",foreground:!1,volume:0.1,onload:a.test.video.gotEvent,onend:a.test.video.gotEvent,ondestroy:a.test.video.gotEvent,onstartbuffering:a.test.video.gotEvent,onendbuffering:a.test.video.gotEvent}),
c.play()):f(3)?(d("Paused"),c.pause()):f(4)?(d("Resumed"),c.resume()):f(5)?(d("Stopped"),c.stop()):f(6)&&(d("Played"),c.play())}}});
rat.modules.add("rat.utils.r_nodegraph",["rat.math.r_vector","rat.graphics.r_graphics","rat.utils.r_shapes","rat.debug.r_console"],function(a){function d(a,c){return(a.x-c.x)*(a.x-c.x)+(a.y-c.y)*(a.y-c.y)}function c(a,c,f){var g=d(c,f);if(0===g)return d(a,c);g=((a.x-c.x)*(f.x-c.x)+(a.y-c.y)*(f.y-c.y))/g;return 0>g?d(a,c):1<g?d(a,f):d(a,{x:c.x+g*(f.x-c.x),y:c.y+g*(f.y-c.y)})}a.NodeGraph=function(){this.nodes=[];this.mapCenter=new a.Vector(0,0);this.mapSize=new a.Vector(1,1);this.config=null;this.fillDefaultConfig()};
a.NodeGraph.debug={nodeColors:"red yellow green cyan blue violet orange".split(" "),NODE_COLOR_COUNT:7};a.NodeGraph.prototype.fillDefaultConfig=function(){this.config||(this.config={});var b={rng:Math,targetNodeCount:50,linkFromCurrent:3,attemptsAtNearSpace:5,nearSpaceDist:3,nearSpaceBias:new a.Vector(0,0),maxTargetNewLinks:2,maxNearNodesToTry:4,maxNearNodeDistance:4,minNearNodeDistance:0,maxLinkGenerationGap:-1,maxLinksFromFirst:1,maxLinksFromLast:1,stuckAction:"backtrack",addRandomJitter:!0,adjustToTopLeft:!1},
c;for(c in b)"undefined"===typeof this.config[c]&&(this.config[c]=b[c])};a.NodeGraph.prototype.setConfig=function(a){this.config=a;this.fillDefaultConfig()};a.NodeGraph.prototype.checkLineNearNodes=function(a,e,d,g,h,j){a={x:a,y:e};d={x:d,y:g};for(g=0;g<this.nodes.length;g++)if(!(g===h||g===j)&&0.2>c(this.nodes[g].pos,a,d))return!0;return!1};a.NodeGraph.prototype.checkNodeNearLines=function(a,e){for(var d={x:a,y:e},g=0;g<this.nodes.length;g++)for(var h=this.nodes[g],j=0;j<h.links.length;j++)if(0.2>
c(d,h.pos,this.nodes[h.links[j]].pos))return!0;return!1};a.NodeGraph.prototype.checkUsedSpace=function(a,c){for(var d=0;d<this.nodes.length;d++)if(this.nodes[d].pos.x===a&&this.nodes[d].pos.y===c)return!0;return!1};a.NodeGraph.prototype.checkIntersects=function(a,c,d,g,h){for(var j=0;j<this.nodes.length;j++)for(var k=this.nodes[j],l=0;l<k.links.length;l++){var m=k.links[l];if(m!==h&&m>j){m=this.nodes[m];var n=k.pos.x,p=k.pos.y,q=m.pos.x,r=m.pos.y,s=(q-n)*(c-p)-(r-p)*(a-n),m=(d-a)*(c-p)-(g-c)*(a-n),
p=(r-p)*(d-a)-(q-n)*(g-c);0===p?m=!1:(n=s/p,m/=p,m=0<m&&1>m,m=0<n&&1>n&&m?!0:!1);if(m)return!0}}return!1};a.NodeGraph.prototype.getNearNodeIndices=function(a,c){var d=this.nodes[a];d.distSq=0;for(var g=[],h=0;h<this.nodes.length;h++){var j=this.nodes[h];j.index=h;j.distSq=j.pos.distanceSqFrom(d.pos);0<=c&&Math.abs(d.generation-j.generation)>c||(g[g.length]=j)}g.sort(function(a,b){return a.distSq-b.distSq});return g};a.NodeGraph.prototype.linkNodes=function(a,c){this.nodes[a].links[this.nodes[a].links.length]=
c;this.nodes[c].links[this.nodes[c].links.length]=a};a.NodeGraph.prototype.nodesHaveLink=function(a,c){for(var d=0;d<this.nodes[a].links.length;d++)if(this.nodes[a].links[d]===c)return!0;return!1};a.NodeGraph.prototype.linkNearNodes=function(a,c){var d=Math.floor(this.config.rng.random()*(c+1));if(0!==d)for(var g=this.nodes[a],h=this.getNearNodeIndices(a,this.config.maxLinkGenerationGap),j=this.config.maxNearNodesToTry,k=this.config.maxNearNodeDistance,l=this.config.minNearNodeDistance,m=1;m<=j&&
m<h.length&&0<d;m++)h[m].distSq>=l&&(h[m].distSq<k&&!this.nodesHaveLink(a,h[m].index)&&!this.checkIntersects(h[m].pos.x,h[m].pos.y,g.pos.x,g.pos.y)&&!this.checkLineNearNodes(h[m].pos.x,h[m].pos.y,g.pos.x,g.pos.y,a,h[m].index))&&!(0===h[m].index&&h[m].links.length>=this.config.maxLinksFromFirst)&&(this.linkNodes(a,h[m].index),d--)};a.NodeGraph.prototype.addRandomMapJitter=function(){for(var a=this.config.rng.random,c=0;c<this.nodes.length;c++)this.nodes[c].pos.x+=0.2*a()-0.1,this.nodes[c].pos.y+=0.2*
a()-0.1};a.NodeGraph.prototype.build=function(){this.nodes=[];this.nodes[0]={pos:new a.Vector(0,0),links:[],colorIndex:0,generation:0,main:!0,leaf:!1};for(var b=0,c=1,d=0;this.nodes.length<this.config.targetNodeCount;d++){var g=this.nodes[b].pos.x,h=this.nodes[b].pos.y,j=b,k=0,l=this.config.linkFromCurrent;this.config.maxLinksFromFirst<l&&0===b&&(l=this.config.maxLinksFromFirst);for(var m=0;m<l;m++)for(var n=0;n<this.config.attemptsAtNearSpace;n++){var p=g+Math.floor(2*this.config.rng.random()*this.config.nearSpaceDist)-
this.config.nearSpaceDist+this.config.nearSpaceBias.x,q=h+Math.floor(2*this.config.rng.random()*this.config.nearSpaceDist)-this.config.nearSpaceDist+this.config.nearSpaceBias.y;if(!(0===p&&0===q)&&!this.checkUsedSpace(p,q)&&!this.checkIntersects(g,h,p,q,b)&&!this.checkLineNearNodes(g,h,p,q,b)&&!this.checkNodeNearLines(p,q)){k={pos:new a.Vector(p,q),links:[],colorIndex:Math.floor(this.config.rng.random()*a.NodeGraph.debug.NODE_COLOR_COUNT),generation:c,main:!1,leaf:!1};this.nodes[this.nodes.length]=
k;this.linkNodes(b,this.nodes.length-1);k=this.nodes.length-1;this.nodes[b].main=!0;n=this.config.maxTargetNewLinks;this.nodes.length>=this.config.targetNodeCount&&this.config.maxLinksFromLast-1<n&&(n=this.config.maxLinksFromLast-1);n&&this.linkNearNodes(this.nodes.length-1,n);break}}k&&(b=k);if(b===j){if("random"===this.config.stuckAction)b=Math.floor(this.config.rng.random()*this.nodes.length);else if("backtrack"===this.config.stuckAction){if(b--,1>=b)break}else break;c=this.nodes[b].generation}c++}this.nodes[this.nodes.length-
1].main=!0;for(b=0;b<this.nodes.length;b++)1===this.nodes[b].links.length&&!this.nodes[b].main&&(this.nodes[b].leaf=!0);this.config.addRandomJitter&&this.addRandomMapJitter();d=99999;g=-99999;h=99999;j=-99999;for(b=0;b<this.nodes.length;b++)this.nodes[b].pos.x<d&&(d=this.nodes[b].pos.x),this.nodes[b].pos.x>g&&(g=this.nodes[b].pos.x),this.nodes[b].pos.y<h&&(h=this.nodes[b].pos.y),this.nodes[b].pos.y>j&&(j=this.nodes[b].pos.y);this.mapSize.x=g-d;this.mapSize.y=j-h;this.mapLargestSide=this.mapSize.x>
this.mapSize.y?this.mapSize.x:this.mapSize.y;this.mapCenter.x=d+this.mapSize.x/2;this.mapCenter.y=h+this.mapSize.y/2;if(this.config.adjustToTopLeft){for(b=0;b<this.nodes.length;b++)this.nodes[b].pos.x-=d,this.nodes[b].pos.y-=h;this.mapCenter.x-=d;this.mapCenter.y-=h}this.maxGeneration=c-1};a.NodeGraph.prototype.getBounds=function(){return new a.shapes.Rect(this.mapCenter.x-this.mapSize.x/2,this.mapCenter.y-this.mapSize.y/2,this.mapSize.x,this.mapSize.y)};a.NodeGraph.prototype.draw=function(b,c,d,
g){var h=20,j,k=(c.w-2*h)/this.mapSize.x;j=(c.h-2*h)/this.mapSize.y;j<k&&(k=j);g&&(k=g,h=0);g=h;d?(g=c.x+c.w/2-this.mapCenter.x*k,h=c.y+c.h/2-this.mapCenter.y*k):(g=c.x,h=c.y);a.graphics.save(b);a.graphics.translate(g,h,b);b.fillStyle="#6040FF";for(j=0;j<this.nodes.length;j++){var l=10;0===j&&(l=20);j===this.nodes.length-1&&(l=20);d=this.nodes[j];h=d.pos.x*k;g=d.pos.y*k;b.fillStyle=a.NodeGraph.debug.nodeColors[d.colorIndex];a.graphics.save();a.graphics.translate(h,g,b);b.beginPath();b.arc(0,0,l/2,
0,2*Math.PI,!0);b.closePath();b.fill();a.graphics.restore();b.font="10px Arial";b.fillStyle="#A0A0A0";b.fillText(d.generation,h+5,g-2)}for(j=0;j<this.nodes.length;j++){d=this.nodes[j];h=d.pos.x*k;g=d.pos.y*k;b.strokeStyle="yellow";for(l=0;l<d.links.length;l++)if(!(d.links[l]<j)){var m=this.nodes[d.links[l]],n=m.pos.x*k,m=m.pos.y*k;b.beginPath();b.moveTo(h,g);b.lineTo(n,m);b.closePath();b.stroke()}}d=this.getBounds();b.strokeStyle="#55FF55";b.strokeRect(d.x*k,d.y*k,d.w*k,d.h*k);a.graphics.restore();
b.strokeStyle="#5555FF";b.strokeRect(c.x,c.y,c.w,c.h)}});
rat.modules.add("rat.graphics.r_image_filter",[{name:"rat.graphics.r_image",processBefore:!0},"rat.debug.r_console","rat.os.r_system"],function(a){a.graphics.imageFilter={filters:{},queue:[]};var d=a.graphics.image_filter=a.graphics.imageFilter;d.filters.invert=function(a){for(var b=a.data,d=0;d<a.data.length;d+=4)b[d]=255-b[d],b[d+1]=255-b[d+1],b[d+2]=255-b[d+2];return a};d.filters.colorize=function(a,b){for(var d=a.data,f=b.color.r,g=b.color.g,h=b.color.b,j=0;j<a.data.length;j+=4)d[j]=d[j]*f/255|
0,d[j+1]=d[j+1]*g/255|0,d[j+2]=d[j+2]*h/255|0;return a};d.filters.brightness=function(a,b){for(var d=a.data,f=b.brightness||1.5,g=0;g<a.data.length;g+=4)d[g]=d[g]*f|0,d[g+1]=d[g+1]*f|0,d[g+2]=d[g+2]*f|0;return a};d.filters.pixelscale=function(a,b,d){var f=a.data;b=b.scale;var g=a.width,h=b*a.width,j=b*a.height;d=d.getContext("2d").createImageData(h,j);a=d.data;for(j-=1;0<=j;j--)for(var k=h-1;0<=k;k--){var l=4*(h*j+k),m=4*(g*(j/b|0)+(k/b|0));a[l]=f[m];a[l+1]=f[m+1];a[l+2]=f[m+2];a[l+3]=f[m+3]}return d};
d.apply=function(c,b,e,f){"string"===typeof c&&(c=a.graphics.findInCache(c));if("string"===typeof b){var g=b;b=d.filters[g];if(!b)return a.console.log("ERROR: No such filter : "+g),null}c.isImage&&(c=c.getImageFrame(0));g=document.createElement("canvas");g.width=c.width;g.height=c.height;var h=g.getContext("2d");h.drawImage(c,0,0);c=h.getImageData(0,0,g.width,g.height);e&&e.scale&&(g.width=g.width*e.scale|0,g.height=g.height*e.scale|0,1E3<g.width&&console.log("WTF"));b=b(c,e,g);h.putImageData(b,0,
0);f&&a.graphics.addToCache(g,f);return g};d.queueFilter=function(a,b,e,f,g){if(Array.isArray(a))for(var h=0;h<a.length;h++){var j=f;f&&Array.isArray(f)&&(j=f[h]);d.queueFilter(a[h],b,e,j,g)}else{f===a&&void 0===g&&(g=!0);if(g)for(h=0;h<d.queue.length;h++)if(g=d.queue[h],g.srcImage===a&&g.registerName===f&&b===g.filter)return;d.queue.push({srcImage:a,filter:b,filterOptions:e,registerName:f})}};d.processQueue=function(){if(0<d.queue.length){var a=d.queue.shift();d.apply(a.srcImage,a.filter,a.filterOptions,
a.registerName)}return 0>=d.queue.length?!0:!1}});
rat.modules.add("rat.live.r_sync",[{name:"rat.live.r_firebase",processBefore:!0},{name:"rat.os.r_system",processBefore:!0},"rat.debug.r_console"],function(a){a.live||(a.live={});a.live.sync={playerList:{},map:{}};var d=a.live.sync;d.debugLog=function(){};d.init=function(c,b,e){d.config=c||{};void 0===d.config.hostMigration&&(d.config.hostMigration=!0);d.projectRoot=c.projectRoot||"";useFirebase=c.useFirebase;d.timer=0;d.debugLog("sync init "+c.id);d.connection=new a.live.firebase.Connection(d.projectRoot,
useFirebase);d.connection.onDisconnect(function(){console.log("ON DIS")});d.connection.onConnect(function(){console.log("ON CON");d.connectMyPlayerInfo()});d.handler=e;d.myPlayerInfo=b;b.isHost&&(d.isHost=!0);d.mRef=d.connection.ref("games/"+c.id);b=new Date;var f=b.toUTCString();b={lastDate:b.getTime(),lastDateString:f};d.mRef.child("_info/").update(b);d.playersRef=d.mRef.child("_players/");d.isHost&&d.playersRef.set({});d.myPlayerRef=d.playersRef.push();d.myPlayerInfo._syncID=d.myPlayerRef.key;
d.connectMyPlayerInfo();d.playersRef.on("value",function(a){d.playerList=a.val();null===d.playerList&&(d.playerList={});a=d.myPlayerInfo._syncID;d.playerList[a]&&(d.myPlayerInfo=d.playerList[a]);d.myPlayerInfo._syncID=a;e.playerListChanged&&e.playerListChanged(d.playerList)});d.playersRef.on("child_removed",function(a){var b=a.val();if(d.config.hostMigration&&b.isHost)if(d.myPlayerInfo._syncID===a.key)d.demoteHost();else for(var c in d.playerList)if(!d.playerList[c].isHost){c===d.myPlayerInfo._syncID&&
d.promoteHost();break}});d.eventsRef=d.mRef.child("_events/");d.eventsRef.push({syncJoin:!0});d.eventsRef.limitToLast(1).once("child_added",function(a){d.eventsRef.startAt(null,a.key).on("child_added",function(a){(a=a.val())&&e.handleSyncEvent&&!a.syncJoin&&e.handleSyncEvent(a)})});d.requestsRef=d.mRef.child("_requests/");b=d.requestsRef.push({syncJoin:!0});d.requestsRef.startAt(null,b.key).on("child_added",function(b){if(d.isHost){var c=b.val();c&&!c.syncJoin&&("own"===c.code||"disown"===c.code?
d.handleOwnership(c):e.handleSyncRequest&&(a.console.log("R <- : "+b.key+" : "+c.code),e.handleSyncRequest(c)))}});d.chatLog=[];d.chatRef=d.mRef.child("_chat/");d.chatRef.limitToLast(10).on("child_added",function(a){if(a=a.val())d.chatLog.unshift(a),10<d.chatLog.length&&d.chatLog.pop(),e.handleChat&&e.handleChat(a),d.chatLog.sort(function(a,b){return b.timestamp-a.timestamp})});d.matchRef=d.mRef.child("_match/");if(d.isHost&&d.config.matchConfig)d.config.matchConfig.id=c.id,d.matchRef.set(d.config.matchConfig);
else d.matchRef.on("value",function(b){d.config.matchConfig=b.val();a.console.log("got matchconfig: "+d.config.matchConfig)});d.setupOwnershipTracking();d.debugLog("sync init done");a.console.registerCommand("disconnect",function(){d.connection.db.goOffline()});a.console.registerCommand("connect",function(){d.connection.db.goOnline()},["reconnect"]);return{playerID:d.myPlayerInfo._syncID}};d.shutDown=function(){d.playersRef.off();d.connection.close();d.connection=null};d.isReady=function(){return d.connection.isReady()};
d.isConnected=function(){return d.connection.isConnected()};d.getMatchConfig=function(){if(d.config.matchConfig)return d.config.matchConfig};d.setupOwnershipTracking=function(){d.ownList={};d.ownRef=d.mRef.child("_own/");d.ownRef.on("value",function(a){(a=a.val())||(a={});d.ownList=a})};d.iOwn=function(a){return!a._syncID?!1:d.ownList[a._syncID]===d.myPlayerInfo._syncID?!0:!1};d.getOwner=function(a){return!a._syncID?0:d.ownList[a._syncID]};d.handleOwnership=function(a){if("own"===a.code){if(d.ownList[a.params.syncID])return!1;
d.ownRef.child(a.params.syncID).set(a.params.playerID);return!0}return"disown"===a.code?(d.ownList[a.params.syncID]===a.params.playerID&&d.ownRef.child(a.params.syncID).set(null),!0):!1};d.demoteHost=function(){a.console.log("demote me from host.");d.isHost&&(d.isHost=!1,d.myPlayerInfo.isHost=!1,d.updateOperations(),d.handler&&d.handler.demoteHost&&d.handler.demoteHost())};d.promoteHost=function(){a.console.log("promote me to host.");d.isHost=!0;d.myPlayerInfo.isHost=!0;d.updateOperations();d.config.matchConfig&&
(d.config.matchConfig.id&&d.config.matchConfig.isPublic&&a.live.match)&&(a.live.match.init(d.projectRoot),a.live.match.hostGameWithID(d.config.matchConfig.id,d.config.matchConfig.name,d.config.matchConfig),a.live.match.shutDown());d.handler&&d.handler.promoteHost&&d.handler.promoteHost();d.myPlayerRef.set(d.myPlayerInfo)};d.updateOperations=function(){for(var a in d.map){var b=d.map[a];b.operations=d.isHost?b.hostOperations:b.clientOperations}};d.connectMyPlayerInfo=function(){d.myPlayerRef.onDisconnect().remove();
d.myPlayerRef.set({name:d.myPlayerInfo.name,isHost:!!d.myPlayerInfo.isHost})};d.updatePlayer=function(a,b){d.playersRef.child(a).transaction(function(a){if(a)return b})};d.prop={};d.prop.none=0;d.prop.change=1;d.prop.init=2;d.prop.writeNext=4;d.prop.low=8;d.prop.reckon=16;d.register=function(c,b,e){var f=e?e.props:null,f=f?a.utils.copyObject(f,!0):d.pickDefaultProps(b),g=e?e.hostOperations:null;g||(g={write_init:!0,write:!0,read:!0});var h=e?e.clientOperations:null;h||(h={write_init:!0,write:!0,read:!0});
var j=d.isHost?g:h,k=e?e.readCallback:null,l=e?e.lowTimer:void 0;l||(l=3);e=Array.isArray(b);var m=d.mRef.child(c);d.map[c]={sourceData:b,props:f,curData:{},ref:m,operations:j,hostOperations:g,clientOperations:h,isArray:e,lowTimer:l,lowTimerMax:l};if(j.write_init||j.write)if(d.debugLog("write initial value "+c),e){!j.write_init&&0<b.length&&a.console.log("rat sync ERROR: please don't register an array with write but no write_init");for(g=0;g<b.length;g++)h=d.copyProps(b[g],f),l=m.push(h),syncID=l.key,
b[g]._syncID=l.key,d.map[c].curData[syncID]=h}else h=d.copyProps(b,f),d.map[c].curData=h,j.write_init&&m.set(h);if(j.read)if(e)m.on("child_added",function(e){if(d.suppressRead!==c){var f=d.map[c];d.debugLog("read: child_added "+c+" : "+e.key);var g=e.val();e=e.key;0>d.findInSourceListByID(b,e)&&(f.curData[e]=g,g._syncID=e,f=a.utils.copyObject(g,!0),b.push(f))}}),m.on("child_removed",function(a){var e=d.map[c];d.debugLog("read: child_removed "+c+" : "+a.key);var f=d.findInSourceListByID(b,a.key);0<=
f&&(delete e.curData[a.key],b.splice(f,1))}),m.on("child_changed",function(a){var e=d.map[c],f=a.key,g=d.findInSourceListByID(b,f);d.debugLog("read: child_changed "+c+" : "+a.key+" :#"+g);0<=g&&(a=a.val(),e.isWriting||d.applyProps(a,e.sourceData[g],e.props),e.curData[f]=d.copyProps(a,e.props),k&&!e.isWriting&&k(c,a,g))});else m.on("value",function(a){var b=d.map[c];d.debugLog("read: value for '"+c+"' : "+a.key);if(a=a.val())b.isWriting||d.applyProps(a,b.sourceData,b.props),b.curData=d.copyProps(a,
b.props),k&&!b.isWriting&&k(c,a)})};d.pickDefaultProps=function(a){Array.isArray(a)&&(a=a[0]);if(!a)return{};var b={},d;for(d in a)a.hasOwnProperty(d)&&(void 0===typeof a[d]||"function"===typeof a[d]||(b[d]=1));return b};d.findInSourceListByID=function(a,b){for(var d=0;d<a.length;d++)if(a[d]._syncID===b)return d;return-1};d.copyProps=function(c,b){if(Array.isArray(c)){for(var e=[],f=0;f<c.length;f++){var g=d.copyProps(c[f],b);e.push(g)}return e}e={};for(f in b)g=typeof c[f],"undefined"===g||"function"===
g||(e[f]="object"===g?a.utils.copyObject(c[f],!0):c[f]);return e};d.applyProps=function(a,b){for(var e in a)if("object"===typeof a[e]){if(!b[e]||"object"!==typeof b[e])b[e]={};d.applyProps(a[e],b[e],null)}else b[e]=a[e]};d.update=function(a){var b=d.timer;d.timer+=a;for(var e in d.map){var f=d.map[e];f.lowTimer&&!f.updateLow&&(f.lowTimer-=a,0>=f.lowTimer&&(f.updateLow=!0,f.lowTimer=f.lowTimerMax))}d.config.hostMigration&&(d.config.matchConfig&&(b/2|0)!==(d.timer/2|0))&&d.checkActiveHost();d.isHost&&
(b/2|0)!==(d.timer/2|0)&&d.checkActiveOwners()};d.checkActiveHost=function(){if(d.isConnected()){var c=!1,b,e;for(e in d.playerList)d.playerList[e].isHost?c=!0:b||(b=e);c||(a.console.log("detected no host"),b===d.myPlayerInfo._syncID&&d.promoteHost())}};d.checkActiveOwners=function(){var c={},b=!1,e;for(e in d.ownList)d.playerList[d.ownList[e]]||(c[e]=null,b=!0,a.console.log("Dead owner - object available again."));b&&d.ownRef.update(c)};d.updateObjectIfChanged=function(a,b){function e(a,b,c,f){var k=
!1;if(Array.isArray(b)&&void 0!==c){a.length!==b.length&&(d.debugLog("write [] "+f+" (whole array) "),j[f]=b,h=!0);for(var l=0;l<b.length;l++)e(a[l],b[l],c,f+"/"+l)&&(k=!0);return k}var m=c;void 0===m&&(m=b);for(l in m){var m=!1,n=0;c&&(c[l]&&"object"!==typeof c[l])&&(n=c[l]);n&d.prop.writeNext&&(m=!0,c[l]&=~d.prop.writeNext,n&=d.prop.reckon,n&=d.prop.low);if(!(n&d.prop.reckon)){var p=b[l],u=a[l];if(p&&!u||u&&!p||typeof u!==typeof p)m=!0;if(!m&&"object"===typeof p){var z=void 0;c&&"object"===typeof c[l]&&
(z=c[l]);e(u,p,z,f+"/"+l)&&(k=!0)}else p!==u&&(m=!0);if(m&&(!(n&d.prop.low)||g.updateLow))d.debugLog("write-> "+f+" . "+l),j[f+"/"+l]=p,k=h=!0}}return k}function f(a,b,c,d){j={};h=!1;e(a,b,c,"");if(b._syncUpdates){for(var f in b._syncUpdates)j[f]=b._syncUpdates[f];delete b._syncUpdates;h=!0}h&&d.update(j)}var g=d.map[a];if(g&&g.operations.write){var h=!1,j={};b||(b=g.sourceData);g.isWriting=!0;if(g.isArray){for(var k=0;k<b.length;k++){var j={},l=b[k]._syncID;if(l)f(g.curData[l],b[k],g.props,g.ref.child(l));
else{var m=d.copyProps(b[k],g.props);d.suppressRead=a;var n=g.ref.push(m);d.suppressRead=0;l=n.key;b[k]._syncID=n.key;g.curData[l]=m;d.debugLog("write-> "+a+" child "+l+" (new)")}}for(var p in g.curData)0>d.findInSourceListByID(b,p)&&(d.debugLog("delete-> "+a+" child "+p),delete g.curData[p],g.ref.child(p).remove())}else f(g.curData,b,g.props,g.ref);g.isWriting=!1;g.updateLow=!1}};d.updateAllChanges=function(){for(var a in d.map)d.updateObjectIfChanged(a,d.map[a].sourceData)};d.markChanged=function(a,
b,d){b._syncUpdates=b._syncUpdates||{};b._syncUpdates["/"+d]=b[d]};d.queueRequest=function(a,b){var e={code:a,params:b,timestamp:(new Date).getTime(),playerID:d.myPlayerInfo._syncID};d.requestsRef.push(e)};d.requestOwnership=function(a,b,e){!b&&void 0!==e&&(b=d.map[a].sourceData[e]);b&&d.queueRequest("own",{key:a,syncID:b._syncID,playerID:d.myPlayerInfo._syncID})};d.releaseOwnership=function(a,b,e){!b&&void 0!==e&&(b=d.map[a].sourceData[e]);b&&d.queueRequest("disown",{key:a,syncID:b._syncID,playerID:d.myPlayerInfo._syncID})};
d.queueEvent=function(a,b){var e={code:a,params:b,timestamp:(new Date).getTime()};d.eventsRef.push(e)};d.queueChat=function(a,b,e){b||(b="chat");e||(e=null);a={text:a,code:b,params:e,timestamp:(new Date).getTime(),playerID:d.myPlayerInfo._syncID,playerName:d.myPlayerInfo.name};d.chatRef.push(a)};d.watchObject=function(a,b){d.mRef.child(a).on("value",function(d){b(a,d.val())})}});
rat.modules.add("rat.live.r_match",[{name:"rat.live.r_firebase",processBefore:!0},{name:"rat.os.r_system",processBefore:!0},"rat.debug.r_console"],function(a){a.live||(a.live={});a.live.match={};var d=a.live.match;d.init=function(c,b){a.console.log("matchmaking init");d.connection=new a.live.firebase.Connection(c,b);d.mGamesRef=d.connection.ref("match/")};d.shutDown=function(){a.console.log("matchmaking shut down");d.connection.close();d.connection=null};d.isReady=function(){return d.connection.isReady()};
d.isConnected=function(){return d.connection.connected};d.watchGameList=function(a){d.mGamesRef.on("value",function(b){var e=b.val();b=[];d.gameListVal=e;for(var f in e)e.hasOwnProperty(f)&&(e[f].id=f,b.push(e[f]),d.connection.ref("games/"+f+"/_players/").on("value",function(a){var b=0,c=null;if(a=a.val())for(var d in a)b++,a[d].isHost&&(c=a[d].name);e[f].activePlayerCount=b;e[f].activeHostName=c}));a(b)})};d.unwatchGameList=function(){d.mGamesRef.off()};d.hostGame=function(a,b,e,f){var g=d.mGamesRef.push();
d.hostGameWithID(g.key,a,b,e,f);return g.key};d.hostGameWithID=function(a,b,e,f){e||(e={});var g=d.mGamesRef.child(a);g.onDisconnect().remove();g.set({name:b,config:e});f&&f({isHost:!0,name:b,id:a,config:e})};d.joinGame=function(c,b){if(!this.gameListVal)return!1;var d=this.gameListVal[c];if(!d)return!1;b&&(d=a.utils.copyObject(d,!0),d.id=c,d.isHost=!1,b(d));return!0}});
rat.modules.add("rat.graphics.r_graphics",[{name:"rat.math.r_math",processBefore:!0},"rat.graphics.r_color","rat.os.r_system","rat.os.r_events","rat.debug.r_console","rat.debug.r_profiler","rat.math.r_matrix","rat.utils.r_utils","rat.utils.r_shapes"],function(a){function d(){if(a.system.has.winJS){var b=window.Windows.UI.ViewManagement.ApplicationViewState;switch(a.graphics.winJSAppView.value){case b.fullScreenLandscape:a.graphics.viewState="fullscreen";break;case b.filled:a.graphics.viewState="filled";
break;case b.snapped:a.graphics.viewState="snapped";break;case b.fullscreenPortrait:a.graphics.viewState="fullscreenPortrait";break;default:a.graphics.viewState="unknown"}a.graphics.viewState=a.graphics.winJSAppView.value}else a.graphics.viewState="fullscreen"}function c(){var b={x:a.graphics.SCREEN_WIDTH,y:a.graphics.SCREEN_HEIGHT};if(e.x!==b.x||e.y!==b.y)a.events.fire("resize",b,e),e.x=b.x,e.y=b.y}var b=a.math,e={x:0,y:0};a.graphics={SCREEN_WIDTH:760,SCREEN_HEIGHT:600,globalScale:{x:void 0,y:void 0},
globalTranslate:null,autoTargetSize:{x:0,y:0},autoResizeCanvas:!0,autoFillOnResize:!1,autoCenterCanvas:!1,autoScaleWithDevicePixelRatio:!1,canvasPixelRatio:1,autoClearCanvas:!1,autoClearColor:"#000",frameIndex:0,ctx:null,frameStats:{totalElementsDrawn:0},cursorPos:{x:-1,y:-1},minAutoScale:1E-7,mTransform:void 0,mStateStack:[],viewState:"fullscreen"};var f=!1;a.graphics.setContext=function(b){a.graphics.ctx=b};a.graphics.getContext=function(){return a.graphics.ctx};a.graphics.init=function(b){var e=
a.graphics;e.mTransform=new a.Matrix;e.canvas=document.getElementById(b);a.system.has.Wraith&&"PS4"===Wraith.w_onPlatform&&(e.canvas.style={});e.ctx=e.canvas.getContext("2d");e.SCREEN_WIDTH=e.canvas.width;e.SCREEN_HEIGHT=e.canvas.height;e.winJSAppView=void 0;a.system.has.winJS&&(e.winJSAppView=window.Windows.UI.ViewManagement.ApplicationView);d();a.addOSEventListener(window,"resize",e.resizeCallback);c()};a.graphics.resizeCallback=function(b){d();a.events.fire("before_resize",b);a.graphics.callAutoScale&&
a.graphics.autoScaleCallback()};a.graphics.setAutoClear=function(b,c){a.graphics.autoClearCanvas=b;typeof("undefined"!==c)&&(a.graphics.autoClearColor=c)};a.graphics.clearCanvas=function(){var b=a.graphics.getContext();""===a.graphics.autoClearColor||a.graphics.Video&&0<a.graphics.Video.numberOfActiveBGVideos?b.clearRect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT):(b.fillStyle=a.graphics.autoClearColor,b.fillRect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT))};a.graphics.beginFrame=
function(){a.graphics.frameIndex++;a.graphics.frameStats.totalElementsDrawn=0;a.profiler&&a.profiler.beginFrame&&a.profiler.beginFrame()};a.graphics.endFrame=function(){a.profiler&&a.profiler.endFrame&&a.profiler.endFrame()};a.graphics.setGlobalScale=function(b,d){a.graphics.globalScale.x=b||1;a.graphics.globalScale.y=d||1;a.graphics.SCREEN_WIDTH=a.graphics.canvas.width/a.graphics.globalScale.x|0;a.graphics.SCREEN_HEIGHT=a.graphics.canvas.height/a.graphics.globalScale.y|0;c()};a.graphics.clearGlobalScale=
function(){a.graphics.globalScale.x=void 0;a.graphics.globalScale.y=void 0;a.graphics.SCREEN_WIDTH=a.graphics.canvas.width;a.graphics.SCREEN_HEIGHT=a.graphics.canvas.height;c()};a.graphics.setGlobalTranslate=function(b,c){a.graphics.globalTranslate={x:b,y:c}};a.graphics.clearGlobalTranslate=function(){a.graphics.globalTranslate={x:0,y:0}};a.graphics.hasGlobalScale=function(){var b=a.graphics.globalScale;return b.x&&b.y&&(1!==b.x||1!==b.y)};a.graphics.counterGlobalScale=function(b){a.graphics.hasGlobalScale()&&
a.graphics.scale(1/a.graphics.globalScale.x,1/a.graphics.globalScale.y,b)};a.graphics.counterGlobalTranslate=function(b){a.graphics.globalTranslate&&a.graphics.translate(-a.graphics.globalTranslate.x,-a.graphics.globalTranslate.y,b)};a.graphics.autoScaleCallback=function(){var c=a.utils.getWindowSize(),d=c.w/a.graphics.autoTargetSize.w,e=c.h/a.graphics.autoTargetSize.h;e<d&&(d=e);d<a.graphics.minAutoScale&&(d=a.graphics.minAutoScale);!a.graphics.allowAutoUpscale&&1<d&&(d=1);if(a.graphics.autoResizeCanvas&&
a.graphics.canvas){var f=b.floor(a.graphics.autoTargetSize.w*d),l=b.floor(a.graphics.autoTargetSize.h*d),m=c.w-f,e=c.h-l;a.graphics.autoFillOnResize&&(f=c.w,l=c.h);a.graphics.autoScaleWithDevicePixelRatio&&!a.graphics.allowAutoUpscale&&a.console.log("WARNING: autoScaleWithDevicePixelRatio is not compatible with rat.graphics.allowAutoUpscale being false.");if(a.graphics.autoScaleWithDevicePixelRatio&&a.graphics.allowAutoUpscale){var n=a.graphics.canvas.getContext("2d"),c=window.devicePixelRatio||1,
n=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;if(a.system.has.windows8&&Windows&&Windows.Graphics&&Windows.Graphics.Display){var p=Windows.Graphics.Display.DisplayInformation?Windows.Graphics.Display.DisplayInformation.getForCurrentView():Windows.Graphics.Display.DisplayProperties;p&&(n=100,c=p.resolutionScale)}p=c/n;a.graphics.canvasPixelRatio=p;a.graphics.canvas.style.width=""+f+"px";a.graphics.canvas.style.height=
""+l+"px";f*=p;l*=p;d*=p;1!==p&&a.console.log("device pixel ratio "+p+" : "+c+" / "+n)}a.graphics.canvas.width=f;a.graphics.canvas.height=l;a.graphics.autoCenterCanvas&&(f=b.floor(m/2),e=b.floor(e/2),a.graphics.canvas.style["margin-left"]=""+f+"px",a.graphics.canvas.style["margin-top"]=""+e+"px")}a.graphics.setGlobalScale(d,d)};a.graphics.setAutoScaleFromIdeal=function(b,c,d,e){a.graphics.autoTargetSize.w=b;a.graphics.autoTargetSize.h=c;"undefined"!==typeof d&&(a.graphics.autoResizeCanvas=d);a.graphics.allowAutoUpscale=
e;a.graphics.callAutoScale=!0;a.graphics.autoScaleCallback()};a.graphics.rotate=function(b,c){var d=c||a.graphics.ctx;f||a.graphics.mTransform.rotateSelf(b);d.rotate(b)};a.graphics.scale=function(b,c,d){void 0===c&&(c=b);d=d||a.graphics.ctx;f||a.graphics.mTransform.scaleSelf(b,c);d.scale(b,c)};a.graphics.translate=function(b,c,d){d=d||a.graphics.ctx;f||a.graphics.mTransform.translateSelf(b,c);d.translate(b,c)};a.graphics.transform=function(b,c,d,e,l,m,n){Array.isArray(b.m)&&(b=b.m);Array.isArray(b)&&
(n=e,c=b[1][0],d=b[0][1],e=b[1][1],l=b[0][2],m=b[1][2],b=b[0][0]);n=n||a.graphics.ctx;f||a.graphics.mTransform.multSelf([[b,c,l],[d,e,m],[0,0,1]]);n.transform(b,c,d,e,l,m)};a.graphics.setTransform=function(b,c,d,e,f,m,n){a.graphics.resetTransform();a.graphics.transform(b,c,d,e,f,m,n)};a.graphics.resetTransform=function(b){b=b||a.graphics.ctx;f||a.graphics.mTransform.loadIdent();b.setTransform(1,0,0,1,0,0)};a.graphics.save=function(b){var c=a.graphics.ctx;b=b||{};b.ignoreRatMat=void 0===b.ignoreRatMat?
f:f||b.ignoreRatMat||!1;c.save();c={ignoreRatMat:f,transform:void 0};(f=b.ignoreRatMat)?a.graphics.mStateStack.push(c):(c.transform=a.graphics.mTransform.m,a.graphics.mStateStack.push(c),b=a.graphics.mTransform.m,b=[[b[0][0],b[0][1],b[0][2]],[b[1][0],b[1][1],b[1][2]],[b[2][0],b[2][1],b[2][2]]],a.graphics.mTransform.m=b)};a.graphics.restore=function(){a.graphics.ctx.restore();var b=a.graphics.mStateStack.pop();f=b.ignoreRatMat;b.transform&&(a.graphics.mTransform.m=b.transform)};a.graphics.getTransform=
function(){return a.graphics.mTransform};a.graphics.transformPoint=function(b,c){return a.graphics.mTransform.transformPoint(b,c)};a.graphics.pushPerfMark=function(b,c){c||(c=a.graphics.ctx);c.pushPerfMark&&c.pushPerfMark(b)};a.graphics.popPerfMark=function(b){b||(b=a.graphics.ctx);b.popPerfMark&&b.popPerfMark()};a.graphics.setImageSmoothing=function(b,c){c||(c=a.graphics.ctx);void 0!==c.imageSmoothingEnabled?c.imageSmoothingEnabled=b:(c.mozImageSmoothingEnabled=b,c.webkitImageSmoothingEnabled=b,
c.msImageSmoothingEnabled=b)};a.graphics.drawLine=function(b,c,d,e,f){var m={x:0,y:0},n={x:0,y:0};void 0!==b.x?(m=b,void 0!==c.x?(n=c,f=d):(n.x=c,n.y=d,f=e)):(m.x=b,m.y=c,void 0!==d.x?(n=d,f=e):(n.x=d,n.y=e));b=a.graphics.ctx;f&&(f.color&&(b.strokeStyle=f.color.toString()),void 0!==f.lineWidth&&(b.lineWidth=f.lineWidth));b.beginPath();b.moveTo(m.x,m.y);b.lineTo(n.x,n.y);b.stroke()};a.graphics.drawText=function(b,c,d,e){c=c||0;d=d||0;e?a.graphics.ctx.fillText(b,c,d,e):a.graphics.ctx.fillText(b,c,d)};
a.graphics.drawTextArc=function(b,c,d,e,f,m){m=m||{};var n;f||(n=a.graphics.ctx.measureText(b),void 0!==n.width&&(n=n.width),f=a.math.min(n/e),m.angleScale&&(f*=m.angleScale));var p=a.graphics.ctx;m.stroke&&m.lineWidth&&(p.lineWidth=m.lineWidth);n=b.length;p.save();p.translate(c,d);p.rotate(-1*f/2);p.rotate(-1*(f/n)/2);for(d=0;d<n;d++)p.rotate(f/n),p.save(),p.translate(0,-1*e),c=b[d],m.stroke?p.strokeText(c,0,0):p.fillText(c,0,0),p.restore();p.restore()};a.graphics.drawCircle=function(b,c,d,e){var f=
a.graphics.ctx;f.beginPath();void 0!==b.center?(e=c,d=b.radius,c=b.center.y,b=b.center.x):void 0!==b.x&&(void 0!==b.r?(e=c,d=b.r):(e=d,d=c),c=b.y,b=b.x);void 0!==e&&(e.color&&(e.fill?f.fillStyle=e.color.toString():f.strokeStyle=e.color.toString()),!e.fill&&void 0!==e.lineWidth&&(f.lineWidth=e.lineWidth));f.arc(b,c,d,0,a.math.PI2,!0);f.closePath();e&&e.fill?f.fill():f.stroke()};a.graphics.drawRect=function(b,c){c=c||{};c.fill?(c.color&&(a.graphics.ctx.fillStyle=c.color.toString()),a.graphics.ctx.fillRect(b.x,
b.y,b.w,b.h)):(c.lineWidth&&(a.graphics.ctx.lineWidth=c.lineWidth),c.color&&(a.graphics.ctx.stokeStyle=c.color.toString()),a.graphics.ctx.strokeRect(b.x,b.y,b.w,b.h))};a.graphics.drawShapeList=function(b){if(b&&!(0>=b.length))for(var c,d=0;d!==b.length;++d){c=b[d];switch(c.type){case "circle":a.graphics.drawCircle(c);break;case "rect":a.graphics.drawRect(c);break;default:a.console.log("Unable able to identify shape for drawing\n")}a.graphics.drawShapeList(c.children)}};a.graphics.drawFillbar=function(b,
c,d,e,f,m,n,p,q,r){f=f*d/m;m=a.graphics.getContext();m.fillStyle=n.toString();m.fillRect(b,c,d,e);m.fillStyle=p.toString();m.fillRect(b,c,f,e);m.lineWidth=r||1;m.strokeStyle=q.toString();m.strokeRect(b,c,d,e)};a.graphics.draw_fillbar=a.graphics.drawFillbar;a.graphics.makePolygonShape=function(b,c,d,e,f){"undefined"===typeof f&&(f=3);"undefined"===typeof e&&(e=0);var m=2*Math.PI/f;a.graphics.ctx.beginPath();for(var n=0;n<f;n++){var p=Math.cos(e+n*m)*d,q=Math.sin(e+n*m)*d;0===n?a.graphics.ctx.moveTo(b+
p,c+q):a.graphics.ctx.lineTo(b+p,c+q)}a.graphics.ctx.closePath()};a.graphics.fillPolygon=function(b,c,d,e,f){a.graphics.makePolygonShape(b,c,d,e,f);a.graphics.ctx.fill()};a.graphics.strokePolygon=function(b,c,d,e,f){a.graphics.makePolygonShape(b,c,d,e,f);a.graphics.ctx.stroke()};a.graphics.radialClip=function(a,b,c,d,e,f,n){a.beginPath();a.moveTo(b,c);a.arc(b,c,d,e,f,n);a.closePath();a.clip()};a.graphics.roundRect=function(b,c){var d=Math.PI,e=a.graphics.ctx;e.beginPath();var f=b.x+c,m=b.y+c;e.arc(f,
m,c,d,1.5*d);f=b.x+b.w-c;e.lineTo(f,b.y);e.arc(f,m,c,1.5*d,2*d);m=b.y+b.h-c;e.lineTo(b.x+b.w,m);e.arc(f,m,c,0,0.5*d);f=b.x+c;e.lineTo(f,b.y+b.h);e.arc(f,m,c,0.5*d,d);e.closePath()};a.graphics.drawMiniArrow=function(b,c,d){var e=a.graphics.ctx;e.strokeStyle=d;e.lineWidth=3;e.beginPath();e.moveTo(b-2,c);e.lineTo(b+7,c);e.closePath();e.stroke();e.beginPath();e.lineWidth=2;e.moveTo(b+4,c-3);e.lineTo(b+8,c);e.lineTo(b+4,c+3);e.closePath();e.stroke()};a.graphics.drawArrow=function(b,c,d,e,f,m){var n=a.graphics.ctx;
d-=b;var p=e-c;e=Math.sqrt(d*d+p*p);d=Math.atan2(p,d);e/=4;a.graphics.save();a.graphics.translate(b,c);a.graphics.rotate(d);n.beginPath();n.moveTo(-e,-e);n.lineTo(-e,e);n.lineTo(e,e);n.lineTo(e,2*e);n.lineTo(3*e,0);n.lineTo(e,-2*e);n.lineTo(e,-e);n.closePath();n.fillStyle=f;n.fill();n.lineWidth=1;n.strokeStyle=m;n.stroke();a.graphics.restore()};a.graphics.drawPlus=function(){var b=a.graphics.ctx;b.fillStyle="#70B070";b.fillRect(-7,-3,14,6);b.fillRect(-3,-7,6,14)};a.graphics.drawMinus=function(){var b=
a.graphics.ctx;b.fillStyle="#C07070";b.fillRect(-7,-3,14,6)};a.graphics.drawParallelogram=function(b,c,d,e,f,m,n){"undefined"===typeof n&&(n=1);if(0!==n){var p=a.graphics.ctx;f=Math.tan(f)*e;var q=b+f*(1-n);n=c+(1-n)*e;p.beginPath();p.moveTo(q,n);p.lineTo(q+d,n);p.lineTo(b+d+f,c+e);p.lineTo(b+f,c+e);p.closePath();p.fillStyle=m;p.fill()}};a.graphics.drawSegmentOrArc=function(b,c,d){c.toString()&&(c=c.toString());d=d||1;var e=a.graphics.ctx;e.beginPath();"arc"===b.type?e.arc(b.center.x,b.center.y,b.radius,
b.startAngle,b.endAngle,b.anticlockwise):(e.moveTo(b.point1.x,b.point1.y),e.lineTo(b.point2.x,b.point2.y),e.closePath());e.lineWidth=d;e.strokeStyle=c;e.stroke()};a.graphics.setupMatrixForRendering=function(){a.graphics.globalTranslate&&a.graphics.translate(a.graphics.globalTranslate.x,a.graphics.globalTranslate.y);a.graphics.hasGlobalScale()&&a.graphics.scale(a.graphics.globalScale.x,a.graphics.globalScale.y)}});
rat.modules.add("rat.input.r_input",["rat.debug.r_console","rat.os.r_system","rat.math.r_math","rat.utils.r_utils","rat.graphics.r_graphics","rat.input.r_voice","rat.input.r_keyboard",{name:"rat.input.r_input_xbo",platform:"xbox"},{name:"rat.input.r_input_le",platform:"xboxLE"}],function(a){function d(a,b){a.lastButtons|=b.lastButtons;a.newButtons|=b.newButtons;a.rawButtons|=b.rawButtons;a.leftStick.x+=b.leftStick.x;a.leftStick.y+=b.leftStick.y;a.rightStick.x+=b.rightStick.x;a.rightStick.y+=b.rightStick.y;
b.leftTrigger>a.leftTrigger&&(a.leftTrigger=b.leftTrigger);b.rightTrigger>a.rightTrigger&&(a.rightTrigger=b.rightTrigger)}function c(b){b.x=a.math.clamp(b.x,-1,1);b.y=a.math.clamp(b.y,-1,1);var c=a.math.sqrt(b.x*b.x+b.y*b.y);1<c&&(b.x/=c,b.y/=c)}function b(b){var c="mousedown";"touchmove"===b.type?c="mousemove":"touchstart"===b.type?c="mousedown":"touchend"===b.type&&(c="mouseup");for(var d=!1,e=0;e!==b.changedTouches.length;++e)var f=a.input.setTouchPositionOnEvent(b.changedTouches[e],b),f=a.input.mouseToRatEvent(f,
c,!0),d=d||f.handled;a.input.handlePreventDefault({sysEvent:b},d)}function e(b){if(a.input.customUIEventTranslations)for(var c=0;c<a.input.customUIEventTranslations.length;c++){var d=a.input.customUIEventTranslations[c];if(b===d.which)return d.result}if(b===a.keys.leftArrow)return"left";if(b===a.keys.upArrow)return"up";if(b===a.keys.rightArrow)return"right";if(b===a.keys.downArrow)return"down";if(b===a.keys.enter)return"enter";if(b===a.keys.esc||b===a.keys.backspace)return"back";if(b===a.keys.leftSys||
b===a.keys.rightSys)return"menu";if(b===a.keys.selectKey)return"view";if(a.system.has.xbox&&a.input.translateGamePadKeys){c=window.WinJS.Utilities.Key;if(b===c.gamepadDPadLeft||b===c.gamepadLeftThumbstickLeft)return"left";if(b===c.gamepadDPadUp||b===c.gamepadLeftThumbstickUp)return"up";if(b===c.gamepadDPadRight||b===c.gamepadLeftThumbstickRight)return"right";if(b===c.gamepadDPadDown||b===c.gamepadLeftThumbstickDown)return"down";if(b===c.gamepadA)return"enter";if(b===c.gamepadB)return"back"}return null}
a.input={};var f=!1;a.input.useLastUIInputType=!1;a.input.lastUIInputType="mouse";a.input.allowRepeatEvents={buttons:!1,directions:!0};a.input.standardPreventDefaultOnEvents=!1;a.input.allowedControllers=[];a.input.activeControllerID=0;a.input.controllers=[];a.input.controllers.getByID=function(b){for(var c=0;c<a.input.controllers.length;++c)if(a.input.controllers[c].id===b)return a.input.controllers[c]};a.input.gamepadKeyFakeEnabled=!1;a.input.BUTTON_UP=1;a.input.BUTTON_DOWN=2;a.input.BUTTON_LEFT=
4;a.input.BUTTON_RIGHT=8;a.input.BUTTON_START=16;a.input.BUTTON_SELECT=32;a.input.BUTTON_A=256;a.input.BUTTON_B=512;a.input.BUTTON_C=1024;a.input.BUTTON_D=2048;a.input.BUTTON_X=a.input.BUTTON_C;a.input.BUTTON_Y=a.input.BUTTON_D;a.input.BUTTON_LT=4096;a.input.BUTTON_LB=8192;a.input.BUTTON_RT=16384;a.input.BUTTON_RB=32768;a.input.BUTTON_DPAD_UP=65536;a.input.BUTTON_DPAD_DOWN=131072;a.input.BUTTON_DPAD_LEFT=262144;a.input.BUTTON_DPAD_RIGHT=524288;a.input.BUTTON_LEFT_STICK=1048576;a.input.BUTTON_RIGHT_STICK=
2097152;a.input.BUTTON_LSTICK_UP=16777216;a.input.BUTTON_LSTICK_DOWN=33554432;a.input.BUTTON_LSTICK_LEFT=67108864;a.input.BUTTON_LSTICK_RIGHT=134217728;a.input.BUTTON_RSTICK_UP=268435456;a.input.BUTTON_RSTICK_DOWN=536870912;a.input.BUTTON_RSTICK_LEFT=1073741824;a.input.BUTTON_RSTICK_RIGHT=2147483648;a.input.BUTTON_COUNT=32;a.input.GAMEPAD_CONTROLLER_MAPPING={BUTTON_A:0,BUTTON_B:1,BUTTON_C:2,BUTTON_X:2,BUTTON_D:3,BUTTON_Y:3,BUTTON_LB:4,BUTTON_RB:5,BUTTON_LT:6,BUTTON_RT:7,BUTTON_SELECT:8,BUTTON_START:9,
BUTTON_LEFT_STICK:10,BUTTON_RIGHT_STICK:11,BUTTON_DPAD_UP:12,BUTTON_DPAD_DOWN:13,BUTTON_DPAD_LEFT:14,BUTTON_DPAD_RIGHT:15,leftStick:{x:-1,y:-2},rightStick:{x:-3,y:-4},leftTrigger:6,rightTrigger:7};a.input.ControllerChangeType={REMOVED:0,ADDED:1,UPDATED:2};a.input.init=function(){var b=a.input,c=a.system.has;b.controllers.pollingForced=!1;b.controllers.pollingAllowed=!1;if(c.xbox)a.input.initXbox();else if(!c.xboxLE)if(c.gamepadAPI){b.controllers.pollingAllowed=!0;c.gamepadAPIEvent?(window.addEventListener("gamepadconnected",
b.onSysControllerAdded),window.addEventListener("gamepaddisconnected",b.onSysControllerRemoved)):b.controllers.pollingForced=!0;var d=navigator,e=d.getGamepads||d.mozGetGamepads||d.webkitGetGamepads||function(){return d.gamepads||d.mozGamepads||d.webkitGamepads||[]},g=e;a.system.has.chromeBrowser&&(g=function(){for(var a=e.call(this),b=[],c=0;c<a.length;++c){var d=a[c];if(null!=d){var f={},g;for(g in d)f[g]=d[g];f.id+=f.index;b.push(f)}else b.push(null)}return b});var h=function(a,b){return!a?-1:
!b?1:b.index-a.index};b.controllers.getSystemControllers=function(){var b=g.call(d);if(!1===Array.isArray(b)){for(var c=[],e=b.length-1;0<=e;--e)c.unshift(b[e]);b=c}a.input.gamepadKeyFakeEnabled&&!a.console.state.consoleActive&&b.push(a.input.buildGamepadKeyFake());a.system.has.Wraith||(b=b.sort(h));return b}}else b.controllers.pollingAllowed=!0,f=b.controllers.pollingForced=!0,b.controllers.getSystemControllers=function(){var b=[];a.input.gamepadKeyFakeEnabled&&b.push(a.input.buildGamepadKeyFake());
return b}};a.input.setMouseHandler=function(b){a.input.mouseHandler=b};a.input.update=function(b){var c=a.input;c.controllers.pollingAllowed&&(c.controllers.pollingForced||0<c.controllers.length)&&c.updateControllers(b);a.input.keyboard.update(b)};a.input.debounceButtons=function(a){a.newButtons=a.rawButtons&~a.lastButtons;a.lastButtons=a.rawButtons};a.input.getControllerByID=function(b){for(var c,d=0;d<a.input.controllers.length;d++)if(c=a.input.controllers[d],c.id===b)return c};a.input.getActiveController=
function(){if(0>=a.input.controllers.length)return null;var b;if(0!==a.input.activeControllerID)for(b=0;b<a.input.controllers.length;b++)if(a.input.controllers[b].id===a.input.activeControllerID)return a.input.controllers[b];var c=void 0;for(b=0;b<a.input.controllers.length;b++)if(!c||c.index>a.input.controllers[b].index)c=a.input.controllers[b];return c};a.input.getCombinedControllers=function(b){if(0>=a.input.controllers.length)return null;var e=new a.input.Controller({},"COMBINED",-1,!0,0);if(!b||
0===b.length)b=a.input.allowedControllers;if(b&&0<b.length)for(var f=0;f<b.length;f++){var g=a.input.controllers.getByID(b[f]);d(e,g)}else if(0===a.input.allowedControllers.length||0===a.input.activeControllerID)for(b=0;b<a.input.controllers.length;b++)d(e,a.input.controllers[b]);c(e.leftStick);c(e.rightStick);return e};a.input.getActiveControllerID=function(){var b=a.input.getActiveController();return!b?null:b.id};a.input.setActiveControllerID=function(b){if(b=b||0)for(var c=0;c<a.input.controllers.length;c++){if(a.input.controllers[c].id===
b)return a.console.log("Setting active controller to "+b),a.input.activeControllerID=b,!0}else return a.console.log("Cleared active controller"),a.input.activeControllerID=b,!0;a.console.log("WARNING! Attempting to set active controller ID for controller "+b+" which cannot be found in the system");a.input.activeControllerID=0;return!1};a.input.getActiveControllerRawButtons=function(){var b=0,c=a.input.getActiveController();c&&(b=c.rawButtons);return b};a.input.getRealMousePosition=function(b){var c=
new a.Vector;b.pageX||b.pageY?(c.x=b.pageX,c.y=b.pageY):(c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);c.x-=a.graphics.canvas.offsetLeft;c.y-=a.graphics.canvas.offsetTop;a.graphics.globalTranslate&&(c.x-=a.graphics.globalTranslate.x,c.y-=a.graphics.globalTranslate.y);a.graphics.hasGlobalScale()&&(c.x/=a.graphics.globalScale.x/a.graphics.canvasPixelRatio,c.y/=a.graphics.globalScale.y/a.graphics.canvasPixelRatio);
a.mousePos.x=c.x;a.mousePos.y=c.y;return c};a.input.controllerIDAllowed=function(b){if(0===a.input.allowedControllers.length)return!0;for(var c=0;c<a.input.allowedControllers.length;c++)if(a.input.allowedControllers[c]===b)return!0;return!1};a.input.getEventWhich=function(b){if(a.system.has.xbox)switch(b.which){case 222:return 220;case 223:return 192;case 192:return 222}return b.which||0};a.input.Event=function(b,c){this.sysEvent=b;c=c||{};b=b||{};if(c.translatedFrom){var d=c.translatedFrom.sysEvent;
c.translatedFrom.sysEvent=void 0;a.utils.extendObject(this,[c.translatedFrom],!1);c.translatedFrom.sysEvent=d;this.translatedFrom=c.translatedFrom;void 0!==c.which&&(this.which=c.which)}this.eventType=c.type||"";void 0===this.controllerID&&(this.controllerID=b.deviceSessionId||b.controllerID||c.defaultControllerID||0);void 0===this.index&&(this.index=c.index||0);void 0===this.which&&(this.which=c.which,void 0===this.which&&(this.which=a.input.getEventWhich(b)));void 0===this.repeat&&(this.repeat=
c.repeat||!1);this.eventID=a.input.Event.nextID++};a.input.Event.nextID=1;a.input.checkAndDispatchControllerEvents=function(b,c){if(a.input.controllerIDAllowed(b.id)){var d=void 0,e,f,g;b.rawButtons!==b.lastButtons||0===b.rawButtons?b.repeatTimer.fullReset():b.repeatTimer.elapsed(c);if(b.newButtons)for(g=0;g<a.input.BUTTON_COUNT;g++)e=1<<g,0!==(b.newButtons&e)&&(f=e.toString(16),"00000000".substr(8-f.length-1),d=d||new a.input.Event({controllerID:b.id},{index:b.index}),d.eventType="buttondown",d.which=
e,a.input.dispatchEvent(d));var h;if(b.rawButtons!==b.lastButtons)for(g=0;g<a.input.BUTTON_COUNT;g++)e=1<<g,h=0!==(b.rawButtons&e),f=0!==(b.lastButtons&e),!0===f&&!1===h&&(d=d||new a.input.Event({controllerID:b.id},{index:b.index}),d.eventType="buttonup",d.which=e,a.input.dispatchEvent(d));f=0>=b.repeatTimer.buttons&&a.input.allowRepeatEvents.buttons;var r=0>=b.repeatTimer.directions&&a.input.allowRepeatEvents.directions;if(f||r){e={};f&&(e.buttons=!0);r&&(e.directions=!0);b.repeatTimer.repeatReset(e);
d&&(d.repeat=!0);for(g=0;g<a.input.BUTTON_COUNT;g++)if(e=1<<g,h=0!==(b.rawButtons&e))h=0!==(e&(a.input.BUTTON_UP|a.input.BUTTON_DOWN|a.input.BUTTON_LEFT|a.input.BUTTON_RIGHT)),h&&!r||!h&&!f||(d||(d=new a.input.Event({controllerID:b.id},{index:b.index}),d.repeat=!0),d.eventType="buttondown",d.which=e,a.input.dispatchEvent(d))}}};var g=[];a.input.registerEventHandler=function(a,b){a&&g.push({func:a,thisObj:b})};a.input.unRegisterEventHandler=function(a,b){if(a)for(var c=0;c!==g.length;++c)if(g[c].func===
a&&g[c].thisObj===b){g.splice(c,1);break}};a.input.dispatchEvent=function(b){for(var c,d=!1,e=-1;e!==g.length;++e){if(-1===e)if(a.console.state.consoleAllowed)c={func:a.console.handleEvent};else continue;else c=g[e];if(c=c.func.call(c.thisObj,b))return!0;void 0!==c&&(d=!0)}if("ui"!==b.eventType&&(b=a.input.translateToUIEvent(b)))return a.input.dispatchEvent(b);if(d)return!1};a.input.standardizeKeyEvent=function(a){null===a.which&&(a.which=a.charCode?a.charCode:a.keyCode?a.keyCode:0)};a.input.charCodeFromEvent=
function(a){return String.fromCharCode(a.which).toLowerCase()};a.input.mouseToRatEvent=function(b,c,d){d=d||!1;var e=a.getRealMousePosition(b);a.graphics.cursorPos.x=e.x;a.graphics.cursorPos.y=e.y;c=new a.input.Event(b,{type:c,defaultControllerID:"mouse"});c.pos=e;c.isFromTouch=d;c.pointerID=void 0!==b.pointerId?b.pointerId:-1;if(d){d=12;a.graphics.hasGlobalScale()&&(d/=a.graphics.globalScale.x/a.graphics.canvasPixelRatio);e=b.webkitRadiusX;if(!e||1===e)e=d;c.touchRadiusX=e;b=b.webkitRadiusY;if(!b||
1===b)b=d;c.touchRadiusY=b}b=!1;a.input.mouseHandler&&(b=a.input.mouseHandler(c));b||(b=a.input.dispatchEvent(c));c.handled=b;return c};a.input.onMouseMove=function(b){if(!a.input.appBar||a.input.appBar.hidden)a.input.lastUIInputType="mouse",b=a.input.mouseToRatEvent(b,"mousemove","touch"===b.pointerType||2===b.pointerType||3===b.pointerType),a.input.handlePreventDefault(b,b.handled)};a.input.onMouseDown=function(b){if(!a.input.appBar||a.input.appBar.hidden)a.system.kong&&a.system.kong.focus(),b=
a.input.mouseToRatEvent(b,"mousedown","touch"===b.pointerType||2===b.pointerType||3===b.pointerType),a.input.handlePreventDefault(b,b.handled)};a.input.onMouseUp=function(b){if(!a.input.appBar||a.input.appBar.hidden)b=a.input.mouseToRatEvent(b,"mouseup","touch"===b.pointerType||2===b.pointerType||3===b.pointerType),a.input.handlePreventDefault(b,b.handled)};a.input.onMouseWheel=function(b){var c=window.event||b,d=0,d=c.wheelDelta?c.wheelDelta/120:c.deltaY?-c.deltaY/3:void 0!==c.detail?-c.detail:0;
b=new a.input.Event(b,{type:"mousewheel",defaultControllerID:"mouse"});b.wheelDelta=d;b.pos={x:a.mousePos.x,y:a.mousePos.y};a.input.dispatchEvent(b)};a.input.onKeyPress=function(b){b.char=b.char||String.fromCharCode(b.keyCode||b.charCode);if(b.char){b=new a.input.Event(b,{type:"keypress",defaultControllerID:"keyboard"});var c=a.input.dispatchEvent(b);a.input.handlePreventDefault(b,c)}};a.input.onKeyDown=function(b){a.input.keyboard.handleKeyDown(b);var c=new a.input.Event(b,{type:"keydown",defaultControllerID:"keyboard"}),
d=a.input.dispatchEvent(c);b.deviceSessionId&&a.system.has.xboxLE&&(b=a.input.getControllerInfo(b.deviceSessionId))&&a.input.handleGamepadDownEvent(c,b);a.input.handlePreventDefault(c,d)};a.input.onKeyUp=function(b){a.input.keyboard.handleKeyUp(b);var c=new a.input.Event(b,{type:"keyup",defaultControllerID:"keyboard"}),d=a.input.dispatchEvent(c);b.deviceSessionId&&a.system.has.xboxLE&&(b=a.input.getControllerInfo(b.deviceSessionId))&&a.input.handleGamepadUpEvent(c,b);a.input.handlePreventDefault(c,
d)};a.input.onContextMenu=function(b){b=a.input.mouseToRatEvent(b,"contextmenu",!1);a.input.handlePreventDefault(b,b.handled)};a.input.getControllerInfo=function(b){var c;a.system.has.xbox?c=a.input.getXboxControllerInfo(b):a.system.has.xboxLE&&(c={id:3735928559+b,user:{}});if(!c)return null;b=-1;for(var d=0;d<a.input.controllers.length;d++)if(a.input.controllers[d].id===c.id){b=d;break}0>b&&(c=a.input.buildRatControllerObject("xle",{type:"gamepad",id:c.id,user:c.user,rawButtons:0,newButtons:0,lastButtons:0}),
a.input.controllers.push(c),b=a.input.controllers.length-1);return a.input.controllers[b]};a.input.setControllerInfoByIndex=function(b,c){if(a.system.has.xboxLE){"string"===typeof b&&(b=parseInt(b));var d=a.input.buildRatControllerObject("xle",{type:"gamepad",id:b,user:{},rawButtons:0,newButtons:0,lastButtons:0});a.input.controllers[c]=d}};a.input.clearAllControllerButtons=function(){for(var b,c=0;c<a.input.controllers.length;c++)b=a.input.controllers[c],b.rawButtons=0,b.newButtons=0,b.lastButtons=
0,b.repeatTimer.fullReset()};a.input.setTouchPositionOnEvent=function(b,c){var d=a.utils.copyObject(c);if(void 0!==b.pageX||void 0!==b.pageY)d.pageX=b.pageX,d.pageY=b.pageY;void 0!==b.identifier?d.pointerId=b.identifier:void 0!==c.pointerId&&(d.pointerId=c.pointerId);return d};a.input.autoHandleEvents=function(){a.addOSKeyEventListener(window,"keydown",a.input.onKeyDown,!1);a.addOSKeyEventListener(window,"keyup",a.input.onKeyUp,!1);a.addOSKeyEventListener(window,"keypress",a.input.onKeyPress,!1);
navigator.msPointerEnabled||"undefined"!==typeof Windows?(a.addOSEventListener(window,"MSPointerMove",a.input.onMouseMove,!1),a.addOSEventListener(window,"MSPointerDown",a.input.onMouseDown,!1),a.addOSEventListener(window,"MSPointerUp",a.input.onMouseUp,!1)):(a.addOSEventListener(window,"mousemove",a.input.onMouseMove,!1),a.addOSEventListener(window,"mousedown",a.input.onMouseDown,!1),a.addOSEventListener(window,"mouseup",a.input.onMouseUp,!1),a.addOSEventListener(window,"contextmenu",a.input.onContextMenu,
!1),document.body&&(document.body.addEventListener("touchmove",b,!1),document.body.addEventListener("touchstart",b,!1),document.body.addEventListener("touchend",b,!1)));a.system.has.firefoxBrowser?a.addOSEventListener(window,"wheel",a.input.onMouseWheel,!1):a.addOSEventListener(window,"mousewheel",a.input.onMouseWheel,!1)};a.input.translateGamePadKeys=void 0;a.input.translateToUIEvent=function(b){var c=0;if("keydown"===b.eventType){if(c=e(b.which))a.input.lastUIInputType="keyboard"}else if("buttondown"===
b.eventType){if(c=b.which===a.input.BUTTON_LEFT?"left":b.which===a.input.BUTTON_UP?"up":b.which===a.input.BUTTON_RIGHT?"right":b.which===a.input.BUTTON_DOWN?"down":b.which===a.input.BUTTON_A?"enter":b.which===a.input.BUTTON_B?"back":b.which===a.input.BUTTON_START?"menu":b.which===a.input.BUTTON_SELECT?"view":null)a.input.lastUIInputType="controller"}else if("voice"===b.eventType&&(c=b.which===a.voice.commands.Back?"back":b.which===a.voice.commands.Menu?"menu":b.which===a.voice.commands.view?"view":
null))a.input.lastUIInputType="voice";return c?new a.input.Event(b.sysEvent,{translatedFrom:b,type:"ui",which:c}):null};a.input.getControllerDirection=function(b){var c={x:0,y:0};b&&(c.x=b.rawButtons&a.input.BUTTON_LEFT?c.x-1:b.rawButtons&a.input.BUTTON_RIGHT?c.x+1:c.x+b.leftStick.x,c.y=b.rawButtons&a.input.BUTTON_UP?c.y-1:b.rawButtons&a.input.BUTTON_DOWN?c.y+1:c.y+b.leftStick.y);return c};a.input.keyToDirection=function(b){return b===a.keys.leftArrow?{x:-1,y:0}:b===a.keys.rightArrow?{x:1,y:0}:b===
a.keys.upArrow?{x:0,y:-1}:b===a.keys.downArrow?{x:0,y:1}:null};a.input.getButtonValue=function(a){return"object"===typeof a?a.value:a};a.input.buildRatControllerObject=function(b,c){var d=a.input,e,f=a.input;switch(b){case "gamepadAPI":e=c.axes;for(var g=c.buttons.concat(),h=0;h<e.length;h++)g[-(h+1)]=e[h];e=d.GAMEPAD_CONTROLLER_MAPPING;void 0===c.connected&&(c.connected=!0);d=new d.Controller(c,c.id,c.index,c.connected,c.timestamp);d.rawButtons=(a.input.getButtonValue(g[e.BUTTON_A])?f.BUTTON_A:0)|
(a.input.getButtonValue(g[e.BUTTON_B])?f.BUTTON_B:0)|(a.input.getButtonValue(g[e.BUTTON_C])?f.BUTTON_C:0)|(a.input.getButtonValue(g[e.BUTTON_D])?f.BUTTON_D:0)|(a.input.getButtonValue(g[e.BUTTON_LB])?f.BUTTON_LB:0)|(a.input.getButtonValue(g[e.BUTTON_RB])?f.BUTTON_RB:0)|(a.input.getButtonValue(g[e.BUTTON_SELECT])?f.BUTTON_SELECT:0)|(a.input.getButtonValue(g[e.BUTTON_START])?f.BUTTON_START:0)|(a.input.getButtonValue(g[e.BUTTON_LEFT_STICK])?f.BUTTON_LEFT_STICK:0)|(a.input.getButtonValue(g[e.BUTTON_RIGHT_STICK])?
f.BUTTON_RIGHT_STICK:0)|(a.input.getButtonValue(g[e.BUTTON_DPAD_UP])?f.BUTTON_DPAD_UP:0)|(a.input.getButtonValue(g[e.BUTTON_DPAD_DOWN])?f.BUTTON_DPAD_DOWN:0)|(a.input.getButtonValue(g[e.BUTTON_DPAD_LEFT])?f.BUTTON_DPAD_LEFT:0)|(a.input.getButtonValue(g[e.BUTTON_DPAD_RIGHT])?f.BUTTON_DPAD_RIGHT:0);d.leftStick.x=g[e.leftStick.x]||0;d.leftStick.y=g[e.leftStick.y]||0;d.rightStick.x=g[e.rightStick.x]||0;d.rightStick.y=g[e.rightStick.y]||0;d.leftTrigger=g[e.leftTrigger]||0;d.rightTrigger=g[e.rightTrigger]||
0;return d;case "xle":return a.input.buildXboxLEControllerObject(b,c);case "xbox":return a.input.buildXboxControllerObject(b,c);default:return new d.Controller(c,0,-1,!1,0)}};a.input.buildGamepadKeyFake=function(){var b={id:"GAMEPAD_KEYFAKE",index:4,axes:[],buttons:[a.input.keyboard.isKeyDown(a.keys.a)|a.input.keyboard.isKeyDown(a.keys.enter),a.input.keyboard.isKeyDown(a.keys.b)|a.input.keyboard.isKeyDown(a.keys.esc),a.input.keyboard.isKeyDown(a.keys.x),a.input.keyboard.isKeyDown(a.keys.y),a.input.keyboard.isKeyDown(a.keys.leftBracket),
a.input.keyboard.isKeyDown(a.keys.rightBracket),a.input.keyboard.isKeyDown(a.keys.l)|a.input.keyboard.isKeyDown(a.keys.semicolon),a.input.keyboard.isKeyDown(a.keys.r)|a.input.keyboard.isKeyDown(a.keys.singleQuote),0,0,0,0,a.input.keyboard.isKeyDown(a.keys.i),a.input.keyboard.isKeyDown(a.keys.k),a.input.keyboard.isKeyDown(a.keys.j),a.input.keyboard.isKeyDown(a.keys.l)]};a.input.keyboard.isKeyDown(a.keys.upArrow)?b.axes[1]=-1:a.input.keyboard.isKeyDown(a.keys.downArrow)&&(b.axes[1]=1);a.input.keyboard.isKeyDown(a.keys.leftArrow)?
b.axes[0]=-1:a.input.keyboard.isKeyDown(a.keys.rightArrow)&&(b.axes[0]=1);return b};a.input.onSysControllerAdded=function(b){var c=a.input;if(a.system.has.xbox)return null;b=c.buildRatControllerObject("gamepadAPI",b.gamepad);return c.onControllerChange(c.ControllerChangeType.ADDED,b)};a.input.onSysControllerRemoved=function(b){var c=a.input;if(a.system.has.xbox)return null;b=c.buildRatControllerObject("gamepadAPI",b.gamepad);return c.onControllerChange(c.ControllerChangeType.REMOVED,b)};a.input.onControllerChange=
function(b,c){for(var d=a.input,e=-1,f=d.controllers,g=f.length-1;0<=g;--g)if(f[g].id===c.id){e=g;break}if(b===d.ControllerChangeType.REMOVED){if(-1===e)return c;c.rawButtons=0;c.leftStick.x=0;c.leftStick.y=0;c.rightStick.x=0;c.rightStick.y=0;c.connected=!1;c.leftTrigger=0;c.rightTrigger=0;c.repeatTimer.fullReset()}else b===d.ControllerChangeType.ADDED&&(c.connected=!0);-1===e?(c.lastButtons=0,f.push(c)):(c.repeatTimer=f[e].repeatTimer,c.lastButtons=f[e].lastButtons,f[e]=c);return c};a.input.updateControllers=
function(b){var c=a.input,d=c.controllers,e=c.thresholds;if(c.controllers.getSystemControllers){var g=c.controllers.getSystemControllers(),h,q,r,s;if(c.controllers.pollingForced&&(a.system.has.gamepadAPI||f)){var t="gamepadAPI";a.system.has.xbox&&(t="xbox");for(h=g.length-1;0<=h;--h)if(g[h]){s=c.buildRatControllerObject(t,g[h]);for(r=d.length-1;0<=r;--r)if(d[r].id===s.id){q=!0;break}r=s.connected?q?c.ControllerChangeType.UPDATED:c.ControllerChangeType.ADDED:c.ControllerChangeType.REMOVED;c.onControllerChange(r,
s)}}}for(h=d.length-1;0<=h;--h)g=d[h],g.leftStick.y<=-e.PRESSED&&(g.rawButtons|=c.BUTTON_LSTICK_UP),g.leftStick.y>=e.PRESSED&&(g.rawButtons|=c.BUTTON_LSTICK_DOWN),g.leftStick.x<=-e.PRESSED&&(g.rawButtons|=c.BUTTON_LSTICK_LEFT),g.leftStick.x>=e.PRESSED&&(g.rawButtons|=c.BUTTON_LSTICK_RIGHT),g.rightStick.y<=-e.PRESSED&&(g.rawButtons|=c.BUTTON_RSTICK_UP),g.rightStick.y>=e.PRESSED&&(g.rawButtons|=c.BUTTON_RSTICK_DOWN),g.rightStick.x<=-e.PRESSED&&(g.rawButtons|=c.BUTTON_RSTICK_LEFT),g.rightStick.x>=e.PRESSED&&
(g.rawButtons|=c.BUTTON_RSTICK_RIGHT),0!==(g.rawButtons&(c.BUTTON_DPAD_UP|c.BUTTON_LSTICK_UP))&&(g.rawButtons|=c.BUTTON_UP),0!==(g.rawButtons&(c.BUTTON_DPAD_DOWN|c.BUTTON_LSTICK_DOWN))&&(g.rawButtons|=c.BUTTON_DOWN),0!==(g.rawButtons&(c.BUTTON_DPAD_LEFT|c.BUTTON_LSTICK_LEFT))&&(g.rawButtons|=c.BUTTON_LEFT),0!==(g.rawButtons&(c.BUTTON_DPAD_RIGHT|c.BUTTON_LSTICK_RIGHT))&&(g.rawButtons|=c.BUTTON_RIGHT),a.input.getButtonValue(g.leftTrigger)>=e.PRESSED&&(g.rawButtons|=c.BUTTON_LT),a.input.getButtonValue(g.rightTrigger)>=
e.PRESSED&&(g.rawButtons|=c.BUTTON_RT),g.newButtons=g.rawButtons&~g.lastButtons,c.checkAndDispatchControllerEvents(g,b),g.lastButtons=g.rawButtons,g.connected||(d.splice(h,1),a.console.log("Controller "+g.id+" removed"))};a.input.setOneAllowedController=function(b){"keyboard"===b||"mouse"===b||(a.console.log("Allowing only controller "+b),a.input.allowedControllers=[b])};a.input.allowAllControllers=function(){a.input.allowedControllers=[]};a.input.setAllowRepeatEvents=function(b){!0===b||!1===b?(a.input.allowRepeatEvents.buttons=
b,a.input.allowRepeatEvents.directions=b):(void 0!==b.buttons&&(a.input.allowRepeatEvents.buttons=!!b.buttons),void 0!==b.directions&&(a.input.allowRepeatEvents.directions=!!b.directions))};var h=function(a,b){this.defaults={rate:a,delay:b};this.directions=this.buttons=0;this.fullReset()};h.prototype.fullReset=function(){this.buttons=this.defaults.delay.buttons;this.directions=this.defaults.delay.directions};h.prototype.repeatReset=function(a){void 0===a&&(a={buttons:!0,directions:!0});a.buttons&&
(this.buttons=this.defaults.rate.buttons);a.directions&&(this.directions=this.defaults.rate.directions)};h.prototype.elapsed=function(a){this.buttons-=a;this.directions-=a;0>this.buttons&&(this.buttons=0);0>this.directions&&(this.directions=0)};a.input.Controller=function(b,c,d,e,f){this.rawData=b||{};this.id=c;this.index=d;this.connected=e;this.timestamp=f;this.rawButtons=0;this.leftStick={x:0,y:0};this.rightStick={x:0,y:0};this.lastButtons=this.newButtons=this.rightTrigger=this.leftTrigger=0;this.repeatTimer=
new h(a.input.Controller.repeatRate,a.input.Controller.repeatDelay)};a.input.Controller.repeatRate={buttons:0.2,directions:0.2};a.input.Controller.repeatDelay={buttons:0.5,directions:0.5};a.input.thresholds={LOW:0.2,NORM:0.5,HIGH:0.8,PRESSED:0.7};a.getRealMousePosition=a.input.getRealMousePosition;a.standardizeKeyEvent=a.input.standardizeKeyEvent;a.charCodeFromEvent=a.input.charCodeFromEvent;a.autoHandleEvents=a.input.autoHandleEvents;a.keys={leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,enter:13,
esc:27,backspace:8,del:46,space:32,home:36,end:35," ":32,tab:9,pageUp:33,pageDown:34,period:190,semicolon:186,singleQuote:222,comma:188,shift:16,"0":48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,numPadPlus:107,numPadMinus:109,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,"~":192,"`":192,"-":189,"=":187,
leftSys:91,rightSys:92,selectKey:93,"/":191,forwardSlash:191,"\\":220,backslash:220,leftBracket:219,rightBracket:221,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};a.input.keyCodeToNumber=function(b){return b>=a.keys["0"]&&b<=a.keys["9"]?b-a.keys["0"]:b>=a.keys.numPad0&&b<=a.keys.numPad9?b-a.keys.numPad0:-1};a.input.handlePreventDefault=function(b,c){var d=a.input.standardPreventDefaultOnEvents;void 0!==c&&(d=c?!0:!1);void 0!==b.allowBrowserDefault&&(d=!b.allowBrowserDefault);
d&&!a.system.has.QUnit&&b.sysEvent&&b.sysEvent.preventDefault&&b.sysEvent.preventDefault()};a.input.setStandardPreventFlag=function(b){a.input.standardPreventDefaultOnEvents=b}});
rat.modules.add("rat.os.r_user",[{name:"rat.utils.r_messenger",processBefore:!0},{name:"rat.os.r_user_xbo",platform:"xbox"},{name:"rat.os.r_user_wraith",platform:"Wraith"},"rat.debug.r_console"],function(a){var d=function(a,b){this.rawData=a;this.id=b.id;this.gamerTag=b.gamerTag;this.isSignedIn=b.isSignedIn||!1;this.userImageSource=b.userImageSource;this.friendsList=b.friendsList},c=function(){this.list=[];this.byId={};this.length=0};c.prototype.add=function(a,b){var c=new d(a,b);this.list.push(c);
this.length=this.list.length;return this.byId[c.id]=c};c.prototype.at=function(a){return this.list[a]};a.user=a.user||{};a.user.supported=a.user.supported||!1;a.user.messages=new a.Messenger;var b={ActiveUserChanged:"activeUserChanged",SignIn:"signIn",SignOut:"signOut",InfoChange:"infoChange",SigninUIClosed:"signinUIClosed",ControllerBindingChanged:"controllerBindingChanged",FriendsInfoAvailable:"friendsInfoAvailable",AchievementInfoAvailable:"achievementInfoAvailable"};a.user.messageType=b;a.user.SigninUIOps=
{NoGuests:"",AllowGuests:"allowGuests",AllowOnlyDistinctControllerTypes:"allowOnlyDistinctControllerTypes"};var e=void 0;a.user._internal={UserList:c,User:d,isSigninUIShowing:!1};a.user.userIDFromControllerID=function(b){return"keyboard"===b||"mouse"===b?a.user.getUsers().at(0).id:0};a.user.controllerIDFromUserID=function(){return 0};a.user.getUsers=function(){return new c};a.user.requestFriendsInfo=function(){};a.user.showSigninUI=void 0;a.user.isSigninUIShowing=function(){return a.user._internal.isSigninUIShowing};
a.user.getUser=function(b){return a.user.getUsers().byId[b]};a.user.clearActiveUser=function(b){a.user.setActiveUser(void 0,b)};a.user.setActiveUser=function(c,d){d=d||{};void 0!==c&&void 0!==c.id&&(c=c.id);var h;if((h=void 0!==c?void 0===e||e.id!==c:void 0!==e)||d.force){var j=e;e=void 0!==c?a.user.getUser(c):void 0;a.console.log("Active user set to:"+JSON.stringify(e));h&&a.user.messages.broadcast(b.ActiveUserChanged,e,j)}};a.user.getActiveUser=function(){return e};a.user.getActiveUserID=function(){return(a.user.getActiveUser()||
{}).id||0};a.user.getActiveUserName=function(){return(a.user.getActiveUser()||{}).gamerTag||""};a.user.getActiveUserImageSource=function(){return(a.user.getActiveUser()||{}).userImageSource||void 0}});
rat.modules.add("rat.audio.r_audio",["rat.debug.r_console","rat.os.r_system",{name:"rat.audio.r_audio_single",platform:"PS4Browser"}],function(a){function d(c,b){b||(b=c);a.console.logOnce("| r_audio: "+c,b)}a.audio={initialized:!1,soundOn:!0,defaultGroup:"sfx",globalVolume:1,groupVolumes:{},toLoadCount:0,loadedCount:0,preferedExt:"",useSequentialLoad:!1,activeSequentialLoad:!1,loadJobs:[],initialDebug:!1,verboseDebug:!1,sounds:{},dukTapeSound:null,audioConstructor:function(){return new Audio},init:function(c){c=
"undefined"===typeof c?a.audio:c;c.initialDebug&&d("Init");c.iOSBrowser=a.system.has.iOSBrowser;c.PS4Browser=a.system.has.PS4Browser;var b=c.audioConstructor();b.canPlayType&&(c.canPlayMp3=!!b.canPlayType("audio/mpeg"),c.canPlayM4a=!!b.canPlayType('audio/mp4; codecs="mp4a.40.5"'),c.canPlayOgg=!!b.canPlayType('audio/ogg; codecs="vorbis"'),c.canPlayXMA=!!b.canPlayType("audio/xma2;"),c.canPlayWav=!0,c.PS4Browser&&(c.canPlayM4a=!0),c.initialDebug&&d("can play: mp3("+c.canPlayMp3+") m4a("+c.canPlayM4a+
") ogg("+c.canPlayOgg+") xma("+c.canPlayXMA+") wav("+c.canPlayWav+") \n"));c.dukTapeSound=b;c.initialized=!0},loadSounds:function(c){a.audio.sounds=a.audio.loadSoundList(c,function(b,c){var d=a.audio.audioConstructor();a.audio.useSequentialLoad?a.audio.loadJobs.push({a:d,res:b,soundInfo:c}):a.audio.doSingleLoad(d,b,c);var g=1;void 0!==c.volume&&(g=c.volume);d.entryVolume=g;d.group=c.group||a.audio.defaultGroup;void 0!==a.audio.groupVolumes[d.group]&&(g*=a.audio.groupVolumes[d.group]);d.volume=g*a.audio.globalVolume;
return d});a.audio.useSequentialLoad&&!a.audio.activeSequentialLoad&&a.audio.processQueuedLoad()},loadSoundList:function(c,b){a.audio.initialized||d("!!NOT INITIALIZED before loadSounds");var e={},f;a.audio.canPlayM4a?f=".m4a":a.audio.canPlayMp3?f=".mp3":a.audio.canPlayOgg?f=".ogg":a.audio.canPlayXMA?f=".xma":a.audio.canPlayWav?f=".wav":(d("Unable to find support audio file format.  Defaulting to .m4a"),f=".m4a");a.audio.initialDebug&&d("load using "+f);for(var g=0;g<c.length;g++){var h=c[g];Array.isArray(h)||
(h=[c[g]]);for(var j,k=[],l,m=0;m<h.length;m++){var n=h[m],p;"string"===typeof n?(p=n,l=p.lastIndexOf("."),0>l&&(l=p.length,a.audio.preferedExt&&("."!==a.audio.preferedExt[0]&&(p+="."),p+=a.audio.preferedExt)),n=p.lastIndexOf("/"),0>n?n=0:n++,n={id:p.substring(n,l),resource:p,volume:1}):p=n.resource;if("data:"!==p.substring(0,5)){l=p.lastIndexOf(".");0>l&&(l=p.length);var q=p.substring(l,p.length);".mp3"===q&&a.audio.canPlayMp3||(".m4a"===q&&a.audio.canPlayM4a||".ogg"===q&&a.audio.canPlayOgg||".xma"===
q&&a.audio.canPlayXMA||".wav"===q&&a.audio.canPlayWav)||(p=p.substring(0,l)+f);p=a.system.fixPath(p)}a.audio.toLoadCount++;l=b(p,n);k[m]=l;0===m&&(j=n.id)}e[j]&&(d("ERROR: "+j+" redefined!",j),a.audio.toLoadCount--);e[j]=k}return e},loadSoundsWithData:function(c,b){function d(a,b){for(var c=0;c<a.length;c++){var j=a[c];if(Array.isArray(j))d(j,b);else for(var k=0;k!=b.length;++k){var l=b[k];if(l.id===j.resource){j.resource=l.resource;break}}}}d(c,b);a.audio.loadSounds(c)},processQueuedLoad:function(){if(!a.audio.loadJobs||
0>=a.audio.loadJobs.length)a.audio.verboseDebug&&d("Done with sequential load."),a.audio.activeSequentialLoad=!1;else{a.audio.verboseDebug&&d("rat.audio: New sequential load job...");a.audio.activeSequentialLoad=!0;var c=a.audio.loadJobs[0];a.audio.loadJobs.splice(0,1);a.audio.doSingleLoad(c.a,c.res,c.soundInfo)}},doSingleLoad:function(c,b,e){function f(){}function g(){this.removeEventListener("canplaythrough",g,!1);this.removeEventListener("error",h,!1);this.removeEventListener("stalled",f,!1);this.ratLoaded||
(this.ratLoaded=!0,a.audio.loadedCount++,a.audio.verboseDebug&&d(a.audio.loadedCount+"/"+a.audio.toLoadCount+" loaded: "+this.src),a.audio.useSequentialLoad&&a.audio.processQueuedLoad())}function h(a){d("encountered error while loading: "+this.src);g.call(this,a)}a.audio.verboseDebug&&d("triggering load "+e.id+" : "+b+" at volume "+e.volume);c.preload="auto";c.addEventListener("canplaythrough",g,!1);c.addEventListener("stalled",f,!1);c.addEventListener("error",h,!1);c.src=b;c.load()},selectSound:function(c){if(!a.audio.soundOn)return null;
if(!a.audio.sounds[c])return d("tried to play nonexistent sound "+c,c),null;var b=a.audio.sounds[c];return 0>=b.length?(d("tried to play from empty list "+c,c),null):1<b.length?b[Math.random()*b.length|0]:b[0]},playSound:function(c){if(c=a.audio.selectSound(c))!c.ended&&(0<c.currentTime&&!c.paused)&&(a.system.has.Wraith?c.stop():c.currentTime=0),c.play()},pauseSound:function(c){if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var b=0;b<c.length;b++){var e=c[b];e&&e.pause()}}else d("tried to pause nonexistent sound "+
c,c)},resetSound:function(c){if(a.audio.sounds[c]){c=a.audio.sounds[c];for(var b=0;b<c.length;b++){var e=c[b];e&&0!==e.currentTime&&(e.currentTime=0)}}else d("tried to reset nonexistent sound "+c,c)},stopSound:function(c){a.audio.pauseSound(c);a.audio.resetSound(c)},seekSound:function(c,b,e){if(a.audio.sounds[c]){"undefined"===typeof e&&(e=!1);c=a.audio.sounds[c];for(var f=0;f<c.length;f++){var g=c[f];if(g){var h=g.duration,j=b;e&&(j*=h);g.currentTime=j}}}else d("tried to reset nonexistent sound "+
c,c)},getSoundVolume:function(c){if(a.audio.sounds[c])return a.audio.sounds[c][0].entryVolume;d("tried to get volume for nonexistent sound "+c,c)},setSoundVolume:function(c,b){if(a.audio.sounds[c])for(var e=a.audio.sounds[c],f=0;f<e.length;f++){var g=e[f];g&&(void 0===a.audio.groupVolumes[g.group]&&(a.audio.groupVolumes[g.group]=1),g.entryVolume=b,g.volume=b*a.audio.groupVolumes[g.group]*a.audio.globalVolume)}else d("tried to set volume for nonexistent sound "+c,c)},setSoundLooping:function(c,b){b=
!!b;if(a.audio.sounds[c])for(var e=a.audio.sounds[c],f=0;f<e.length;f++){var g=e[f];g&&g.loop!=b&&(g.loop=b)}else d("tried to call setSoundLooping nonexistent sound "+c,c)},setGroupVolume:function(c,b){var d,f;if(b!==a.audio.groupVolumes[c]){a.audio.groupVolumes[c]=b;for(var g in a.audio.sounds){d=a.audio.sounds[g];for(var h=0;h!==d.length;++h)f=d[h],f.group===c&&(f.volume=f.entryVolume*b*a.audio.globalVolume)}}},setGlobalVolume:function(c){if(c!==a.audio.globalVolume){a.audio.globalVolume=c;var b,
d;for(d in a.audio.sounds){c=a.audio.sounds[d];for(var f=0;f!==c.length;++f)b=c[f],void 0===a.audio.groupVolumes[b.group]&&(a.audio.groupVolumes[b.group]=1),b.volume=b.entryVolume*a.audio.groupVolumes[b.group]*a.audio.globalVolume}}},update:function(){},getSoundCount:function(){var c=0,b;for(b in a.audio.sounds)a.audio.sounds.hasOwnProperty(b)&&c++;return c},getSoundIDByIndex:function(c){var b=0,d;for(d in a.audio.sounds)if(a.audio.sounds.hasOwnProperty(d)){if(b===c)return d;b++}return"error"},getSoundInfo:function(c){var b=
a.audio.sounds[c];if(b)return b=b[0],c={id:c,duration:b.duration,source:b.src,volume:b.volume,currentPos:b.currentTime,readyState:b.readyState,errorCode:"none"},b.error&&(c.errorCode=b.error.code),c;d("Requested info for nonexistent sound"+c,soundID);return null},getSoundCurrentTime:function(c){return(c=a.audio.sounds[c])?c[0].currentTime:0},isSoundLoaded:function(c){var b=a.audio.sounds[c];if(!b)return d("Tried to check if nonexistent audio ("+c+") is loaded"),null;if(null!==b[0].error)return"error";
c=b[0].buffered;return 1===c.length&&0===c.start(0)&&c.end(0)===b[0].duration},isCacheLoaded:function(){return a.audio.loadedCount>=a.audio.toLoadCount?!0:a.audio.iOSBrowser?!0:!1},isSoundPlaying:function(c){if(c=a.audio.sounds[c])if(c=c[0],0<c.currentTime&&c.currentTime<c.duration)return!0;return!1},whatIsMissing:function(){var c=0,b=0,d;for(d in a.audio.sounds)a.audio.sounds.hasOwnProperty(d)&&(a.audio.sounds[d][0].ratLoaded||(a.console.log("Missing: "+d),b++),c++);a.console.log("missing "+b+" of "+
c)}}});
rat.modules.add("rat.ui.r_screen",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.graphics.r_graphics",processBefore:!0},"rat.ui.r_ui_shape","rat.ui.r_screenmanager","rat.input.r_input","rat.input.r_inputmap"],function(a){function d(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var a={globalPos:this.getGlobalPos(),rect:this.getBounds(this.tempRect),el:this};a.pos={x:a.globalPos.x+a.rect.w/2,y:a.globalPos.y+a.rect.h/2};e.push(a)}}function c(a,
b,c,d,k,l){var m=0,n=-1;d=1/d;for(var p=0;p!==e.length;++p)if(!(c&&p===a)){var q=e[p].pos,r=q.x-b.x,q=q.y-b.y,s=(0>q?-q:q)*d,t=(0>r?-q:r)*d;if("right"===k&&0<r&&r>s||"left"===k&&0>r&&-r>s||"down"===k&&0<q&&q>t||"up"===k&&0>q&&-q>t)if("right"===k||"left"===k?r/=l:q/=l,r=r*r+q*q,0>n||r<m)n=p,m=r}return n}function b(a,b,d,j,k,l,m,n){var p=c(a,b,!0,j,d,k);if(0>p&&(l||m))b={x:b.x,y:b.y},"right"===d&&l&&(b.x-=n.size.x),"left"===d&&l&&(b.x+=n.size.x),"down"===d&&m&&(b.y-=n.size.y),"up"===d&&m&&(b.y+=n.size.y),
p=c(a,b,!1,j,d,k);return 0<=p?e[p].el:null}a.ui.Screen=function(){a.ui.Screen.prototype.parentConstructor.call(this);this.setBounds(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT)};a.utils.inheritClassFrom(a.ui.Screen,a.ui.Element);a.ui.Screen.prototype.modal=!1;a.ui.Screen.prototype.inputMap=null;a.ui.Screen.prototype.targets=null;a.ui.Screen.prototype.allowClickAway=!1;a.ui.Screen.prototype.allowBackClose=!1;a.ui.Screen.prototype.isDeactivated=!0;a.ui.Screen.prototype.isOverlay=!0;a.ui.Screen.prototype.isSuspended=
!0;a.ui.Screen.prototype.savedTarget=void 0;a.utils.addProp(a.ui.Screen.prototype,"fullOpaque",function(a){this.setOverlay(!a)},function(){return!this.isOverlay});a.ui.Screen.prototype.destroy=function(){};a.ui.Screen.prototype.setOverlay=function(a){this.isOverlay=a};a.ui.Screen.prototype.deactivate=function(a){a=!0===a?{allowOnlySuspend:!0}:a||{};this.isSuspended||(this.isSuspended=!0,this.screenSuspend&&this.screenSuspend());if((!a.allowOnlySuspend||!this.screenSuspend)&&!this.isDeactivated)this.isDeactivated=
!0,this.screenDeactivate&&this.screenDeactivate()};a.ui.Screen.prototype.activate=function(){this.isDeactivated&&(this.isDeactivated=!1,this.screenActivate&&this.screenActivate());this.isSuspended&&(this.isSuspended=!1,this.screenResume&&this.screenResume())};a.ui.Screen.prototype.setModal=function(a){this.modal=a};a.ui.Screen.prototype.isModal=function(){return this.modal};a.ui.Screen.prototype.setAllowClickAway=function(a){this.allowClickAway=a};a.ui.Screen.prototype.setAllowBackClose=function(a){this.allowBackClose=
a};a.ui.Screen.prototype.expandToDisplay=function(){this.setPos(0,0);this.setSize(a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT)};a.ui.Screen.prototype.centerInDisplay=function(){var b=this.getSize();this.setPos(Math.floor((a.graphics.SCREEN_WIDTH-b.w)/2),Math.floor((a.graphics.SCREEN_HEIGHT-b.h)/2))};a.ui.Screen.prototype.centerHighInDisplay=function(){var b=this.getSize();this.setPos(Math.floor((a.graphics.SCREEN_WIDTH-b.w)/2),Math.floor((a.graphics.SCREEN_HEIGHT-b.h)/3))};a.ui.Screen.prototype.setCurrentTarget=
function(a){if(this.inputMap)this.inputMap.focusByButton(a,!0);else{this.targets||(this.targets=[]);var b=this.targets[0];b&&b!==a&&(b.Blur?b.Blur():b.blur&&b.blur());(this.targets[0]=a)&&a!==b&&a.focus()}};a.ui.Screen.prototype.getCurrentTarget=function(a){a=a||0;return this.inputMap?this.inputMap.getTarget():this.targets&&this.targets[a]?this.targets[a]:null};a.ui.Screen.prototype.saveCurrentTarget=function(){this.inputMap&&(this.savedTarget=this.inputMap.map[this.inputMap.index])};a.ui.Screen.prototype.restoreSavedTarget=
function(){if(this.inputMap){var a=0,b=this.savedTarget;this.savedTarget=void 0;if(b)for(var c=this.inputMap.map,d=0;d!==c.length;++d)if(c[d]===b){a=d;break}this.inputMap.focusButton(a,!0)}};a.ui.Screen.prototype.handleUIInput=function(b){var c;if(c=this.inputMap)if(c="ui"===b.eventType)c=b.which,c="up"===c||"down"===c||"left"===c||"right"===c||"enter"===c?!0:!1;return c?("enter"===b.which&&(b.which="select"),this.inputMap.handleDirection(b.which)):"back"===b.which&&this.allowBackClose?(a.screenManager.popScreen(),
!0):!1};a.ui.Screen.prototype.handleKeyDown=function(b){return b.which===a.keys.tab&&this.inputMap?this.inputMap.handleTab(b):a.ui.Screen.prototype.parentPrototype.handleKeyDown.call(this,b)};var e;a.ui.Screen.prototype.autoBuildInputMap=function(c,g,h,j){this.inputMap=null;if(this.subElements&&(void 0===c&&(c=!0),void 0===g&&(g=!0),void 0===h&&(h=1),void 0===j&&(j=2),e=[],this.applyRecursively(d,e),!(0>=e.length))){for(var k=[],l=0;l<e.length;l++){var m=e[l],n={currObj:m.el},p=m.pos;n.up=b(l,p,"up",
h,j,c,g,this);n.down=b(l,p,"down",h,j,c,g,this);n.left=b(l,p,"left",h,j,c,g,this);n.right=b(l,p,"right",h,j,c,g,this);k.push(n);m.mapEntry=n}c=-1;if(a.input.useLastUIInputType&&("keyboard"===a.input.lastUIInputType||"controller"===a.input.lastUIInputType))c=0;e.sort(function(a,b){return a.pos.y<b.pos.y?-1:a.pos.y>b.pos.y?1:a.pos.x<b.pos.x?-1:1});for(l=0;l<e.length;l++)e[l].mapEntry.tabOrder=l;this.inputMap=new a.InputMap(k,c);e=void 0;return this.inputMap}}});
rat.modules.add("rat.ui.r_ui_button",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_textbox",processBefore:!0},"rat.ui.r_ui_bubblebox","rat.ui.r_ui_sprite","rat.graphics.r_image","rat.graphics.r_graphics"],function(a){function d(a){a.setSize(a.buttonImage.size.x,a.buttonImage.size.y)}a.ui.Button=function(c,b,d,f,g,h,j){a.ui.Button.prototype.parentConstructor.call(this);this.setTargetable(!0);this.isSetup=!1;void 0!==c&&this.setupButton(c,b,d,
f,g,h,j)};a.utils.inheritClassFrom(a.ui.Button,a.ui.Element);a.ui.Button.prototype.elementType="button";a.ui.Button.prototype.flagsThatDirtyMe=a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag|a.ui.Element.pressedFlag|a.ui.Element.toggledFlag;a.ui.Button.prototype.textInset=8;a.ui.Button.prototype.textOffsetX=0;a.ui.Button.prototype.textOffsetY=0;a.ui.Button.spriteType=1;a.ui.Button.bubbleType=2;a.ui.Button.cheapType=3;a.ui.Button.coolType=4;a.ui.Button.defaultClickSound="click";a.ui.Button.standardCornerScale=
1/6;a.ui.Button.prototype.setupButton=function(c,b,d,f,g,h,j){this.isSetup&&(this.removeAllSubElements(),this.text=this.imageDisabled=this.imagePressed=this.imageHi=this.imageNormal=this.buttonImage=null);this.isSetup=!0;this.type=c;if(c===a.ui.Button.spriteType)this.buttonImage=new a.ui.Sprite;else if(c===a.ui.Button.bubbleType)this.buttonImage=new a.ui.BubbleBox;else if((c===a.ui.Button.cheapType||c===a.ui.Button.coolType)&&b)this.buttonImage=new a.ui.Sprite;this.buttonImage&&this.appendSubElement(this.buttonImage);
b&&(this.imageNormal=a.graphics.makeImage(b,h,j),(c===a.ui.Button.spriteType||c===a.ui.Button.cheapType||c===a.ui.Button.coolType)&&this.imageNormal.size&&this.setSize(this.imageNormal.size.x,this.imageNormal.size.y));d&&(this.imageHi=a.graphics.makeImage(d,h,j));f&&(this.imagePressed=a.graphics.makeImage(f,h,j));g&&(this.imageDisabled=a.graphics.makeImage(g,h,j));this.toggles=!1;this.clickSound=a.ui.Button.defaultClickSound;this.name="<but>"+this.id;this.buttonImage&&this.boundsChanged();this.cornerRadius=
10;this.cornerRadiusSet=!1;this.setDirty(!0)};a.ui.makeSpriteButton=function(c,b,d,f,g,h){return new a.ui.Button(a.ui.Button.spriteType,c,b,d,f,g,h)};a.ui.makeBubbleButton=function(c,b,d,f){return new a.ui.Button(a.ui.Button.bubbleType,c,b,d,f)};a.ui.Button.createStandardColorStates=function(c){"string"===typeof c&&(c=new a.graphics.Color(c));var b=[{}];b[0].flags=a.ui.Element.enabledFlag;b[0].color=c.copy();b[0].textColor=new a.graphics.Color(4*c.r,4*c.g,4*c.b,c.a);b[0].frameColor=new a.graphics.Color(c.r/
4,c.g/4,c.b/4,c.a);b[0].frameWidth=4;b[1]={};b[1].flags=a.ui.Element.enabledFlag|a.ui.Element.highlightedFlag;b[1].color=new a.graphics.Color(c.r+50,c.g+50,c.b+50,c.a);b[1].textColor=new a.graphics.Color(6*c.r,6*c.g,6*c.b,c.a);b[1].frameColor=new a.graphics.Color(c.r/5,c.g/5,c.b/5,c.a);b[1].frameWidth=4;b[2]={};b[2].flags=a.ui.Element.enabledFlag|a.ui.Element.pressedFlag;b[2].color=new a.graphics.Color(c.r/2,c.g/2,c.b/2,c.a);b[2].textColor=new a.graphics.Color(4*c.r,4*c.g,4*c.b,c.a);b[2].frameColor=
new a.graphics.Color(c.r/5,c.g/5,c.b/5,c.a);b[2].frameWidth=4;b[3]={};b[3].flags=a.ui.Element.enabledFlag|a.ui.Element.toggledFlag;b[3].color=b[0].color.copy();b[3].textColor=new a.graphics.Color(10*c.r,10*c.g,10*c.b,c.a);b[3].frameColor=new a.graphics.Color(4*c.r,4*c.g,4*c.b,c.a);b[3].frameWidth=4;b[4]={};b[4].flags=a.ui.Element.enabledFlag|a.ui.Element.toggledFlag|a.ui.Element.highlightedFlag;b[4].color=b[1].color.copy();b[4].textColor=b[1].textColor.copy();b[4].frameColor=new a.graphics.Color(4*
c.r,4*c.g,4*c.b,c.a);b[4].frameWidth=4;b[5]={};b[5].flags=a.ui.Element.enabledFlag|a.ui.Element.toggledFlag|a.ui.Element.pressedFlag;b[5].color=b[2].color.copy();b[5].textColor=b[2].textColor.copy();b[5].frameColor=new a.graphics.Color(4*c.r,4*c.g,4*c.b,c.a);b[5].frameWidth=4;b[6]={};b[6].flags=0;b[6].color=new a.graphics.Color(120,120,120,c.a);b[6].textColor=new a.graphics.Color(64,64,64,c.a);b[6].frameColor=new a.graphics.Color(64,64,64,c.a);b[6].frameWidth=4;return b};a.ui.makeCheapButton=function(c,
b){var d=a.ui.Button.createStandardColorStates(b);return a.ui.makeCheapButtonWithColors(c,d)};a.ui.makeCoolButton=function(c,b){var d=a.ui.Button.createStandardColorStates(b),f=new a.ui.Button(a.ui.Button.coolType,c);f.colorStates=d;return f};a.ui.makeCheapButtonWithColors=function(c,b){var d=new a.ui.Button(a.ui.Button.cheapType,c);d.colorStates=b;return d};a.ui.Button.prototype.checkDirty=function(){return this.buttonImage&&this.buttonImage.isDirty||this.text&&this.text.isDirty||this.isDirty?!0:
!1};a.ui.Button.prototype.setOutline=function(a,b){this.buttonImage&&this.buttonImage.setOutline(a,b)};a.ui.Button.prototype.boundsChanged=function(){this.type===a.ui.Button.bubbleType?(this.buttonImage&&this.buttonImage.setSize(this.size.x,this.size.y),this.setContentSize(this.size.x,this.size.y)):this.type===a.ui.Button.spriteType?(this.buttonImage&&this.buttonImage.setSize(this.size.x,this.size.y),this.setContentSize(this.size.x,this.size.y)):this.text&&(this.resizeTextBox(),this.setContentSize(this.text.contentSize.x,
this.text.contentSize.y));this.type===a.ui.Button.coolType&&!this.cornerRadiusSet&&(this.cornerRadius=this.size.y*a.ui.Button.standardCornerScale|0);a.ui.Button.prototype.parentPrototype.boundsChanged.call(this)};a.ui.Button.prototype.centerContent=function(){this.buttonImage&&this.buttonImage.centerInParent();this.text&&this.text.centerInParent()};a.ui.Button.prototype.setAdjustForScale=function(c){a.ui.Element.prototype.setAdjustForScale.call(this,c);this.buttonImage&&this.buttonImage.setAdjustForScale(c)};
a.ui.Button.prototype.setTextInset=function(a){this.textInset!=a&&(this.textInset=a,this.resizeTextBox())};a.ui.Button.prototype.setTextOffset=function(a,b){if(this.textOffsetX!==a||this.textOffsetY!==b)this.textOffsetX=a,this.textOffsetY=b,this.resizeTextBox()};a.ui.Button.prototype.setTextPosition=function(c,b){this.text&&((this.text.place.pos.x!==c||this.text.place.pos.y!==b)&&this.setDirty(!0),this.text.place.pos.x=c,this.text.place.pos.y=b,this.text.setAlign(a.ui.TextBox.alignLeft),this.text.setBaseline(a.ui.TextBox.baselineTop))};
a.ui.Button.prototype.getTextBox=function(){return this.text};a.ui.Button.prototype.checkAndMakeTextBox=function(){this.text||(this.text=new a.ui.TextBox(""),this.text.setEnabled(!1),this.resizeTextBox(),this.appendSubElement(this.text),this.text.centerText());return this.text};a.ui.Button.prototype.resizeTextBox=function(){this.text&&(this.text.setPos(this.textInset+this.textOffsetX,this.textOffsetY),this.text.setSize(this.size.x-2*this.textInset,this.size.y))};a.ui.Button.prototype.removeTextBox=
function(){this.text&&(this.removeSubElement(this.text),this.text=null)};a.ui.Button.prototype.getImage=function(){return this.buttonImage};a.ui.Button.prototype.setTextValue=function(a){this.checkAndMakeTextBox().setTextValue(a);this.name="<but>"+this.id+"("+a+")"};a.ui.Button.prototype.translateAndSetTextValue=function(a){this.name="<but>"+this.id+"("+a+")";this.checkAndMakeTextBox().translateAndSetTextValue(a)};a.ui.Button.prototype.setFont=function(a,b,d){this.checkAndMakeTextBox().setFont(a,
b,d)};a.ui.Button.prototype.setFontStyle=function(a){this.checkAndMakeTextBox().setFontStyle(a)};a.ui.Button.prototype.setFontSize=function(a){this.checkAndMakeTextBox().setFontSize(a)};a.ui.Button.prototype.setCornerRadius=function(a){a!=this.cornerRadius&&this.setDirty(!0);this.cornerRadius=a;this.cornerRadiusSet=!0};a.ui.Button.prototype.setTextColors=function(c,b,d,f){"undefined"===typeof b&&(b=c);"undefined"===typeof d&&(d=c);"undefined"===typeof f&&(f=c);var g=a.ui.Element;this.setStateTextColors([{state:g.enabledFlag,
textColor:c},{state:g.enabledFlag|g.highlightedFlag,textColor:b},{state:g.enabledFlag|g.pressedFlag,textColor:d},{state:g.enabledFlag|g.toggledFlag,textColor:d},{state:g.enabledFlag|g.toggledFlag|g.highlightedFlag,textColor:b},{state:g.enabledFlag|g.toggledFlag|g.pressedFlag,textColor:c},{state:0,textColor:f}])};a.ui.Button.prototype.setStateTextColors=function(a){this.setStatesByField(a,"textColor")};a.ui.Button.prototype.setTextColorStates=a.ui.Button.prototype.setStateTextColors;a.ui.Button.prototype.setStateColors=
function(a){this.setStatesByField(a,"color")};a.ui.Button.prototype.setStateFrameColors=function(a){this.setStatesByField(a,"frameColor")};a.ui.Button.prototype.setStateFrameWidth=function(a){this.setStatesByField(a,"frameWidth")};a.ui.Button.prototype.setStateImages=function(c,b,d){for(var f=0;f<c.length;f++){var g=c[f];"undefined"===typeof g.imageRef&&(g.resource||a.console.log("Error:  no imageRef or image specified in setStateImages"),g.imageRef=a.graphics.makeImage(g.resource,b,d),Array.isArray(g.resource)&&
g.imageRef.setAnimSpeed(1));"undefined"===typeof g.doUpdate&&(g.doUpdate=!0)}this.setStatesByField(c,"imageRef");this.setStatesByField(c,"doUpdate")};a.ui.Button.prototype.setStatesByField=function(c,b){this.colorStates||(this.colorStates=[]);for(var d=0;d<c.length;d++){var f=c[d],g=this.getMatchingStateIndex(f.state,!0),f=f[b];if("textColor"===b||"color"===b||"frameColor"===b)"string"===typeof f&&(f=a.graphics.Color.makeFromStyleString(f));this.colorStates[g][b]=f}this.setDirty(!0)};a.ui.Button.prototype.getMatchingStateIndex=
function(c,b){if(!this.colorStates)return-1;for(var d=-1,f=0;f<this.colorStates.length;f++)if(this.colorStates[f].flags===c)return f;if(0>d){if(!b)return-1;d=this.colorStates.length;this.colorStates[d]={flags:c,textColor:a.graphics.white}}return d};a.ui.Button.prototype.getMatchingState=function(a){a=this.getMatchingStateIndex(a);return 0<=a?this.colorStates[a]:null};a.ui.Button.prototype.setStroke=function(a,b,d){this.checkAndMakeTextBox();this.text.setStroke(a,b,d)};a.ui.Button.prototype.findBestStateMatch=
function(a,b){"undefined"===typeof a&&(a=this.flags);b||(b=this.colorStates);if(!b)return null;for(var d=0,f=0,g=0;g<b.length;g++){for(var h=0,j=0;4>j;j++){var k=1<<j;(a&k)===(b[g].flags&k)&&h++}h>=f&&(d=g,f=h)}return b[d]};a.ui.Button.prototype.updateDisplayState=function(){var a;"undefined"!==typeof this.colorStates&&(a=this.findBestStateMatch(this.flags,this.colorStates),this.text&&(a.textColor&&this.text.setColor(a.textColor),a.font&&(a.font.font&&this.text.setFont(a.font.font),a.font.size&&this.text.setFontSize(a.font.size)),
a.stroke&&this.text.setStroke(a.stroke.lineWidth||0,a.stroke.color,a.stroke.doCleanup)));return a};a.ui.Button.prototype.drawSelf=function(){var c=a.graphics.getContext(),b=this.updateDisplayState();if(this.type===a.ui.Button.cheapType&&"undefined"!==typeof b){c.fillStyle=b.color.toString();c.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y);var d=4;void 0!==b.frameWidth&&(d=b.frameWidth);c.lineWidth=d;c.strokeStyle=b.frameColor.toString();c.strokeRect(-this.center.x-d/2,-this.center.y-
d/2,this.size.x+d,this.size.y+d)}else this.type===a.ui.Button.coolType&&"undefined"!==typeof b?(a.graphics.roundRect({x:0-this.center.x,y:0-this.center.y,w:this.size.x,h:this.size.y},this.cornerRadius),c.fillStyle=b.color.toString(),c.fill(),d=4,void 0!==b.frameWidth&&(d=b.frameWidth),c.lineWidth=d,c.lineCap="round",c.strokeStyle=b.frameColor.toString(),c.stroke()):"undefined"!==typeof this.buttonImage&&(b&&b.imageRef?this.buttonImage.useImageRef(b.imageRef):(c=0===(this.flags&a.ui.Element.enabledFlag)?
this.imageDisabled:this.flags&a.ui.Element.pressedFlag||this.flags&a.ui.Element.toggledFlag?this.imagePressed:this.flags&a.ui.Element.highlightedFlag?this.imageHi:this.imageNormal,c||(c=this.imageNormal),c&&this.buttonImage.useImageRef(c)))};a.ui.Button.prototype.updateSelf=function(a){if("undefined"!==typeof this.colorStates)for(var b=0;b<this.colorStates.length;b++)(!this.buttonImage||!(this.buttonImage.imageRef&&this.buttonImage.imageRef===this.colorStates[b].imageRef))&&this.colorStates[b].imageRef&&
this.colorStates[b].doUpdate&&this.colorStates[b].imageRef.update(a)};a.ui.Button.prototype.flagsChanged=function(){a.ui.Button.prototype.parentPrototype.flagsChanged.call(this);var c=this.findBestStateMatch();c&&c.imageRef&&c.imageRef.isAnimOneShot()&&c.imageRef.restartAnim()};a.ui.Button.prototype.handleUIInput=function(c){var b=!1;"enter"===c.which&&(b=this.trigger())&&a.eventMap.fireEvent("uiTriggered",this);return b};a.ui.Button.prototype.trigger=function(){if(this.toggles){var c=this.flags;
this.flags=this.flags&a.ui.Element.toggledFlag?this.flags&~a.ui.Element.toggledFlag:this.flags|a.ui.Element.toggledFlag;this.checkFlagsChanged(c)}return a.ui.Button.prototype.parentPrototype.trigger.call(this)};a.ui.Button.prototype.mouseDown=function(){a.ui.Button.prototype.parentPrototype.mouseDown.call(this);return this.flags&a.ui.Element.enabledFlag?!0:!1};a.ui.Button.prototype.autoSize=function(){0===this.buttonImage.size.x?this.buttonImage.setOnLoad(d,this):d(this)};a.ui.Button.prototype.setToggles=
function(a){this.toggles=a};a.ui.Button.setDefaultTextInset=function(c){a.ui.Button.prototype.textInset=c};a.ui.Button.editProperties=[{label:"button",props:[{propName:"buttonType",type:"integer",defValue:a.ui.Button.coolType,tipText:"1=sprite,2=bubble,3=cheap,4=cool"},{propName:"toggles",type:"boolean"},{propName:"text",type:"string",tipText:"button text (if needed)"},{propName:"textColor",type:"color"},{propName:"textInset",type:"float",tipText:"how far in from edges text draws"},{propName:"textUseOffscreen",
type:"boolean"},{propName:"cornerRadius",type:"float",tipText:"for button type 4 (cool)"}]},{label:"resources",defaultClosed:!0,props:[{propName:"resource",type:"resource"},{propName:"resourceHi",type:"resource"},{propName:"resPressed",type:"resource"},{propName:"resDisabled",type:"resource"},{propName:"extra1",type:"resource"},{propName:"extra2",type:"resource"}]},a.ui.TextBox.standardFontEditProperties];a.ui.Button.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.Button,c,b,
d);b.extra1=b.extra1||void 0;b.extra2=b.extra2||void 0;if(b.buttonType===a.ui.Button.cheapType||b.buttonType===a.ui.Button.coolType)c.setupButton(b.buttonType,void 0,void 0,void 0,void 0,b.extra1,b.extra2),c.colorStates=b.colors||b.color,void 0===c.colorStates&&(c.colorStates=new a.graphics.Color(140,140,140)),!1===Array.isArray(c.colorStates)&&(c.colorStates=a.ui.Button.createStandardColorStates(c.colorStates)),void 0!==b.toggles&&(c.setToggles(!0),c.setToggled(!!b.toggled));else if(b.buttonType===
a.ui.Button.bubbleType||b.buttonType===a.ui.Button.spriteType)c.setupButton(b.buttonType,b.res||b.resource,b.resHi||b.resourceHi,b.resPressed||b.resourcePressed,b.resDisabled||b.resourceDisabled,b.extra1,b.extra2),b.toggles&&(c.setToggles(!0),c.setToggled(!!b.toggled));void 0!==b.cornerRadius?c.setCornerRadius(b.cornerRadius):c.cornerRadius=c.size.y*a.ui.Button.standardCornerScale|0;b.font&&(b.font.font&&c.setFont(b.font.font),b.font.size&&c.setFontSize(b.font.size),b.font.style&&c.setFontStyle(b.font.style),
b.font.stroke&&c.setStroke(b.font.stroke.width,b.font.stroke.color));if(b.textColor&&(c.checkAndMakeTextBox().setColor(b.textColor),b.buttonType===a.ui.Button.cheapType||b.buttonType===a.ui.Button.coolType))for(d=0;d<c.colorStates.length;d++)c.colorStates[d].textColor=new a.graphics.Color(b.textColor);b.text&&c.translateAndSetTextValue(b.text);b.textInset&&c.setTextInset(b.textInset);void 0!==b.textUseOffscreen&&c.checkAndMakeTextBox().setUseOffscreen(b.textUseOffscreen)}});
rat.modules.add("rat.ui.r_ui_shape",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console","rat.ui.r_ui_data","rat.graphics.r_graphics","rat.math.r_math"],function(a){a.ui.Shape=function(d,c){var b=d,e=c;"number"===typeof d&&(b=null,e=d);a.ui.Shape.prototype.parentConstructor.call(this,b);this.shapeType=void 0===e?a.ui.circleShape:e;this.cornerRadius=5;this.strokeWidth=-1;this.strokeColor=null};a.utils.inheritClassFrom(a.ui.Shape,a.ui.Element);a.ui.Shape.prototype.elementType=
"shape";a.ui.noShape=0;a.ui.circleShape=1;a.ui.squareShape=2;a.ui.roundRectShape=3;a.ui.pathShape=4;a.ui.Shape.prototype.setShapeType=function(a){a!=this.shapeType&&this.setDirty(!0);this.shapeType=a};a.ui.Shape.prototype.setCornerRadius=function(a){0>a&&(a=0);a!=this.cornerRadius&&this.setDirty(!0);this.cornerRadius=a};a.ui.Shape.prototype.setStroke=function(a,c){(a!==this.strokeWidth||c!=this.strokeColor)&&this.setDirty(!0);this.strokeWidth=a;this.strokeColor=c};a.ui.Shape.prototype.drawSelf=function(){var d=
a.graphics.getContext();if(this.shapeType===a.ui.circleShape){d.beginPath();var c=a.math.min(this.size.x,this.size.y)/2;d.arc(this.size.x/2-this.center.x,this.size.y/2-this.center.y,c,0,2*Math.PI,!0);d.closePath()}else if(this.shapeType===a.ui.squareShape)d.beginPath(),d.rect(0-this.center.x,0-this.center.y,this.size.x,this.size.y),d.closePath();else if(this.shapeType===a.ui.roundRectShape)a.graphics.roundRect({x:0-this.center.x,y:0-this.center.y,w:this.size.x,h:this.size.y},this.cornerRadius);else return;
d.fillStyle=this.color.toString();d.fill();this.strokeWidth&&this.strokeColor&&(d.lineWidth=this.strokeWidth,d.strokeStyle=this.strokeColor.toString(),d.stroke())};a.ui.Shape.editProperties=[{label:"shape",props:[{propName:"shapeType",type:"integer"},{propName:"cornerRadius",type:"float"},{label:"strokeWidth",propName:"strokeWidth",type:"float"},{label:"strokeColor",propName:"strokeColor",type:"color"}]}];a.ui.Shape.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.Shape,d,c,b);
void 0!==c.shapeType&&(d.shapeType=c.shapeType);void 0!==c.cornerRadius&&d.setCornerRadius(c.cornerRadius);void 0!==c.strokeWidth&&(d.strokeWidth=c.strokeWidth);void 0!==c.strokeColor&&(d.strokeColor=c.strokeColor)}});
rat.modules.add("rat.ui.r_ui_textbox",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.graphics.r_graphics","rat.utils.r_wordwrap","rat.debug.r_console","rat.ui.r_ui_data"],function(a){a.ui.TextBox=function(d,c){var b,e;"string"===typeof d?e=d:(b=d,e=c);a.ui.TextBox.prototype.parentConstructor.call(this,b);this.value=void 0===e?"":e;this.font="Calibri";this.fontStyle="";this.fontSize=15;this.fontLineSpacing=2;this.fontLineHeight=16;this.fontDescriptor="15px Calibri";
this.strokeWidth=-1;this.strokeColor=null;this.textShadowEnabled=!1;this.textShadowColor=new a.graphics.Color(0,0,0,0.5);this.textShadowOffset={x:1,y:1};this.autoWrap=!1;this.size.x=100;this.maxWidth=this.size.x;this.overriddenMaxWidth=!1;this.size.y=this.fontLineHeight;this.textWidth=0;this.lineWidths=[];this.align=a.ui.TextBox.alignLeft;this.baseline=a.ui.TextBox.baselineMiddle;this.name="<txt>"+this.id+"("+this.value+")";this.textChanged();this.setTracksMouse(!1)};a.utils.inheritClassFrom(a.ui.TextBox,
a.ui.Element);a.ui.TextBox.prototype.elementType="textBox";a.ui.TextBox.alignLeft=0;a.ui.TextBox.alignCenter=1;a.ui.TextBox.alignRight=2;a.ui.TextBox.baselineTop=0;a.ui.TextBox.baselineMiddle=1;a.ui.TextBox.baselineBottom=2;a.ui.TextBox.fontHeightOverrides={};a.ui.TextBox.prototype.setTextValue=function(a){var c=this.value;this.value=""+a;c!==this.value&&this.textChanged()};a.ui.TextBox.prototype.getTextValue=function(a){var c=this.value;c&&a&&(c=c.trim());return c};a.ui.TextBox.prototype.translateAndSetTextValue=
function(d){a.string&&(d=a.string.getString(d));d!==this.value&&(this.value=d,this.textChanged())};a.ui.TextBox.setFontHeightOverride=function(d,c){a.ui.TextBox.fontHeightOverrides[d]=c};a.ui.TextBox.prototype.updateFontDescriptor=function(){var a=this.fontDescriptor;this.fontDescriptor=(""+this.fontStyle+" "+this.fontSize+"px "+this.font).trim();a!==this.fontDescriptor&&(this.value&&0<this.value.length)&&this.textChanged()};a.ui.TextBox.prototype.setFont=function(a,c,b){this.font=a;c&&this.setFontSize(c);
b&&this.setFontStyle(b);this.updateFontDescriptor()};a.ui.TextBox.prototype.setFontStyle=function(a){this.fontStyle=a;this.updateFontDescriptor()};a.ui.TextBox.prototype.setFontSize=function(d){this.fontSize=d;var c=0;this.font&&(c=a.ui.TextBox.fontHeightOverrides[this.font]);this.fontLineHeight=c?d*c|0:d+1;this.updateFontDescriptor()};a.ui.TextBox.prototype.setLineHeight=function(a){this.fontLineHeight=a};a.ui.TextBox.prototype.setAutoWrap=function(a){var c=this.autoWrap;this.autoWrap=a;c!==a&&this.textChanged()};
a.ui.TextBox.prototype.overrideMaxWidth=function(a){-1==a&&(a=9999);this.maxWidth=a;this.overriddenMaxWidth=!0};a.ui.TextBox.prototype.centerText=function(){this.align=a.ui.TextBox.alignCenter;this.baseline=a.ui.TextBox.baselineMiddle};a.ui.TextBox.prototype.leftAlignText=function(){this.setAlign(a.ui.TextBox.alignLeft)};a.ui.TextBox.prototype.rightAlignText=function(){this.setAlign(a.ui.TextBox.alignRight)};a.ui.TextBox.prototype.setAlign=function(d){"string"===typeof d&&("left"===d?d=a.ui.TextBox.alignLeft:
"center"===d?d=a.ui.TextBox.alignCenter:"right"===d&&(d=a.ui.TextBox.alignRight));d!==this.align&&this.setDirty(!0);this.align=d};a.ui.TextBox.prototype.setBaseline=function(d){"string"===typeof d&&("top"===d?d=a.ui.TextBox.baselineTop:"middle"===d?d=a.ui.TextBox.baselineMiddle:"bottom"===d&&(d=a.ui.TextBox.baselineBottom));d!==this.baseline&&this.setDirty(!0);this.baseline=d};a.ui.TextBox.prototype.setStroke=function(a,c,b){a&&(void 0===c&&void 0===b&&"number"!==typeof a)&&(b=a.doCleanup,c=a.color,
a=a.lineWidth||a.width);void 0===b&&(b=!1);(a!==this.strokeWidth||this.strokeCleanup!==b)&&this.setDirty(!0);(this.strokeColor!==c||this.strokeColor&&c&&this.strokeColor.equal&&!this.strokeColor.equal(c))&&this.setDirty(!0);this.strokeWidth=a;this.strokeColor=c;this.strokeCleanup=b};a.ui.TextBox.prototype.setShadowEnabled=function(a){a=void 0===a?!0:!!a;this.textShadowEnabled!==a&&(this.textShadowEnabled=a,this.setDirty(!0))};a.ui.TextBox.prototype.setShadow=function(a,c,b){var e=!1;a&&!this.textShadowColor.equal(a)&&
(e=!0,this.textShadowColor.copyFrom(a));void 0!==c&&c!==this.textShadowOffset.x&&(e=!0,this.textShadowOffset.x=c);void 0!==b&&b!==this.textShadowOffset.y&&(e=!0,this.textShadowOffset.y=b);e&&this.textShadowEnabled&&this.setDirty(!0)};a.ui.TextBox.prototype.setupAlignX=function(d,c){var b=0;this.forceLeftRender&&c?(d.textAlign="left",b=this.align===a.ui.TextBox.alignLeft?0+this.strokeWidth/2:this.align===a.ui.TextBox.alignCenter?this.size.x/2-c/2+this.strokeWidth/2:this.size.x-c):this.align===a.ui.TextBox.alignLeft?
(d.textAlign="left",b=0+this.strokeWidth/2):this.align===a.ui.TextBox.alignCenter?(d.textAlign="center",b=this.size.x/2):(d.textAlign="right",b=this.size.x-this.strokeWidth/2);this.ignoreCenter||(b-=this.center.x);return b};a.ui.TextBox.prototype.setupAlignY=function(d){var c=0;this.baseline===a.ui.TextBox.baselineTop?(d.textBaseline="top",c=0):this.baseline===a.ui.TextBox.baselineMiddle?(d.textBaseline="middle",c=this.size.y/2):(d.textBaseline="bottom",c=this.size.y);this.ignoreCenter||(c-=this.center.y);
return c};a.ui.TextBox.prototype.textChanged=function(){this.setDirty();if(!this.value||0>=this.value.length||!a.graphics.ctx)this.lines=[],this.textWidth=this.lineWidths[0]=0,this.setContentSize(0,0);else{a.graphics.ctx.font=this.fontDescriptor;for(var d=this.fontLineHeight,c=1,b=!1,e=0;!b&&4>e;e++){this.lines=this.autoWrap?a.wordwrap.wrapString(this.value,this.maxWidth*c,a.graphics.ctx):this.value.split("\n");if(!this.lines||1>this.lines.length){this.lines=[];this.setContentSize(0,0);return}d=this.fontLineHeight*
this.lines.length+this.fontLineSpacing*(this.lines.length-1);1<this.lines.length&&d>this.size.y?c+=0.1:b=!0}c=0;a.graphics.ctx.font=this.fontDescriptor;for(b=0;b<this.lines.length;b++)try{var f=a.graphics.ctx.measureText(this.lines[b]);f.width>c&&(c=f.width);this.lineWidths[b]=f.width}catch(g){a.console.log("r_ui_textbox error: "+g.message)}1===this.lines.length?(this.lines=[],this.setContentSize(c,this.fontLineHeight)):this.setContentSize(c,d);this.textWidth=c}};a.ui.TextBox.prototype.getTextWidth=
function(){return this.maxWidth<this.textWidth?this.maxWidth:this.textWidth};a.ui.TextBox.prototype.getTextHeight=function(){var a=this.lines.length||1;return totalHeight=this.fontLineHeight*a+this.fontLineSpacing*(a-1)};a.ui.TextBox.prototype.drawLine=function(d,c,b,e){if(e){d.font=this.fontDescriptor;d.fillStyle=this.color.a?this.color.toString():this.color;var f=this.maxWidth;0<this.strokeWidth&&this.strokeColor&&(f-=this.strokeWidth,d.strokeStyle=this.strokeColor.toString(),d.lineWidth=this.strokeWidth,
d.strokeText(e,c,b,f));this.textShadownEnabled&&(0<this.textShadowColor.a&&0!==this.textShadowOffset.x&&0!==this.textShadowOffset.y)&&(d.shadowColor=this.textShadowColor.toString(),d.shadowOffsetX=this.textShadowOffset.x,d.shadowOffsetY=this.textShadowOffset.y);d.fillText(e,c,b,f);if(this.strokeCleanup&&0<=this.strokeWidth&&this.strokeColor){var g=new a.graphics.Color(this.strokeColor);g.a=0.3;d.strokeStyle=g.toString();d.lineWidth=1;d.strokeText(e,c,b,f)}}};a.ui.TextBox.prototype.drawSelf=function(){var d=
a.graphics.getContext(),c,b;if(0<this.lines.length){b=this.setupAlignY(d);var e=this.fontLineHeight+this.fontLineSpacing;c=this.lines.length*e;this.baseline===a.ui.TextBox.baselineMiddle?b-=(c-e)/2:this.baseline===a.ui.TextBox.baselineBottom&&(b-=c-e);for(var f=0;f<this.lines.length;f++)c=this.setupAlignX(d,this.lineWidths[f]),this.drawLine(d,c,b,this.lines[f]),b+=e}else c=this.setupAlignX(d,this.textWidth),b=this.setupAlignY(d),this.drawLine(d,c,b,this.value)};a.ui.TextBox.prototype.boundsChanged=
function(){this.overriddenMaxWidth||(this.maxWidth=this.size.x);a.ui.TextBox.prototype.parentPrototype.boundsChanged.call(this);this.textChanged();this.setDirty(!0)};a.ui.TextBox.standardFontEditProperties={label:"font",props:[{label:"font",propName:"font.font",type:"string",defValue:"impact"},{label:"size",propName:"font.size",type:"float",defValue:40},{label:"style",propName:"font.style",type:"string"},{label:"lineHeight",propName:"font.lineHeight",type:"float"}]};a.ui.TextBox.standardFontStrokeEditProperties=
{label:"stroke",props:[{label:"width",propName:"font.stroke.width",type:"float"},{label:"color",propName:"font.stroke.color",type:"color"},{label:"cleanup",propName:"font.stroke.doCleanup",type:"boolean",tipText:"expensive way to try to make edges nicer"}]};a.ui.TextBox.editProperties=[{label:"text",props:[{propName:"text",type:"string"},{propName:"translateText",type:"string",tipText:"overrides text, tries to translate first"},{propName:"autoWrap",type:"boolean"}]},a.ui.TextBox.standardFontEditProperties,
{label:"align",props:[{propName:"align",type:"string",defValue:"left"},{propName:"baseline",type:"string",defValue:"middle",tipText:"vertical alignment"}]},a.ui.TextBox.standardFontStrokeEditProperties];a.ui.TextBox.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.TextBox,d,c,b);c.font&&(void 0!=c.font.font&&d.setFont(c.font.font),void 0!=c.font.size&&d.setFontSize(c.font.size),void 0!=c.font.style&&d.setFontStyle(c.font.style),c.font.lineHeight&&d.setLineHeight(c.font.lineHeight),
void 0!=c.font.stroke&&d.setStroke(c.font.stroke.width,a.graphics.fixColorStyle(c.font.stroke.color),c.font.stroke.doCleanup));"left"===c.align?d.setAlign(a.ui.TextBox.alignLeft):"center"===c.align?d.setAlign(a.ui.TextBox.alignCenter):"right"===c.align&&d.setAlign(a.ui.TextBox.alignRight);"top"===c.baseline?d.setBaseline(a.ui.TextBox.baselineTop):"middle"===c.baseline||"center"===c.baseline?d.setBaseline(a.ui.TextBox.baselineMiddle):"bottom"===c.baseline&&d.setBaseline(a.ui.TextBox.baselineBottom);
void 0!==c.autoWrap&&d.setAutoWrap(!!c.autoWrap);c.translateText?d.translateAndSetTextValue(c.translateText||""):d.setTextValue(c.text||"")};a.ui.TranslatedTextBox=function(d){a.string&&(d=a.string.getString(d));a.ui.TranslatedTextBox.prototype.parentConstructor.call(this,d)};a.utils.inheritClassFrom(a.ui.TranslatedTextBox,a.ui.TextBox);a.ui.TranslatedTextBox.prototype.setTextValue=function(d){a.ui.TranslatedTextBox.prototype.parentPrototype.translateAndSetTextValue.call(this,d)};a.ui.TranslatedTextBox.prototype.setTextValueRaw=
function(d){a.ui.TranslatedTextBox.prototype.parentPrototype.setTextValue.call(this,d)}});
rat.modules.add("rat.ui.r_screenmanager",[{name:"rat.os.r_events",processBefore:!0},{name:"rat.input.r_input",processBefore:!0},"rat.debug.r_console","rat.debug.r_profiler","rat.graphics.r_graphics","rat.ui.r_screen","rat.ui.r_ui_textbox","rat.ui.r_ui_button","rat.utils.r_collision2d","rat.utils.r_shapes","rat.math.r_math"],function(a){a.OK_COMMAND=-100;a.CANCEL_COMMAND=-99;a.screenManager={screenStack:[],regScreens:{},setUIRoot:function(d){a.screenManager.popAllScreens();d&&a.screenManager.pushScreen(d)},
getTopScreen:function(){return 0<a.screenManager.screenStack.length?a.screenManager.screenStack[a.screenManager.screenStack.length-1]:null},pushScreen:function(d){if(d){var c=a.screenManager.getTopScreen();c&&c.saveCurrentTarget();if(d.isOverlay){if(d.isModal)for(b=a.screenManager.screenStack.length-1;0<=b;--b)c=a.screenManager.screenStack[b],c.applyRecursively(function(){this.toolTip&&(this.toolTip.timer=0);this.mouseLeave()})}else for(var b=a.screenManager.screenStack.length-1;0<=b;--b){c=a.screenManager.screenStack[b];
if(c.isSuspended)break;c.deactivate({allowOnlySuspend:!0})}a.screenManager.screenStack.push(d);d.activate()}},insertScreen:function(d){a.screenManager.screenStack.length?(d.deactivate({allowOnlySuspend:!0}),a.screenManager.screenStack.unshift(d)):a.screenManager.pushScreen(d)},removeScreen:function(d){for(var c=0;c<a.screenManager.screenStack.length;++c)if(a.screenManager.screenStack[c].id===d.id)return c===a.screenManager.screenStack.length-1?a.screenManager.popScreen():a.screenManager.removeScreenAtIndex(c)},
removeScreenAtIndex:function(d){if(!(0>d||d>=a.screenManager.screenStack.length)){var c=a.screenManager.screenStack[d];a.screenManager.screenStack.splice(d,1);c.deactivate();c.destroy();return c}},popScreen:function(){for(var d=a.screenManager.removeScreenAtIndex(a.screenManager.screenStack.length-1),c,b=a.screenManager.screenStack.length-1;0<=b;--b)if(c=a.screenManager.screenStack[b])if(c.activate(),!c.isOverlay)break;(c=a.screenManager.getTopScreen())&&c.restoreSavedTarget();return d},popAllScreens:function(){for(var d=
a.screenManager.screenStack.length-1;0<=d;--d)a.screenManager.screenStack[d].deactivate();a.screenManager.screenStack=[]},registerScreen:function(d,c){a.screenManager.regScreens[d]={creator:c}},switchToScreen:function(d,c,b){b=b||[];var e=a.screenManager.regScreens[d];if(!e)return a.console.log("ERROR: no such registered screen: "+d),null;b=e.creator.apply(void 0,b);if(!b)return a.console.log("Error: screen creator failed "+d),null;b._screenTag=d;c||a.screenManager.popScreen();a.screenManager.pushScreen(b);
return b},doConfirmDialog:function(d){var c=d.width,b=d.height;"undefined"===typeof c&&(c=420);"undefined"===typeof b&&(b=200);"undefined"===typeof d.title&&(d.title="");"undefined"===typeof d.body&&(d.body="");"undefined"===typeof d.yesText&&(d.yesText="Yes");"undefined"===typeof d.yesCommand&&(d.yesCommand=a.OK_COMMAND);"undefined"===typeof d.noText&&(d.noText="");"undefined"===typeof d.noCommand&&(d.noCommand=a.CANCEL_COMMAND);"undefined"===typeof d.userData&&(d.userData=null);d.bgColor||(d.bgColor=
{r:80,g:80,b:80});d.frameColor||(d.frameColor={r:120,g:120,b:120});d.pos||(d.pos={x:a.graphics.SCREEN_WIDTH/2-c,y:a.graphics.SCREEN_WIDTH/3-b/2});d.titleFont||(d.titleFont=d.font);d.bodyFont||(d.bodyFont=d.font);d.buttonFont||(d.buttonFont=d.font);d.titleFont||(d.titleFont={font:"Impact",size:14});d.bodyFont||(d.titleFont={font:"Arial",size:12});var e=new a.ui.Screen;e.setModal(!0);e.setPos(d.pos.x,d.pos.y);e.setSize(c,b);e.setBackground(new a.graphics.Color(d.bgColor.r,d.bgColor.g,d.bgColor.b));
e.setFrame(4,new a.graphics.Color(120,120,120));""!==d.title&&(c=new a.ui.TextBox(d.title),c.setFont(d.titleFont.font||d.titleFont),c.setFontSize(d.titleFont.size||14),c.setPos(0,0),c.setSize(e.size.x,14),c.setAlign(a.ui.TextBox.alignCenter),c.setColor(new a.graphics.Color(250,250,220)),e.appendSubElement(c));""!==d.body&&(c=new a.ui.TextBox(d.body),c.setFont(d.bodyFont.font||d.bodyFont),c.setFontSize(d.bodyFont.size||12),c.setPos(0,40),c.setSize(e.size.x,14),c.setAlign(a.ui.TextBox.alignCenter),
c.setColor(new a.graphics.Color(190,190,190)),e.appendSubElement(c));b=2*e.size.y/3-30;""!==d.yesText&&(c=a.ui.makeCheapButton(null,new a.graphics.Color(150,200,150)),c.setTextValue(d.yesText),c.setSize(70,30),c.setPos(50,b),c.setCommand(d.yesCommand,d.userData),e.appendSubElement(c));""!==d.noText&&(c=a.ui.makeCheapButton(null,new a.graphics.Color(150,200,150)),c.setTextValue(d.noText),c.setSize(70,30),c.setPos(e.size.x-30-70,b),c.setCommand(d.noCommand,d.userData),e.appendSubElement(c));a.screenManager.pushScreen(e);
e.handleCommand=function(){a.screenManager.popScreen();return!1};return e},dispatchEvent:function(d){for(var c=!1,b=a.screenManager.screenStack.length-1;0<=b;b--){if(b>a.screenManager.screenStack.length-1)return!0;var e=a.screenManager.screenStack[b];if("undefined"===typeof e){console.log("bogus screen at "+b);return}var f=e.modal;if(e.isSuspended&&!e.forceScreenActive)break;c=null;"mousedown"===d.eventType||("mouseup"===d.eventType||"mousemove"===d.eventType||"contextmenu"===d.eventType||"touchstart"===
d.eventType||"touchend"===d.eventType||"mousewheel"===d.eventType||"touchmove"===d.eventType)||(e.inputMap&&(c=e.inputMap.getTargetForEvent(d)),!c&&e.targets&&(c=e.targets[0]));if(c=c?c.handleEvent(d):e.handleEvent(d))break;if(f){if(("mousedown"===d.eventType||"touchstart"===d.eventType)&&e.allowClickAway&&!a.collision2D.pointInRect(d.pos,e.getBounds()))e.clickAwaySound&&a.audio&&a.audio.playSound(e.clickAwaySound),a.screenManager.popScreen(),c=!0;break}}return c},updateScreens:function(){a.ui.updateCallCount=
0;for(var d,c=a.screenManager.screenStack.length-1;0<=c;--c)if(d=a.screenManager.screenStack[c]){if(d.isSuspended&&!d.forceScreenActive)break;a.profiler.pushPerfMark(d._screenTag||"???");a.screenManager.screenStack[c].update(a.deltaTime);a.profiler.popPerfMark(d._screenTag||"???")}},drawScreens:function(){var d,c,b=a.screenManager.screenStack;for(d=0;d<b.length;d++)if(c=b[d],!c.isSuspended||c.forceScreenActive)a.profiler.pushPerfMark(c._screenTag||"???"),c.draw(),d===b.length-1&&a.screenManager.drawTooltips(c),
a.profiler.popPerfMark(c._screenTag||"???")},drawTooltips:function(d){if(d.activeToolTip){var c=new a.shapes.Rect(0,0,a.graphics.SCREEN_WIDTH-d.activeToolTip.size.x,a.graphics.SCREEN_HEIGHT-d.activeToolTip.size.y);d.activeToolTip.place.pos.limitToRect(c);d.activeToolTip.setVisible(!0);d.activeToolTip.draw();d.activeToolTip=null}},onWindowResize:function(){for(var d,c=a.screenManager.screenStack.length-1;0<=c;--c){d=a.screenManager.screenStack[c];if(d.isSuspended&&!d.forceScreenActive)break;if(d.onWindowResize)d.onWindowResize()}},
centerAllScreens:function(){for(var d,c=a.screenManager.screenStack.length-1;0<=c;--c)d=a.screenManager.screenStack[c],d.centerInDisplay()}};a.addEventListener("resize",a.screenManager.onWindowResize);a.input.registerEventHandler(a.screenManager.dispatchEvent)});
rat.modules.add("rat.ui.r_ui",[{name:"rat.os.r_events",processBefore:!0},{name:"rat.graphics.r_offscreen",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.math.r_vector","rat.graphics.r_graphics","rat.utils.r_shapes","rat.ui.r_ui_animator","rat.ui.r_ui_tooltip","rat.math.r_math","rat.utils.r_collision2d","rat.ui.r_ui_textbox","rat.ui.r_ui_edittext","rat.ui.r_ui_data","rat.utils.r_eventmap"],function(a){a.ui={};a.ui.nextElementID=1;a.ui.mouseMoveCallCount=0;a.ui.updateCallCount=0;a.ui.debugOffscreens=
!1;a.ui.allowOffscreens=a.Offscreen.allowOffscreens;a.ui.Element=function(c){void 0===this.id&&(this.id=a.ui.nextElementID++,this.place=new a.Position(0,0,0),this.center=new a.Vector(0,0),this.color=new a.graphics.Color,this.size=new a.Vector(0,0),this.scale=new a.Vector(1,1),this.opacity=1,this.tempRect=new a.shapes.Rect,this.contentOffset=new a.Vector(0,0),this.contentSize=new a.Vector(0,0),this.contentScale=new a.Vector(1,1),this.contentScaleMin=new a.Vector(0.1,0.1),this.contentScaleMax=new a.Vector(10,
10),this.flags=0,this.flags|=a.ui.Element.enabledFlag,this.flags|=a.ui.Element.visibleFlag,this.flags|=a.ui.Element.adjustForScaleFlag,this.flags|=a.ui.Element.tracksMouseFlag,this.name="<elem>"+this.id,this.commandInfo=this.command=0,this.callbackInfo=this.callback=null,this.events={},this.frameWidth=0,this.frameColor=new a.graphics.Color(0,0,0),this.frameOutset=0,this.offscreen=null,this.useOffscreen=!1,this.needsUpdate=this.isDirty=!0,c?c.appendSubElement(this):this.parent=null,this.toolTip=null)};
a.ui.Element.prototype.elementType="element";a.ui.Element.highlightedFlag=1;a.ui.Element.enabledFlag=2;a.ui.Element.pressedFlag=4;a.ui.Element.toggledFlag=8;a.ui.Element.visibleFlag=16;a.ui.Element.clipFlag=32;a.ui.Element.targetableFlag=64;a.ui.Element.targetedFlag=128;a.ui.Element.mouseInFlag=256;a.ui.Element.trackingMouseDownFlag=512;a.ui.Element.tracksMouseFlag=1024;a.ui.Element.handleAllMouseInMe=2048;a.ui.Element.autoSizeAfterLoadFlag=4096;a.ui.Element.autoCenterAfterLoadFlag=8192;a.ui.Element.autoScaleAfterLoadFlag=
16384;a.ui.Element.adjustForScaleFlag=65536;a.ui.Element.drawTiledFlag=1048576;a.ui.Element.prototype.flagsThatDirtyMe=0;a.ui.Element.prototype.flagsThatDirtyParent=a.ui.Element.visibleFlag;a.ui.Element.prototype.appendSubElement_unsafe=function(a){this.subElements?this.subElements.push(a):this.subElements=[a];a.parent=this;a.toolTip&&a.toolTipScreenWasAssumed&&(a.toolTipScreen=a.getTopParent());this.setDirty(!0);this.setNeedsUpdate(!0)};a.ui.Element.prototype.appendSubElement=function(c){this.findSubElementByID(c.id,
!1)&&a.console.logOnce("WARNING: appending subelement with duplicate ID:  "+c.id,"dupID");this.appendSubElement_unsafe(c)};a.ui.Element.prototype.insertSubElement=function(c,b){this.findSubElementByID(c.id)&&a.console.logOnce("WARNING: appending subelement with duplicate ID:  "+c.id,"dupID");void 0===b&&(b=0);this.subElements?this.subElements.splice(b,0,c):this.subElements=[c];c.parent=this;this.setDirty(!0)};a.ui.Element.prototype.insertSubElementBefore=function(c,b){var d=this.getSubElementIndex(b);
0>d&&(a.console.logOnce("ERROR: attempting insert before element not in tree: "+b.id,"noBeforeElem"),d=0);this.insertSubElement(c,d)};a.ui.Element.prototype.replaceSubElement=function(c,b){var d=this.getSubElementIndex(c);0>d?a.console.logOnce("ERROR: replaceSubElement failed to find: "+c.id,"noReplaceElem"):(b.parent=this,b.setPos(c.getPos()),b.setSize(c.getSize()),this.subElements[d]=b,this.setDirty(!0))};a.ui.Element.prototype.getParent=function(){return this.parent};a.ui.Element.prototype.getTopParent=
function(){for(var a=this;a.parent;)a=a.parent;return a};a.ui.Element.prototype.removeSubElementByID=function(a){if(this.subElements){var b;for(b=0;b<this.subElements.length;b++)if(this.subElements[b].id===a)return this.subElements.splice(b,1),this.setDirty(!0),!0;for(b=0;b<this.subElements.length;b++)if(this.subElements[b].removeSubElementByID(a))return this.setDirty(!0),!0}return!1};a.ui.Element.prototype.removeSubElement=function(a){return this.removeSubElementByID(a.id)};a.ui.Element.prototype.removeFromParent=
function(){"undefined"!==typeof this.parent&&this.parent.removeSubElement(this)};a.ui.Element.prototype.detachAllChildren=function(){var a=this.subElements||[];this.subElements=void 0;for(var b=0;b!==a.length;++b)a[b].parent=null;this.setDirty(!0);return a};a.ui.Element.prototype.removeAllSubElements=function(a){if(this.subElements)for(var b=0;b<this.subElements.length;b++)this.subElements[b].removeAllSubElements(!0);a&&this.killMyAnimators();this.subElements=[];this.setDirty(!0)};a.ui.Element.prototype.killMyAnimators=
function(){a.ui.killAnimatorsForElement(this)};a.ui.Element.prototype.findSubElementByID=function(a,b){void 0===b&&(b=!0);var d;if(this.subElements)for(var f=0;f!==this.subElements.length;++f)if(d=this.subElements[f])if(d.id===a||b&&(d=this.subElements[f].findSubElementByID(a,b)))return d};a.ui.Element.prototype.getSubElement=function(a){return!this.subElements||this.subElements.length<a?null:this.subElements[a]};a.ui.Element.prototype.getSubElementIndex=function(a){if(this.subElements)for(var b=
0;b<this.subElements.length;++b)if(this.subElements[b]===a)return b;return-1};a.ui.Element.prototype.getSubElementCount=function(){return this.subElements?this.subElements.length:0};a.ui.Element.prototype.dumpTree=function(c,b){"undefined"===typeof c&&(c=0);var d=this.isVisible();b||(b={lines:[],totalCount:0,hiddenCount:0,updateCount:0,parentHidden:!1});b.totalCount++;var f=b.totalCount;this.needsUpdate&&b.updateCount++;(!d||b.parentHidden)&&b.hiddenCount++;var g=b.lines.length;b.lines.push("");if(this.subElements){var h=
b.parentHidden;d||(b.parentHidden=!0);this.useOffscreen&&(b.parentHidden=!0);for(j=0;j<this.subElements.length;j++)this.subElements[j].dumpTree(c+1,b);b.parentHidden=h}var h="",j;for(j=0;j<c;j++)h+="._";j=this.getBounds();j.x=""+a.math.floor(100*j.x)/100;j.y=""+a.math.floor(100*j.y)/100;j.w=""+a.math.floor(100*j.w)/100;j.h=""+a.math.floor(100*j.h)/100;var k="";this.xuiElemType&&(k=" "+this.xuiElemType);var l="";b.totalCount>f&&(l=" subCount: "+(b.totalCount-f));d=d?"Visible":"Hidden";this.useOffscreen&&
(d="Offscreen");b.parentHidden&&(d="("+d+")");b.lines[g]=h+this.id+":"+this.name+k+" : "+d+" : "+(this.needsUpdate?"ups":"noup")+" : "+j.x+", "+j.y+" ("+j.w+" x "+j.h+")"+l;return b};a.ui.Element.prototype.setColor=function(c){"string"===typeof c&&(c=new a.graphics.Color(c));this.color=c};a.ui.Element.prototype.getColor=function(){return this.color?this.color.copy():null};a.ui.Element.prototype.setSize=function(a,b){void 0!==a.h&&(b=a.h,a=a.w);this.size.x=a;this.size.y=b;this.boundsChanged()};a.ui.Element.prototype.setWidth=
function(a){this.size.x=a;this.boundsChanged()};a.ui.Element.prototype.setBounds=function(a,b,d,f){void 0!==a.x?(this.place.pos.x=a.x,this.place.pos.y=a.y,this.size.x=a.w,this.size.y=a.h):(this.place.pos.x=a,this.place.pos.y=b,this.size.x=d,this.size.y=f);this.boundsChanged()};a.ui.Element.prototype.setHeight=function(a){this.size.y=a;this.boundsChanged()};a.ui.Element.prototype.getSize=function(){var a={};a.x=this.size.x;a.y=this.size.y;a.w=this.size.x;a.h=this.size.y;return a};a.ui.Element.prototype.getWidth=
function(){return this.size.x};a.ui.Element.prototype.getHeight=function(){return this.size.y};a.ui.Element.prototype.setContentSize=function(a,b){this.contentSize.x=a;this.contentSize.y=b};a.ui.Element.prototype.setContentSizeFromSubElements=function(){var a=this.calculateContentBounds();this.setContentSize(a.w,a.h)};a.ui.Element.prototype.calculateContentBounds=function(){for(var a=9999,b=-9999,d=9999,f=-9999,g=0;this.subElements&&g<this.subElements.length;g++){var h=this.subElements[g];h.getBounds(h.tempRect);
var j=h.place.pos,k=Math.cos(h.place.rot.angle),l=Math.sin(h.place.rot.angle),m=function(g,h){var m=j.x+g*k-h*l,r=j.y+g*l+h*k;m<a&&(a=m);m>b&&(b=m);r<d&&(d=r);r>f&&(f=r)};m(0,0);m(h.size.x*h.scale.x,0);m(h.size.x*h.scale.x,h.size.y*h.scale.y);m(0,h.size.y*h.scale.y)}return{x:a,y:d,w:b-a,h:f-d}};a.ui.Element.prototype.setBoundsFromContent=function(a){var b=this.calculateContentBounds(),d=b.x-a,f=b.y-a;this.setPos(this.place.pos.x+d,this.place.pos.y+f);for(var g=0;this.subElements&&g<this.subElements.length;g++){var h=
this.subElements[g];h.setPos(h.place.pos.x-d,h.place.pos.y-f)}this.setSize(b.w+2*a,b.h+2*a)};a.ui.Element.prototype.getContentSize=function(){return this.contentSize.copy()};a.ui.Element.prototype.setPos=function(a,b){void 0!=a.x&&(b=a.y,a=a.x);this.place.pos.x=a;this.place.pos.y=b;this.boundsChanged()};a.ui.Element.prototype.getPos=function(){return this.place.pos};a.ui.Element.prototype.getPosX=function(){return this.place.pos.x};a.ui.Element.prototype.getPosY=function(){return this.place.pos.y};
a.ui.Element.prototype.setPosX=function(a){this.place.pos.x=a;this.boundsChanged()};a.ui.Element.prototype.setPosY=function(a){this.place.pos.y=a;this.boundsChanged()};a.ui.Element.prototype.setScale=function(a,b){this.scale.x=a;this.scale.y=b;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getScale=function(){return this.scale};a.ui.Element.prototype.setRotation=function(a){this.place.rot.angle=a;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getRotation=function(){return this.place.rot.angle};
a.ui.Element.prototype.setOpacity=function(a){this.opacity=a;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getOpacity=function(){return this.opacity};a.ui.Element.prototype.setOpacityRecursive=function(c){this.applyRecursively(a.ui.Element.prototype.setOpacity,c)};a.ui.Element.prototype.setID=function(a){this.id=a};a.ui.Element.prototype.setFrame=function(c,b,d){this.frameWidth=c;"undefined"!==typeof b?"string"===typeof b?this.frameColor.copyFrom(a.graphics.Color.makeFromStyleString(b)):
this.frameColor.copyFrom(b):void 0===b&&this.frameColor.copyFrom(a.graphics.white);"undefined"!==typeof d&&(this.frameOutset=d);this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.setFrameRandom=function(a){this.frameWidth=a;this.frameColor.setRandom();this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.getGlobalPos=function(a,b){void 0===a&&(b=a=0);void 0!==a.x&&(b=a.y,a=a.x);var d=this;do a-=d.center.x,b-=d.center.y,a*=d.scale.x,b*=d.scale.y,a+=d.place.pos.x,b+=d.place.pos.y,
d.parent&&(a*=d.parent.contentScale.x,b*=d.parent.contentScale.y,a+=d.parent.contentOffset.x,b+=d.parent.contentOffset.y),d=d.parent;while(d);return{x:a,y:b}};a.ui.Element.prototype.getGlobalContentPos=function(a,b){"undefined"===typeof a&&(b=a=0);a*=this.contentScale.x;b*=this.contentScale.y;a+=this.contentOffset.x;b+=this.contentOffset.y;return this.getGlobalPos(a,b)};a.ui.Element.prototype.parentToLocalPos=function(c,b){var d=new a.Vector(c,b);d.x-=this.place.pos.x;d.y-=this.place.pos.y;d.x/=this.scale.x;
d.y/=this.scale.y;return d};a.ui.Element.prototype.parentToLocalContentPos=function(a,b){var d=this.parentToLocalPos(a,b);d.x-=this.contentOffset.x;d.y-=this.contentOffset.y;d.x/=this.contentScale.x;d.y/=this.contentScale.y;return d};a.ui.Element.prototype.globalToLocalPos=function(a,b){var d;d=this.parent?this.parent.globalToLocalPos(a,b):{x:a,y:b};d.x-=this.place.pos.x;d.y-=this.place.pos.y;d.x/=this.scale.x;d.y/=this.scale.y;return d};a.ui.Element.prototype.applyRecursively=function(a,b){var d=
a.call(this,b);if(d)return d;if(this.subElements)for(var f=0;f<this.subElements.length;f++)if(d=this.subElements[f].applyRecursively(a,b))return d;return!1};a.ui.Element.prototype.callForSubElements=function(a,b){if(this.subElements)for(var d=0,f=this.subElements.length;d!==f;++d){var g=a.call(this.subElements[d],b);if(g)return g}return!1};a.ui.Element.prototype.callForSubElementsWithPos=function(a,b,d,f){if(this.subElements){b=this.parentToLocalContentPos(b.x,b.y);b.x+=this.center.x;b.y+=this.center.y;
for(var g=this.subElements.length-1;0<=g;g--){var h=a.call(this.subElements[g],b,d,f);if(h)return h}}return!1};a.ui.Element.prototype.update=function(c){a.ui.updateCallCount++;var b=!1;if(this.updateSelf){var d=this.updateSelf(c);if(void 0===d||!0===d)b=!0}if(this.subElements)for(var f=this.subElements.length-1;0<=f;--f)if(d=this.subElements[f],d.needsUpdate&&(d=d.update(c),void 0===d||!0===d))b=!0;this.toolTip&&(b=!0,this.updateToolTip(c));if(this.updateSelfPost&&(d=this.updateSelfPost(c),void 0===
d||!0===d))b=!0;b||(this.needsUpdate=!1);return this.needsUpdate};a.ui.Element.prototype.setNeedsUpdate=function(a){void 0===a&&(a=!0);if(this.needsUpdate=a)for(a=this.parent;a;)a.needsUpdate=!0,a=a.parent};a.ui.Element.prototype.autoCenter=function(a){a||void 0===a?(this.center.x=this.size.x/2,this.center.y=this.size.y/2):this.center.x=this.center.y=0};a.ui.Element.prototype.setCenter=function(a,b){this.center.x=a;this.center.y=b;this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.centerAt=
function(a,b){this.setPos(a-this.size.x/2,b-this.size.y/2)};a.ui.Element.prototype.centerInParent=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.size.x)/2,this.place.pos.y=(this.parent.size.y-this.size.y)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.centerInParentHorizontally=function(){this.parent&&(this.place.pos.x=(this.parent.size.x-this.size.x)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.centerInParentVertically=function(){this.parent&&(this.place.pos.y=(this.parent.size.y-
this.size.y)/2,this.parent.setDirty(!0))};a.ui.Element.prototype.autoSizeToParent=function(){this.parent&&this.setBounds(0,0,this.parent.size.x,this.parent.size.y)};a.ui.Element.prototype.autoSizeToContent=function(){this.size.x=this.contentSize.x;this.size.y=this.contentSize.y;this.boundsChanged()};a.ui.Element.prototype.getBounds=function(c){c=c||new a.shapes.Rect;c.x=this.place.pos.x-this.center.x;c.y=this.place.pos.y-this.center.y;c.w=this.size.x*this.scale.x;c.h=this.size.y*this.scale.y;return c};
a.ui.Element.prototype.getLocalBounds=function(){return new a.shapes.Rect(0-this.center.x,0-this.center.y,this.size.x,this.size.y)};a.ui.Element.prototype.getMyLocalBounds=a.ui.Element.prototype.getLocalBounds;a.ui.Element.prototype.getGlobalBounds=function(){var c=this.getGlobalPos(),b=this.getGlobalPos(this.size.x,this.size.y);return new a.shapes.Rect(c.x,c.y,b.x-c.x,b.y-c.y)};a.ui.Element.prototype.adjustBoundsForPointer=function(a,b){if(b&&b.isFromTouch){var d=b.touchRadiusX,f=b.touchRadiusY;
a.x-=d;a.y-=f;a.w+=2*d;a.h+=2*f}return a};a.ui.Element.prototype.findSubElementByPoint=function(c,b,d){var f=this.parentToLocalContentPos(c.x,c.y);f.x+=this.center.x;f.y+=this.center.y;var g=null;if(this.subElements)for(var h=this.subElements.length-1;0<=h;h--){var j=this.subElements[h];if((j.flags&b)===b&&(g=j.findSubElementByPoint(f,b)))break}if(g)return g;b=this.getBounds(this.tempRect);d&&this.adjustBoundsForPointer(b,d);return!a.collision2D.pointInRect(c,b)?null:this};a.ui.Element.prototype.mouseEnter=
function(){if(0!==(this.flags&a.ui.Element.enabledFlag)){var c=this.flags;this.flags|=a.ui.Element.mouseInFlag;this.flags=this.flags&a.ui.Element.trackingMouseDownFlag?this.flags|a.ui.Element.pressedFlag:this.flags|a.ui.Element.highlightedFlag;this.checkFlagsChanged(c)}};a.ui.Element.prototype.mouseLeave=function(){if(0!==(this.flags&a.ui.Element.enabledFlag)){var c=this.flags;this.flags&=~a.ui.Element.mouseInFlag;0===(this.flags&a.ui.Element.trackingMouseDownFlag)&&(this.flags&=~a.ui.Element.highlightedFlag);
this.flags&=~a.ui.Element.pressedFlag;this.checkFlagsChanged(c)}};a.ui.Element.prototype.mouseDown=function(c,b){if(0===(this.flags&a.ui.Element.enabledFlag)||0===(this.flags&a.ui.Element.tracksMouseFlag))return!1;var d=this.flags;this.flags|=a.ui.Element.trackingMouseDownFlag;this.flags|=a.ui.Element.pressedFlag;this.targetMe(b);this.checkFlagsChanged(d);return!1};a.ui.Element.prototype.mouseUp=function(c,b){if(0===(this.flags&a.ui.Element.enabledFlag))return!1;var d=this.flags;this.flags&=~a.ui.Element.trackingMouseDownFlag;
this.flags&=~a.ui.Element.pressedFlag;b.isFromTouch&&(this.flags&=~a.ui.Element.highlightedFlag,this.flags&=~a.ui.Element.mouseInFlag);var f=!1;d&a.ui.Element.trackingMouseDownFlag&&(f=this.getLocalBounds(),this.adjustBoundsForPointer(f,b),a.collision2D.pointInRect(c,f)?(f=this.trigger())&&a.eventMap.fireEvent("uiTriggered",this):(this.flags&=~a.ui.Element.highlightedFlag,f=!1));this.checkFlagsChanged(d);return f};a.ui.Element.prototype.handleMouseMove=function(c,b,d){if(!this.isVisible())return!1;
a.ui.mouseMoveCallCount++;"undefined"===typeof b&&(b=!1);var f=this.getBounds(this.tempRect);this.adjustBoundsForPointer(f,d);f=a.collision2D.pointInRect(c,f);!b&&(f&&0===(this.flags&a.ui.Element.mouseInFlag))&&this.mouseEnter();(b||!f&&this.flags&a.ui.Element.mouseInFlag)&&this.mouseLeave();!f&&0!==(this.flags&a.ui.Element.clipFlag)&&(b=!0);this.mousePos=c=this.parentToLocalContentPos(c.x,c.y);this.mouseMove&&this.mouseMove(c,d);c.x+=this.center.x;c.y+=this.center.y;if(this.subElements)for(f=this.subElements.length-
1;0<=f;f--){var g=this.subElements[f];g.flags&a.ui.Element.tracksMouseFlag&&g.handleMouseMove(c,b,d)}};a.ui.Element.prototype.handlePositionalEvent=function(c,b,d,f){if(!this.isVisible())return!1;var g=this.getBounds(this.tempRect);this.adjustBoundsForPointer(g,b);var g=a.collision2D.pointInRect(c,g),h=!1;if(this.subElements&&(g||0===(this.flags&a.ui.Element.clipFlag))){var j=this.parentToLocalContentPos(c.x,c.y);j.x+=this.center.x;j.y+=this.center.y;for(var k=this.subElements.length-1;0<=k;k--)if(d(this.subElements[k],
j,b))return!0}g&&!h&&(c=this.parentToLocalPos(c.x,c.y),h=f(this,c,b));return h};a.ui.Element.prototype.handleMouseDown=function(c,b){if(!this.isVisible())return!1;var d=this.getBounds(this.tempRect);this.adjustBoundsForPointer(d,b);var d=a.collision2D.pointInRect(c,d),f=!1;if(d||0===(this.flags&a.ui.Element.clipFlag))f=this.callForSubElementsWithPos(a.ui.Element.prototype.handleMouseDown,c,b);if(d&&(!f||this.flags&a.ui.Element.handleAllMouseInMe))d=this.parentToLocalPos(c.x,c.y),f=this.mouseDown(d,
b);return f};a.ui.Element.prototype.handleMouseUp=function(c,b){if(!this.isVisible||!this.isVisible())return!1;var d=this.parentToLocalPos(c.x,c.y);(d=this.mouseUp(d,b))||(d=this.callForSubElementsWithPos(a.ui.Element.prototype.handleMouseUp,c,b));return d};a.ui.Element.prototype.handleContextMenu=function(a,b){return this.handlePositionalEvent(a,b,function(a,b,c){return a.handleContextMenu(b,c)},function(a,b,c){return a.contextMenuEvent?a.contextMenuEvent(b,c):!1})};a.ui.Element.prototype.handleMouseWheel=
function(a,b){return this.handlePositionalEvent(a,b,function(a,b,c){return a.handleMouseWheel(b,c)},function(a,b,c){return a.mouseWheelEvent?a.mouseWheelEvent(b,c):!1})};a.ui.Element.prototype.handleKeyDown=function(a){return this.keyDown?this.keyDown(a):!1};a.ui.Element.prototype.handleKeyUp=function(a){return this.keyUp?this.keyUp(a):!1};a.ui.Element.prototype.handleKeyPress=function(a){return this.keyPress?this.keyPress(a):!1};a.ui.Element.prototype.handleButtonDown=function(){return!1};a.ui.Element.prototype.handleButtonUp=
function(){return!1};a.ui.Element.prototype.handleEvent=function(c){var b=!1;"keydown"===c.eventType?b=this.handleKeyDown(c):"keyup"===c.eventType?b=this.handleKeyUp(c):"keypress"===c.eventType&&(b=this.handleKeyPress(c));"mousedown"===c.eventType&&(b=this.handleMouseDown(c.pos,c));"mouseup"===c.eventType&&(b=this.handleMouseUp(c.pos,c));a.ui.mouseMoveCallCount=0;"mousemove"===c.eventType&&(b=this.handleMouseMove(c.pos,!1,c));"contextmenu"===c.eventType&&(b=this.handleContextMenu(c.pos,c));"mousewheel"===
c.eventType&&(b=this.handleMouseWheel(c.pos,c));"buttondown"===c.eventType&&(b=this.handleButtonDown(c));"buttonup"===c.eventType&&(b=this.handleButtonUp(c));"ui"===c.eventType&&(b=this.handleUIInput(c));if(b)return b;this.parent&&(b=this.parent.handleEvent(c));return b};a.ui.Element.prototype.handleUIInput=function(){return!1};a.ui.Element.prototype.targetMe=function(a){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){for(var b=this;b.parent&&!b.inputMap;)b=b.parent;if(b.setCurrentTarget)return b.setCurrentTarget(this,
a),!0}return!1};a.ui.Element.prototype.focus=function(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var a=this.isHighlighted();this.setHighlighted(!0);if(!a&&this.events.onFocus)this.events.onFocus(this);this.setTargeted(!0);return!0}return!1};a.ui.Element.prototype.blur=function(){if(this.isTargetable()&&this.isEnabled()&&this.isVisible()){var a=this.isHighlighted();this.setHighlighted(!1);if(a&&this.events.onBlur)this.events.onBlur(this);this.setTargeted(!1)}return!0};a.ui.Element.prototype.press=
function(){this.trigger()&&a.eventMap.fireEvent("uiTriggered",this)};a.ui.Element.prototype.trigger=function(){var c=a.telemetry,b=!1;0!==this.command&&(c&&this.name&&c.recordUI("UI com",this.name),a.dispatchCommand(this.command,this.commandInfo)&&(b=!0));if(this.callback&&(c&&this.name&&c.recordUI("UI cb",this.name),(c=this.callback(this,this.callbackInfo))||void 0===c))b=!0;b&&this.clickSound&&a.audio&&a.audio.playSound(this.clickSound);return b};a.ui.Element.prototype.setCommand=function(a,b){this.command=
a;this.commandInfo=b};a.ui.Element.prototype.setCallback=function(a,b){this.callback=a;"undefined"!==typeof b&&(this.callbackInfo=b)};a.ui.Element.prototype.setFlagsChangedCallback=function(a,b){this.flagsChangedCallback=a;"undefined"!==typeof b&&(this.callbackInfo=b)};a.ui.Element.prototype.setCallbackInfo=function(a){this.callbackInfo=a};a.ui.Element.prototype.setFlag=function(a,b){var d=this.flags;"undefined"===typeof b&&(b=!0);this.flags=b?this.flags|a:this.flags&~a;this.checkFlagsChanged(d)};
a.ui.Element.prototype.clearFlag=function(a){this.setFlag(a,!1)};a.ui.Element.prototype.setVisible=function(c){this.setFlag(a.ui.Element.visibleFlag,c)};a.ui.Element.prototype.isVisible=function(){return 0!==(this.flags&a.ui.Element.visibleFlag)};a.ui.Element.prototype.setHighlighted=function(c){this.setFlag(a.ui.Element.highlightedFlag,c)};a.ui.Element.prototype.isHighlighted=function(){return 0!==(this.flags&a.ui.Element.highlightedFlag)};a.ui.Element.prototype.setEnabled=function(c){var b=this.flags;
"undefined"===typeof c&&(c=!0);c?this.flags|=a.ui.Element.enabledFlag:(this.flags&=~a.ui.Element.enabledFlag,this.flags&=~a.ui.Element.highlightedFlag,this.flags&=~a.ui.Element.pressedFlag,this.flags&=~a.ui.Element.mouseInFlag,this.flags&=~a.ui.Element.trackingMouseDownFlag);this.checkFlagsChanged(b)};a.ui.Element.prototype.isEnabled=function(){return 0!==(this.flags&a.ui.Element.enabledFlag)};a.ui.Element.prototype.setToggled=function(c){this.setFlag(a.ui.Element.toggledFlag,c)};a.ui.Element.prototype.isToggled=
function(){return 0!==(this.flags&a.ui.Element.toggledFlag)};a.ui.Element.prototype.setClipped=function(c){this.setFlag(a.ui.Element.clipFlag,c)};a.ui.Element.prototype.setClip=a.ui.Element.prototype.setClipped;a.ui.Element.prototype.isClipped=function(){return 0!==(this.flags&a.ui.Element.clipFlag)};a.ui.Element.prototype.isPressed=function(){return 0!==(this.flags&a.ui.Element.pressedFlag)};a.ui.Element.prototype.setTracksMouse=function(c){this.setFlag(a.ui.Element.tracksMouseFlag,c)};a.ui.Element.prototype.isTargetable=
function(){return 0!==(this.flags&a.ui.Element.targetableFlag)};a.ui.Element.prototype.setTargetable=function(c){this.setFlag(a.ui.Element.targetableFlag,c)};a.ui.Element.prototype.canBeTarget=a.ui.Element.prototype.isTargetable;a.ui.Element.prototype.isTargeted=function(){return 0!==(this.flags&a.ui.Element.targetedFlag)};a.ui.Element.prototype.setTargeted=function(c){this.setFlag(a.ui.Element.targetedFlag,c)};a.ui.Element.prototype.setAdjustForScale=function(c){this.setFlag(a.ui.Element.adjustForScaleFlag,
c)};a.ui.Element.prototype.scroll=function(a,b){this.contentOffset.x+=a;this.contentOffset.y+=b;this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.setContentOffset=function(a,b){void 0!==a&&(this.contentOffset.x=a);void 0!==b&&(this.contentOffset.y=b);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.getContentOffset=function(){return this.contentOffset.copy()};a.ui.Element.prototype.getScroll=a.ui.Element.prototype.getContentOffset;a.ui.Element.prototype.getTargetContentOffset=
function(){var c=a.ui.getAnimatorsForElement(this,a.ui.Animator.scroller);return c&&0<c.length?c[0].endValue:this.contentOffset.copy()};a.ui.Element.prototype.pointIsInView=function(a,b,d){b||(b=0);d||(d=0);var f=this.contentOffset,g=this.contentScale;return 0>(a.x-b)*g.x+f.x||0>(a.y-d)*g.y+f.y||(a.x+b)*g.x+f.x>this.size.x||(a.y+d)*g.y+f.y>this.size.y?!1:!0};a.ui.Element.prototype.scrollToShow=function(a,b,d,f){f||(f=this.contentOffset);var g=this.contentScale,h=this.size.x-(a.x+b)*g.x;b=-(a.x-b)*
g.x;f.x>h?f.x=h:f.x<b&&(f.x=b);h=this.size.y-(a.y+d)*g.y;a=-(a.y-d)*g.y;f.y>h?f.y=h:f.y<a&&(f.y=a);this.clampScroll(f)};a.ui.Element.prototype.animateScrollToShow=function(a,b,d,f){var g=this.contentOffset.copy();this.scrollToShow(a,b,d,g);this.animateScroll(g,f)};a.ui.Element.prototype.animateScrollToShowElement=function(a,b,d,f){"undefined"===typeof b&&(b=0);"undefined"===typeof d&&(d=0);"undefined"===typeof f&&(f=0);a=a.getBounds(this.tempRect);this.animateScrollToShow({x:a.x+a.w/2,y:a.y+a.h/2},
a.w/2+b,a.h/2+d,f)};a.ui.Element.prototype.scrollToCenter=function(a,b){b||(b=this.contentOffset);b.x=this.size.x/2-a.x*this.contentScale.x;b.y=this.size.y/2-a.y*this.contentScale.y;this.clampScroll(b);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.animateScrollToCenter=function(a,b){var d=this.contentOffset.copy();this.scrollToCenter(a,d);this.animateScroll(d,b)};a.ui.Element.prototype.scrollToCenterContent=function(a){a||(a=this.contentOffset);a.x=this.size.x/2-this.contentSize.x/
2*this.contentScale.x;a.y=this.size.y/2-this.contentSize.y/2*this.contentScale.y};a.ui.Element.prototype.animateScroll=function(c,b){var d=a.ui.killAnimatorsForElement(this,a.ui.Animator.scroller),f=new a.ui.Animator(a.ui.Animator.scroller,this);f.setTimer(b);f.setStartEndVectors({x:this.contentOffset.x,y:this.contentOffset.y},{x:c.x,y:c.y});f.setAutoDie();d&&f.setInterpFilter(a.ui.Animator.filterEaseOut)};a.ui.Element.prototype.clampScroll=function(a){a||(a=this.contentOffset);if(!(0>=this.contentSize.x||
0>=this.contentSize.y)){var b=-(this.contentSize.x*this.contentScale.x-this.size.x),d=-(this.contentSize.y*this.contentScale.y-this.size.y);a.x<b&&(a.x=b);a.y<d&&(a.y=d);0<a.x&&(a.x=0);0<a.y&&(a.y=0)}};a.ui.Element.prototype.setContentScale=function(a,b){void 0!==a&&(this.contentScale.x=a);void 0!==b&&(this.contentScale.y=b);this.setDirty(!0);this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.stepZoom=function(a){this.contentScale.x+=a;this.contentScale.y+=a;this.clampContentScale();this.setDirty(!0);
this.viewChanged&&this.viewChanged()};a.ui.Element.prototype.clampContentScale=function(){this.contentScale.x=(100*(this.contentScale.x+0.001)|0)/100;this.contentScale.y=(100*(this.contentScale.y+0.001)|0)/100;this.contentScale.x<this.contentScaleMin.x&&(this.contentScale.x=this.contentScaleMin.x);this.contentScale.y<this.contentScaleMin.y&&(this.contentScale.y=this.contentScaleMin.y);this.contentScale.x>this.contentScaleMax.x&&(this.contentScale.x=this.contentScaleMax.x);this.contentScale.y>this.contentScaleMax.y&&
(this.contentScale.y=this.contentScaleMax.y)};a.ui.Element.prototype.setContentScaleLimits=function(a,b){this.contentScaleMin.x=this.contentScaleMin.y=a;this.contentScaleMax.x=this.contentScaleMax.y=b};a.ui.Element.prototype.drawTiled=function(){};a.ui.Element.prototype.draw=function(c){if(this.isVisible()){void 0===c&&(c=!1);if(this.preDraw&&(res=this.preDraw(c))&&res.abortDraw)return;this.useOffscreen&&(!this.offscreen||this.isDirty||this.checkDirty&&this.checkDirty())&&this.renderOffscreen();var b=
a.graphics.getContext();c||(a.graphics.save(),this.applyTransformation?this.applyTransformation(b):(a.graphics.translate(this.place.pos.x,this.place.pos.y),this.place.rot.angle&&a.graphics.rotate(this.place.rot.angle),(1!==this.scale.x||1!==this.scale.y)&&a.graphics.scale(this.scale.x,this.scale.y)),a.graphics.frameStats.totalElementsDrawn++,1>this.opacity&&(b.globalAlpha=this.opacity));0<this.frameWidth&&(b.strokeStyle=this.frameColor.toString(),b.lineWidth=this.frameWidth,b.strokeRect(-this.center.x-
this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+2*this.frameOutset));!c&&this.flags&a.ui.Element.clipFlag&&(b.beginPath(),b.rect(0,0,this.size.x,this.size.y),b.clip());if(!c&&this.useOffscreen&&this.offscreen)this.offscreen.render(b,-this.center.x,-this.center.y);else{this.events.beforeDraw&&this.events.beforeDraw(this);this.drawSelfPre&&this.drawSelfPre(this);this.drawSelf(b);if(this.events.onDrawSelf)this.events.onDrawSelf(this);if(this.subElements){var b=
this.contentOffset.x+-this.center.x,d=this.contentOffset.y+-this.center.y;(0!==b||0!==d)&&a.graphics.translate(b,d);(1!==this.contentScale.x||1!==this.contentScale.y)&&a.graphics.scale(this.contentScale.x,this.contentScale.y);if(this.events.onPreDrawChildren)this.events.onPreDrawChildren(this);this.drawSubElements();if(this.events.onDrawChildren)this.events.onDrawChildren(this);(1!==this.contentScale.x||1!==this.contentScale.y)&&a.graphics.scale(1/this.contentScale.x,1/this.contentScale.y);(0!==b||
0!==d)&&a.graphics.translate(-b,-d)}this.drawSelfPost&&this.drawSelfPost(this);this.events.afterDraw&&this.events.afterDraw(this)}this.postDraw&&this.postDraw(c);c||a.graphics.restore()}};a.ui.Element.prototype.drawSelf=function(){};a.ui.Element.prototype.drawSubElements=function(){if(this.subElements){var c=this.tempRect;c.x=-this.contentOffset.x;c.y=-this.contentOffset.y;c.w=this.size.x/this.contentScale.x;c.h=this.size.y/this.contentScale.y;for(var b=0;b<this.subElements.length;b++){var d=this.subElements[b];
if(d.flags&a.ui.Element.visibleFlag){var f=!0;if(0!==(this.flags&a.ui.Element.clipFlag)&&0===d.place.rot.angle){var g=d.getBounds(this.tempRect);a.collision2D.rectOverlapsRect(g,c)||(f=!1)}f&&d.draw()}}}};a.ui.Element.prototype.setBackground=function(c){var b=new a.ui.Shape(a.ui.squareShape);b.setColor(c);this.insertSubElement(b);b.autoSizeToParent();this.elementBackground=b};a.ui.Element.prototype.setBackgroundFrame=function(a,b){this.elementBackground&&this.elementBackground.setFrame(a,b)};a.ui.Element.prototype.boundsChanged=
function(){this.toolTip&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse);this.setDirty(!0)};a.ui.Element.prototype.flagsChanged=function(){};a.ui.Element.prototype.checkFlagsChanged=function(a){a!==this.flags&&(0!==((a^this.flags)&this.flagsThatDirtyMe)&&this.setDirty(!0),0!==((a^this.flags)&this.flagsThatDirtyParent)&&this.parent&&this.parent.setDirty(!0,!0),this.flagsChanged(a),this.flagsChangedCallback&&this.flagsChangedCallback(a,this.callbackInfo))};
a.ui.Element.prototype.frameAllRandom=function(){this.applyRecursively(a.ui.Element.prototype.setFrameRandom,1)};var d=["before_","on_","after_"];a.ui.Element.prototype.fireCustomTrigger=function(a,b){for(var e,f=0;f!==d.length&&!(e=d[f]+a,this[e]&&(e=this[e](this,a,b),void 0!==e&&!e));++f);};a.ui.Element.prototype.setUseOffscreen=function(c){a.ui.allowOffscreens&&(this.useOffscreen!==c&&this.setDirty(!0),this.useOffscreen=c)};a.ui.Element.prototype.setDirty=function(a,b){if(this.isVisible()||b)void 0===
a&&(a=!0),(this.isDirty=a)&&this.parent&&this.parent.setDirty(!0)};a.ui.Element.prototype.setDirtyRecursive=function(a){this.setDirty(a);this.applyRecursively(function(a){this.isDirty=a},a)};a.ui.Element.prototype.renderOffscreen=function(){var c=this.size.x,b=this.size.y,d;this.offscreen?(d=this.offscreen,d.setSize(c,b,!0)):d=new a.Offscreen(c,b);c=d.getContext();b=a.graphics.getContext();a.graphics.setContext(c);this.useOffscreen=!1;this.ignoreCenter=!0;this.draw(!0);a.ui.debugOffscreens&&d.applyDebugOverlay();
this.ignoreCenter=!1;this.useOffscreen=!0;a.graphics.setContext(b);this.offscreen=d;this.isDirty=!1;this.applyRecursively(function(){this.isDirty=!1})};a.ui.Element.editProperties=[{label:"basic",props:[{propName:"type",type:"string"},{propName:"id",type:"string"},{propName:"name",type:"string"}]},{label:"location",props:[{label:"pos",propName:"bounds",type:"xyvector",valueType:"float"},{label:"size",propName:"bounds",type:"whvector",valueType:"float"},{propName:"autoCenter",type:"boolean",tipText:"anchor from center"},
{propName:"rotation",type:"float",tipText:"rotation around anchor, in radians"}]},{label:"appearance",defaultClosed:!0,props:[{propName:"color",type:"color",tipText:"content color, used depending on type"},{propName:"frameSize",type:"float"},{propName:"frameColor",type:"color"},{propName:"frameOutset",type:"float",tipText:"expand or shrink frame (in pixels)"}]},{label:"flags",defaultClosed:!0,props:[{propName:"visible",type:"boolean"},{propName:"enabled",type:"boolean"},{propName:"toggled",type:"boolean"},
{propName:"clip",type:"boolean"},{propName:"autoSizeAfterLoad",type:"boolean"},{propName:"autoScaleAfterLoad",type:"boolean"},{propName:"drawTiled",type:"boolean"},{propName:"useOffscreen",type:"boolean"}]}];a.ui.Element.setupFromData=function(c,b,d){c.setBounds(a.ui.data.calcBounds(b,d));if(void 0!==b.rotation||void 0!==b.rot)c.setRotation(b.rotation||b.rot);void 0!==b.autoCenter&&c.autoCenter(b.autoCenter);b.frame&&c.setFrame(b.frame.size,a.graphics.fixColorStyle(b.frame.color),b.frame.outset);
void 0!==b.frameSize&&c.setFrame(b.frameSize,a.graphics.fixColorStyle(b.frameColor),b.frameOutset);void 0!==b.id&&c.setID(b.id);b.color&&c.setColor(new a.graphics.Color(b.color));void 0!==b.visible&&c.setVisible(!!b.visible);void 0!==b.highlighted&&c.setHighlighted(!!b.highlighted);void 0!==b.enabled&&c.setEnabled(!!b.enabled);void 0!==b.toggled&&c.setToggled(!!b.toggled);void 0!==b.clip&&c.setClip(!!b.clip);void 0!==b.autoSizeAfterLoad&&c.setFlag(a.ui.Element.autoSizeAfterLoadFlag,!!b.autoSizeAfterLoad);
void 0!==b.autoScaleAfterLoad&&c.setFlag(a.ui.Element.autoScaleAfterLoadFlag,!!b.autoScaleAfterLoad);void 0!==b.drawTiled&&c.setFlag(a.ui.Element.drawTiledFlag,!!b.drawTiled);b.contentSize&&b.contentSize.x&&c.setContentSize(b.contentSize.x,b.contentSize.y);b.contentOffset&&c.setContentOffset(b.contentOffset.x,b.contentOffset.y);b.contentScale&&c.setContentScale(b.contentScale.x,b.contentScale.y);b.callback&&c.setCallback(b.callback,b.callbackInfo);b.onFocus&&(c.events.onFocus=b.onFocus);b.onBlur&&
(c.events.onBlur=b.onBlur);b.beforeDraw&&(c.events.beforeDraw=b.beforeDraw);b.onDrawSelf&&(c.events.onDrawSelf=b.onDrawSelf);b.onPreDrawChildren&&(c.events.onPreDrawChildren=b.onPreDrawChildren);b.onDrawChildren&&(c.events.onDrawChildren=b.onDrawChildren);b.afterDraw&&(c.events.afterDraw=b.afterDraw);void 0!==b.useOffscreen&&c.setUseOffscreen(b.useOffscreen)}});
rat.modules.add("rat.ui.r_ui_animator",[{name:"rat.ui.r_ui",processBefore:!0},"rat.debug.r_console","rat.math.r_vector","rat.utils.r_utils"],function(a){a.ui.animators=[];a.ui.Animator=function(c,b,d,f){"boolean"===typeof d&&3===arguments.length&&(f=d,d=void 0);this.id=d;this.type=c;this.relative=!!f;this.target=b;this.startValue=new a.Vector(0,0);this.endValue=new a.Vector(0,0);this.time=this.startTime=-1;this.delay=0;this.interpFilter=a.ui.Animator.filterEaseInOut;this.flags=0;this.setAutoDie(!0);
this.speed=1;this.continuousVal=0;this.continuousSign=1;this.doneCallback=this.delayCallback=null;this.target?(this.targetStartState={x:this.target.place.pos.x,y:this.target.place.pos.y,cx:this.target.contentOffset.x,cy:this.target.contentOffset.y,sx:this.target.scale.x,sy:this.target.scale.y,w:this.target.size.x,h:this.target.size.y,r:this.target.place.rot.angle,opacity:this.target.opacity},a.ui.animators.push(this)):a.console.log("No target input for animator! Bad juju! Not adding it to the animator list")};
a.ui.Animator.mover=1;a.ui.Animator.rotator=2;a.ui.Animator.rotater=a.ui.Animator.rotator;a.ui.Animator.scaler=3;a.ui.Animator.resizer=4;a.ui.Animator.fader=5;a.ui.Animator.scroller=6;a.ui.Animator.autoDieFlag=1;a.ui.Animator.autoRemoveTargetFlag=2;a.ui.Animator.prototype.setAutoDie=function(c){this.flags=c||void 0===c?this.flags|a.ui.Animator.autoDieFlag:this.flags&~a.ui.Animator.autoDieFlag};a.ui.Animator.prototype.setAutoRemoveTarget=function(c){this.flags=c||void 0===c?this.flags|a.ui.Animator.autoRemoveTargetFlag:
this.flags&~a.ui.Animator.autoRemoveTargetFlag};a.ui.Animator.prototype.setDoneCallback=function(a){this.doneCallback=a};a.ui.Animator.prototype.setDelayDoneCallback=function(a){this.delayCallback=a};a.ui.Animator.prototype.setTimer=function(a){this.time=this.startTime=a};a.ui.Animator.prototype.setDelay=function(a){this.delay=a};a.ui.Animator.prototype.setSpeed=function(a){this.speed=a};a.ui.Animator.prototype.setStartEnd=function(a,b){this.startValue.x=a;this.startValue.y=a;this.endValue.x=b;this.endValue.y=
b;this.update(0)};a.ui.Animator.prototype.setStartEndVectors=function(a,b){if(a)this.startValue.x=a.x,this.startValue.y=a.y;else{var d=this.getCurrentValueForType();this.startValue.x=d.x;this.startValue.y=d.y}this.endValue.x=b.x;this.endValue.y=b.y;this.update(0)};a.ui.Animator.filterNone=function(){return 0};a.ui.Animator.filterLinear=function(a){return a};a.ui.Animator.filterEaseInOut=function(a){return a*a*(3-2*a)};a.ui.Animator.filterEaseIn=function(a){return a*a};a.ui.Animator.filterEaseOut=
function(a){return a*(2-a)};a.ui.Animator.filterEaseThereAndBack=function(c){return 0.5>c?a.ui.Animator.filterEaseInOut(2*c):1-a.ui.Animator.filterEaseInOut(2*(c-0.5))};a.ui.Animator.filterEaseInElastic=function(a){return a};a.ui.Animator.filterEaseOutElastic=function(a){if(0>=a)return 0;if(1<=a)return 1;var b=1.5707*(0.4/(2*Math.PI));return Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/0.4)+1};a.ui.Animator.prototype.setInterpFilter=function(a){this.interpFilter=a};a.ui.Animator.prototype.clearInterpFilter=
function(){this.setInterpFilter(null)};a.ui.Animator.prototype.update=function(c){if(!this.target)return!1;if(0<this.delay){this.delay-=c;if(0<this.delay)return!1;this.delayCallback&&this.delayCallback(this)}var b=!1,d=null;0>this.time?this.type===a.ui.Animator.rotator?this.target.place.rot.angle+=this.speed*c:(this.continuousVal+=this.continuousSign*this.speed*c,1<this.continuousVal?(this.continuousVal=1,this.continuousSign=-this.continuousSign):0>this.continuousVal&&(this.continuousVal=0,this.continuousSign=
-this.continuousSign),d=this.continuousVal):(this.time-=c,0>this.time&&(this.time=0,b=!0),d=0>=this.startTime?1:1-this.time/this.startTime);null!==d&&(void 0!==this.interpFilter&&(d=this.interpFilter(d)),c=a.utils.interpolate(this.startValue.x,this.endValue.x,d),d=a.utils.interpolate(this.startValue.y,this.endValue.y,d),this.type===a.ui.Animator.mover?(this.relative&&(c+=this.targetStartState.x,d+=this.targetStartState.y),this.target.place.pos.x=c,this.target.place.pos.y=d,this.target.parent&&this.target.parent.setDirty(!0)):
this.type===a.ui.Animator.rotator?(this.relative&&(c+=this.targetStartState.r),this.target.place.rot.angle=c,this.target.parent&&this.target.parent.setDirty(!0)):this.type===a.ui.Animator.scaler?(this.relative&&(c+=this.targetStartState.sx,d+=this.targetStartState.sy),this.target.setScale(c,d)):this.type===a.ui.Animator.resizer?(this.relative&&(c+=this.targetStartState.w,d+=this.targetStartState.h),this.target.setSize(c,d)):this.type===a.ui.Animator.fader?(this.relative&&(c+=this.targetStartState.opacity),
this.target.setOpacityRecursive(c)):this.type===a.ui.Animator.scroller&&(this.relative&&(c+=this.targetStartState.cx,d+=this.targetStartState.cy),this.target.contentOffset.x=c,this.target.contentOffset.y=d,this.target.viewChanged&&this.target.viewChanged()));b&&this.doneCallback&&this.doneCallback(this.target,this);b&&this.flags&a.ui.Animator.autoRemoveTargetFlag&&this.target.removeFromParent();return b&&this.flags&a.ui.Animator.autoDieFlag?!0:!1};a.ui.Animator.prototype.getCurrentValueForType=function(){return this.type===
a.ui.Animator.mover?this.target.place.pos:this.type===a.ui.Animator.rotator?this.target.place.rot.angle:this.type===a.ui.Animator.scaler?this.target.scale:this.type===a.ui.Animator.resizer?this.target.size:this.type===a.ui.Animator.fader?this.target.opacity:this.type===a.ui.Animator.scroller?this.target.contentOffset:null};a.ui.Animator.prototype.die=function(){this.target=null};a.ui.Animator.prototype.getElapsed=function(){return this.startTime-this.time};a.ui.Animator.prototype.finish=function(){0>
this.time||(this.delay=0,this.update(this.time+1E-4))};a.ui.Animator.prototype.resetTargetState=function(){var c=this.targetStartState;switch(this.type){case a.ui.Animator.mover:this.target.setPos(c.x,c.y);break;case a.ui.Animator.rotator:this.target.setRotation(c.r);break;case a.ui.Animator.scaler:this.target.setScale(c.sx,c.sy);break;case a.ui.Animator.resizer:this.target.setSize(c.w,c.h);break;case a.ui.Animator.fader:this.target.setOpacity(c.opacity);break;case a.ui.Animator.scroller:this.target.setContentOffset(c.cx,
c.cy)}};var d=0;a.ui.updateAnimators=function(c){++d;for(var b=a.ui.animators.length-1;0<=b;b--)a.ui.animators[b].update(c)&&a.ui.animators.splice(b,1);--d};a.ui.resetStateStateForAllAnimatorsForElement=function(c,b){for(var d=a.ui.animators.length-1;0<=d;d--){var f=a.ui.animators[d];f.target?f.target===c&&(void 0===b||f.type===b)&&f.resetTargetState():(a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(d,1))}};a.ui.finishAnimatorsForElement=
function(c,b,e){for(var f=a.ui.animators.length-1;0<=f;f--){var g=a.ui.animators[f];if(g.target){if(g.target===c&&(void 0===b||g.type===b))g.finish(),e&&!d&&a.ui.animators.splice(f,1)}else a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(f,1)}};a.ui.killAnimatorsForElement=function(c,b){for(var d=0,f=a.ui.animators.length-1;0<=f;f--){var g=a.ui.animators[f];if(g.target){if(g.target===c&&(void 0===b||g.type===b))a.ui.animators.splice(f,
1),d++}else a.console.log("JS FAILURE: animator is missing target! check that on construction all objects have a target!\n"),a.ui.animators.splice(f,1)}return d};a.ui.getAnimatorsForElement=function(c,b,d){for(var f=[],g=a.ui.animators.length-1;0<=g;g--){var h=a.ui.animators[g];h.target===c&&((void 0===b||h.type===b)&&(void 0===d||h.id===d))&&f.push(h)}return f};a.ui.killAnimators=function(){a.ui.animators=[]}});
rat.modules.add("rat.ui.r_ui_sprite",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.graphics.r_graphics","rat.graphics.r_image","rat.debug.r_console","rat.ui.r_ui_data"],function(a){a.ui.Sprite=function(d,c,b){var e=null;d&&d.elementType&&(e=d,d=null);a.ui.Sprite.prototype.parentConstructor.call(this,e);this.flags|=a.ui.Element.autoSizeAfterLoadFlag;this.name="<sprite>"+this.id;this.loadImage(d,c,b);this.setTracksMouse(!1);this.imageScaleX=this.imageScaleY=
1};a.utils.inheritClassFrom(a.ui.Sprite,a.ui.Element);a.ui.Sprite.prototype.elementType="sprite";a.ui.Sprite.prototype.loadImage=function(d,c,b){if((this.resource=d)&&void 0!==d){this.imageRef=a.graphics.makeImage(d,c,b);var e=this;this.imageRef.setOnLoad(function(){var b=e.imageRef.getFrameSize(0);e.setContentSize(b.w,b.h);e.setDirty(!0);e.flags&a.ui.Element.autoScaleAfterLoadFlag?e.scaleImageToSize():e.flags&a.ui.Element.autoSizeAfterLoadFlag&&e.sizeToImage();e.flags&a.ui.Element.autoCenterAfterLoadFlag&&
e.autoCenter(!0);if(e.onLoad)e.onLoad(e.onLoadArg)});"string"===typeof d&&(this.name="<sprite>"+d+this.id)}};a.ui.Sprite.prototype.useImageRef=function(a){this.imageRef=a;this.setDirty(!0)};a.ui.Sprite.prototype.getImageRef=function(){return this.imageRef};a.ui.Sprite.prototype.sizeToImage=function(){if(this.imageRef){var a=this.imageRef.getFrameSize(0);this.setSize(a.w,a.h)}};a.ui.Sprite.prototype.scaleImageToSize=function(a,c){a=a||1;c=c||1;if(this.imageRef){var b=this.imageRef.getFrameSize(0);
this.imageScaleX=this.size.x/b.w*a;this.imageScaleY=this.size.y/b.h*c;this.setDirty(!0)}};a.ui.Sprite.prototype.setImageScale=function(a,c){this.imageScaleX=a;this.imageScaleY=c;this.setDirty(!0)};a.ui.Sprite.prototype.autoCenter=function(d){void 0===d&&(d=!0);d&&"undefined"!==typeof this.imageRef&&!this.imageRef.isLoaded()?this.flags|=a.ui.Element.autoCenterAfterLoadFlag:a.ui.Sprite.prototype.parentPrototype.autoCenter.call(this,d)};a.ui.Sprite.prototype.setOutline=function(a,c){(this.outline!==
a||this.outlineScale!==c)&&this.setDirty(!0);this.outline=a;this.outlineScale=c};a.ui.Sprite.prototype.updateSelf=function(a){if(this.imageRef){var c=this.imageRef.getFrame();this.imageRef.update(a);this.imageRef.getFrame()!==c&&this.setDirty(!0)}};a.ui.Sprite.prototype.drawTiled=function(d,c){if(this.isVisible()){a.graphics.frameStats.totalElementsDrawn++;var b=a.graphics.getContext();a.graphics.save();a.graphics.translate(this.place.pos.x,this.place.pos.y);this.place.rot.angle&&a.graphics.rotate(this.place.rot.angle);
(1!==this.scale.x||1!==this.scale.y)&&a.graphics.scale(this.scale.x,this.scale.y);b.globalAlpha=this.opacity;0<this.frameWidth&&(b.strokeStyle=this.frameColor.toString(),b.lineWidth=this.frameWidth,b.strokeRect(-this.center.x-this.frameOutset,-this.center.y-this.frameOutset,this.size.x+2*this.frameOutset,this.size.y+2*this.frameOutset));this.flags&a.ui.Element.clipFlag&&(b.beginPath(),b.moveTo(0,0),b.lineTo(this.size.x,0),b.lineTo(this.size.x,this.size.y),b.lineTo(0,this.size.y),b.lineTo(0,0),b.clip());
this.drawMyImageTiled(d,c);a.graphics.restore()}};a.ui.Sprite.prototype.drawMyImageTiled=function(d,c){for(var b=a.graphics.getContext(),e=this.imageRef.getSize(),f=0;f<d;f+=e.w)for(var g=0;g<c;g+=e.h){a.graphics.save();var h,j;h=e.w+f>d?d-f:e.w;j=e.h+g>c?c-g:e.h;a.graphics.translate(f,g);this.imageRef.draw(b,0,0,h,j,0,0,h,j);a.graphics.restore()}};a.ui.Sprite.prototype.drawSelf=function(){if(0!==(this.flags&a.ui.Element.drawTiledFlag))this.drawMyImageTiled(this.size.x,this.size.y);else if(this.imageRef){var d=
a.graphics.getContext();if(this.outline){var c=this.imageRef.getSize();d.globalCompositeOperation="destination-out";var b=c.w*this.outlineScale,e=c.h*this.outlineScale;this.imageRef.draw(d,-(this.center.x+(b-c.w)/2),-(this.center.y+(e-c.h)/2),b,e);d.globalCompositeOperation="source-over"}c=this.imageRef.getSize();this.imageRef.draw(d,-this.center.x,-this.center.y,c.w*this.imageScaleX,c.h*this.imageScaleY)}};a.ui.Sprite.prototype.setOnLoad=function(a,c){this.onLoad=a;this.onLoadArg=c};a.ui.Sprite.editProperties=
[{label:"image",props:[{propName:"resource",type:"resource"},{propName:"outline",type:"float"}]}];a.ui.Sprite.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.Sprite,d,c,b);c.outline&&d.setOutline(!0,c.outline);c.onLoad&&d.setOnLoad(c.onLoad,d);c.resource&&d.loadImage(c.resource);c.animSpeed&&d.imageRef&&(d.imageRef.animSpeed=c.animSpeed)}});
rat.modules.add("rat.ui.r_ui_scrollview",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.math.r_math","rat.math.r_vector","rat.graphics.r_graphics","rat.debug.r_console","rat.os.r_system"],function(a){function d(){this.isEnabled()&&(this.setEnabled(!1),this.setEnabled(!0));this.stopMouseTracking&&this.stopMouseTracking();this.callForSubElements(d)}a.ui.ScrollView=function(c){a.ui.ScrollView.prototype.parentConstructor.call(this,c);this.setClip(!0);this.lastMousePos=
new a.Vector(0,0);this.grabPos=new a.Vector(0,0);this.grabOffset=new a.Vector(0,0);this.wheelSensitivity=32;this.wheelAffects="y";this.allowPinchZoom=!1;this.allowFling=!0;this.flingMouse={x:0,y:0};this.flingTrack=[];for(c=0;c<a.ui.ScrollView.flingTrackFrames;c++)this.flingTrack[c]={x:0,y:0};this.flingTrackIndex=0;this.flingVelocity={x:0,y:0};this.flingHard=!1;this.flingMaxVel=3E3;this.flingHardVel=8E3};a.utils.inheritClassFrom(a.ui.ScrollView,a.ui.Element);a.ui.ScrollView.flingTrackFrames=4;a.ui.ScrollView.prototype.elementType=
"scrollView";a.ui.ScrollView.prototype.minimumDragThreshold=10;a.ui.ScrollView.prototype.meaningfulDragThreshold=15;a.ui.ScrollView.prototype.supportZoom=function(a){a||void 0===a?(this.wheelAffects="z",this.wheelSensitivity=0.1,this.allowPinchZoom=!0):this.allowPinchZoom=!1};a.ui.ScrollView.prototype.mouseWheelEvent=function(a,b){return!this.isEnabled()?!1:"y"===this.wheelAffects||"x"===this.wheelAffects?("y"===this.wheelAffects?this.contentOffset.y+=b.wheelDelta*this.wheelSensitivity:this.contentOffset.x+=
b.wheelDelta*this.wheelSensitivity,this.clampScroll(),this.viewChanged&&this.viewChanged(),!0):"z"===this.wheelAffects?(this.stepZoomAnchored(b.wheelDelta*this.wheelSensitivity,this.mousePos),!0):!1};a.ui.ScrollView.prototype.stepZoomAnchored=function(c,b){var d=this.getTargetContentOffset();this.contentOffset.x=d.x;this.contentOffset.y=d.y;a.ui.killAnimatorsForElement(this,a.ui.Animator.scroller);b||(b=this.parentToLocalContentPos(this.place.pos.x+this.size.x/2,this.place.pos.y+this.size.y/2));var d=
b.x,f=b.y,g=this.contentScale.x,h=this.contentScale.y;this.stepZoom(c);this.contentOffset.x-=d*this.contentScale.x-d*g;this.contentOffset.y-=f*this.contentScale.y-f*h;this.clampScroll();this.viewChanged&&this.viewChanged()};a.ui.ScrollView.prototype.mouseDown=function(c,b){if(this.isEnabled()){this.lastMousePos.x=c.x+this.place.pos.x;this.lastMousePos.y=c.y+this.place.pos.y;this.grabPos.x=c.x+this.place.pos.x;this.grabPos.y=c.y+this.place.pos.y;this.grabOffset.x=this.contentOffset.x;this.grabOffset.y=
this.contentOffset.y;this.flingMouse.x=a.mousePos.x;this.flingMouse.y=a.mousePos.y;for(var d=this.flingVelocity.x=this.flingVelocity.y=0;d<a.ui.ScrollView.flingTrackFrames;d++)this.flingTrack[d].x=this.flingTrack[d].y=0;a.ui.ScrollView.prototype.parentPrototype.mouseDown.call(this,c,b)}};a.ui.ScrollView.prototype.mouseUp=function(c,b){var d=0!==(this.flags&a.ui.Element.trackingMouseDownFlag),f=a.ui.ScrollView.prototype.parentPrototype.mouseUp.call(this,c,b);if(d&&this.allowFling){for(var g=d=vy=0;g<
a.ui.ScrollView.flingTrackFrames;g++)d+=this.flingTrack[g].x,vy+=this.flingTrack[g].y;d/=a.ui.ScrollView.flingTrackFrames;vy/=a.ui.ScrollView.flingTrackFrames;var g=this.flingMaxVel,h=this.flingHardVel;this.flingHard=!1;d*d+vy*vy>h*h&&(this.flingHard=!0,console.log("hard fling "+d+", "+vy));d>g&&(d=g);d<-g&&(d=-g);vy>g&&(vy=g);vy<-g&&(vy=-g);this.flingVelocity.x=d;this.flingVelocity.y=vy}return f};a.ui.ScrollView.prototype.handleMouseMove=function(c,b,e){a.ui.ScrollView.prototype.parentPrototype.handleMouseMove.call(this,
c,b,e);if(this.flags&a.ui.Element.trackingMouseDownFlag){b=c.x-this.grabPos.x;e=c.y-this.grabPos.y;if(Math.abs(b)>this.minimumDragThreshold||Math.abs(e)>this.minimumDragThreshold){var f=this.grabOffset.y+e;this.contentOffset.x=this.grabOffset.x+b;this.contentOffset.y=f;this.clampScroll();this.lastMousePos.x=c.x;this.lastMousePos.y=c.y;this.viewChanged&&this.viewChanged()}c=this.meaningfulDragThreshold;(Math.abs(b)>c||Math.abs(e)>c)&&this.callForSubElements(d)}};a.ui.ScrollView.prototype.isFlung=function(){return!(this.flags&
a.ui.Element.trackingMouseDownFlag)&&(0!==this.flingVelocity.x||0!==this.flingVelocity.y)?!0:!1};a.ui.ScrollView.prototype.updateSelf=function(c){if(this.allowFling)if(this.flags&a.ui.Element.trackingMouseDownFlag){var b=a.mousePos,d=(b.x-this.flingMouse.x)/c;c=(b.y-this.flingMouse.y)/c;this.flingMouse.x=b.x;this.flingMouse.y=b.y;b=this.flingTrackIndex;this.flingTrack[b].x=d;this.flingTrack[b].y=c;this.flingTrackIndex=(b+1)%a.ui.ScrollView.flingTrackFrames}else this.isFlung()&&(this.contentOffset.x+=
this.flingVelocity.x*c,this.contentOffset.y+=this.flingVelocity.y*c,this.clampScroll(),this.viewChanged&&this.viewChanged(),d=3E3*c,0>this.flingVelocity.x?(this.flingVelocity.x+=d,0<this.flingVelocity.x&&(this.flingVelocity.x=0)):0<this.flingVelocity.x&&(this.flingVelocity.x-=d,0>this.flingVelocity.x&&(this.flingVelocity.x=0)),0>this.flingVelocity.y?(this.flingVelocity.y+=d,0<this.flingVelocity.y&&(this.flingVelocity.y=0)):0<this.flingVelocity.y&&(this.flingVelocity.y-=d,0>this.flingVelocity.y&&(this.flingVelocity.y=
0)))};a.ui.ScrollView.editProperties=[{label:"scroll",props:[{propName:"contentSize",type:"sizevector",valueType:"float"},{propName:"wheelSensitivity",type:"float",defValue:32,tipText:"If used for zoom, use a really low value, like 0.1"},{propName:"wheelAffects",type:"string",defValue:"y"},{propName:"allowPinchZoom",type:"boolean",tipText:"Not supported yet!"},{propName:"allowFling",type:"boolean"}]}];a.ui.ScrollView.setupFromData=function(c,b,d){a.ui.data.callParentSetupFromData(a.ui.ScrollView,
c,b,d);c.wheelSensitivity=b.wheelSensitivity||c.wheelSensitivity;c.wheelAffects=b.wheelAffects||c.wheelAffects;c.allowPinchZoom=b.allowPinchZoom||c.allowPinchZoom;c.allowFling=b.allowFling||c.allowFling};a.ui.ButtonScrollView=a.ui.ScrollView});
rat.modules.add("rat.ui.r_ui_fillbar",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_fill",processBefore:!0},"rat.debug.r_console","rat.ui.r_ui_data","rat.graphics.r_graphics","rat.math.r_math","rat.ui.r_ui_data"],function(a){a.ui.FillBar=function(){a.ui.FillBar.prototype.parentConstructor.call(this);this.fillStyle="fill";this.fillShape="rectangle";this.minColor=a.graphics.red;this.maxColor=a.graphics.green;this.backColor=a.graphics.black;this.frameColor=
a.graphics.blue};a.utils.inheritClassFrom(a.ui.FillBar,a.ui.Fill);a.ui.FillBar.prototype.elementType="fillBar";a.ui.FillBar.prototype.setColors=function(a,c,b){this.backColor=a;this.minColor=c.min||c;this.maxColor=c.max||c;this.frameColor=b};a.ui.FillBar.prototype.drawSelf=function(){var d=a.graphics.ctx;d.save();var c=new a.graphics.Color;this.minColor.r!==this.maxColor.r||this.minColor.g!==this.maxColor.g||this.minColor.b!==this.maxColor.b||this.minColor.a!==this.maxColor.a?a.graphics.Color.interp(this.minColor,
this.maxColor,this.percent,c):c=this.minColor;var b,e;b=this.getWidth();e=this.getHeight();var f=-a.math.HALFPI,g=f+a.math.PI2*this.percent,h=this.size.x/2+this.center.x,j=this.size.y/2+this.center.y;"circle"===this.fillShape?(b=b<e?b:e,d.fillStyle=this.backColor.toString(),d.beginPath(),d.arc(0,0,b,0,a.math.PI2,!1),"radialFill"===this.fillStyle?(d.fillStyle=c.toString(),d.beginPath(),d.moveTo(h,j),d.arc(h,j,b,f,g,!1),d.closePath(),d.fill()):"radialStroke"===this.fillStyle?(d.strokeStyle=c.toString(),
d.lineWidth=this.lineWidth,d.beginPath(),d.arc(h,j,b,f,g,!1),d.stroke()):a.console.log("rat.ui.fillBar does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape),d.strokeStyle=this.frameColor.toString(),d.lineWidth=1,d.beginPath(),d.arc(h,j,b,f,g,!1),d.stroke()):(d.translate(-this.center.x,-this.center.y),d.fillStyle=this.backColor.toString(),d.fillRect(0,0,b,e),"radialFill"===this.fillStyle?(d.beginPath(),d.rect(0,0,b,e),d.clip(),b=2*(b>e?b:e),d.beginPath(),d.moveTo(h,j),d.arc(h,
j,b,f,g,!1),d.closePath(),d.fillStyle=c.toString(),d.fill()):"radialStroke"===this.fillStyle?a.console.log("rat.ui.fillBar does not support fillStyle "+this.fillStyle+" with shape "+this.fillShape):"fill"===this.fillStyle?(d.fillStyle=c.toString(),d.fillRect(0,0,b*this.percent,e)):(d.strokeStyle=c.toString(),d.lineWidth=this.lineWidth,d.strokeRect(0,0,b*this.percent,e)),d.strokeStyle=this.frameColor.toString(),d.lineWidth=1,d.strokeRect(0,0,this.getWidth(),this.getHeight()));d.restore()};a.ui.FillBar.setupFromData=
function(d,c,b){c.colors=c.colors||{};a.ui.data.callParentSetupFromData(a.ui.FillBar,d,c,b);b=new a.graphics.Color(c.colors.background||a.graphics.black);var e=new a.graphics.Color(c.colors.minBody||c.colors.body||d.color||a.graphics.red),f=new a.graphics.Color(c.colors.maxBody||c.colors.body||d.color||a.graphics.green);c=new a.graphics.Color(c.colors.frame||(c.frame?c.frame.color:void 0)||a.graphics.blue);d.setColors(b,{min:e,max:f},c)}});
rat.modules.add("rat.ui.r_ui_spiderchart",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.math.r_math","rat.graphics.r_graphics","rat.debug.r_console"],function(a){a.ui.SpiderChart=function(){a.ui.SpiderChart.prototype.parentConstructor.call(this);this.setTracksMouse(!1)};a.utils.inheritClassFrom(a.ui.SpiderChart,a.ui.Element);a.ui.SpiderChart.prototype.elementType="spiderChart";a.ui.SpiderChart.START_ANGLE=-a.math.PI/2;a.ui.SpiderChart.prototype.setData=function(a){this.data=
a;"undefined"===typeof this.data.normalizeScale&&(this.data.normalizeScale=1);a=1;for(var b=0;b<this.data.sets.length;b++)for(var d=this.data.sets[b],f=0;f<d.points.length;f++)d.points[f]>a&&(a=d.points[f]);this.data.normalizeTarget=a};var d=!0;a.ui.SpiderChart.prototype.drawSelf=function(){var c=a.graphics.getContext();c.fillStyle="#AAEEFF";c.fillRect(0,0,this.size.x,this.size.y);var b=this.data.sets[0].points.length,e=2*a.math.PI/b,f,g,h,j;a.graphics.save();c.translate(this.size.x/2,this.size.y/
2);if(this.data.drawAxes.color){g=a.ui.SpiderChart.START_ANGLE;for(f=0;f<b;f++)j=this.data.drawAxes.scale*this.size.x/2,h=j*a.math.cos(g),j*=a.math.sin(g),c.beginPath(),c.moveTo(0,0),c.lineTo(h,j),c.strokeStyle=this.data.drawAxes.color.toString(),c.stroke(),g+=e}if(this.data.drawAxes.hashColor)for(var k=this.data.drawAxes.hashCount,l=0;l<k;l++){g=a.ui.SpiderChart.START_ANGLE;c.beginPath();for(f=0;f<b;f++)j=(l+1)/k*this.data.normalizeScale*this.size.x/2,h=j*a.math.cos(g),j*=a.math.sin(g),0===f?c.moveTo(h,
j):c.lineTo(h,j),g+=e;c.closePath();c.strokeStyle=this.data.drawAxes.hashColor.toString();c.stroke()}for(b=0;b<this.data.sets.length;b++){h=this.data.sets[b];h.fillColor&&(c.fillStyle=h.fillColor.toString());h.strokeColor&&(c.strokeStyle=h.strokeColor.toString());c.lineWidth=h.strokeWidth;g=a.ui.SpiderChart.START_ANGLE;c.beginPath();for(f=0;f<h.points.length;f++)j=h.points[f],this.data.normalize&&(j=j/this.data.normalizeTarget*this.data.normalizeScale*this.size.x/2),k=j*a.math.cos(g),l=j*a.math.sin(g),
d&&(a.console.log(". "+h.points[f]+"("+j+") : "+k+", "+l),d=!1),0===f?c.moveTo(k,l):c.lineTo(k,l),g+=e;c.closePath();h.fillColor&&c.fill();h.strokeColor&&c.stroke()}a.graphics.restore()}});
rat.modules.add("rat.ui.r_ui_treeview",[{name:"rat.ui.r_ui",processBefore:!0},"rat.utils.r_utils","rat.graphics.r_graphics","rat.ui.r_ui_data"],function(a){a.ui.TreeView=function(d){a.ui.TreeView.prototype.parentConstructor.call(this,d);this.setTracksMouse(!0);this.setTargetable(!0);this.editBodyLook={normalColor:new a.graphics.Color(20,20,20)};this.editFrameLook={normalColor:new a.graphics.Color(180,180,180),highlightColor:new a.graphics.Color(255,255,180),targetColor:new a.graphics.Color(255,255,
255),lineWidth:2};this.editSelectionLook={normalColor:new a.graphics.Color(200,200,180,0.2)};this.nextNodeID=1;this.setFont("arial",13,"")};a.utils.inheritClassFrom(a.ui.TreeView,a.ui.Element);a.ui.TreeView.prototype.elementType="treeView";a.ui.TreeView.prototype.flagsThatDirtyMe=a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag;a.ui.TreeView.prototype.setFont=function(a,c,b){this.font=a;c&&(this.fontSize=c);b&&(this.fontStyle=b);this.fontDescriptor=(""+this.fontStyle+" "+this.fontSize+"px "+
this.font).trim()};a.ui.TreeView.prototype.setTreeValues=function(d){function c(b,c,d){b._treeView||(b._treeView={});var g=[];g[0]={flags:a.ui.Element.enabledFlag,color:new a.graphics.Color(0,0,0,0),frameColor:new a.graphics.Color(0,0,0,0),textColor:new a.graphics.Color(180,180,180)};g[1]={flags:a.ui.Element.enabledFlag|a.ui.Element.highlightedFlag,color:new a.graphics.Color(80,80,80),frameColor:new a.graphics.Color(0,0,0,0),textColor:new a.graphics.Color(180,180,180)};g[1]={flags:a.ui.Element.enabledFlag|
a.ui.Element.toggledFlag,color:new a.graphics.Color(40,40,180),frameColor:new a.graphics.Color(0,0,0,0),textColor:new a.graphics.Color(180,180,180)};g=a.ui.makeCheapButtonWithColors(null,g);g.setToggles(!0);g.setFont(e.font,e.fontSize,e.fontStyle);g.setTextValue(b.label);g.getTextBox().setAlign(a.ui.TextBox.alignLeft);g.setPos(c,d);g.setSize(e.size.x-c-100,f);g.setCallback(function(a){e.selectNodeByID(a.treeNode._treeView.treeNodeID)},null);e.appendSubElement(g);b._treeView.treeNodeID||(b._treeView.treeNodeID=
e.nextNodeID++);b._treeView.treeIndex=j++;b._treeView.elem=g;g.treeNode=b;return f}function b(a,d,e,j){for(var k=j,l=0;l<d.length;l++){var t=d[l];c(t,e,j);t._treeView.parentNode=a;j+=f+g;t.children&&(t=b(t,t.children,e+h,j),j+=t)}return j-k}var e=this;this.tree=d;this.removeAllSubElements();var f=this.fontSize+2,g=4,h=30,j=0;d=0;var k=5,l=5;this.tree&&(d=c(this.tree,k,l),this.tree.children&&(d+=b(this.tree,this.tree.children,k+h,l+(d+g))));this.elemCount=j;this.setContentSize(this.size.x,d+g);this.setDirty(!0)};
a.ui.TreeView.prototype.getTreeValues=function(){return this.tree};a.ui.TreeView.prototype.removeChildFrom=function(a,c){if(a.children)for(var b=0;b<a.children.length;b++)if(a.children[b]._treeView.treeNodeID===c._treeView.treeNodeID)return a.children.splice(b,1),c._treeView.parentNode=null,this.removeChildCallback&&this.removeChildCallback(this,this.tree,a,c),!0;return!1};a.ui.TreeView.prototype.addChildTo=function(a,c,b){a.children||(a.children=[]);void 0===b&&(b=a.children.length);a.children.splice(b,
0,c);c._treeView.parentNode=a;this.addChildCallback&&this.addChildCallback(this,this.tree,a,c,b);return!0};a.ui.TreeView.prototype.getChildIndex=function(a,c){if(a.children)for(var b=0;b<a.children.length;b++)if(a.children[b]._treeView.treeNodeID===c._treeView.treeNodeID)return b;return-1};a.ui.TreeView.prototype.isDescendentOf=function(a,c){do{var b=c._treeView.parentNode;if(b===a)return!0;c=b}while(c);return!1};a.ui.TreeView.prototype.applyToTree=function(a,c,b){b||(b=this.tree);if(b){var e=a(b,
c);if(void 0!==e)return e;if(b.children)for(var f=0;f<b.children.length;f++)if(e=this.applyToTree(a,c,b.children[f]),void 0!==e)return e}};a.ui.TreeView.prototype.selectNodeByID=function(a){var c=null;this.applyToTree(function(a,d){a._treeView.elem&&(a._treeView.treeNodeID===d?(c=a,a._treeView.elem.setToggled(!0)):a._treeView.elem.setToggled(!1))},a);this.selectionCallback&&this.selectionCallback(this,this.tree,[c])};a.ui.TreeView.prototype.selectNodeByIndex=function(a){(a=this.getNodeByIndex(a))&&
this.selectNodeByID(a._treeView.treeNodeID)};a.ui.TreeView.prototype.selectNode=function(a){!a||!a._treeView?this.selectNodeByID(-99999):this.selectNodeByID(a._treeView.treeNodeID)};a.ui.TreeView.prototype.getNodeByIndex=function(a){return this.applyToTree(function(a,b){if(a._treeView.treeIndex===b)return a},a)};a.ui.TreeView.prototype.getSelectedNode=function(){return this.applyToTree(function(a){if(a._treeView.elem&&a._treeView.elem.isToggled())return a})};a.ui.TreeView.prototype.getNodeParent=
function(a){function c(b){for(var e=0;e<b.children.length;e++){var f=b.children[e];if(f._treeView.treeNodeID===a._treeView.treeNodeID)return b;if(f.children&&(f=c(f)))return f}return null}return!a?null:c(this.tree)};a.ui.TreeView.prototype.moveNode=function(d,c){if(!d)return!1;var b=!1,e=this.getNodeParent(d),f=null;e&&(f=this.getNodeParent(e));if(c===a.keys.leftArrow)f&&(b=this.getChildIndex(f,e),this.removeChildFrom(e,d),this.addChildTo(f,d,b),b=!0);else if(c===a.keys.rightArrow){var f=d._treeView.treeIndex,
g;do g=this.getNodeByIndex(++f);while(g&&this.isDescendentOf(d,g));e&&g&&(this.removeChildFrom(e,d),this.addChildTo(g,d,0),b=!0)}else c===a.keys.upArrow?(f=this.getChildIndex(e,d),0<f&&(this.removeChildFrom(e,d),this.addChildTo(e,d,f-1),b=!0)):c===a.keys.downArrow&&(f=this.getChildIndex(e,d),f<e.children.length-1&&(this.removeChildFrom(e,d),this.addChildTo(e,d,f+1),b=!0));return b?(this.setTreeValues(this.tree),this.selectNodeByID(d._treeView.treeNodeID),this.changeCallback&&this.changeCallback(this,
this.tree,""),!0):!1};a.ui.TreeView.prototype.drawFrame=function(){};a.ui.TreeView.prototype.drawSelf=function(){a.graphics.getContext()};a.ui.TreeView.prototype.updateSelf=function(){};a.ui.TreeView.prototype.keyDown=function(d){var c=this.getSelectedNode();if(!d.sysEvent.altKey&&c){var b=c._treeView.treeIndex;if(d.which===a.keys.upArrow&&0<b)return this.selectNodeByIndex(b-1),!0;if(d.which===a.keys.downArrow&&b<this.elemCount-1)return this.selectNodeByIndex(b+1),!0}b=!1;a.input.keyToDirection(d.which)&&
d.sysEvent.altKey&&(this.moveNode(c,d.which),b=!0);return b?!0:!1};a.ui.TreeView.prototype.mouseDown=function(d,c){return a.ui.TreeView.prototype.parentPrototype.mouseDown.call(this,d,c)};a.ui.TreeView.prototype.mouseUp=function(d,c){return a.ui.TreeView.prototype.parentPrototype.mouseUp.call(this,d,c)};a.ui.TreeView.prototype.mouseMove=function(){};a.ui.TreeView.prototype.trigger=function(){return a.ui.TreeView.prototype.parentPrototype.trigger.call(this)};a.ui.TreeView.setupFromData=function(d,
c,b){a.ui.data.callParentSetupFromData(a.ui.TreeView,d,c,b)}});
rat.modules.add("rat.utils.r_shapes",["rat.math.r_math","rat.math.r_vector"],function(a){a.shapes={};a.shapes.Circle=function(d,c,b){var e=0;void 0!==d.x&&(c=d.y,e=void 0!==d.squaredRadius?d.squaredRadius:d.r*d.r||0,b=void 0!==d.r?d.r:a.math.sqrt(e),d=d.x);this.center={x:d||0,y:c||0};this.radius=b||0;this.squaredRadius=e};a.shapes.Rect=function(a,c,b,e){void 0===a?this.h=this.w=this.y=this.x=0:void 0!==a.x?(this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h):(this.x=a,this.y=c,this.w=b,this.h=e)};a.shapes.Rect.prototype.copy=
function(){var d=new a.shapes.Rect;d.x=this.x;d.y=this.y;d.w=this.w;d.h=this.h;return d};a.shapes.Rect.prototype.expandToInclude=function(a){a.x<this.x&&(this.x=a.x);a.y<this.y&&(this.y=a.y);a.x+a.w>this.x+this.w&&(this.w=a.x+a.w-this.x);a.y+a.h>this.y+this.h&&(this.h=a.y+a.h-this.y)};a.shapes.Rect.prototype.getCenter=function(d){d=d||new a.Vector;d.x=this.x+this.w/2;d.y=this.y+this.h/2;return d};a.shapes.Rect.prototype.calcEdges=function(){this.l=this.x;this.t=this.y;this.r=this.x+this.w;this.b=
this.y+this.h;return this};a.shapes.Rect.prototype.isPointInRect=function(a,c){void 0!=a.x&&(c=a.y,a=a.x);return a>=this.l&&a<=this.r&&c>=this.t&&c<=this.b}});
rat.modules.add("rat.graphics.r_image",[{name:"rat.graphics.r_graphics",processBefore:!0},{name:"rat.debug.r_console",processBefore:!0},"rat.os.r_system"],function(a){function d(b,c,d){this.image=b;this.tpjs=c;this.opts=d;this.scaledBy=c.meta&&c.meta?Number(c.meta.scale)||1:1;this.undoScaler=1/this.scaledBy;++a.graphics.Image.spriteSheets.numInMemory}a.graphics.Image=function(){this.imageFrames=[];this.frames=null;this.frameEvents=void 0;this.loadedTargetCount=this.loadedCount=0};a.graphics.Image.prototype.isImage=
!0;a.graphics.Image.centeredX=1;a.graphics.Image.centeredY=2;a.graphics.Image.flipX=4;a.graphics.Image.flipY=8;a.graphics.Image.lastRenderFrameIndex=-1;a.graphics.Image.perFrameDrawCount=0;var c="frames",b="filename";a.graphics.Image.prototype.getImageFrame=function(b,c){if(!this.imageFrames)return null;if(0>b||b>=this.imageFrames.length){if(!c||!c.noWarn)0>=this.imageFrames.length?a.console.log("Bad image frame! Failed to specify/load any images?"):a.console.log("Bad image frame! "+b+" / "+this.imageFrames.length);
return null}return!this.imageFrames[b].valid?null:this.imageFrames[b]};a.graphics.Image.prototype.isLoaded=function(){for(var a=0;a<this.imageFrames.length;a++)if(!this.imageFrames[a].valid&&!this.imageFrames[a].error)return!1;return!0};a.graphics.Image.prototype.appendFrames=function(b){function c(a){a.onload=null;a.valid=!0;this.loadedCount++;if(this.loadedCount>=this.loadedTargetCount&&this.onLoad)this.onLoad(a)}function d(b){b.onerror=null;a.console.log("ERROR loading image "+b.src);this.loadedCount++;
b.error=!0}if(b){var h=b;Array.isArray(b)||(h=[b]);b=typeof h[0];"string"===b&&(this.debugName=h[0]);if(!("string"===b&&this.findAndBuildFromSpriteSheets(h))){this.loadedTargetCount=h.length;for(var j=0;j<h.length;j++){var k=a.graphics.findInCache(h[j]);null!==k?this.loadedCount++:"string"===b?(k=new Image,k.valid=!1,k.error=!1,k.onload=c.bind(this,k),k.origSrc=h[j],k.onerror=d.bind(this,k),k.src=a.system.fixPath(h[j]),0<k.width&&k.onload&&c.call(this,k)):(console.log("Trying to load non-string-resource image..."),
k=h[j],k.valid=!0,this.loadedCount++);this.imageFrames.push(k)}}}};a.graphics.Image.spriteSheets=[];a.graphics.Image.spriteSheets.numInMemory=0;d.prototype.inMemory=!0;d.prototype.setActive=function(b){void 0===b&&(b=!0);b!=this.inMemory&&(b?(a.graphics.preLoadImages([this.image]),this.inMemory=!0,++a.graphics.Image.spriteSheets.numInMemory):(this.inMemory=!1,a.graphics.clearFromCache(this.image),--a.graphics.Image.spriteSheets.numInMemory),a.console.log((b?"":"UN-")+"loading spritesheet "+this.image))};
a.graphics.Image.registerSpriteSheet=function(e,f,g){if(!(0<=a.graphics.Image.getSpriteSheetIndex(f))){g||(g={});e=new d(e,f,g);var h=f[c];if(!Array.isArray(h)){f.namedFrames=h;f[c]=[];for(var j in h)h.hasOwnProperty(j)&&(h[j][b]=g.forceLowerCase?j.toLowerCase():j,f[c].push(h[j]))}g.forceLowerCase&&(j=f.meta.image)&&(f.meta.image=j.toLowerCase());g.verbose&&a.console.log("loaded spritesheet with "+e.tpjs[c].length+" frames");a.graphics.Image.spriteSheets.push(e)}};a.graphics.Image.getSpriteSheetCount=
function(b){return b&&b.inMemory?a.graphics.Image.spriteSheets.numInMemory:a.graphics.Image.spriteSheets.length};a.graphics.Image.getNthSpriteSheet=function(b,c){var d=a.graphics.Image.spriteSheets;if(c&&c.inMemory)for(var h=0;h<d.length;++h){var j=a.graphics.Image.spriteSheets[h];if(j.inMemory&&(--b,0>b))return j}else return d[b]};a.graphics.Image.forEachSpriteSheet=function(b,c){if(b)for(var d=0,h;h=a.graphics.Image.getNthSpriteSheet(d,c);)++d,b(h,c)};a.graphics.Image.getSpriteSheetIndex=function(b){for(var c=
0;c<a.graphics.Image.spriteSheets.length;c++)if(a.graphics.Image.spriteSheets[c].tpjs===b)return c;return-1};a.graphics.Image.findInSpriteSheet=function(d){function f(d,e){for(var f=0;f!==a.graphics.Image.spriteSheets.length;++f){var g=a.graphics.Image.spriteSheets[f],n=g.tpjs,p=n[c],q;q=[];var r="";if(e){r=n.meta;if(!r)continue;r=r.image;if(!r)continue;r=a.utils.getPath(r,!0)}else if(g.opts.requirePath)continue;for(h=0;h!==d.length;++h)for(var n=null,s=0;s!==p.length;++s){var t;g.opts.forceLowerCase?
(n||(n=d[h].toLowerCase()),t=n):t=d[h];if(r+p[s][b]===t){q.push(s);break}}if(q.length===d.length)return{sheetIndex:f,frameIndexList:q}}return null}if(!a.graphics.Image.spriteSheets||1>a.graphics.Image.spriteSheets.length)return null;for(var g=[],h=0;h!==d.length;++h)g[h]=a.utils.cleanPath(d[h]),0<=g[h].indexOf("out/media/img/char/lvl1_m/attack_1.png")&&a.console.log("will be searching for "+g[h]);if(g=f(g,!0))return g;g=[];for(h=0;h!==d.length;++h)g[h]=a.utils.stripPath(d[h]);return f(g,!1)};a.graphics.Image.prototype.findAndBuildFromSpriteSheets=
function(b){b=a.graphics.Image.findInSpriteSheet(b);if(!b)return!1;this.buildFramesFromSpriteSheets(b.sheetIndex,b.frameIndexList);return!0};a.graphics.Image.prototype.buildFramesFromSpriteSheets=function(d,f){var g=a.graphics.Image.spriteSheets[d],h=g.tpjs;this.appendFrames(g.image);this.frames=[];for(var j=0;j<f.length;j++){var k={},l=h[c][f[j]],m=l[b];k.name=m.substring(0,m.length-4);k.scaledBy=g.scaledBy;k.undoScaler=g.undoScaler;k.drawBox={x:l.frame.x,y:l.frame.y,w:l.frame.w,h:l.frame.h};k.box=
{};k.box.x=k.drawBox.x*g.undoScaler;k.box.y=k.drawBox.y*g.undoScaler;k.box.w=k.drawBox.w*g.undoScaler;k.box.h=k.drawBox.h*g.undoScaler;m=l.spriteSourceSize;k.trimRect={x:m.x*g.undoScaler,y:m.y*g.undoScaler,w:m.w*g.undoScaler,h:m.h*g.undoScaler};m=l.spriteSourceSize;k.sourceSize={w:m.w,h:m.h};l=l.sourceSize;k.origSize={w:l.w?l.w*g.undoScaler:k.box.w,h:l.h?l.h*g.undoScaler:k.box.h};this.frames.push(k)}};a.graphics.Image.prototype.buildFromSpriteSheet=function(b){var d=a.graphics.Image.getSpriteSheetIndex(b);
if(!(0>d)){for(var g=[],h=0;h<b[c].length;h++)g[h]=h;this.buildFramesFromSpriteSheets(d,g)}};a.graphics.Image.prototype.frameCount=function(){return this.frames?this.frames.length:this.imageFrames.length};a.graphics.Image.prototype.getNamedFrame=function(a){if(this.frames)for(var b=0;b<this.frames.length;b++)if(this.frames[b].name===a)return b;return-1};a.graphics.Image.prototype.getFrameSize=function(b){if(this.frames)return this.frames[b].origSize;if(b=this.getImageFrame(b))return{w:b.width,h:b.height};
a.console.logOnce("r_image: error:  asking for size of image that hasn't been loaded : "+(this.debugName||""),"imageSizeError");return{w:32,h:32}};a.graphics.Image.prototype.setOnLoad=function(a){if((this.onLoad=a)&&this.loadedCount>=this.loadedTargetCount)this.onLoad(this.imageFrames[0])};a.graphics.Image.prototype.draw=function(b,c,d,h,j,k,l,m,n,p,q){b=b||a.graphics.ctx;var r,s,t=1,w=1,v=!1;d=d||0;h=h||0;if(this.frames){s=this.getImageFrame(0);if(!s)return;m=this.frames[c];"undefined"===typeof j&&
(j=m.origSize.w);"undefined"===typeof k&&(k=m.origSize.h);n=j/m.origSize.w;p=k/m.origSize.h;q=m.box.w*n;var y=m.box.h*p;c=m.trimRect.x*n;r=m.trimRect.y*p;l&a.graphics.Image.flipX&&(v=!0,b.save(),t=-1,b.translate(q,0),c=(m.origSize.w-(m.trimRect.x+m.box.w))*n,b.scale(-1,1));l&a.graphics.Image.flipY&&(v||(v=!0,b.save()),w=-1,b.translate(0,y),c=(m.origSize.h-(m.trimRect.y+m.box.h))*p,b.scale(1,-1));l&a.graphics.Image.centeredX&&(c-=j/2);l&a.graphics.Image.centeredY&&(r-=k/2);b.drawImage(s,m.drawBox.x,
m.drawBox.y,m.drawBox.w,m.drawBox.h,(d+c)*t,(h+r)*w,q,y)}else{s=this.getImageFrame(c);if(!s)return;void 0===j&&(j=s.width);void 0===k&&(k=s.height);void 0===m&&(m=0);void 0===n&&(n=0);void 0===p&&(p=s.width);void 0===q&&(q=s.height);r=c=0;l&a.graphics.Image.centeredX&&(c=-j/2);l&a.graphics.Image.centeredY&&(r=-k/2);l&a.graphics.Image.flipX&&(v=!0,b.save(),t=-1,b.translate(j,0),b.scale(-1,1));l&a.graphics.Image.flipY&&(v||(v=!0,b.save()),w=-1,b.translate(0,k),b.scale(1,-1));b.drawImage(s,m,n,p,q,(d+
c)*t,(h+r)*w,j,k)}v&&b.restore();a.graphics.frameIndex!==a.graphics.Image.lastRenderFrameIndex&&(a.graphics.Image.lastRenderFrameIndex=a.graphics.frameIndex,a.graphics.Image.perFrameDrawCount=0);a.graphics.Image.perFrameDrawCount++};a.graphics.ImageRef=function(b){"object"===typeof b&&b.isImageRef?this.copyFrom(b):("object"===typeof b&&b.isImage?this.image=b:(this.image=new a.graphics.Image,b&&this.image.appendFrames(b)),this.animSpeed=this.frame=0,this.animDir=1,this.animOneShot=this.animAutoReverse=
this.animPaused=!1,this.flags=this.time=0)};a.graphics.ImageRef.prototype.isImageRef=!0;a.graphics.ImageRef.prototype.copyFrom=function(a){this.image=a.image;this.frame=a.frame;this.animSpeed=a.animSpeed;this.animDir=a.animDir;this.animPaused=a.animPaused;this.animAutoReverse=a.animAutoReverse;this.animOneShot=a.animOneShot;this.time=a.time;this.flags=a.flags;this.frameEvents=a.frameEvents};a.graphics.ImageRef.prototype.setFrameEvents=function(a){this.frameEvents=a};a.graphics.ImageRef.prototype.fireEventsForFrame=
function(b){this.frameEvents&&(this.frameEvents[b]&&a.eventMap)&&a.eventMap.fire(this.frameEvents[b],this)};a.graphics.ImageRef.buildFromSpriteSheet=function(b,c){a.graphics.Image.registerSpriteSheet(b,c);var d=new a.graphics.ImageRef;d.image.buildFromSpriteSheet(c);return d};a.graphics.ImageRef.constructAllFromSpriteSheet=function(d){function f(b,c){if(!(0>=c.length)){var d=b.length;"_"===b.charAt(d-1)&&(b=b.substring(0,d-1));d=new a.graphics.ImageRef;d.image.buildFramesFromSpriteSheets(g,c);h[b]=
d}}var g=a.graphics.Image.getSpriteSheetIndex(d);if(0>g)return null;var h={};d="";for(var j=[],k=a.graphics.Image.spriteSheets[g].tpjs[c],l=0;l<k.length;l++){for(var m=k[l][b],n=m.lastIndexOf("."),m=m.substring(0,n);0<=n;){if(isNaN(m.charAt(n))){n++;break}n--}if(!(0>=n||n>=m.length)){var p=m.substring(n),m=m.substring(0,n);parseInt(p)}d!==m&&(f(d,j),j=[]);j.push(l);d=m}f(d,j);return h};a.graphics.ImageRef.prototype.setOnLoad=function(a){this.image.setOnLoad(a)};a.graphics.ImageRef.prototype.isLoaded=
function(){return this.image.isLoaded()};a.graphics.ImageRef.prototype.getImage=function(){return this.image.getImageFrame(this.frame)};a.graphics.ImageRef.prototype.getNamedFrame=function(a){return this.image.getNamedFrame(a)};a.graphics.ImageRef.prototype.getFrameCount=function(){return this.image.frameCount()};a.graphics.ImageRef.prototype.setFrame=function(a){var b=this.image.frameCount();0>a&&(a=0);var c=this.frame;this.frame=a%b;c!==this.frame&&this.frameEvents&&this.fireEventsForFrame(this.frame)};
a.graphics.ImageRef.prototype.setFrameByName=function(a){this.setFrame(this.getNamedFrame(a))};a.graphics.ImageRef.prototype.getFrame=function(){return this.frame};a.graphics.ImageRef.prototype.getFrameSize=function(a){return this.image.getFrameSize(a)};a.graphics.ImageRef.prototype.getSize=function(){return this.getFrameSize(this.frame)};a.graphics.ImageRef.prototype.setAnimSpeed=function(a){this.animSpeed=a};a.graphics.ImageRef.prototype.setAnimAutoReverse=function(a){this.animAutoReverse=a};a.graphics.ImageRef.prototype.setAnimOneShot=
function(a){this.animOneShot=a};a.graphics.ImageRef.prototype.setAnimPaused=function(a){this.animPaused=void 0===a?!0:a};a.graphics.ImageRef.prototype.setAnimFinished=function(){this.time=this.image.frameCount();this.update(0)};a.graphics.ImageRef.prototype.isAnimFinished=function(){return this.time>=this.image.frameCount()};a.graphics.ImageRef.prototype.isAnimOneShot=function(){return this.animOneShot};a.graphics.ImageRef.prototype.restartAnim=function(){this.time=0;this.update(0)};a.graphics.ImageRef.prototype.setRandomTime=
function(){this.time=Math.random()*this.image.frameCount();this.update(0)};a.graphics.ImageRef.prototype.update=function(a){if(0<this.animSpeed){var b=this.image.frameCount();if(!this.animPaused)if(this.time+=this.animSpeed*this.animDir*a,this.animAutoReverse)this.time>b&&(this.time=b-(this.time-b),this.animDir=-1),0>this.time&&(this.animOneShot?this.time=0:(this.time=-this.time,this.animDir=1));else if(this.animOneShot)this.time>b&&(this.time=b);else for(;this.time>b;)this.time-=b;a=this.frame;this.frame=
this.time|0;0>this.frame&&(this.frame=0);this.frame>=b&&(this.frame=b-1);a!==this.frame&&this.frameEvents&&this.fireEventsForFrame(this.frame)}};a.graphics.ImageRef.prototype.draw=function(a,b,c,d,j,k,l,m,n){this.image.draw(a,this.frame,b,c,d,j,this.flags,k,l,m,n)};a.graphics.ImageRef.prototype.setCentered=function(b,c){"undefined"===typeof c&&(c=b);this.flags=b?this.flags|a.graphics.Image.centeredX:this.flags&~a.graphics.Image.centeredX;this.flags=c?this.flags|a.graphics.Image.centeredY:this.flags&
~a.graphics.Image.centeredY;return this};a.graphics.ImageRef.prototype.setFlipped=function(b,c){this.flags=b?this.flags|a.graphics.Image.flipX:this.flags&~a.graphics.Image.flipX;this.flags=c?this.flags|a.graphics.Image.flipY:this.flags&~a.graphics.Image.flipY};a.graphics.imageCache=[];a.graphics.imageCache.leftToLoad=0;a.graphics.preLoadImages=function(b){Array.isArray(b)||(b=[b]);for(var c=0,d=0,h=0;h<b.length;h++)if(a.graphics.Image.findInSpriteSheet([b[h]]))c++;else if(a.graphics.findInCache(b[h]))d++;
else{a.graphics.imageCache.leftToLoad+=1;var j=new a.graphics.Image;j.appendFrames(b[h]);j.setOnLoad(function(b){b.setOnLoad(void 0);--a.graphics.imageCache.leftToLoad;0>a.graphics.imageCache.leftToLoad&&(a.graphics.imageCache.leftToLoad=0)}.bind(void 0,j));a.graphics.imageCache.push(j)}};a.graphics.addToCache=function(b,c){var d=a.graphics.imageCache.length,h;if(c){var j={};if(h=a.graphics.findInCache(c,j))h=a.graphics.imageCache[j.index],d=j.index}b.isImage||(h?(h.imageFrames[0]=b,b=h):(h=b,b=new a.graphics.Image,
b.appendFrames(h)),c&&(b.imageFrames[0].origSrc=c),b.imageFrames[0].valid=!0);a.graphics.imageCache[d]=b};a.graphics.clearFromCache=function(b){var c={};a.graphics.findInCache(b,c)&&a.graphics.imageCache.splice(c.index,1)};a.graphics.isCacheLoaded=function(){for(var b=0;b<a.graphics.imageCache.length;b++)if(!a.graphics.imageCache[b].isLoaded())return!1;return!0};a.graphics.getCacheState=function(){for(var b={total:a.graphics.imageCache.length,current:0,firstWaiting:-1},c=0;c<a.graphics.imageCache.length;c++)a.graphics.imageCache[c].isLoaded()?
b.current++:0>b.firstWaiting&&(b.firstWaiting=c);return b};a.graphics.reportCache=function(){var b=a.graphics.imageCache;a.console.log("-----------------------------------");a.console.log(""+b.length+" images in cache.");for(var c=0;c<b.length;c++){var d=b[c].getImageFrame(0,{noWarn:!0});a.console.log("\t "+c.toFixed(2)+">"+d.origSrc)}a.console.log("-----------------------------------")};a.console.registerCommand("imageCache",a.graphics.reportCache,["reportImageCache","showImageCache"]);a.graphics.findInCache=
function(b,c){for(var d=0;d<a.graphics.imageCache.length;d++){var h=a.graphics.imageCache[d];if(h.imageFrames&&0<h.imageFrames.length&&(h=h.imageFrames[0],null!==h&&(h.origSrc&&h.origSrc===b||h===b)))return c&&(c.index=d),h}return null};a.graphics.externalSpriteMaker=null;a.graphics.makeImage=function(b,c,d){return c&&a.graphics.externalSpriteMaker?a.graphics.externalSpriteMaker(b,c,d):new a.graphics.ImageRef(b)};a.graphics.setExternalSpriteMaker=function(b){a.graphics.externalSpriteMaker=b}});
rat.modules.add("rat.live.r_firebase",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.os.r_events",processBefore:!0},"rat.debug.r_console"],function(a){a.live||(a.live={});a.live.firebase={};a.live.firebase.Connection=function(d,c){c||(c=firebase);var b=c.database();this.db=b;this.baseRef=b.ref(d);this.state="init";this.connected=!1;if("firebase"in window){a.console.log("firebase connection init");this.connectedRef=b.ref(".info/connected");var e=this;this.connectCallback=this.connectedRef.on("value",
function(b){"init"===e.state&&(e.state="ok");!0===b.val()?(a.console.log("++ rat.firebase connected"),e.connected=!0,e.connectFunction&&e.connectFunction(e)):(a.console.log("-- rat.firebase disconnected"),e.connected=!1,e.disconnectFunction&&e.disconnectFunction(e))})}else a.console.log("!no firebase!")};a.live.firebase.Connection.prototype.onDisconnect=function(a){this.disconnectFunction=a};a.live.firebase.Connection.prototype.onConnect=function(a){this.connectFunction=a};a.live.firebase.Connection.prototype.ref=
function(a){return this.baseRef.child(a)};a.live.firebase.Connection.prototype.close=function(){this.connectedRef&&this.connectCallback&&(this.connectedRef.off("value",this.connectCallback),this.connectedRef=this.connectCallback=null);this.baseRef=null};a.live.firebase.Connection.prototype.isReady=function(){return"ok"!=this.state?!1:!0};a.live.firebase.Connection.prototype.isConnected=function(){return this.connected}});
rat.modules.add("rat.graphics.r_particle",[{name:"rat.math.r_math",processBefore:!0},"rat.debug.r_console","rat.debug.r_profiler","rat.graphics.r_graphics","rat.math.r_vector","rat.graphics.r_image"],function(a){var d=a.math,c=d.randomVariance;a.particle={systems:[],stateCaching:{enabled:!0,minObjectCount:0,createPerFrame:0}};a.particle.System=function(a){this.options=a;this.emitters=[]};a.particle.System.prototype.onRemoveEmitter=void 0;a.particle.System.prototype.onAddEmitter=void 0;a.particle.System.prototype.emitterConstructor=
void 0;a.particle.System.infinite=-1;a.particle.System.statusDead=0;a.particle.System.statusActive=1;a.particle.System.statusAlive=1;a.particle.System.emitTypeUnknown=0;a.particle.System.emitTypeSingle=1;a.particle.System.emitTypeBurst=2;a.particle.System.emitTypeStream=3;a.particle.System.killParticles=!0;a.particle.System.RENDER_UNKNOWN=0;a.particle.System.RENDER_DOT=1;a.particle.System.RENDER_TRIANGLE=2;a.particle.System.RENDER_BOX=3;a.particle.System.RENDER_SPRITE=4;a.particle.System.RENDER_TEXT=
5;a.particle.System.RENDER_CUSTOM=10;a.particle.System.prototype.newEmitter=function(){var b=new (this.emitterConstructor||a.particle.Emitter);this.emitters.push(b);this.options&&this.options.trackBounds&&(b.trackBounds=this.options.trackBounds);if(this.onAddEmitter)this.onAddEmitter(b);return b};a.particle.System.prototype.getEmitterCount=function(){return this.emitters.length};a.particle.System.prototype.killAllEmitters=function(a){void 0===a&&(a=!0);for(var c=this.emitters.length-1;0<=c;c--)this.emitters[c].die(a)};
a.particle.System.prototype.killAllParticles=function(){for(var a=this.emitters.length-1;0<=a;a--)this.emitters[a].killAllParticles()};a.particle.System.prototype.moveEmitterToTop=function(a){for(var c=this.emitters.length-1;0<=c;c--)if(this.emitters[c]===a){this.emitters.splice(c,1);this.emitters.push(a);break}};a.particle.System.prototype.removeEmitter=function(a){for(var c=this.emitters.length-1;0<=c;c--)if(this.emitters[c]===a){if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[c]);this.emitters.splice(c,
1);break}};a.particle.System.prototype.appendEmitter=function(a){this.emitters.push(a);if(this.onAddEmitter)this.onAddEmitter(a)};a.particle.System.prototype.update=function(b){a.profiler.pushPerfMark("PSystem:Update");for(var c=this.emitters.length-1;0<=c;c--)if(this.emitters[c].update(b)===a.particle.System.statusDead){this.emitters[c].destroy();if(this.onRemoveEmitter)this.onRemoveEmitter(this.emitters[c]);this.emitters.splice(c,1)}a.profiler.popPerfMark("PSystem:Update")};a.particle.System.prototype.draw=
function(b){a.profiler.pushPerfMark("PSystem:draw");b=b&&b.ctx?b.ctx:a.graphics.getContext();var c=a.graphics.getContext();a.graphics.setContext(b);a.graphics.save({ignoreRatMat:!0});for(var d=0;d<this.emitters.length;d++)this.emitters[d].draw(b);a.graphics.restore();a.graphics.setContext(c);a.profiler.popPerfMark("PSystem:draw")};a.particle.System.prototype.applyBoundsToRectList=function(a){for(var c=0;c<this.emitters.length;c++){var d=this.emitters[c];d.trackBounds&&0<d.bounds.w&&0<d.bounds.h&&
a.add(d.bounds)}};a.particle.System.prototype.applyToDirtyRects=a.particle.System.prototype.applyBoundsToRectList;a.particle.Emitter=function(){this.pos=new a.Vector(100,100);this.angle=new a.Angle;this.startState=a.particle.State.create();this.startVariance=a.particle.State.create();this.asset=[];this.stateSets=[];this.stateSets[0]={state:this.startState,variance:this.startVariance};this.endState=this.startState;this.startState.color.a=1;this.startState.color.r=255;this.startState.color.g=255;this.startState.color.b=
255;this.startState.ageLimit=1;this.prevBounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0};this.trackBounds=!1;this.particles=[]};a.particle.Emitter.fAutoDie=1;a.particle.Emitter.fAutoDieAfterAgeLimit=4;a.particle.Emitter.fRadialStartVelocity=8;a.particle.Emitter.fRadialStartOffset=16;a.particle.Emitter.fEmitting=256;a.particle.Emitter.fEmitImmediately=512;a.particle.Emitter.fStroke=2048;a.particle.Emitter.fGlobalVelocity=4096;a.particle.Emitter.fGlobalOffset=
8192;a.particle.Emitter.fKillParticleAfterAnimation=16384;a.particle.Emitter.prototype.flags=a.particle.Emitter.fEmitting;a.particle.Emitter.prototype.emitType=a.particle.System.emitTypeStream;a.particle.Emitter.prototype.renderType=a.particle.System.RENDER_UNKNOWN;a.particle.Emitter.prototype.rate=10;a.particle.Emitter.prototype.burstCount=1;a.particle.Emitter.prototype.burstAmount=0;a.particle.Emitter.prototype.emitCounter=0;a.particle.Emitter.prototype.status=a.particle.System.statusActive;a.particle.Emitter.prototype.ageLimit=
a.particle.System.infinite;a.particle.Emitter.prototype.age=0;a.particle.Emitter.prototype.font="";a.particle.Emitter.prototype.fontSize=0;a.particle.Emitter.prototype.createEvent=null;a.particle.Emitter.prototype.updateEvent=null;a.particle.Emitter.prototype.deathEvent=null;a.particle.Emitter.prototype.customDraw=null;a.particle.Emitter.prototype.isReadyForUse=!1;a.particle.Emitter.prototype.setFlag=function(a){this.flags|=a};a.particle.Emitter.prototype.clearFlag=function(a){this.flags&=~a};a.particle.Emitter.prototype.isFlag=
function(a){return 0!==(this.flags&a)};a.particle.Emitter.prototype.startEmitting=function(){this.setFlag(a.particle.Emitter.fEmitting)};a.particle.Emitter.prototype.stopEmitting=function(){this.clearFlag(a.particle.Emitter.fEmitting)};a.particle.Emitter.prototype.isEmitting=function(){return this.isFlag(a.particle.Emitter.fEmitting)};a.particle.Emitter.prototype.killAllParticles=function(){if(a.particle.stateCaching.enabled)for(var b=0,c=this.particles.length;b!==c;b++)this.particles[b].destroy&&
this.particles[b].destroy();this.particles=[]};a.particle.Emitter.prototype.die=function(b){this.stopEmitting();this.setFlag(a.particle.Emitter.fAutoDie);b&&this.killAllParticles()};a.particle.Emitter.prototype.addState=function(b,c){var d=this.stateSets[this.stateSets.length-1].state.copy();d.keyTime=b;d.keyFlags=c;d={state:d,variance:a.particle.State.create()};this.stateSets.push(d);return d};a.particle.Emitter.prototype.getInitState=function(){return this.stateSets[0]};a.particle.Emitter.prototype.initEndState=
function(a,c){var d=this.addState(a,c);this.endState=d.state;return d};a.particle.Emitter.prototype.setupStandardBurst=function(b){this.emitType=a.particle.System.emitTypeBurst;this.rate=1;this.emitCounter=1/this.rate+1E-4;this.burstCount=1;this.burstAmount=b};a.particle.Emitter.prototype.getParticleCount=function(){return this.particles.length};a.particle.Emitter.prototype.readyForUse=function(){var b,c;for(c=0;c<this.stateSets.length;c++)b=this.stateSets[c].state,"undefined"===typeof b.keyTime&&
(b.keyTime=c/(this.stateSets.length-1)),"undefined"===typeof b.keyFlags&&(b.keyFlags=0),"object"!==typeof b.angle&&(b.angle=new a.Angle(b.angle));"object"!==typeof this.angle&&(this.angle=new a.Angle(this.angle));for(c=0;c<this.stateSets.length-1;c++)b=this.stateSets[c].state,b.keyTimeLength=this.stateSets[c+1].state.keyTime-b.keyTime;this.stateSets[this.stateSets.length-1].state.keyTimeLength=0;1===this.stateSets.length&&(this.stateSets[this.stateSets.length-1].state.keyTimeLength=1);this.isFlag(a.particle.Emitter.fEmitImmediately)&&
(this.emitCounter=1/this.rate+1E-4);this.isReadyForUse=!0};a.particle.Emitter.prototype.update=function(b){if(this.renderType===a.particle.System.RENDER_UNKNOWN)return a.particle.System.statusDead;var c;a.profiler.pushPerfMark("Emitter.update");this.isReadyForUse||this.readyForUse();var d;this.trackBounds&&(this.prevBounds=this.bounds,this.bounds={x:this.pos.x,y:this.pos.y,w:0,h:0});if(0<this.rate&&this.isEmitting()&&(this.emitCounter+=b,this.emitCounter>1/this.rate)){a.profiler.pushPerfMark("Emitting");
this.emitCounter-=1/this.rate;if(this.emitType===a.particle.System.emitTypeStream)this.spawnNewParticle();else if(this.emitType===a.particle.System.emitTypeBurst&&0<this.burstCount){for(d=0;d<this.burstAmount;d++)this.spawnNewParticle();this.burstCount--;0>=this.burstCount&&(this.rate=0,this.stopEmitting())}a.profiler.popPerfMark("Emitting")}a.profiler.pushPerfMark("p.update");var g;for(d=this.particles.length-1;0<=d;d--)g=this.particles[d],g.update(b,this)===a.particle.System.statusDead?(this.deathEvent&&
this.deathEvent(this,g),this.particles[d].destroy&&this.particles[d].destroy(),this.particles.splice(d,1)):this.trackBounds&&this.addToBounds(g.state.pos.x-0.75*g.state.size,g.state.pos.y-0.75*g.state.size,1.5*g.state.size,1.5*g.state.size);a.profiler.popPerfMark("p.update");a.profiler.pushPerfMark("statusUpdate");this.age+=b;0<this.ageLimit&&this.age>this.ageLimit&&(this.stopEmitting(),this.flags&a.particle.Emitter.fAutoDieAfterAgeLimit&&(this.flags|=a.particle.Emitter.fAutoDie));this.flags&a.particle.Emitter.fAutoDie?
0>=this.particles.length&&(c=a.particle.System.statusDead):c=a.particle.System.statusActive;a.profiler.popPerfMark("statusUpdate");a.profiler.popPerfMark("Emitter.update");return c};a.particle.Emitter.prototype.destroy=function(){this.killAllParticles();if(a.particle.stateCaching.enabled){for(var b=0,c=this.stateSets.length;b!==c;++b)a.particle.State.destroy(this.stateSets[b].state),a.particle.State.destroy(this.stateSets[b].variance);this.stateSets=[]}};a.particle.Emitter.prototype.spawnNewParticle=
function(){a.profiler.pushPerfMark("spawnNewParticle");var b=new a.particle.One,e;e=this.stateSets;var f,g,h;a.profiler.pushPerfMark("setupStates");for(var j=0,k=e.length;j!==k;++j)f=a.particle.State.create(),g=e[j].state,h=e[j].variance,f.keyTime=g.keyTime,f.keyTimeLength=g.keyTimeLength,f.size=g.size,f.grow=g.grow,f.roll=g.roll,f.friction=g.friction,f.color.r=g.color.r,f.color.g=g.color.g,f.color.b=g.color.b,f.color.a=g.color.a,h.size&&(f.size+=2*h.size*d.random()-h.size),h.grow&&(f.grow+=2*h.grow*
d.random()-h.grow),h.roll&&(f.roll+=2*h.roll*d.random()-h.roll),h.friction&&(f.friction+=2*h.friction*d.random()-h.friction),h.color.r&&(f.color.r+=2*h.color.r*d.random()-h.color.r,f.color.r=0>f.color.r?0:255<f.color.r?255:f.color.r|0),h.color.g&&(f.color.g+=2*h.color.g*d.random()-h.color.g,f.color.g=0>f.color.g?0:255<f.color.g?255:f.color.g|0),h.color.b&&(f.color.b+=2*h.color.b*d.random()-h.color.b,f.color.b=0>f.color.b?0:255<f.color.b?255:f.color.b|0),h.color.a&&(f.color.a+=2*h.color.a*d.random()-
h.color.a,f.color.a=0>f.color.a?0:1<f.color.a?1:f.color.a),b.states[j]=f;a.profiler.popPerfMark("setupStates");a.profiler.pushPerfMark("initialState");b.state.size=b.states[0].size;b.state.grow=b.states[0].grow;b.state.color.a=b.states[0].color.a;b.state.color.r=b.states[0].color.r;b.state.color.g=b.states[0].color.g;b.state.color.b=b.states[0].color.b;b.state.friction=b.states[0].friction;b.state.roll=b.states[0].roll;b.state.pos.x=this.pos.x;b.state.pos.y=this.pos.y;f=new a.Vector;this.flags&a.particle.Emitter.fRadialStartOffset?
(e=d.random()*d.PI2,f.setFromAngle(e),f.scale(this.startState.offset.x+c(this.startVariance.offset.x))):(f.x=this.startState.offset.x+c(this.startVariance.offset.x),f.y=this.startState.offset.y+c(this.startVariance.offset.y));this.isFlag(a.particle.Emitter.fGlobalOffset)||(f=this.angle.rotateVector(f));b.state.pos.x+=f.x;b.state.pos.y+=f.y;b.state.angle.angle=this.angle.angle;b.state.angle.angle+=this.startState.angle.angle+c(this.startVariance.angle.angle);this.flags&a.particle.Emitter.fRadialStartVelocity?
(e=d.random()*d.PI2,b.state.vel=new a.Vector,b.state.vel.setFromAngle(e),b.state.vel.scale(this.startState.vel.x+c(this.startVariance.vel.x))):b.state.vel=new a.Vector(this.startState.vel.x+c(this.startVariance.vel.x),this.startState.vel.y+c(this.startVariance.vel.y));b.state.accel=new a.Vector(this.startState.accel.x+c(this.startVariance.accel.x),this.startState.accel.y+c(this.startVariance.accel.y));this.isFlag(a.particle.Emitter.fGlobalVelocity)||(b.state.vel=this.angle.rotateVector(b.state.vel));
b.ageLimit=this.startState.ageLimit+c(this.startVariance.ageLimit);a.profiler.popPerfMark("initialState");b.asset=null;this.renderType===a.particle.System.RENDER_SPRITE?(e=this.asset,this.assetSpawnFunction&&(e=this.assetSpawnFunction(this)),Array.isArray(e)&&(e=e[d.random()*e.length|0]),b.setImageAsset(e)):this.renderType===a.particle.System.RENDER_TEXT&&(e=this.asset,Array.isArray(this.asset)&&(e=this.asset[d.random()*this.asset.length|0]),b.text=e);if(this.createEvent&&(a.profiler.pushPerfMark("createEvent"),
e=this.createEvent(this,b),a.profiler.popPerfMark("createEvent"),!1===e)){a.profiler.popPerfMark("spawnNewParticle");return}this.trackBounds&&this.addToBounds(b.state.pos.x-0.75*b.state.size,b.state.pos.y-0.75*b.state.size,1.5*b.state.size,1.5*b.state.size);this.particles.push(b);a.profiler.popPerfMark("spawnNewParticle")};a.particle.Emitter.prototype.addToBounds=function(a,c,d,g){a<this.bounds.x&&(this.bounds.w+=this.bounds.x-a,this.bounds.x=a);c<this.bounds.y&&(this.bounds.h+=this.bounds.y-c,this.bounds.y=
c);a+d>this.bounds.x+this.bounds.w&&(this.bounds.w=a+d-this.bounds.x);c+g>this.bounds.y+this.bounds.h&&(this.bounds.h=c+g-this.bounds.y)};a.particle.Emitter.prototype.spawn=function(a){"undefined"===typeof a&&(a=1);for(var c=0;c<a;c++)this.spawnNewParticle()};a.particle.Emitter.prototype.draw=function(b){a.profiler.pushPerfMark("Emitter.Draw");this.preDraw&&this.preDraw(b,this);var c,f=!1;this.renderType===a.particle.System.RENDER_TEXT&&(b.textBaseline="middle",b.textAlign="center",this.flags&a.particle.Emitter.fStroke&&
(f=!0));a.profiler.pushPerfMark("particle.Draw");for(var g=0;g<this.particles.length;g++){var h=this.particles[g],j=h.state;b.save();b.translate(j.pos.x,j.pos.y);j.angle.angle&&b.rotate(j.angle.angle);if(this.renderType===a.particle.System.RENDER_BOX)c=j.size,b.fillStyle=j.color.toString(),b.fillRect(-c/2,-c/2,c,c);else if(this.renderType===a.particle.System.RENDER_TRIANGLE){c=j.size/2;var k=d.PI2/3;b.fillStyle=j.color.toString();b.beginPath();b.moveTo(c,0);b.lineTo(d.cos(k)*c,d.sin(k)*c);b.lineTo(d.cos(2*
k)*c,d.sin(2*k)*c);b.closePath();b.fill()}else if(this.renderType===a.particle.System.RENDER_DOT)b.fillStyle=j.color.toString(),b.beginPath(),c=j.size/2,b.arc(0,0,c,0,1.9999*d.PI,!1),b.closePath(),b.fill();else if(this.renderType===a.particle.System.RENDER_SPRITE){if(h.asset)if(b.globalAlpha=j.color.a,c=j.size*h.scaleWidth,j=j.size*h.scaleHeight,h.asset.isImageRef){var l=h.asset.image,m=h.asset.frame,k=h.asset.flags,n=!!l.frames,p=l.getImageFrame(n?0:m),q=0,r=0;p&&(n?(l=l.frames[m],q=c/l.origSize.w,
r=j/l.origSize.h,m=l.box.w*q,n=l.box.h*r,q*=l.trimRect.x,r*=l.trimRect.y,k&a.graphics.Image.centeredX&&(q-=c/2),k&a.graphics.Image.centeredY&&(r-=j/2),b.drawImage(p,l.drawBox.x,l.drawBox.y,l.drawBox.w,l.drawBox.h,q,r,m,n)):(k&a.graphics.Image.centeredX&&(q=-c/2),k&a.graphics.Image.centeredY&&(r=-j/2),b.drawImage(p,q,r,c,j)))}else b.drawImage(h.asset,0,0,h.asset.width,h.asset.height,-c/2,-j/2,c,j)}else this.renderType===a.particle.System.RENDER_TEXT?(b.font=j.size*this.fontSize+"pt "+this.font,f&&
(b.strokeStyle="rgba("+(j.color.r>>3)+","+(j.color.g>>3)+","+(j.color.b>>3)+","+j.color.a+")",b.lineWidth=3,b.strokeText(h.text,-j.size/2,0)),b.fillStyle=j.color.toString(),b.fillText(h.text,-j.size/2,0)):this.renderType!==a.particle.System.RENDER_CUSTOM&&a.console.log("Error:  Unknown particle render type");this.customDraw&&this.customDraw(b,h,this);b.restore()}a.profiler.popPerfMark("particle.Draw");this.postDraw&&this.postDraw(b,this);a.profiler.popPerfMark("Emitter.Draw")};a.particle.Emitter.prototype.setAdditive=
function(){this.preDraw=a.particle.Emitter.preDrawAdditive;this.postDraw=a.particle.Emitter.postDrawAdditive};a.particle.Emitter.preDrawAdditive=function(a,c){c.oldOperation=a.globalCompositeOperation;a.globalCompositeOperation="lighter"};a.particle.Emitter.postDrawAdditive=function(a,c){a.globalCompositeOperation=c.oldOperation};a.particle.State=function(){this.pos=new a.Vector;this.offset=new a.Vector;this.angle=new a.Angle;this.vel=new a.Vector;this.accel=new a.Vector;this.color=new a.graphics.Color(0,
0,0,0);this.protoObject=a.particle.State.prototype};a.particle.State.prototype.size=0;a.particle.State.prototype.grow=0;a.particle.State.prototype.roll=0;a.particle.State.prototype.ageLimit=0;a.particle.State.prototype.friction=0;a.particle.State.prototype.nextInCache=void 0;a.particle.State.prototype.reset=function(){this.size=this.protoObject.size;this.grow=this.protoObject.grow;this.roll=this.protoObject.roll;this.ageLimit=this.protoObject.ageLimit;this.friction=this.protoObject.friction;this.keyFlags=
this.keyTime=this.nextInCache=void 0;this.pos.x=0;this.pos.y=0;this.offset.x=0;this.offset.y=0;this.angle.angle=0;this.vel.x=0;this.vel.y=0;this.accel.x=0;this.accel.y=0;this.color.r=0;this.color.g=0;this.color.b=0;this.color.a=0};a.particle.State.prototype.copy=function(){var b=a.particle.State.create();b.size=this.size;b.grow=this.grow;b.roll=this.roll;b.ageLimit=this.ageLimit;b.friction=this.friction;b.keyTime=this.keyTime;b.keyFlags=this.keyFlags;b.pos.x=this.pos.x;b.pos.y=this.pos.y;b.offset.x=
this.offset.x;b.offset.y=this.offset.y;b.angle.angle=this.angle.angle;b.vel.x=this.vel.x;b.vel.y=this.vel.y;b.accel.x=this.accel.x;b.accel.y=this.accel.y;b.color.r=this.color.r;b.color.g=this.color.g;b.color.b=this.color.b;b.color.a=this.color.a;return b};a.particle.State.cache=void 0;a.particle.State.cacheSize=0;a.particle.State.count=0;a.particle.State.create=function(){if(a.particle.State.cache){var b=a.particle.State.cache;a.particle.State.cache=b.nextInCache;--a.particle.State.cacheSize;b.reset();
return b}++a.particle.State.count;return new a.particle.State};a.particle.State.destroy=function(b){b&&(b.nextInCache=a.particle.State.cache,a.particle.State.cache=b,++a.particle.State.cacheSize)};a.particle.State.FillCache=function(){var b=a.particle.stateCaching.minObjectCount-a.particle.State.count;if(0<b){for(var c=d.min(b,a.particle.stateCaching.createPerFrame),f=c;0<f;--f)a.particle.State.destroy(new a.particle.State),++a.particle.State.count;b-=c}0>=b&&a.cycleUpdate&&a.cycleUpdate.removeUpdater(a.particle.State.FillCache)};
a.particle.One=function(){this.state=a.particle.State.create();this.states=[];this.ageLimit=this.age=0;this.pos=this.state.pos;this.curKeyIndex=0};a.particle.One.prototype.copy=function(){var b=new a.particle.One,c;for(c in this)b[c]=this[c];b.pos=this.pos.copy();b.state=this.state.copy();c=this.states.length;b.states=[];for(var d=0;d<c;d++)b.states[d]=this.states[d].copy();return b};a.particle.One.prototype.update=function(b,c){var d=this.state;d.size+=d.grow*b;0>d.size&&(d.size=0);var g=d.vel,h=
d.friction;0<h&&(h=1-h*b,g.x*=h,g.y*=h);h=d.accel;g.x+=h.x*b;g.y+=h.y*b;h=d.pos;h.x+=g.x*b;h.y+=g.y*b;d.angle.angle+=d.roll*b;for(var g=this.age/this.ageLimit,h=this.states.length-1,j=this.curKeyIndex+1;j<h;j++)g>=this.states[j].keyTime&&(this.curKeyIndex=j);var j=this.curKeyIndex,k=j+1;k>h?(k=j,g=0):(g=(g-this.states[j].keyTime)/this.states[j].keyTimeLength,g=0>g?0:1<g?1:g);h=1-g;j=this.states[j];k=this.states[k];if(k.color.r!==j.color.r){var l=k.color.r*g+h*j.color.r;d.color.r=0>l?0:255<l?255:l|
0}else d.color.r=k.color.r;k.color.g!==j.color.g?(l=k.color.g*g+h*j.color.g,d.color.g=0>l?0:255<l?255:l|0):d.color.g=k.color.g;k.color.b!==j.color.b?(l=k.color.b*g+h*j.color.b,d.color.b=0>l?0:255<l?255:l|0):d.color.b=k.color.b;k.color.a!==j.color.a?(g=k.color.a*g+h*j.color.a,d.color.a=0>g?0:1<g?1:g):d.color.a=k.color.a;d=a.particle.System.statusActive;this.asset&&this.asset.isImageRef&&(this.asset.update(b),c.flags&a.particle.Emitter.fKillParticleAfterAnimation&&(this.asset.animOneShot&&this.asset.isAnimFinished())&&
(d=a.particle.System.statusDead));this.age+=b;this.age>=this.ageLimit&&(d=a.particle.System.statusDead);return d};a.particle.One.prototype.setImageAsset=function(b){b.isImageRef?(this.asset=new a.graphics.ImageRef(b),b=b.getSize(),this.scaleWidth=1,this.scaleHeight=b.h/b.w):0<b.width&&0<b.height&&(this.asset=b,this.scaleWidth=1,this.scaleHeight=b.width/b.height)};a.particle.One.prototype.destroy=function(){a.particle.State.destroy(this.state);this.state=void 0;for(var b=0,c=this.states.length;b!==
c;++b)a.particle.State.destroy(this.states[b]);this.states=[]};a.particle.createSystem=function(b){b=new a.particle.System(b);return a.particle.systems[a.particle.systems.length]=b};a.particle.removeSystem=function(b){for(var c=a.particle.systems.length,d=0;d<c;d++)if(a.particle.systems[d]===b){a.particle.systems.splice(d,1);break}};a.particle.getSystemCount=function(){return a.particle.systems.length};a.particle.getAllEmitterCount=function(){for(var b=0,c=a.particle.systems.length,d=0;d<c;d++)var g=
a.particle.systems[d].getEmitterCount(),b=b+g;return b};a.particle.getAllParticleCount=function(){for(var b=a.particle.systems.length,c=0,d=0;d<b;d++)for(var g=a.particle.systems[d].getEmitterCount(),h=0;h<g;h++)c+=a.particle.systems[d].emitters[h].getParticleCount();return c};a.particle.init=function(){a.particle.stateCaching.enabled?(0>=a.particle.stateCaching.createPerFrame&&(a.particle.stateCaching.createPerFrame=a.particle.stateCaching.minObjectCount,a.particle.State.FillCache(0),a.particle.stateCaching.createPerFrame=
0),a.cycleUpdate&&a.cycleUpdate.addUpdater(a.particle.State.FillCache)):(a.particle.stateCaching.minObjectCount=0,a.particle.stateCaching.createPerFrame=0)}});
rat.modules.add("rat.graphics.r_offscreen",[{name:"rat.graphics.r_graphics",processBefore:!0},{name:"rat.graphics.r_color",processBefore:!0},"rat.debug.r_console","rat.os.r_system","rat.graphics.r_rectlist"],function(a){a.Offscreen=function(d,c){this.canvas=document.createElement("canvas");this.canvas.width=this.width=d;this.canvas.height=this.height=c;this.ctx=this.canvas.getContext("2d");a.ui&&!a.ui.allowOffscreens&&a.console.log("WARNING!  You're trying to use an OffscreenImage() object, but offscreens are not allowed by this host!")};
a.Offscreen.allowOffscreens=!a.system.has.Wraith;a.Offscreen.prototype.enableDirtyRects=function(){this.dirtyRects||(this.dirtyRects=new a.RectList,this.dirtyRects.snapEven=!0)};a.Offscreen.prototype.setSize=function(a,c,b){if(b||!(this.width===a&&this.height===c))this.canvas.width=this.width=a,this.canvas.height=this.height=c};a.Offscreen.prototype.getContext=function(){return this.ctx};a.Offscreen.prototype.getCanvas=function(){return this.canvas};a.Offscreen.prototype.render=function(d,c,b,e,f){d||
(d=a.graphics.getContext());c||(c=0);b||(b=0);e||(e=this.canvas.width);f||(f=this.canvas.height);d.drawImage(this.canvas,c,b,e,f)};a.Offscreen.prototype.eraseDirty=function(){this.dirtyRects&&this.dirtyRects.eraseList(this.ctx)};a.Offscreen.prototype.clear=function(){this.canvas.width=this.canvas.width;this.dirtyRects&&this.dirtyRects.clear()};a.Offscreen.prototype.erase=function(){10===a.system.has.IEVersion&&!a.Offscreen.warnedAboutIE10&&(a.console.log("!! Warning:  This clearRect() call will fail in IE10 if you're using fancy clipping."),
a.Offscreen.warnedAboutIE10=!0);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};a.Offscreen.prototype.clipAndEraseDirty=function(){10===a.system.has.IEVersion?(this.eraseDirty(),this.clipToDirty()):(this.clipToDirty(),this.erase())};a.Offscreen.prototype.clipToDirty=function(){this.dirtyRects.clipToList(this.ctx)};a.Offscreen.prototype.unclip=function(){this.dirtyRects.unclip(this.ctx)};a.Offscreen.prototype.dirtyToPath=function(a,c){a||(a=this.ctx);c||(c=this.dirtyRects.list);this.dirtyRects.listToPath(a,
c)};a.Offscreen.debugColors=[a.graphics.orange,a.graphics.darkGreen,a.graphics.cyan,a.graphics.blue,a.graphics.violet];a.Offscreen.prototype.applyDebugOverlay=function(){var d;if(!a.Offscreen.checkerImages){a.Offscreen.checkerImages=[];for(var c=a.Offscreen.debugColors,b=0;b<c.length;b++){var e=c[b];a.Offscreen.checkerImages[b]=document.createElement("canvas");a.Offscreen.checkerImages[b].width=32;a.Offscreen.checkerImages[b].height=32;d=a.Offscreen.checkerImages[b].getContext("2d");d.fillStyle="#FFFFFF";
d.fillRect(0,0,32,32);d.fillStyle=e.toString();d.fillRect(0,0,16,16);d.fillRect(16,16,16,16)}}this.debugOffscreenCycle||(this.debugOffscreenCycle=0);c=a.Offscreen.debugColors.length;d=this.ctx;this.pat=d.createPattern(a.Offscreen.checkerImages[this.debugOffscreenCycle],"repeat");b=d.globalAlpha;d.globalAlpha=0.3;d.fillStyle=this.pat;d.fillRect(0,0,this.width,this.height);this.debugOffscreenCycle=(this.debugOffscreenCycle+1)%c;d.globalAlpha=b}});
rat.modules.add("rat.utils.r_hexgrid",[{name:"rat.math.r_math",processBefore:!0},"rat.utils.r_utils"],function(a){var d=a.math.sqrt(3),c=function(b){b=a.utils.copyObject(b);b.colCount=b.colCount||1;b.rowCount=b.rowCount||1;b.sideSize=b.sideSize||1;b.vScale=b.vScale||1;this.config=b;this.pointyStyle=!0;"undefined"!==typeof b.style&&(this.pointyStyle="pointy"===b.style);this.size=b.sideSize;this.vScale=b.vScale;this.hexHeight=2*this.size*this.vScale;this.hexWidth=2*d/2*this.size;var e=0;this.data=[];
for(var f=0;f<b.rowCount;f++){var g=[];this.data[f]=g;g.offset=-a.math.floor(f/2);for(g=0;g<b.colCount;g++)this.data[f][g]={value:void 0,blocking:{main:c.noBlocking},debugStyle:void 0,id:e++}}};c.direction={right:0,upRight:1,upLeft:2,left:3,downLeft:4,downRight:5};c.neighbors=[{delta:{q:1,r:0}},{delta:{q:1,r:-1}},{delta:{q:0,r:-1}},{delta:{q:-1,r:0}},{delta:{q:-1,r:1}},{delta:{q:0,r:1}}];c.neighbors2=[{delta:{q:2,r:0}},{delta:{q:2,r:-1}},{delta:{q:2,r:-2}},{delta:{q:1,r:-2}},{delta:{q:0,r:-2}},{delta:{q:-1,
r:-1}},{delta:{q:-2,r:0}},{delta:{q:-2,r:1}},{delta:{q:-2,r:2}},{delta:{q:-1,r:2}},{delta:{q:0,r:2}},{delta:{q:1,r:1}}];c.fullBlocking=-1;c.noBlocking=0;c.prototype.inBounds=function(a,c){if(0>c||c>=this.data.length)return!1;var d=this.data[c],g=a-d.offset;return 0>g||g>=d.length?!1:!0};c.prototype.forEachHex=function(a,c){for(var d={hexGrid:this,userData:c},g=0;g<this.data.length;g++){d.r=g;for(var h=this.data[g],j=0;j<h.length;j++)d.q=j+h.offset,d.entry=h[j],d.value=d.entry.value,a(d)}};c.distance=
function(b,c,d,g){return(a.math.abs(b-d)+a.math.abs(b+c-d-g)+a.math.abs(c-g))/2};c.prototype.distance=c.distance;c.isNeighbor=function(a,c,d,g,h){h||(h=1);return this.distance(a,c,d,g)<=h};c.prototype.isNeighbor=c.isNeighbor;c.prototype.forEachNeighbor=function(a,c,d,g,h,j,k){g={hexGrid:this,userData:g};a=this.getNeighbors(a,c,h,j,k);for(c=0;c<a.length;c++)h=a[c].q,j=a[c].r,this.inBounds(h,j)&&(k=this.data[j],g.entry=k[h-k.offset],g.value=g.entry.value,g.q=h,g.r=j,d(g))};c.prototype.getEntryAt=function(a,
c){a|=0;c|=0;if(this.inBounds(a,c)){var d=this.data[c];return d[a-d.offset]}};c.prototype.setValueAt=function(a,c,d){if(a=this.getEntryAt(a,c))return a.value=d,!0};c.prototype.clearValueAt=function(a,c){return this.setValueAt(a,c,void 0)};c.prototype.getValueAt=function(a,c){var d=this.getEntryAt(a,c);return!d?void 0:d.value};c.prototype.setAllValues=function(a){this.forEachHex(function(c){c.entry.value=a})};c.prototype.clearAllValues=function(){this.setAllValues(void 0)};c.prototype.setBlockingAt=
function(a,d,f,g){if(a=this.getEntryAt(a,d))return void 0===f&&(f=c.fullBlocking),void 0===g&&(g="main"),a.blocking[g]=f,!0};c.prototype.getBlockingAt=function(a,c,d){if(a=this.getEntryAt(a,c))return void 0===d&&(d="main"),a.blocking[d]};c.prototype.clearBlockingAt=function(a,d){return this.setBlockingAt(a,d,c.noBlocking)};c.prototype.setDebugStyleAt=function(a,c,d){if(a=this.getEntryAt(a,c))return a.debugStyle=d,!0};c.prototype.clearDebugStyleAt=function(a,c){return this.setDebugStyleAt(a,c,void 0)};
c.prototype.setAllDebugStyles=function(a){this.forEachHex(function(c){c.entry.debugStyle=a})};c.prototype.clearAllDebugStyles=function(){this.setAllDebugStyles(void 0)};c.prototype.getNeighbors=function(a,d,f,g,h){avoidBlockingSet=!0===f?"main":f;void 0===g&&(g=!1);void 0===h&&(h=1);var j=c.neighbors;2===h&&(j=c.neighbors2);h=[];for(var k=0;k<j.length;k++){var l=a+j[k].delta.q,m=d+j[k].delta.r,n=this.getEntryAt(l,m);n&&(f&&n.blocking[avoidBlockingSet]===c.fullBlocking||h.push({q:l,r:m}))}g&&h.push({q:a,
r:d});return h};c.prototype.isValidNeighbor=function(a,d,f,g,h,j){if(a===f&&d===g)return!!j;avoidBlockingSet=!0===h?"main":h;for(j=0;j<c.neighbors.length;j++){var k=a+c.neighbors[j].delta.q,l=d+c.neighbors[j].delta.r;if(k===f&&l===g){a=this.getEntryAt(k,l);if(!a)break;if(h&&a.blocking[avoidBlockingSet]===c.fullBlocking)break;return!0}}return!1};c.prototype.mergeHexList=function(a,c){for(var d=0;d<c.length;d++){for(var g=!1,h=0;h<a.length;h++)if(a[h].q===c[d].q&&a[h].r===c[d].r){g=!0;break}g||a.push(c[d])}return a};
c.prototype.axialToPixelPos=function(a,c){return this.pointyStyle?{x:this.size*d*(a+c/2),y:3*this.size*this.vScale/2*c}:{x:3*this.size/2*a,y:this.size*this.vScale*d*(c+a/2)}};c.prototype.posToPixelPos=c.prototype.axialToPixelPos;c.prototype.pixelPosToHex=function(b,c){b/=this.hexWidth;var d=(c+this.size*this.vScale)/(this.hexHeight/2),g=a.math.floor(b+d),d=a.math.floor((a.math.floor(d-b)+g)/3);return{q:a.math.floor((a.math.floor(2*b+1)+g)/3)-d,r:d}};c.prototype.sortListByXYDistance=function(a,c,d){c=
this.axialToPixelPos(c,d);for(d=0;d<a.length;d++){var g=this.axialToPixelPos(a[d].q,a[d].r),h=g.x-c.x,g=g.y-c.y;a[d].dist2=h*h+g*g}return a.sort(function(a,b){return a.dist2-b.dist2})};c.prototype.findPath=function(b){b.cycles=b.cycles||-1;if(!b.frontier||b.done){b.path=[];b.settings||(b.settings={});b.done=!1;b.valid=!1;var c=this.getEntryAt(b.start.q,b.start.r);if(!c)return b.valid=!1,b.done=!0;b.startID=c.id;if(b.start.q===b.end.q&&b.start.r===b.end.r)return b.valid=!0,b.done=!0;b.frontier=[];
b.frontier.push({q:b.start.q,r:b.start.r,id:c.id,priority:0});b.visited={};b.visited[c.id]={q:b.start.q,r:b.start.r,fromID:-1,cost:0};b.closest=b.findClosest?{dist:99999999,id:c.id,pos:{q:b.start.q,r:b.start.r}}:null;void 0===b.blockingSet&&(b.blockingSet="main");b.done=!1}for(var d=0;(-1===b.cycles||d<b.cycles)&&b.frontier.length;){var g=b.frontier[0];b.frontier.splice(0,1);var h=b.visited[g.id],j=this.getNeighbors(g.q,g.r,!0);b.settings.prioritizeXYDistance&&(j=this.sortListByXYDistance(j,b.end.q,
b.end.r));for(var k=0;k<j.length;k++){var l=j[k],m=this.getEntryAt(l.q,l.r),c=h.cost+m.blocking[b.blockingSet];if(!b.visited[m.id]||c<b.visited[m.id].cost){for(var n={q:l.q,r:l.r,id:m.id,priority:c},p=0;p<b.frontier.length&&!(c<b.frontier[p].priority);p++);b.frontier.splice(p,0,n);b.visited[m.id]={fromQ:g.q,fromR:g.r,fromID:g.id,q:l.q,r:l.r,cost:c};if(l.q===b.end.q&&l.r===b.end.r){for(d=m.id;d!==b.startID;)g=b.visited[d],b.path.unshift({q:g.q,r:g.r}),d=b.visited[d].fromID;b.frontier=void 0;b.visited=
void 0;b.totalCost=c;b.valid=!0;return b.done=!0}b.findClosest&&(n=a.HexGrid.distance(l.q,l.r,b.end.q,b.end.r),n<b.closest.dist&&(b.closest.totalCost=c,b.closest.dist=n,b.closest.pos={q:l.q,r:l.r},b.closest.id=m.id))}}d++}if(b.frontier.length)return!1;if(b.findClosest)for(d=b.closest.id;d!==b.startID;)g=b.visited[d],b.path.unshift({q:g.q,r:g.r}),d=b.visited[d].fromID;b.frontier=void 0;b.visited=void 0;b.valid=!1;return b.done=!0};c.prototype.floodFill=function(a,c,d,g,h){var j,k;j="main";d&&void 0!==
d.blockingSet&&(j=d.blockingSet);var l=this.getEntryAt(a,c),m=l.blocking[j];d=[];d.push({q:a,r:c,id:l.id});k={};k[l.id]={q:a,r:c};a=1;for(h={hexGrid:this,userData:h};d.length;){l=d[0];d.splice(0,1);c=this.getEntryAt(l.q,l.r);h.entry=c;h.q=l.q;h.r=l.r;h.value=h.entry.value;g(h);for(var l=this.getNeighbors(l.q,l.r),n=0;n<l.length;n++){var p=l[n];c=this.getEntryAt(p.q,p.r);!k[c.id]&&c.blocking[j]===m&&(d.push({q:p.q,r:p.r,id:c.id}),k[c.id]={q:p.q,r:p.r},a++)}}return a};c.prototype.loadLayersFromData=
function(b,c){var d=b.layers;d&&this.forEachHex(function(b){for(var h=[],j=!1,k=b.r,l=b.q+a.math.floor(b.r/2),m=0;m<d.length;m++){var n=d[m],p=n.data,q=n.width,r=n.height,s=k*q+l;l<q&&(k<r&&"tilelayer"===n.type&&p&&void 0!==p[s])&&(h[m]=p[s],j=!0)}if(j)if(c)b.layerData=h,c(b);else{if(!b.entry.value||"object"!==typeof b.entry.value)b.entry.value={};b.entry.value={layerData:h}}})};c.prototype.makeHexContextPath=function(a,c,d,g){g=g||0;d=this.axialToPixelPos(c,d);c=d.x;d=d.y;var h=this.hexHeight,j=
this.hexWidth;a.beginPath();a.moveTo(c+g-j/2,d+g/2-h/4);a.lineTo(c,d+g-h/2);a.lineTo(c-g+j/2,d+g/2-h/4);a.lineTo(c-g+j/2,d-g/2+h/4);a.lineTo(c,d-g+h/2);a.lineTo(c+g-j/2,d-g/2+h/4);a.closePath()};c.prototype.strokeOneHex=function(a,c,d,g){this.makeHexContextPath(a,c,d,g);a.stroke()};c.prototype.fillOneHex=function(a,c,d,g){this.makeHexContextPath(a,c,d,g);a.fill()};c.prototype.drawGrid=function(a){for(var c=0;c<this.data.length;c++)for(var d=this.data[c].offset,g=0;g<this.data[c].length;g++){var h=
g+d,j=c;this.strokeOneHex(a,h,j);var k=this.getEntryAt(h,j);k.debugStyle&&(a.fillStyle=k.debugStyle,this.fillOneHex(a,h,j))}};a.HexGrid=c});
rat.modules.add("rat.input.r_keyboard",[{name:"rat.input.r_input",processBefore:!0}],function(a){a.input.keyboard={MAX_KEY_CODE:256,KEY_SLOTS:8,rawKeys:[0,0,0,0,0,0,0,0],newKeys:[0,0,0,0,0,0,0,0],lastKeys:[0,0,0,0,0,0,0,0],update:function(){for(var d=a.input.keyboard,c=0;c<d.KEY_SLOTS;c++)d.newKeys[c]=d.rawKeys[c]&~d.lastKeys[c],d.lastKeys[c]=d.rawKeys[c]},handleKeyDown:function(d){d=a.input.getEventWhich(d);var c=a.math.floor(d/32);a.input.keyboard.rawKeys[c]|=1<<d-32*c},handleKeyUp:function(d){d=
a.input.getEventWhich(d);var c=a.math.floor(d/32);a.input.keyboard.rawKeys[c]&=~(1<<d-32*c)},isKeyDown:function(d){var c=a.math.floor(d/32);return a.input.keyboard.rawKeys[c]&1<<d-32*c?!0:!1},isKeyNewlyDown:function(d){var c=a.math.floor(d/32);return a.input.keyboard.newKeys[c]&1<<d-32*c?!0:!1}}});
rat.modules.add("rat.utils.r_collision2d",["rat.graphics.r_graphics","rat.debug.r_console","rat.math.r_math","rat.utils.r_shapes"],function(a){function d(c,b){var e;switch(c.type){case "circle":case "Circle":e=new a.shapes.Circle(c);e.type="circle";var f=e.center,g=e.radius;if(void 0===b.left||b.left>f.x-g)b.left=f.x-g;if(void 0===b.right||b.right<f.x+g)b.right=f.x+g;if(void 0===b.top||b.top>f.y-g)b.top=f.y-g;if(void 0===b.bottom||b.bottom<f.y+g)b.bottom=f.y+g;break;case "rect":case "Rect":case "box":case "box":e=
new a.shapes.Rect(c);e.type="rect";if(void 0===b.left||b.left>e.x)b.left=e.x;if(void 0===b.right||b.right<e.x+e.w)b.right=e.x+e.w;if(void 0===b.top||b.top>e.y)b.top=e.y;if(void 0===b.bottom||b.bottom<e.y+e.h)b.bottom=e.y+e.h;break;default:a.console.log("ERROR: Un-supported shape found in bounding shape data: "+c.type);return}e.type=c.type;c.name&&(e.name=c.name);e.children=[];if(c.children){f=0;for(g=c.children.length;f!==g;++f)e.children.push(d(c.children[f],b))}return e}a.collision2D={};a.collision2D.pointInRect=
function(a,b){return!(a.x<b.x||a.y<b.y||a.x>b.x+b.w||a.y>b.y+b.h)};a.collision2D.limitPointToSpace=function(a,b,d,f,g){a.x<b&&(a.x=b);a.y<d&&(a.y=d);a.x>b+f&&(a.x=b+f);a.y>d+g&&(a.y=d+g)};a.collision2D.rectOverlapsRect=function(a,b){return!(a.y+a.h<b.y||a.y>b.y+b.h||a.x+a.w<b.x||a.x>b.x+b.w)};a.collision2D.circlesCollide_Offset=function(c,b,d,f){if(c&&d){var g=c.radius+d.radius,h=d.center.x+f.x-(c.center.x+b.x);c=d.center.y+f.y-(c.center.y+b.y);h=a.math.sqrt(h*h+c*c);return h>g?void 0:{dist:h,radii:g}}};
a.collision2D.circlesCollide=function(c,b){if(c&&b){var d=c.radius+b.radius,f=b.center.x-c.center.x,g=b.center.y-c.center.y,f=a.math.sqrt(f*f+g*g);return f>d?void 0:{dist:f,radii:d}}};a.collision2D.rectsCollide_Offset=function(a,b,d,f){var g=a.x+b.x;b=a.y+b.y;var h=d.x+f.x;f=d.y+f.y;return!(b+a.h<f||b>f+d.h||g+a.w<h||g>h+d.w)};a.collision2D.rectsCollide=a.collision2D.rectOverlapsRect;a.collision2D.circlesAndRectCollide_Offset=function(a,b,d,f){var g,h=0,j;j=a.squaredRadius?a.squaredRadius:a.radius*
a.radius;g=a.center.y+b.x;a=a.center.y+b.y;b=d.x+f.x;f=d.y+f.y;var k=b+d.w;d=f+d.h;g<b?(g-=b,h+=g*g):g>k&&(g-=k,h+=g*g);a<f?(g=a-f,h+=g*g):a>d&&(g=a-d,h+=g*g);if(h<=j)return{}};a.collision2D.circlesAndRectCollide=function(a,b){var d,f=0,g;g=a.squaredRadius?a.squaredRadius:a.radius*a.radius;var h=a.center;d=b.x+b.w;var j=b.y+b.h;h.x<b.x?(d=h.x-b.x,f+=d*d):h.x>d&&(d=h.x-d,f+=d*d);h.y<b.y?(d=h.y-b.y,f+=d*d):h.y>j&&(d=h.y-j,f+=d*d);if(f<=g)return{}};a.collision2D.shapesCollide=function(c,b,d,f){switch(c.type){case "circle":switch(d.type){case "circle":return a.collision2D.circlesCollide_Offset(c,
b,d,f);case "rect":return a.collision2D.circlesAndRectCollide_Offset(c,b,d,f);default:return}case "rect":switch(d.type){case "circle":return a.collision2D.circlesAndRectCollide_Offset(d,f,c,b);case "rect":return a.collision2D.rectsCollide_Offset(c,b,d,f)}}};a.collision2D.shapeAndShapeListCollide=function(c,b,d,f){for(var g,h,j=c.children&&c.children.length,k,l=0,m=d.length;l!==m;++l)if(h=d[l],g=a.collision2D.shapesCollide(c,b,h,f)){k=h.children&&h.children.length;if(!j&&!k)return g;if(j&&!k){if(g=
a.collision2D.shapeAndShapeListCollide(h,f,c.children,b))return g}else if(g=a.collision2D.shapeAndShapeListCollide(c,b,h.children,f))if(!j||(g=a.collision2D.shapeListsCollide(c.children,b,h.children,f)))return g}};a.collision2D.shapeListsCollide=function(c,b,d,f){for(var g,h=0,j=c.length;h!==j;++h)if(g=a.collision2D.shapeAndShapeListCollide(c[h],b,d,f))return g};a.collision2D.BoundingShapesCollide=function(c,b,d,f){var g=a.collision2D.circlesCollide_Offset(c.mBounding,b,d.mBounding,f);return!g?g:
a.collision2D.shapeListsCollide(c.mShapes,b,d.mShapes,f)};a.collision2D.BoundingShape=function(c){!1===Array.isArray(c)&&(c=[c]);this.mLimits={left:void 0,right:void 0,top:void 0,bottom:void 0};this.mShapes=[];for(var b=0,e=c.length;b!==e;++b)this.mShapes.push(d(c[b],this.mLimits));this.mLimits.left=this.mLimits.left||0;this.mLimits.right=this.mLimits.right||0;this.mLimits.top=this.mLimits.top||0;this.mLimits.bottom=this.mLimits.bottom||0;this.mSize={x:this.mLimits.right-this.mLimits.left,y:this.mLimits.bottom-
this.mLimits.top};c=this.mSize.x/2;b=this.mSize.y/2;this.mBounding=new a.shapes.Circle({x:this.mLimits.left+c,y:this.mLimits.top+b,squaredRadius:c*c+b*b})};a.collision2D.BoundingShape.prototype.debugDraw=function(c,b,d){a.graphics.save();var f=a.graphics.ctx;b=b.toString();f.strokeStyle=b;f.lineWidth=1;a.graphics.translate(c.x,c.y);c=this.mLimits;b=this.mSize;a.graphics.ctx.strokeRect(c.left,c.top,b.x,b.y);a.graphics.drawCircle(this.mBounding);b=d.toString();f.strokeStyle=b;a.graphics.drawShapeList(this.mShapes);
a.graphics.restore()};a.collision2D.pointToLine=function(a,b,d){var f={onLine:!1},g=b.x-d.x,h=b.y-d.y,g=((a.x-b.x)*(d.x-b.x)+(a.y-b.y)*(d.y-b.y))/(g*g+h*h),h={};h.x=b.x+g*(d.x-b.x);h.y=b.y+g*(d.y-b.y);f.closePoint=h;b=a.x-h.x;a=a.y-h.y;f.distanceSquared=b*b+a*a;f.onLine=0<=g&&1>=g;return f}});
rat.modules.add("rat.graphics.r_rectlist",[],function(a){a.RectList=function(){this.list=[]};a.RectList.prototype.clear=function(){this.list=[]};a.RectList.prototype.snap=function(a){var c={};c.x=a.x-1|0;c.y=a.y-1|0;c.w=a.w+1+(a.x-c.x)+0.999999999|0;c.h=a.h+1+(a.y-c.y)+0.999999999|0;return c};a.RectList.prototype.add=function(a){a=this.snapEven?this.snap(a):{x:a.x,y:a.y,w:a.w,h:a.h};for(var c=this.list.length-1;0<=c;c--){var b=this.list[c],e=a.x+a.w,f=a.y+a.h,g=b.x+b.w,h=b.y+b.h;if(a.x>=b.x&&a.y>=
b.y&&e<=g&&f<=h)return;if(a.x<=b.x&&a.y<=b.y&&e>=g&&f>=h)this.list.splice(c,1);else{var j=0,k=0,l;if(!(e<b.x||g<a.x)&&!(f<b.y||h<a.y))a.x<b.x?(l=a.x,e>g?j=b.w:(j=e-b.x,e=g)):(l=b.x,g>e?(j=a.w,e=g):j=g-a.x),a.y<b.y?(g=a.y,f>h?k=b.h:(k=f-b.y,f=h)):(g=b.y,h>f?(k=a.h,f=h):k=h-a.y),j*k>0.7*a.w*a.h&&(b.x+b.w>e&&console.log("LOSS"),a.x=l,a.y=g,a.w=e-l,a.h=f-g,this.list.splice(c,1))}}this.list.push(a)};a.RectList.prototype.hits=function(a){this.snapEven&&(a=this.snap(a));for(var c=0;c<this.list.length;c++){var b=
this.list[c];if(a.x+a.w>=b.x&&a.x<=b.x+b.w&&a.y+a.h>=b.y&&a.y<=b.y+b.h)return!0}return!1};a.RectList.prototype.eraseList=function(a){for(var c=0;c<this.list.length;c++){var b=this.list[c];a.clearRect(b.x,b.y,b.w,b.h)}};a.RectList.prototype.clipToList=function(a,c){a.save();this.listToPath(a,c);a.clip()};a.RectList.prototype.unclip=function(a){a.restore()};a.RectList.prototype.listToPath=function(a,c){c||(c=this.list);a.beginPath();for(var b=0;b<c.length;b++){var e=c[b];a.moveTo(e.x,e.y);a.lineTo(e.x+
e.w,e.y);a.lineTo(e.x+e.w,e.y+e.h);a.lineTo(e.x,e.y+e.h);a.lineTo(e.x,e.y)}}});
rat.modules.add("rat.ui.r_ui_pageslider",[{name:"rat.ui.r_ui",processBefore:!0},{name:"rat.ui.r_ui_scrollview",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0},"rat.debug.r_console"],function(a){a.ui.PageSlider=function(d){a.ui.PageSlider.prototype.parentConstructor.call(this,d);this.setClip(!0);this.orientation="horizontal";this.displayPageIndex=this.pageIndex=0;this.lastFocusedPage=-1;this.pageCount=0;this.pageAnim=null;this.config={animTime:0.5};this.pages=[];this.wheelAffects="x";
this.supportZoom(!1)};a.utils.inheritClassFrom(a.ui.PageSlider,a.ui.ScrollView);a.ui.PageSlider.prototype.elementType="PageSlider";a.ui.PageSlider.prototype.setUserData=function(a){this.userData=a};a.ui.PageSlider.prototype.setAnimTime=function(a){this.config.animTime=a};a.ui.PageSlider.prototype.setOrientation=function(a){this.orientation=a};a.ui.PageSlider.prototype.setPageCount=function(a){var c=this.pageCount;this.pageCount=a;if(this.pageIndex>a-1)this.setPageIndex(a-1,!1);else if(0===c||this.pageIndex===
a-1)this.callCreatePage(this.pageIndex),this.lastFocusedPage=-1,this.updateFocusedPage();this.updateButtonState();this.contentSize.x=this.size.x*a;this.contentSize.y=this.size.y};a.ui.PageSlider.prototype.setPageIndex=function(a,c){void 0===c&&(c=!0);this.pages[this.displayPageIndex|0]||(c=!1);a>=this.pageCount&&(a=this.pageCount-1);0>a&&(a=0);this.pageIndex=a;this.updateButtonState();c?this.startPageAnimation():this.snapPageAnimation()};a.ui.PageSlider.prototype.attachButtons=function(a,c){"string"===
typeof a&&(a=this.parent.findSubElementByID(a));"string"===typeof c&&(c=this.parent.findSubElementByID(c));this.button1=a;this.button2=c;this.button1.setCallback(function(a,c){c.setPageIndex(c.pageIndex-1)},this);this.button2.setCallback(function(a,c){c.setPageIndex(c.pageIndex+1)},this);this.updateButtonState()};a.ui.PageSlider.prototype.updateButtonState=function(){this.button1&&(0===this.pageIndex?this.button1.setVisible(!1):this.button1.setVisible(!0));this.button2&&(this.pageIndex>=this.pageCount-
1?this.button2.setVisible(!1):this.button2.setVisible(!0))};a.ui.PageSlider.prototype.setCreatePage=function(a){this.createPageFunc=a;0<this.pageCount&&this.callCreatePage(this.pageIndex)};a.ui.PageSlider.prototype.setDeletePage=function(a){this.deletePageFunc=a};a.ui.PageSlider.prototype.setVisiblePageChanged=function(a){this.visiblePageChangedFunc=a;this.updateFocusedPage()};a.ui.PageSlider.prototype.callCreatePage=function(a){a|=0;var c=this.pages[a];c&&this.removeSubElement(c);if(this.createPageFunc){var b=
this.createPageFunc(a,{container:this,size:this.size,oldPage:c},this.userData);this.appendSubElement(b);c!==b&&this.deletePageFunc&&this.callDeletePage(c);b.setPos(a*this.size.x,0);this.pages[a]=b}};a.ui.PageSlider.prototype.callDeletePage=function(a){a&&this.deletePageFunc&&this.deletePageFunc(a,{container:this,size:this.size},this.userData)};a.ui.PageSlider.prototype.mouseWheelEvent=function(d,c){return a.ui.PageSlider.prototype.parentPrototype.mouseWheelEvent.call(this,d,c)};a.ui.PageSlider.prototype.mouseDown=
function(d,c){return a.ui.PageSlider.prototype.parentPrototype.mouseDown.call(this,d,c)};a.ui.PageSlider.prototype.mouseUp=function(d,c){var b=a.ui.PageSlider.prototype.parentPrototype.mouseUp.call(this,d,c);if(!this.isFlung()){var e=this.displayPageIndex+0.5|0;e===this.displayPageIndex?this.setPageIndex(e,!1):(this.setPageIndex(e,!0),this.quickSettleToPage())}return b};a.ui.PageSlider.prototype.handleMouseMove=function(d,c,b){d=a.ui.PageSlider.prototype.parentPrototype.handleMouseMove.call(this,
d,c,b);this.flags&a.ui.Element.trackingMouseDownFlag&&this.updateDisplayPageFromScroll();return d};a.ui.PageSlider.prototype.startPageAnimation=function(){this.pageAnim={time:0,totalTime:this.config.animTime,source:this.displayPageIndex,dest:this.pageIndex}};a.ui.PageSlider.prototype.snapPageAnimation=function(){this.pageAnim=null;this.displayPageIndex=this.pageIndex;this.contentOffset.x=-this.displayPageIndex*this.size.x;this.viewChanged()};a.ui.PageSlider.prototype.quickSettleToPage=function(){if(this.pageAnim){var a=
this.pageAnim.dest-this.displayPageIndex,a=Math.abs(a);this.pageAnim.totalTime=a*this.config.animTime}};a.ui.PageSlider.prototype.setDisplayPage=function(a){this.displayPageIndex=a};a.ui.PageSlider.prototype.viewChanged=function(){this.updateDisplayPageFromScroll();var a=this.displayPageIndex|0,c=a+1;this.displayPageIndex===a&&(c=-1);this.pages[a]||this.callCreatePage(a);-1!=c&&!this.pages[c]&&this.callCreatePage(c);for(var b in this.pages)if(!(b===""+a||-1!==c&&b===""+c)){var e=this.pages[b];this.removeSubElement(e);
this.callDeletePage(e);delete this.pages[b]}this.updateFocusedPage()};a.ui.PageSlider.prototype.updateDisplayPageFromScroll=function(){this.setDisplayPage(-this.contentOffset.x/this.size.x,!1)};a.ui.PageSlider.prototype.updateSelf=function(d){a.ui.PageSlider.prototype.parentPrototype.updateSelf.call(this,d);if(this.isFlung()){var c=this.flingVelocity.x/this.size.x,b=-this.grabOffset.x/this.size.x+0.5|0,e=-1,f=4;this.flingHard&&(f=1);0<c&&c<1*f/this.config.animTime?(e=this.displayPageIndex|0,e===b&&
(e=b-1)):0>c&&c>-1*f/this.config.animTime&&(e=this.displayPageIndex+0.5+0.05|0,e===b&&(e=b+1));-1<e&&(this.setPageIndex(e,!0),this.quickSettleToPage(),this.flingVelocity.x=this.flingVelocity.y=0)}this.pageAnim&&(this.pageAnim.time+=d,this.pageAnim.time>=this.pageAnim.totalTime?(this.setDisplayPage(this.pageIndex,this.pageAnim),this.pageAnim=null):(d=a.ui.Animator.filterEaseOut(this.pageAnim.time/this.pageAnim.totalTime),this.setDisplayPage(a.utils.interpolate(this.pageAnim.source,this.pageAnim.dest,
d),this.pageAnim)),this.contentOffset.x=-this.displayPageIndex*this.size.x,this.viewChanged())};a.ui.PageSlider.prototype.updateFocusedPage=function(){if(this.visiblePageChangedFunc){var a=this.displayPageIndex+0.5|0;this.lastFocusedPage!==a&&(this.lastFocusedPage=a,this.visiblePageChangedFunc(a,{container:this,size:this.size},this.userData))}};a.ui.PageSlider.editProperties=[{label:"page slider",props:[{propName:"orientation",type:"string",defValue:"horizontal"},{propName:"pageCount",type:"integer",
defValue:"10"},{propName:"startingPage",type:"integer",defValue:"0"}]}];a.ui.PageSlider.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.PageSlider,d,c,b)}});
rat.modules.add("rat.storage.r_storage_firebase",[{name:"rat.storage.r_storage",processBefore:!0},"rat.debug.r_console"],function(a){a.FirebaseStorage=function(d,c){a.FirebaseStorage.prototype.parentConstructor.call(this,c);this.ref=null;if("undefined"!==typeof Firebase){var b=d;c&&""!==c&&(b+="/"+c);this.ref=new Firebase(b)}if(this.ref){var e=this;this.data=void 0;this.ref.once("value",function(a){e.data=a.val();e._fireOnReady()})}else a.console.log("WARNING!  Attempting to use Firebase storage without Firebase")};
a.utils.inheritClassFrom(a.FirebaseStorage,a.BasicStorage);a.FirebaseStorage.prototype._internalSetItem=function(a,c){if(this.ref){var b=this.ref;a&&""!==a&&(b=b.child(a));b.set(c)}};a.FirebaseStorage.prototype._internalGetItem=function(a){return!this.hasData()?null:a&&""!==a?this.data[a]:this.data};a.FirebaseStorage.prototype.remove=function(a){var c=this.ref;a&&""!==a&&(c=c.child(a));c.remove();this.data=null};a.FirebaseStorage.prototype.hasData=function(){return"undefined"===typeof this.data?!1:
!0}});
rat.modules.add("rat.os.r_kong",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.os.r_user_kong",processBefore:!0},{name:"rat.utils.r_timer",processBefore:!0},"rat.debug.r_console"],function(a){a.system.kong=a.system.kong||{};var d=a.system.kong;d.init=function(){d.fake=!0;d.status="init";"undefined"===typeof kongregateAPI?(a.console.log("Kong: kong module included, but no kongregateAPI available..."),a.console.log("remember to add kongregate API to html file")):window!==window.top&&(a.console.log("Kong: Initializing API..."),d.status=
"pending",kongregateAPI.loadAPI(function(){d.kongregate=kongregateAPI.getAPI();d.fake=!1;d.status="ready";a.console.log("kong API ready.");a.user.init(d);a.ads&&a.ads.enableKong&&a.ads.enableKong();a.license&&a.license.enableKong&&a.license.enableKong();a.events.queueEvent("platformReady","kong",null);d.focus()}));d.fake&&"init"===d.status&&(d.kongregate=null,d.fake=!0,d.status="pending",a.console.log("Kong: Faking it..."),(new a.timer(function(){a.console.log("Delayed kong fake init");d.status="ready";
a.user.init(d)},0.2,null)).autoUpdate())};d.isReady=function(){return"ready"===d.status?!0:!1};d.getUserId=function(){return d.kongregate?d.kongregate.services.getUserId():-1};d.focus=function(){"undefined"!==typeof kongregateAPI&&d.kongregate&&(window.top&&window.top.focus(),window.focus(),a.graphics.canvas.focus())}});
rat.modules.add("rat.os.r_license",[{name:"rat.os.r_user",processBefore:!0},{name:"rat.os.r_system",processBefore:!0},{name:"rat.os.r_events",processBefore:!0},{name:"rat.utils.r_timer",processBefore:!0},{name:"rat.os.r_license_winjs",platform:"winJS"},"rat.debug.r_console"],function(a){var d={osIsLicensed:!1,forceLicenseTo:void 0};a.license=d;a.License=d;var c=[{identifier:"frogbuddy",name:"Frog Buddy",description:"A frog buddy that will be your best friend forever",uses:0},{identifier:"acorn1",
name:"Acorn",description:"A consumable acorn",uses:1}],b=[],e=1;d.isOwned=function(){return void 0!==d.forceLicenseTo?d.forceLicenseTo:d.osIsLicensed};var f=!1;d.onLicenseChange=function(){var b=d.isOwned();f!==b&&(a.events.fire("licenseChanged",b,f),f=b)};d.forceLicenseState=function(a){d.forceLicenseTo=a;d.onLicenseChange()};d.unforceLicenseState=function(){d.forceLicenseState(void 0)};d.launchPurchaseUI=function(b){b=b||a.user.getActiveUserID();d._OSPurchaseUI(b)};d.purchaseItem=function(d,f,j){(new a.timer(function(){for(var k=
0;k<c.length;k++)if(c[k].identifier===d[0]){b.push({id:e++,identifier:c[k].identifier,data:f,remaining_uses:c[k].uses});a.console.log("rat.license: fake purchase succeeded");j({success:!0});return}a.console.log("rat.license: fake purchase failed");j({success:!1})},0.2,null)).autoUpdate()};d.getUserItemList=function(c,d){(new a.timer(function(){a.console.log("rat.license: delayed fake item list callback");d({success:!0,data:b})},0.2,null)).autoUpdate()};d.consumeItem=function(c,d){(new a.timer(function(){for(var e=
0;e<b.length;e++)if(b[e].id===c){a.console.log("rat.license: delayed fake item consume "+c);0==b[e].remaining_uses?d({success:!1}):(b[e].remaining_uses--,0>=b[e].remaining_uses&&b.splice(e,1));d({success:!0,id:c});return}d({success:!1})},0.2,null)).autoUpdate()};d.consumeItemType=function(b,c,e){1<c?a.console.log("rat.license: error: consumeItemType doesn't support count other than 1"):d.getUserItemList(null,function(a){if(a.success)for(var c=0;c<a.data.length;c++)if(a.data[c].identifier===b){d.consumeItem(a.data[c].id,
e);return}e({success:!1})})};d._OSPurchaseUI=function(){function b(){d.osIsLicensed=!0;d.onLicenseChange()}if(window.confirm)!0==window.confirm("Buy the game?")&&b();else if(a.system.has.winJS){var c=new Windows.UI.Popups.MessageDialog("Buy the game?"),e=new Windows.UI.Popups.UICommand("Yes",b);e.Id=0;c.commands.append(e);e=new Windows.UI.Popups.UICommand("No",function(){});e.Id=1;c.commands.append(e);c.defaultCommandIndex=0;c.cancelCommandIndex=1;c.showAsync()}}});
rat.modules.add("rat.os.r_license_kong",[{name:"rat.os.r_license",processBefore:!0},{name:"rat.os.r_kong"}],function(a){var d=a.license,c=!1;d.enableKong=function(){if(!c&&(a.console.log("rat.license: see if we can enable kong"),"undefined"!==typeof kongregateAPI)){var b=a.system.kong;b&&(b.kongregate&&b.kongregate.mtx)&&(a.console.log("rat.license: Enabling Kong!"),c=!0,d._OSPurchaseUI=function(){a.system.kong.kongregate.mtx.showKredPurchaseDialog("offers")},d.purchaseItem=function(b,c,d){a.console.log("L purchaseItem");
a.system.kong.kongregate.mtx.purchaseItems(b,d)},d.getUserItemList=function(b,c){a.console.log("L getUserItemList");a.system.kong.kongregate.mtx.requestUserItemList(b,c)},d.consumeItem=function(b,c){a.console.log("L consumeItem");a.system.kong.kongregate.mtx.useItemInstance(b,c)})}}});
rat.modules.add("rat.os.r_ads",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.os.r_events",processBefore:!0},{name:"rat.utils.r_messenger",processBefore:!0},{name:"rat.utils.r_timer",processBefore:!0},"rat.debug.r_console"],function(a){var d={adPlaying:!1,curAdInfo:null,curAdTimer:null};a.ads=d;a.ads.messages=new a.Messenger;a.ads.messageType={AdsAvailable:"adsAvailable",AdsUnavailable:"adsUnavailable",AdOpened:"adOpened",AdCompleted:"adCompleted",AdAbandoned:"adAbandoned"};d.adsAvailable=
function(){return!0};d.onAdCompleted=function(c){d.adPlaying=!1;d.curAdInfo=null;d.curAdTimer=null;a.ads.messages.broadcast("adCompleted",c)};d.onAdAbandoned=function(c){d.adPlaying=!1;d.curAdTimer&&d.curAdTimer.endAutoUpdate();d.curAdInfo=null;d.curAdTimer=null;a.ads.messages.broadcast("adAbandoned",c)};d.getAdPlaying=function(){return d.adPlaying?(d.curAdInfo.time=d.curAdTimer?d.curAdTimer.currentTime:0,d.curAdInfo):null};d.openAd=function(){d.adPlaying=!0;d.curAdInfo={id:0};a.console.log("fake ad: start");
var c=new a.timer(function(){a.console.log("fake ad: complete.");d.onAdCompleted(d.curAdInfo)},2,null);c.autoUpdate();d.curAdTimer=c;return d.curAdInfo};d.abandonAd=function(){if(d.adPlaying&&d.curAdInfo)d.onAdAbandoned(d.curAdInfo)};d.renderFrame=function(){}});
rat.modules.add("rat.os.r_ads_kong",[{name:"rat.os.r_ads",processBefore:!0},{name:"rat.os.r_kong"},"rat.debug.r_console"],function(a){a.ads=a.ads||{};var d=a.ads,c=!1;d.enableKong=function(){if(!c&&(a.console.log("rat.ads: see if we can enable kong"),"undefined"!==typeof kongregateAPI)){var b=a.system.kong;if(b&&b.kongregate&&b.kongregate.mtx){a.console.log("rat.ads: Enabling Kong!");c=!0;d.adsAreAvailable=!1;var e=b.kongregate.mtx;e.addEventListener("adsAvailable",function(){d.adsAreAvailable=!0});
e.addEventListener("adsUnavailable",function(){d.adsAreAvailable=!1});e.addEventListener("adOpened",function(){d.adPlaying=!0});e.addEventListener("adCompleted",function(){d.onAdCompleted(d.curAdInfo)});e.addEventListener("adAbandoned",function(){d.onAdAbandoned(d.curAdInfo)});d.adsAvailable=function(){return d.adsAreAvailable};d.openAd=function(){a.console.log("kong ad: openAd");d.curAdInfo={id:0};e.showIncentivizedAd();return d.curAdInfo};e.initializeIncentivizedAds()}}}});
rat.modules.add("rat.graphics.r_color",[{name:"rat.graphics.r_graphics",processBefore:!0}],function(a){function d(a,c,d){a=(a%1+1)%1;1<c&&(c=1);1<d&&(d=1);var g=6*a|0,h=6*a-g;a=d*(1-c);var j=d*(1-c*h);c=d*(1-c*(1-h));switch(g){case 0:return[d,c,a];case 1:return[j,d,a];case 2:return[a,d,c];case 3:return[a,j,d];case 4:return[c,a,d];case 5:return[d,a,j]}}var c=a.math;a.graphics.Color=function(b,c,d,g){"undefined"===typeof b?(this.b=this.g=this.r=255,this.a=1):"string"===typeof b?this.copyFrom(a.graphics.Color.makeFromStyleString(b)):
(void 0!==b.r?(this.r=b.r,this.g=b.g,this.b=b.b,this.a=void 0===b.a?1:b.a):(this.r=b,this.g=c,this.b=d,this.a=void 0===g?1:g),this.applyLimits())};a.graphics.Color.prototype.mult=function(b,c,d,g,h){void 0!==b.r&&(h=c,g=b.a,d=b.b,c=b.g,b=b.r);b=this.r*(b/255);c=this.g*(c/255);d=this.b*(d/255);g*=this.a;h?h.set(b,c,d,g):h=new a.graphics.Color(b,c,d,g);h.applyLimits();return h};a.graphics.Color.prototype.scale=function(a){this.r*=a;this.g*=a;this.b*=a;this.applyLimits()};a.graphics.Color.prototype.applyLimits=
function(){this.r=0>this.r?0:255<this.r?255:this.r|0;this.g=0>this.g?0:255<this.g?255:this.g|0;this.b=0>this.b?0:255<this.b?255:this.b|0;0>this.a?this.a=0:1<this.a&&(this.a=1)};a.graphics.Color.prototype.toString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};a.graphics.Color.prototype.setWhite=function(){this.b=this.g=this.r=255;this.a=1};a.graphics.Color.prototype.setRandom=function(a){a||(a=c);this.r=(200*a.random()|0)+54;this.g=(200*a.random()|0)+54;this.b=(200*a.random()|
0)+54;this.a=1};a.graphics.Color.randomColor=function(b){var c=new a.graphics.Color;c.setRandom(b);return c};a.graphics.Color.prototype.copy=function(){return new a.graphics.Color(this.r,this.g,this.b,this.a)};a.graphics.Color.prototype.set=function(a,c,d,g){void 0===g&&(g=1);this.r=a;this.g=c;this.b=d;this.a=g};a.graphics.Color.prototype.copyFrom=function(a){this.set(a.r,a.g,a.b,a.a)};a.graphics.Color.prototype.equal=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a?!0:!1};
a.graphics.Color.prototype.distanceSq=function(a){var c=this.r-a.r,d=this.g-a.g;a=this.b-a.b;return c*c+d*d+a*a};a.graphics.Color.prototype.luminance=function(){return 0.2126*this.r/255+0.7152*this.g/255+0.0722*this.b/255};a.graphics.Color.luminanceRGB=function(a,c,d){return 0.2126*a/255+0.7152*c/255+0.0722*d/255};a.graphics.Color.prototype.luminancePerceived=function(){return 0.299*this.r/255+0.587*this.g/255+0.114*this.b/255};a.graphics.Color.luminancePerceivedRGB=function(a,c,d){return 0.299*a/
255+0.587*c/255+0.114*d/255};a.graphics.Color.prototype.luminancePerceived2=function(){return Math.sqrt(0.299*this.r*this.r/65025+0.587*this.g*this.g/65025+0.114*this.b*this.b/65025)};a.graphics.Color.prototype.matchLuminanceTo=function(a){a=a.luminancePerceived();for(var c=0;20>c;c++){var d=this.luminancePerceived();0>a-d?(this.r-=10,this.g-=10,this.b-=10):(this.r+=10,this.g+=10,this.b+=10);this.applyLimits()}};a.graphics.Color.interp=function(b,c,d,g){var h=1-d,j=c.r*d+h*b.r,k=c.g*d+h*b.g,l=c.b*
d+h*b.b;b=c.a*d+h*b.a;j=0>j?0:255<j?255:j|0;k=0>k?0:255<k?255:k|0;l=0>l?0:255<l?255:l|0;b=0>b?0:1<b?1:b;g?(g.r=j,g.g=k,g.b=l,g.a=b):g=new a.graphics.Color(j,k,l,b);return g};a.graphics.Color.prototype.randomVariance=function(b,d){var f=this.r,g=this.g,h=this.b,j=this.a;b.r&&(f+=2*b.r*c.random()-b.r,f=0>f?0:255<f?255:f|0);b.g&&(g+=2*b.g*c.random()-b.g,g=0>g?0:255<g?255:g|0);b.b&&(h+=2*b.b*c.random()-b.b,h=0>h?0:255<h?255:h|0);b.a&&(j+=2*b.a*c.random()-b.a,j=0>j?0:1<j?1:j);d?(d.r=f,d.g=g,d.b=h,d.a=
j):d=new a.graphics.Color(f,g,h,j);return d};a.graphics.makeColorFromHSV=function(b,c,f){b=d(b,c,f);b=new a.graphics.Color(255*b[0],255*b[1],255*b[2]);b.applyLimits();return b};a.graphics.transparent=new a.graphics.Color(0,0,0,0);a.graphics.black=new a.graphics.Color(0,0,0);a.graphics.white=new a.graphics.Color(255,255,255);a.graphics.gray=new a.graphics.Color(128,128,128);a.graphics.lightGray=new a.graphics.Color(190,190,190);a.graphics.darkGray=new a.graphics.Color(64,64,64);a.graphics.red=new a.graphics.Color(255,
0,0);a.graphics.green=new a.graphics.Color(0,255,0);a.graphics.blue=new a.graphics.Color(0,0,255);a.graphics.yellow=new a.graphics.Color(255,255,0);a.graphics.cyan=new a.graphics.Color(0,255,255);a.graphics.violet=new a.graphics.Color(255,0,255);a.graphics.magenta=a.graphics.violet;a.graphics.lightRed=new a.graphics.Color(255,128,128);a.graphics.darkRed=new a.graphics.Color(128,0,0);a.graphics.lightGreen=new a.graphics.Color(128,255,128);a.graphics.darkGreen=new a.graphics.Color(0,128,0);a.graphics.lightBlue=
new a.graphics.Color(128,128,256);a.graphics.darkBlue=new a.graphics.Color(0,0,128);a.graphics.darkYellow=new a.graphics.Color(128,128,0);a.graphics.darkCyan=new a.graphics.Color(0,128,128);a.graphics.darkViolet=new a.graphics.Color(128,0,128);a.graphics.darkMagenta=a.graphics.darkViolet;a.graphics.lightYellow=new a.graphics.Color(255,255,128);a.graphics.lightCyan=new a.graphics.Color(128,255,255);a.graphics.lightViolet=new a.graphics.Color(255,128,255);a.graphics.lightMagenta=a.graphics.lightViolet;
a.graphics.orange=new a.graphics.Color(255,128,0);a.graphics.brown=new a.graphics.Color(128,96,0);a.graphics.darkBrown=new a.graphics.Color(96,64,0);a.graphics.Color.makeFromStyleString=function(b){var c,d,g;c=d=g=255;var h=1;if("rgb"===b.substring(0,3)){var j=b.indexOf("(");j&&(b=b.substring(j+1),g=b.indexOf(","),c=parseInt(b.substring(0,g),10),b=b.substring(g+1),g=b.indexOf(","),d=parseInt(b.substring(0,g),10),b=b.substring(g+1),g=b.indexOf(","),0>g?g=b.indexOf(")"):h=parseFloat(b.substring(g+1)),
g=parseInt(b.substring(0,g),10))}else{if(a.graphics.Color.isStandard(b))return a.graphics.Color.standard(b);"#"===b.charAt(0)&&(b=b.substring(1,7));c=parseInt(b.substring(0,2),16);d=parseInt(b.substring(2,4),16);g=parseInt(b.substring(4,6),16)}return new a.graphics.Color(c,d,g,h)};a.graphics.Color.makeFromHexString=a.graphics.Color.makeFromStyleString;a.graphics.Color.standardColorTable={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",
bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",
darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",
ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",
mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",
papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",
violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};a.graphics.Color.isStandard=function(b){b=b.toLowerCase();var c=a.graphics.Color.standardColorTable;return c[b]?c[b]:null};a.graphics.Color.standard=function(b){var c=a.graphics.Color.standardColorTable;b=b.toLowerCase();return c[b]?a.graphics.Color.makeFromHexString(c[b]):a.graphics.gray};a.graphics.fixColorStyle=function(a){return"string"===typeof a&&"0"<=a.charAt(0)&&"9">=a.charAt(0)?"#"+
a:a}});
rat.modules.add("rat.input.r_voice",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.input.r_voice_xbo",platform:"xbox"}],function(a){a.voice={commands:{Play:"play",Pause:"pause",Stop:"stop",Record:"record",FastForward:"fastForward",Rewind:"rewind",Next:"next",Previous:"previous",ChannelUp:"channelUp",ChannelDown:"channelDown",Back:"back",View:"view",Menu:"menu"},callbacks:{},enabled:{}};var d=void 0;a.voice.registerCB=function(c,b,d){(c=a.voice.callbacks[c])&&c.push({func:b,ctx:d})};a.voice.unregisterCB=
function(c,b,e){if(c=a.voice.callbacks[c])for(var f,g=0;g!==c.length;++g)if(f=c[g],f.func===b&&f.ctx===e){d&&d.index>=g&&--d.index;c.splice(g,1);break}};a.voice.fireCB=function(c,b){var e=a.voice.callbacks[c];if(e){var f=d;d={index:0};var g=!1,h;for(d.index=0;d.index!==e.length&&!(g=e[d.index].func,h=e[d.index].ctx,g=g.call(h,c));++d.index);d=f;!g&&a.input&&(e=new a.input.Event(b,{type:"voice",defaultControllerID:"voice",which:c}),a.input.dispatchEvent(e));return g}};a.voice.enableCommand=function(c,
b){b=void 0===b?!0:!!b;a.voice.enabled[c]=b;a.voice._internalEnabledCommand&&a.voice._internalEnabledCommand(c,b)};a.voice.resetCommands=function(){for(var c in a.voice.commands)a.voice.callbacks[a.voice.commands[c]]=[],a.voice.enableCommand(a.voice.commands[c],!1)}});
rat.modules.add("rat.utils.r_messenger",[],function(a){a.Messenger=function(){this.handlers=[]};a.Messenger.remove="REMOVE";a.Messenger.prototype.broadcast=function(d){var c=this.handlers[d];if(c){var b=[],e;Array.prototype.splice.call(arguments,0,1);for(e in c)if(c.hasOwnProperty(e)){var f=c[e];f.apply(this,arguments)===a.Messenger.remove&&b.push(f)}for(e=0;e!==b.length;++e)this.stopListening(d,b[e])}};a.Messenger.prototype.listen=function(a,c){"function"===typeof c&&(this.handlers[a]=this.handlers[a]||
[],-1===this.handlers[a].indexOf(c)&&this.handlers[a].push(c))};a.Messenger.prototype.stopListening=function(a,c){if("function"===typeof c){var b=this.handlers[a].indexOf(c);-1!==b&&this.handlers[a].splice(b,1)}}});
rat.modules.add("rat.input.r_inputmap",["rat.input.r_input"],function(a){a.InputMap=function(a,c){this.events={};this.map=a;this.index=(!c||0===c)&&this.checkBounds(c)&&this.map[c]?this.defaultIndex=c:this.defaultIndex=-1;this.validateMap();0<=this.index&&this.focusButton(this.index,!0)};a.InputMap.prototype.setOnChange=function(a){this.events.onChange=a};a.InputMap.prototype.validateMap=function(){for(var a,c=0;c<this.map.length;++c){var b=this.map[c],e=["up","left","right","down","select"];for(a=
0;a<e.length;a++){var f=b[e[a]];if(f){for(var g=null,h=0;h<this.map.length;++h)this.map[h].currObj===f&&(g=f);g||(b[e[a]]=null)}}}};a.InputMap.prototype.handleKeyDown=function(d){switch(d){case a.keys.leftArrow:d="left";break;case a.keys.upArrow:d="up";break;case a.keys.rightArrow:d="right";break;case a.keys.downArrow:d="down";break;case a.keys.enter:d="select";break;default:return}return this.handleDirection(d)};a.InputMap.prototype.handleDirection=function(a){if(this.checkBounds(this.index)){var c=
this.map[this.index];if("select"===a)this.doPress(this.map[this.index].currObj);else{if(c&&c[a]&&c.currObj!==c[a]){var b;a=c[a];for(c=0;c<this.map.length;++c)this.map[c].currObj===a&&(b=c);this.focusButton(b);return!0}if(c&&(this.doFocus(c.currObj),c.currObj.handleDirection&&c.currObj.handleDirection(a)))return!0}}else if(-1===this.index&&(-1===this.defaultIndex&&0<this.map.length?this.index=0:this.checkBounds(this.defaultIndex)&&(this.index=this.defaultIndex),this.checkBounds(this.index)))return this.doFocus(this.map[this.index].currObj),
!0;return!1};a.InputMap.prototype.handleTab=function(a){var c=1;a.sysEvent.shiftKey&&(c=-1);if(this.checkBounds(this.index)){var b=this.map[this.index],e=0;if(void 0!==b.tabOrder){newOrder=b.tabOrder+c;0>newOrder?newOrder=this.map.length-1:newOrder>this.map.length-1&&(newOrder=0);for(c=0;c<this.map.length;++c)if(this.map[c].tabOrder===newOrder){e=c;break}}else e=this.index+c,0>e?e=this.map.length-1:e>this.map.length-1&&(e=0);this.focusButton(e);this.index===e&&(e=this.map[e].currObj,e.handleTabbedTo&&
e.handleTabbedTo(a));return!0}return!1};a.InputMap.prototype.doFocus=function(a){return a.Focus?a.Focus():a.focus?a.focus():!1};a.InputMap.prototype.doBlur=function(a){return a.Blur?a.Blur():a.blur?a.blur():!1};a.InputMap.prototype.doPress=function(a){return a.Press?a.Press():a.press?a.press():!1};a.InputMap.prototype.getButtonCount=function(){return this.map.length};a.InputMap.prototype.getButton=function(a){return this.checkBounds(a)?this.map[a].currObj:null};a.InputMap.prototype.getCurrIndexButton=
function(){return this.checkBounds(this.index)?this.map[this.index].currObj:null};a.InputMap.prototype.getCurrentFocusedButton=a.InputMap.prototype.getCurrIndexButton;a.InputMap.prototype.getTarget=a.InputMap.prototype.getCurrIndexButton;a.InputMap.prototype.getTargetForEvent=function(){return this.getTarget()};a.InputMap.prototype.getIndexByButton=function(a){for(var c=0;c<this.map.length;++c)if(this.map[c].currObj===a)return c;return null};a.InputMap.prototype.focusButton=function(a,c){var b=this.index;
if(a===this.index)if(c)b=-1;else return;if(this.checkBounds(a)&&this.map[a]&&(this.doFocus(this.map[a].currObj)&&this.checkBounds(b)&&this.map[b]&&this.doBlur(this.map[b].currObj),this.index=a,this.events.onChange))this.events.onChange(this.map[a].currObj,this.map[b]?this.map[b].currObj:void 0)};a.InputMap.prototype.focusByButton=function(a,c){var b=this.getIndexByButton(a);null!==typeof b&&this.focusButton(b,c)};a.InputMap.prototype.clearIndex=function(){this.index=-1};a.InputMap.prototype.reset=
function(){this.index!==this.defaultIndex&&(this.checkBounds(this.index)&&this.doBlur(this.map[this.index].currObj),this.checkBounds(this.defaultIndex)&&this.doFocus(this.map[this.defaultIndex].currObj),this.index=this.defaultIndex)};a.InputMap.prototype.checkBounds=function(a){return 0<=a&&a<this.map.length?!0:!1};a.InputMap.prototype.dumpList=function(){a.console.log("inputmap: "+this.map.length+" elements:");for(var d=0;d<this.map.length;++d){var c=this.map[d].currObj;a.console.log(""+d+" : "+
(c.name||"(no name)")+" "+("type: "+(c.elementType||"?")))}}});
rat.modules.add("rat.ui.r_ui_bubblebox",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.math.r_vector","rat.graphics.r_image","rat.debug.r_console","rat.graphics.r_graphics"],function(a){a.ui.BubbleBox_TILE=0;a.ui.BubbleBox_STRETCH=1;a.ui.BubbleBox_defaultDrawType=a.ui.BubbleBox_TILE;a.ui.BubbleBox=function(d,c){a.ui.BubbleBox.prototype.parentConstructor.call(this);this.blockSize=new a.Vector(4,4);this.resource=d;if(void 0!==d){this.imageRef=new a.graphics.ImageRef(d);
var b=this;this.imageRef.setOnLoad(function(a){b.updateWithNewImageSize(a.width,a.height)})}this.name="<bbl>"+d+this.id;this.drawType=c?c:a.ui.BubbleBox_defaultDrawType};a.utils.inheritClassFrom(a.ui.BubbleBox,a.ui.Element);a.ui.BubbleBox.prototype.elementType="bubbleBox";a.ui.BubbleBox.prototype.updateWithNewImageSize=function(d,c){var b=4;d/3===a.math.floor(d/3)&&(b=3);this.blockSize=new a.Vector(d/b,c/b);this.blockRows=3;c===d/b&&(this.blockRows=1,this.blockSize.y=image.height);this.setDirty(!0)};
a.ui.BubbleBox.prototype.useImageRef=function(a){this.imageRef=a;a=this.imageRef.getFrameSize(0);this.updateWithNewImageSize(a.w,a.h);this.setDirty(!0)};a.ui.BubbleBox.prototype.updateSelf=function(d){a.ui.Sprite.prototype.updateSelf.call(this,d)};a.ui.BubbleBox.prototype.drawSelf=function(){function d(a,b,c,d){m=d;if(0===a)return 0;if(a>=b-1)return 1<b&&2>b&&(m=(b-c)*d),2*d+(d-m);a>=c-1&&(m=(b-c)*d);return d}var c=a.graphics.getContext();if(void 0!==this.imageRef){var b=this.imageRef.getImage();
if(null!==b){var e=!1,f=a.math.floor(this.size.x),g=a.math.floor(this.size.y);if(this.flags&a.ui.Element.adjustForScaleFlag&&(1!==a.graphics.mTransform.m[0][0]||1!==a.graphics.mTransform.m[1][1])){var e=!0,h=a.graphics.transformPoint({x:0,y:0}),j=a.graphics.transformPoint({x:this.size.x,y:this.size.y});a.graphics.save();c.setTransform(1,0,0,1,0,0);f=a.math.floor(j.x-h.x);g=a.math.floor(j.y-h.y);h.x=a.math.floor(h.x);h.y=a.math.floor(h.y);c.translate(h.x,h.y);1===this.blockRows&&(c.scale(1,g/this.size.y),
g=this.size.y)}h=g/this.blockSize.y;1===this.blockRows&&(h=1);var j=a.math.floor(h),k=f/this.blockSize.x,l=a.math.floor(k),m=0,n=0,p=0,q=0,r,s;if(this.drawType===a.ui.BubbleBox_TILE)for(f=0;f<h;f++){q=d(f,h,j,this.blockSize.y);s=m;for(var t=g=0;t<k;t++)p=d(t,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,g-this.center.x,n-this.center.y,r,s),g+=r;n+=s}else this.drawType===a.ui.BubbleBox_STRETCH&&(n=f-this.center.x,t=g-this.center.y,q=d(0,h,j,this.blockSize.y),s=m,p=d(0,k,l,this.blockSize.x),r=m,c.drawImage(b,
p,q,r,s,-this.center.x,-this.center.y,r,s),q=d(0,h,j,this.blockSize.y),s=m,p=d(l,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,n-r,-this.center.y,r,s),q=d(j,h,j,this.blockSize.y),s=m,p=d(0,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,-this.center.x,t-s,r,s),q=d(j,h,j,this.blockSize.y),s=m,p=d(l,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,n-r,t-s,r,s),2<k&&(q=d(0,h,j,this.blockSize.y),s=m,p=d(1,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,r-this.center.x,-this.center.y,f-2*r,s),q=d(j,h,
j,this.blockSize.y),s=m,p=d(1,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,r-this.center.x,t-s,f-2*r,s)),2<h&&(q=d(1,h,j,this.blockSize.y),s=m,p=d(0,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,-this.center.x,s-this.center.y,r,g-2*s),q=d(1,h,j,this.blockSize.y),s=m,p=d(l,k,l,this.blockSize.x),r=m,c.drawImage(b,p,q,r,s,n-r,s-this.center.y,r,g-2*s)),2<h&&2<k&&(q=d(1,h,j,this.blockSize.y),s=m,p=d(1,k,l,this.blockSize.x),r=m,2<h&&2<k&&c.drawImage(b,p,q,r,s,r-this.center.x,s-this.center.y,f-2*r,
g-2*s)));e&&a.graphics.restore()}}};a.ui.BubbleBox_setDefaultDrawType=function(d){a.ui.BubbleBox_defaultDrawType=d===a.ui.BubbleBox_STRETCH?a.ui.BubbleBox_STRETCH:a.ui.BubbleBox_TILE}});
rat.modules.add("rat.ui.r_ui_data",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.debug.r_console","rat.utils.r_shapes"],function(a){function d(a,c){void 0!==a.val&&(a.percent&&(a.val*=c),a.fromParent&&(a.val+=c),a=a.val);return a}function c(a,c,d){void 0===a.val&&(a={val:a});a.percent&&(a.val*=c);if(a.fromCenter)a.val+=c/2;else if(a.fromParentEdge||a.fromParentFarEdge)a.val=c-a.val;if(a.centered||a.drawCentered||a.center)a.val-=d/2;else if(a.fromMyEdge||a.fromMyFarEdge)a.val-=
d;return a=a.val}a.ui.data={};a.ui.data.inDesignTime=!1;a.ui.data.calcBounds=function(b,e){var f=a.utils.copyObject(b.bounds||{},!0);f.x=f.x||0;f.y=f.y||0;f.w=f.w||0;f.h=f.h||0;if(f.noChange)return void 0!==f.x.val&&(f.x.val=f.x.val),void 0!==f.y.val&&(f.y.val=f.y.val),void 0!==f.w.val&&(f.w.val=f.w.val),void 0!==f.h.val&&(f.h.val=f.h.val),f;if(f.autoFill)return{x:0,y:0,w:e.w,h:e.h};f.w=d(f.w,e.w);f.h=d(f.h,e.h);f.x=c(f.x,e.w,f.w);f.y=c(f.y,e.h,f.h);return f};a.ui.data.getSetupCallsForType=function(b){"Container"===
b&&(b="Element");a.ui[b]||(a.console.log("WARNING! Unknown pane type '"+b+"' hit in createPaneFromData.  Falling back to Element."),b="Element");var c=a.ui[b];c||(a.console.log("WARNING! Unable to find createFromData for element of type "+b+".  Reverting to rat.ui.Element.createFromData"),c=a.ui.Element);for(var d=c;d&&!d.setupFromData;)d=d.prototype?d.prototype.parentConstructor:void 0;d||(a.console.log("WARNING! Unable to find createFromData for element of type "+b+".  Reverting to rat.ui.Element.createFromData"),
d=a.ui.Element);return{paneType:b,elementClass:c,setupClass:d}};a.ui.data.createPaneFromData=function(b,c){if(b._editor&&b._editor.designTimeOnly)return null;var d;d=c?c.getBounds():{x:0,y:0,w:0,h:0};var g=a.ui.data.getSetupCallsForType(b.type),h=new g.elementClass;g.setupClass.setupFromData&&g.setupClass.setupFromData(h,b,d);a.ui.data.createChildrenFromData(h,b.children);if(b.onCreate)b.onCreate(h);return h};a.ui.data.createChildrenFromData=function(b,c){if(b&&c)for(var d=0;d!==c.length;++d){var g=
a.ui.data.createPaneFromData(c[d],b);g&&b.appendSubElement(g)}};a.ui.data.callParentSetupFromData=function(a,c,d,g){do a&&(a=a.prototype?a.prototype.parentConstructor:void 0);while(a&&!a.setupFromData);a&&a.setupFromData(c,d,g)};a.ui.data.createTreeFromData=function(b,c){return a.ui.data.createPaneFromData(b,{getBounds:function(){return c?c:new a.shapes.Rect(0,0,a.graphics.SCREEN_WIDTH,a.graphics.SCREEN_HEIGHT)}})};a.ui.data.preLoadAssetsFromData=function(b){var c=[],d=function(a){if(!("object"!==
typeof a||null===a))for(var b in a){var j=a[b];if(void 0!==j&&a.hasOwnProperty(b))if("string"===typeof j){var k=j.substring(j.length-4).toLowerCase();(".png"===k||".jpg"===k||".gif"===k||".svg"===k||".bmp"===k||".ico"===k)&&c.push(j)}else"object"===typeof j&&d(j)}};0<c.length&&a.graphics.preLoadImages(c);d(b)}});
rat.modules.add("rat.utils.r_wordwrap",["rat.debug.r_console"],function(a){a.wordwrap={isWhitespace:function(a){return" "===a||"\t"===a||"\n"===a||"\r"===a||a===String.fromCharCode(12288)},skipWhitespaceAhead:function(d,c){for(;c<d.length&&a.wordwrap.isWhitespace(d.charAt(c));c++);return c},isAlphabetic:function(a){return 4096>a},isTwoPartPunctuation:function(a){return"?"===a||"!"===a||";"===a||":"===a},canBreakBetween:function(d,c){var b=d.charCodeAt(0),e=c.charCodeAt(0),f=!1;if(!a.wordwrap.isAlphabetic(b)||
!a.wordwrap.isAlphabetic(e))f=!0;if(a.wordwrap.isWhitespace(c)||"-"===d)f=!0;if(a.wordwrap.isNonBeginningChar(e)||a.wordwrap.isNonEndingChar(b))f=!1;return f},wrapString:function(d,c,b){for(var e=[],f=0,g=0,h=0,j=0;j<d.length;j++)if("\n"===d[j])e.push(d.substring(f,j)),g=h=f=j+1;else{var k=d.substring(f,j+1),k=b.measureText(k);if((k.width||k)>=c)g===f&&(a.console.logOnce("bad textwrap at "+j),g=h=j),e.push(d.substring(f,g)),f=g=h;if(j===d.length-1||a.wordwrap.canBreakBetween(d.charAt(j),d.charAt(j+
1)))g=j+1,h=a.wordwrap.skipWhitespaceAhead(d,j+1)}f!==d.length&&e.push(d.substring(f,d.length));return e},isNonBeginningChar:function(a){return 69===a||160===a||65292===a||65294===a||65306===a||65072===a||65104===a||183===a||65110===a||65373===a||12303===a||65116===a||8221===a||58===a||93===a||8226===a||8231===a||8230===a||65105===a||65108===a||65111===a||12305===a||12301===a||65118===a||12318===a||59===a||125===a||65307===a||65281===a||65106===a||65109===a||12309===a||12297===a||65114===a||8217===
a||8242===a||37===a||176===a||8243===a||8451===a||12299===a||65285===a||65341===a||65504===a||8211===a||8212===a||65377===a||65380===a||12387===a||12419===a||12421===a||12423===a||12483===a||12515===a||12517===a||12519===a||12353===a||12355===a||12357===a||12359===a||12361===a||12430===a||12449===a||12451===a||12453===a||12455===a||12457===a||12526===a||34===a||33===a||41===a||44===a||46===a||63===a||12289===a||12290===a||12540===a||65281===a||65289===a||65311===a||65392===a||65438===a||65439===a},
isNonEndingChar:function(a){return 12304===a||12300===a||65117===a||12317===a||91===a||12308===a||12296===a||65113===a||8216===a||8245===a||123===a||65371===a||12302===a||65115===a||8220===a||92===a||36===a||65505===a||12298===a||65284===a||65339===a||65510===a||65509===a||34===a||40===a||65288===a}}});
rat.modules.add("rat.ui.r_ui_tooltip",[{name:"rat.ui.r_ui",processBefore:!0},"rat.utils.r_shapes","rat.ui.r_ui_textbox"],function(a){a.ui.TOOL_TIP_TIME=0.5;a.ui.Element.prototype.updateToolTip=function(d){this.toolTip&&(this.flags&a.ui.Element.mouseInFlag&&this.flags&a.ui.Element.visibleFlag?(this.toolTip.timer+=d,this.toolTip.timer>a.ui.TOOL_TIP_TIME&&(this.toolTipPlacementFromMouse&&this.positionToolTip(this.toolTipPlacement,this.toolTipPlacementOffset,this.toolTipPlacementFromMouse),d=this.getGlobalPos(this.toolTipOffset.x,
this.toolTipOffset.y),this.toolTip.setPos(d.x,d.y),this.toolTipScreen.activeToolTip=this.toolTip)):(this.toolTip.setVisible(!1),this.toolTip.timer=0))};a.ui.Element.prototype.setTextToolTip=function(d,c,b,e){b||(b=a.graphics.black);c||(c=a.graphics.white);var f=new a.ui.Shape(a.ui.squareShape);f.setSize(200,20);f.setColor(b);f.setFrame(1,c);b=new a.ui.TextBox(d);b.setFont("calibri");b.setTextValue(d);b.setColor(c);this.sizeTextToolTip(15,f,b);f.appendSubElement(b);this.setToolTip(f,e,"rightHigh",
{x:6,y:0});return{container:f,textBox:b}};a.ui.Element.prototype.addTextToolTip=a.ui.Element.prototype.setTextToolTip;a.ui.Element.prototype.sizeTextToolTip=function(a,c,b){c||(c=this.toolTip);b||(b=c.subElements[0]);b.setFontSize(a);b.setPos(7,2);c.setSize(b.contentSize.x+14,b.contentSize.y+4+2);b.autoSizeToContent()};a.ui.Element.prototype.positionToolTip=function(a,c,b){var e=this.toolTip;if(e){"undefined"===typeof c&&(c={x:0,y:0});var f=e.getSize(),g=this.getSize();b&&(g.x=g.y=16);var h=0,j=0;
"none"===a||""===a?h=j=0:"top"===a?(h=(g.x-f.x)/2,j=-f.y):"topLeft"===a?(h=-f.x,j=-f.y):"topRight"===a?(h=g.x,j=-f.y):"bottom"===a?(h=(g.x-f.x)/2,j=g.y):"bottomLeft"===a?(h=-f.x,j=g.y):"bottomRight"===a?(h=g.x,j=g.y):(h=g.x,j=g.y/3-f.y/2);b&&this.mousePos&&(h+=this.mousePos.x,j+=this.mousePos.y);e.setPos(h+c.x,j+c.y);this.toolTipPlacement=a;this.toolTipPlacementOffset={x:c.x,y:c.y};this.toolTipPlacementFromMouse=b;this.toolTipOffset=e.getPos().copy()}};a.ui.Element.prototype.setToolTip=function(a,
c,b,e,f){"undefined"===typeof e&&(e={x:0,y:0});this.toolTip=a;this.positionToolTip(b,e,f);a.setVisible(!1);a.timer=0;c||(c=this.getTopParent(),this.toolTipScreenWasAssumed=!0);this.toolTipScreen=c;this.setTracksMouse(!0)};a.ui.Element.prototype.getToolTip=function(){return this.toolTip}});
rat.modules.add("rat.ui.r_ui_edittext",[{name:"rat.ui.r_ui_textbox",processBefore:!0},"rat.os.r_clipboard"],function(a){a.ui.EditText=function(d,c){this.config={};this.config.enters=[{action:"toggleActive"},{ctrlKey:!0,action:"insertCR"}];this.config.maxLength=-1;this.supportPan=!0;this.pan={x:20,y:0};a.ui.EditText.prototype.parentConstructor.call(this,d,c);this.setTracksMouse(!0);this.setTargetable(!0);this.editFrameLook={normalColor:new a.graphics.Color(180,180,180),highlightColor:new a.graphics.Color(255,
255,180),activeColor:new a.graphics.Color(255,255,255),lineWidth:2};this.editFillLook={activeColor:new a.graphics.Color(20,20,20,0.2)};this.editSelectionLook={normalColor:new a.graphics.Color(200,200,180,0.2),activeColor:new a.graphics.Color(255,255,180,0.8),caratColor:new a.graphics.Color(255,255,255),caratWidth:2,caratBlinkSpeed:2};this.timer=0;this.active=!1;this.overrideMaxWidth(-1);var b=0;this.value?b=this.value.length:this.value="";this.setCursorPos(b)};a.utils.inheritClassFrom(a.ui.EditText,
a.ui.TextBox);a.ui.EditText.prototype.elementType="editText";a.ui.EditText.prototype.flagsThatDirtyMe=a.ui.Element.highlightedFlag|a.ui.Element.enabledFlag;a.ui.EditText.prototype.setEnterHandling=function(a){"string"===typeof a?a={action:a}:"function"===typeof a&&(a={action:a});a||(a=[]);Array.isArray(a)||(a=[a]);this.config.enters=a};a.ui.EditText.prototype.setMaxTextLength=function(a){this.config.maxLength=a};a.ui.EditText.prototype.setTextValue=function(d){a.ui.EditText.prototype.parentPrototype.setTextValue.call(this,
d);var c=0;d&&(c=d.length);this.setCursorPos(c)};a.ui.EditText.prototype.textChanged=function(){0<this.config.maxLength&&this.value.length>this.config.maxLength&&(this.value=this.value.substring(0,this.config.maxLength));this.textChangeCallback&&this.textChangeCallback(this,this.value);a.ui.EditText.prototype.parentPrototype.textChanged.call(this);this.updatePan()};a.ui.EditText.prototype.setCursorPos=function(a){this.selectionRight=this.selectionLeft=this.selectionEnd=this.selectionAnchor=this.cursorPos=
a;this.timer=0;this.setDirty(!0);this.updatePan()};a.ui.EditText.prototype.selectAll=function(){this.cursorPos=this.value.length;this.selectionLeft=this.selectionAnchor=0;this.selectionRight=this.selectionEnd=this.value.length;this.timer=0;this.setDirty(!0);this.updatePan()};a.ui.EditText.prototype.updateSelectionLeftRight=function(){this.selectionAnchor<this.selectionEnd?(this.selectionLeft=this.selectionAnchor,this.selectionRight=this.selectionEnd):(this.selectionLeft=this.selectionEnd,this.selectionRight=
this.selectionAnchor)};a.ui.EditText.prototype.updatePan=function(){if(0===this.cursorPos)this.pan.x=0;else{a.graphics.ctx.font=this.fontDescriptor;var d=this.value.substring(0,this.cursorPos),d=a.graphics.ctx.measureText(d).width,c;this.pan.x<d-4&&this.pan.x+this.size.x>d+4?c=this.pan.x+this.size.x+4>this.textWidth?this.textWidth-this.size.x+4:this.pan.x:(c=d-this.size.x+4,this.pan.x>c&&(c=d-4));this.pan.x=c;0>this.pan.x&&(this.pan.x=0)}};a.ui.EditText.prototype.setActive=function(a){a!=this.active&&
this.setDirty(!0);(this.active=a)?this.timer=0:this.caratBlinkOn=!1};a.ui.EditText.prototype.drawFrame=function(d){var c=this.editFrameLook;d.lineWidth=c.lineWidth;var b=0,e=0!==(this.flags&a.ui.Element.targetedFlag),f=this.flags&a.ui.Element.enabledFlag&&this.flags&a.ui.Element.highlightedFlag;d.strokeStyle=this.active?c.activeColor.toString():f?c.highlightColor.toString():c.normalColor.toString();if(f||e)d.lineWidth=c.lineWidth+1,b=1;d.strokeRect(-this.center.x-b,-this.center.y-b,this.size.x+2*
b,this.size.y+2*b)};a.ui.EditText.prototype.drawSelf=function(){var d=a.graphics.getContext();this.active&&(d.fillStyle=this.editFillLook.activeColor.toString(),d.fillRect(-this.center.x,-this.center.y,this.size.x,this.size.y));this.drawFrame(d);var c=!1;this.supportPan&&(c=!0,d.save(),d.beginPath(),d.rect(1-this.center.x,1-this.center.y,this.size.x-2,this.size.y-2),d.clip(),d.translate(-this.pan.x,-this.pan.y));a.ui.EditText.prototype.parentPrototype.drawSelf.call(this);var b=this.editSelectionLook,
e=this.setupAlignX(d,this.textWidth);if(this.selectionAnchor!==this.selectionEnd){var f=-this.center.y+2,g=this.size.y-4,h=e,j=this.value.substring(0,this.selectionAnchor),j=a.graphics.ctx.measureText(j),h=h+j.width,k=e+1,j=this.value.substring(0,this.selectionEnd),j=a.graphics.ctx.measureText(j),k=k+j.width;d.fillStyle=this.active?b.activeColor.toString():b.normalColor.toString();d.fillRect(h,f,k-h,g)}f=this.caratBlinkOn;this.active&&f&&(h=e+1,f=-this.center.y+2,e=b.caratWidth,g=this.size.y-4,j=
this.value.substring(0,this.cursorPos),j=a.graphics.ctx.measureText(j),h+=j.width,d.fillStyle=b.caratColor.toString(),d.fillRect(h,f,e,g));c&&d.restore()};a.ui.EditText.prototype.updateSelf=function(a){this.active&&(this.timer+=a,a=this.caratBlinkOn,this.caratBlinkOn=1>2*this.timer*this.editSelectionLook.caratBlinkSpeed%2,a!=this.caratBlinkOn&&this.setDirty(!0))};a.ui.EditText.prototype.keyDown=function(d){if(d.which>=a.keys.f1&&d.which<=a.keys.f12)return!1;if(d.which===a.keys.esc)return this.active?
(this.setActive(!1),!0):!1;if(d.which===a.keys.enter)for(var c=0;c<this.config.enters.length;c++){var b=this.config.enters[c];if(!!d.sysEvent.ctrlKey===!!b.ctrlKey&&!!d.sysEvent.shiftKey===!!b.shiftKey&&!!d.sysEvent.altKey===!!b.altKey)return"function"===typeof b.action?b.action(this,this.value,d):"toggleActive"===b.action?this.active?this.setActive(!1):this.setActive(!0):"insertCR"===b.action&&this.insertText("\n"),!0}if(this.active){var e=this,c=function(a){var b=e.value.slice(0,a);a=e.value.slice(a+
1,e.value.length);e.value=b+a;e.textChanged()},b=function(){var a=e.value.slice(0,e.selectionLeft),b=e.value.slice(e.selectionRight,e.value.length);e.value=a+b;e.textChanged()},f=d.sysEvent.shiftKey,g=!1,h=this.cursorPos;if(d.which===a.keys.c&&d.sysEvent.ctrlKey){if((d=e.value.slice(e.selectionLeft,e.selectionRight))&&0<d.length)a.clipboard.store("text",d),console.log("copy "+d);return!0}if(d.which===a.keys.v&&d.sysEvent.ctrlKey){if(d=a.clipboard.retrieve("text"))console.log("paste "+d),this.insertText(d);
return!0}if(d.which===a.keys.x&&d.sysEvent.ctrlKey){if((d=e.value.slice(e.selectionLeft,e.selectionRight))&&0<d.length)a.clipboard.store("text",d),console.log("cut "+d),this.insertText("");return!0}d.which===a.keys.backspace?(d.sysEvent.preventDefault(),this.selectionEnd!=this.selectionAnchor?(b(),h=this.selectionLeft):0<this.cursorPos&&(c(this.cursorPos-1),h=this.cursorPos-1),f=!1,g=!0):d.which===a.keys.del?(this.selectionEnd!=this.selectionAnchor?(b(),h=this.selectionLeft):this.cursorPos<this.value.length&&
c(this.cursorPos),f=!1,g=!0):d.which===a.keys.leftArrow?(h=!f&&this.selectionEnd!=this.selectionAnchor?this.selectionLeft:this.cursorPos-1,g=!0):d.which===a.keys.rightArrow?(h=!f&&this.selectionEnd!=this.selectionAnchor?this.selectionRight:this.cursorPos+1,g=!0):d.which===a.keys.home?(h=0,g=!0):d.which===a.keys.end&&(h=this.value.length,g=!0);if(g)return h=Math.max(h,0),h=Math.min(h,this.value.length),this.selectionEnd=f?h:this.selectionAnchor=h,this.updateSelectionLeftRight(),this.cursorPos=h,this.updatePan(),
this.timer=0,this.setDirty(!0),!0}else if(d.which===a.keys.backspace||d.which===a.keys.del)return d.sysEvent.preventDefault(),this.setTextValue(""),!0;return!1};a.ui.EditText.prototype.keyPress=function(a){if(!this.active)return!1;a=a.sysEvent.char;if(32>a.charCodeAt(0))return!1;"\n"!==a&&"\t"!==a&&this.insertText(a);return!0};a.ui.EditText.prototype.insertText=function(a){var c=this.value.slice(0,this.selectionLeft),b=this.value.slice(this.selectionRight,this.value.length);this.value=c+a+b;this.textChanged();
this.setCursorPos(this.selectionLeft+a.length)};a.ui.EditText.prototype.blur=function(){this.setActive(!1);return a.ui.EditText.prototype.parentPrototype.blur.call(this)};a.ui.EditText.prototype.handleTabbedTo=function(){this.setActive(!0);this.selectAll()};a.ui.EditText.prototype.pointToCharIndex=function(d){a.graphics.ctx.font=this.fontDescriptor;for(var c=this.value.length,b=0,e=1;e<=this.value.length;e++){var f=this.value.substring(0,e),f=a.graphics.ctx.measureText(f);if(d.x+this.center.x+this.pan.x<
b+(f.width-b)/2){c=e-1;break}b=f.width}return c};a.ui.EditText.prototype.mouseDown=function(d,c){a.ui.EditText.prototype.parentPrototype.mouseDown.call(this,d,c);if(this.active)b=this.pointToCharIndex(d),c.sysEvent.shiftKey?(this.selectionEnd=b,this.updateSelectionLeftRight()):this.selectionEnd=this.selectionAnchor=this.selectionLeft=this.selectionRight=b,this.cursorPos=b;else if(this.setActive(!0),this.config.selectAllOnClickActivate)this.selectAll();else{var b=this.pointToCharIndex(d);this.setCursorPos(b)}this.trackingClick=
!0;this.timer=0;this.setDirty(!0);return!0};a.ui.EditText.prototype.mouseUp=function(d,c){a.ui.EditText.prototype.parentPrototype.mouseUp.call(this,d,c);return this.trackingClick?(this.trackingClick=!1,!0):!1};a.ui.EditText.prototype.mouseMove=function(a){return this.trackingClick?(a=this.pointToCharIndex(a),a!=this.selectionEnd&&this.setDirty(!0),this.cursorPos=this.selectionEnd=a,this.updateSelectionLeftRight(),this.updatePan(),!0):!1};a.ui.EditText.prototype.trigger=function(){this.active||(this.setActive(!0),
this.selectAll());return a.ui.EditText.prototype.parentPrototype.trigger.call(this)};a.ui.EditText.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.EditText,d,c,b)}});
rat.modules.add("rat.utils.r_eventmap",["rat.debug.r_console"],function(a){a.eventMap={};var d={};a.eventMap.register=function(a,b){b&&(a=a.toUpperCase(),d[a]?d[a].push(b):d[a]=[b])};a.eventMap.registerHandler=a.eventMap.register;a.eventMap.add=a.eventMap.register;a.eventMap.fireEvent=function(a,b){a=a.toUpperCase();var e=d[a];if(e){var f=Array.prototype.slice.call(arguments);f.splice(0,2);for(var g=e.length,h=0;h<g;++h)e[h].apply(b,f)}};a.eventMap.fire=a.eventMap.fireEvent});
rat.modules.add("rat.ui.r_ui_fill",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.ui.r_ui",processBefore:!0},"rat.ui.r_ui_data"],function(a){a.ui.Fill=function(){a.ui.Fill.prototype.parentConstructor.call(this);this.fillCur=5;this.fillTotal=10;this.percent=0.5;this.allowUnderFill=this.allowOverFill=!1;this.fillStyle="stroke";this.fillShape="circle";this.lineWidth=1;this.setTracksMouse(!1)};a.utils.inheritClassFrom(a.ui.Fill,a.ui.Element);a.ui.Fill.prototype.elementType="fill";a.ui.Fill.prototype.setFill=
function(a,c){if(this.fillCur!==a||void 0!==c&&this.fillTotal!==c)this.fillCur=a,void 0!==c&&(this.fillTotal=c),!this.allowUnderFill&&0>this.fillCur&&(this.fillCur=0),!this.allowOverFill&&this.fillCur>this.fillTotal&&(this.fillCur=this.fillTotal),this.percent=this.fillCur/this.fillTotal,this.setDirty(!0)};a.ui.Fill.setupFromData=function(d,c,b){a.ui.data.callParentSetupFromData(a.ui.Fill,d,c,b);c.allowOverFill&&(d.allowOverFill=c.allowOverFill);c.allowUnderFill&&(d.allowUnderFill=c.allowUnderFill);
d.setFill(c.currentFill||0,c.maxFill);d.fillStyle=c.fillStyle||d.fillStyle;d.fillShape=c.fillShape||d.fillShape;void 0!==c.lineWidth&&(d.lineWidth=c.lineWidth)}});
rat.modules.add("rat.storage.r_storage",[{name:"rat.utils.r_utils",processBefore:!0},{name:"rat.debug.r_console",processBefore:!0},{name:"rat.storage.r_storage_xbo",platform:"xbox"},{name:"rat.storage.r_storage_firebase"},"rat.os.r_system","rat.os.r_user"],function(a){function d(){if(a.user)return a.user.getActiveUserID()||void 0}a.storage={storageObjects:{byUser:{},byType:{}}};a.storage.clear=function(){function c(a){var b=a.values,c;for(c in b)b.hasOwnProperty(c)&&a.values.remove(c)}void 0!==window.Windows&&
(c(window.Windows.Storage.ApplicationData.current.localSettings),c(window.Windows.Storage.ApplicationData.current.roamingSettings));a.system.has.xbox&&a.storage.XboxOne.clear();var b=a.system.getLocalStorage();b&&(b.clear?b.clear():a.system.has.Wraith&&a.console.log('To clear user settings under wraith, use the wraith cheat "resetPrefs"'));document.cookie&&(document.cookie="FakeStorage=; expires=Thu, 01 Jan 1970 00:00:00 UTC")};a.storage.getStorage=function(c,b){b=void 0!==b&&void 0!==b.id?b.id:b||
"";var d=a.storage.storageObjects.byType;b&&(a.storage.storageObjects.byUser[b]=a.storage.storageObjects.byUser[b]||{},d=a.storage.storageObjects.byUser[b]);if(d&&d[c])return d[c];if(a.system.has.xbox)d[c]=a.storage.XboxOne.getStorage(c,b);else if(a.system.has.realWindows8)c===a.storage.permanentLocal?d[c]=new a.Win8AppStorage("",!0):c===a.storage.permanentRoaming?d[c]=new a.Win8AppStorage("",!1):c===a.storage.suspendLocal&&(d[c]=new a.Win8SessionStorage(""));else{var f=a.LocalStore;!a.system.has.localStorage&&
void 0!=document.cookie&&(f=a.LocalCookieStore);c===a.storage.permanentLocal?d[c]=new f(""):c===a.storage.suspendLocal&&(d[c]=new f("_sus_"))}return d[c]};a.storage.permanentLocal=1;a.storage.permanentRoaming=2;a.storage.permanentServer=3;a.storage.suspendLocal=4;a.console.registerCommand("clearStorage",function(){a.storage.clear()},["clearstore"]);a.BasicStorage=function(a){this.prefix=a||"";this._onReady=[];this.defaultData=void 0};a.BasicStorage.prototype.onReady=function(a,b){a&&(this.hasData()?
a.call(b):this._onReady.push({func:a,ctx:b}))};a.BasicStorage.prototype._fireOnReady=function(){var a=this._onReady;this._onReady=[];for(var b,d,f=0;f!==a.length;++f)b=a[f].func,d=a[f].ctx,b.call(d)};a.BasicStorage.prototype.setPrefix=function(a){this.prefix=a||""};a.BasicStorage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))};a.BasicStorage.prototype.getObject=function(a){a=this.getItem(a);return"{"===a?{}:"string"!==typeof a||""===a?a:JSON.parse(a)};a.BasicStorage.prototype.save=
function(a,b){if(this.hasData())this._internalSave?this._internalSave(a,b):a&&a.call(b);else this.onReady(this.save.bind(this,a,b),void 0)};a.BasicStorage.prototype.hasData=function(){return!0};a.BasicStorage.prototype.setDefaults=function(a){this.defaultData=a};a.BasicStorage.prototype.setItem=function(c,b){"string"!==typeof b&&(b=JSON.stringify(b));"save"===c?a.console.log("ERROR! You cannot save items to local storage with the key 'save'.  That keyword is reserved!"):this.hasData()?this._internalSetItem(c,
b):(a.console.log("WARNING: Setting item on storage object that is not ready.  Set delayed..."),this.onReady(this.setItem.bind(this,c,b),void 0))};a.BasicStorage.prototype._internalSetItem=void 0;a.BasicStorage.prototype._internalGetItem=void 0;a.BasicStorage.prototype.getItem=function(c){if(this.hasData())if("save"===c)a.console.log("ERROR! You cannot load items from local storage with the key 'save'.  That keyword is reserved!");else{var b=this._internalGetItem(c);void 0===b&&(this.defaultData&&
void 0!==this.defaultData[c])&&(b=this.defaultData.key);return b}else a.console.log("ERROR! Attempting to ready storage when it is not ready!")};a.LocalStore=function(c){a.LocalStore.prototype.parentConstructor.call(this,c);this._fireOnReady()};a.utils.inheritClassFrom(a.LocalStore,a.BasicStorage);a.LocalStore.prototype._internalSetItem=function(c,b){a.system.has.localStorage&&a.system.localStorageObject.setItem(this.prefix+c,b,d())};a.LocalStore.prototype._internalGetItem=function(c){var b=null;
a.system.has.localStorage&&(b=a.system.localStorageObject.getItem(this.prefix+c,d()));return b};a.LocalStore.prototype.remove=function(c){a.system.has.localStorage&&a.system.localStorageObject.removeItem(this.prefix+c,d())};a.LocalStore.prototype.hasData=function(){return a.system.localStorageObject&&a.system.localStorageObject.hasData?a.system.localStorageObject.hasData(d()):!0};a.LocalStore.prototype._internalSave=function(c,b){var e;a.system.localStorageObject&&(a.system.localStorageObject.save&&
"function"===typeof a.system.localStorageObject.save)&&(a.console.log("Saving storage."),e=a.system.localStorageObject.save(d()),a.console.log("...Done"));c&&c.call(b);return e};a.LocalCookieStore=function(c){a.LocalCookieStore.prototype.parentConstructor.call(this,c);this.cookieData={};c=(document.cookie||"").split(";");for(var b=0;b<c.length;++b){var d=c[b].trim(),f,g=d.indexOf("=");-1!=g?(f=d.substr(0,g).trim(),d=d.substr(g+1).trim()):(f=d,d="{}");if("FakeStorage"==f){try{this.cookieData=JSON.parse(d)}catch(h){a.console.log("WARNING: Unable to parse save data from cookie data"),
this.cookieData={}}break}}this._fireOnReady()};a.utils.inheritClassFrom(a.LocalCookieStore,a.BasicStorage);a.LocalCookieStore.prototype._internalSetItem=function(a,b){0<this.prefix.length&&(a=this.prefix+a);this.cookieData[this.prefix+a]=b;this._internalSave()};a.LocalCookieStore.prototype._internalGetItem=function(a){0<this.prefix.length&&(a=this.prefix+a);return this.cookieData[a]};a.LocalCookieStore.prototype.remove=function(a){0<this.prefix.length&&(a=this.prefix+a);delete this.cookieData[a];
this._internalSave()};a.LocalCookieStore.prototype.hasData=function(){return!0};a.LocalCookieStore.prototype._internalSave=function(c,b){a.console.log("Saving storage.");document.cookie="FakeStorage=; expires=Thu, 01 Jan 1970 00:00:00 UTC";document.cookie="FakeStorage="+JSON.stringify(this.cookieData)+";";a.console.log("...Done");c&&c.call(b)};a.Win8SessionStorage=function(c){a.Win8SessionStorage.prototype.parentConstructor.call(this,c)};a.utils.inheritClassFrom(a.Win8SessionStorage,a.BasicStorage);
a.Win8SessionStorage.prototype.getSessionStateObj=function(){return window.WinJS&&window.WinJS.Application?window.WinJS.Application.sessionState:{}};a.Win8SessionStorage.prototype._internalSetItem=function(a,b){this.getSessionStateObj()[this.prefix+a]=b};a.Win8SessionStorage.prototype._internalGetItem=function(a){return this.getSessionStateObj()[this.prefix+a]};a.Win8SessionStorage.prototype.remove=function(a){this.getSessionStateObj()[this.prefix+a]=null};a.Win8AppStorage=function(c,b){a.Win8AppStorage.prototype.parentConstructor.call(this,
c);this.settings=b?window.Windows.Storage.ApplicationData.current.localSettings:window.Windows.Storage.ApplicationData.current.roamingSettings};a.utils.inheritClassFrom(a.Win8AppStorage,a.BasicStorage);a.Win8AppStorage.prototype._internalSetItem=function(a,b){this.settings.values[this.prefix+a]=b};a.Win8AppStorage.prototype._internalGetItem=function(a){return this.settings.values[this.prefix+a]};a.Win8AppStorage.prototype.remove=function(a){this.settings.values.remove(this.prefix+a)}});
rat.modules.add("rat.os.r_user_kong",[{name:"rat.os.r_user",processBefore:!0},{name:"rat.os.r_system",processBefore:!0},{name:"rat.os.r_kong"},"rat.debug.r_console"],function(a){function d(c,b){a.console.log("requestFriendGroup count "+b.length);for(var d="https://api.kongregate.com/api/user_info.json?user_ids=",f=0;f<b.length;f++)d+=""+b[f],f<b.length-1&&(d+=",");var g=a.system.kong,h;h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f=!1;if(!g||g.fake||!g.isReady())f=
!0;g=d;f&&(h.crossOrigin="Anonymous",d=d.indexOf("://"),d=g.substring(d+3),g="http://104.236.146.97:9186/"+d);h.onload=function(){a:{if(4===h.readyState&&200===h.status){a.console.log("got kong friend data");for(var b=JSON.parse(h.responseText),d=0;d<b.users.length;d++)for(var e=0;e<c.friendsList.length;e++)b.users[d].user_id===c.friendsList[e].id&&(c.friendsList[e].userInfo=b.users[d],c.friendsList[e].userInfoStatus="ready",c.friendsList[e].userImageSource=b.users[d].user_vars.avatar_url)}for(e=
0;e<c.friendsList.length;e++)if("ready"!==c.friendsList[e].userInfoStatus)break a;a.user.messages.broadcast(a.user.messageType.FriendsInfoAvailable,c)}};h.open("GET",g,!0);h.send()}a.user=a.user||{};a.user.supported=!0;a.user.getUsers=function(){var c=new a.user._internal.UserList,b={},d=a.system.kong;d&&d.kongregate?(b.id=d.kongregate.services.getUserId(),b.gamerTag=d.kongregate.services.getUsername(),b.isGuest=d.kongregate.services.isGuest()):(b.id=-1,b.gamerTag="gostay",b.isGuest=!1);b.isSignedIn=
!0;b.userImageSource=null;b.friendsList=null;c.add(b,b);return c};a.user.requestFriendsInfo=function(c){if(c.friendsList){a.console.log("requesting info for "+c.friendsList.length+" friends");for(var b=[],e=0;e<c.friendsList.length;e++)c.friendsList[e].userInfoStatus="pending",b.push(c.friendsList[e].id),50<=b.length&&(d(c,b),b=[]);b.length&&d(c,b)}};a.user.init=function(c){a.console.log("rat.user.init kong");c=c.getUserId();a.user.setActiveUser(c)};a.user.writeStat=function(c,b){var d=a.system.kong;
d&&!d.fake&&d.isReady()?d.kongregate.stats.submit(c,b):a.console.log("non-kong stat write attemp:  "+c+" : "+b)}});
rat.modules.add("rat.utils.r_timer",["rat.debug.r_console"],function(a){a.timer=function(a,c,b){this.func=a;this.param2=b;this.currentTime=0;this.delay=c;this.flags=0};a.setTimeout=function(d,c,b){d=new a.timer(d,c,b);d.autoUpdate();return d};a.setInterval=function(d,c,b){d=new a.timer(d,c,b);d.setRepeat(!0);d.autoUpdate();return d};a.timer.prototype.setRepeat=function(a){this.flags=a?this.flags|1:this.flags&-2};a.timer.prototype.setPause=function(a){this.flags=a?this.flags|2:this.flags&-3};a.timer.prototype.update=
function(a){this.flags&49154||(this.currentTime+=a,this.currentTime>=this.delay&&this.callNow())};a.timer.prototype.autoUpdate=function(){this.flags&=-32769;this.flags&=-16385;a.timerUpdater.timers.push(this)};a.timer.prototype.endAutoUpdate=function(){this.flags|=32768};a.timer.prototype.callNow=function(){this.func(this,this.param2);this.flags&1?this.currentTime=0:(this.flags|=32768,this.flags|=16384)};a.timerUpdater={timers:[]};a.timerUpdater.updateAll=function(a){for(var c=this.timers.length-
1;0<=c;--c){var b=this.timers[c];b.update(a);b.flags&32768&&(this.timers[c]=this.timers[this.timers.length-1],this.timers.pop())}};a.timerUpdater.test=function(){a.setTimeout(function(){a.console.log("2 seconds once")},2);a.setInterval(function(d,c){a.console.log(c)},3,"Every 3 seconds.")}});
rat.modules.add("rat.storage.r_file_access",[{name:"rat.os.r_system",processBefore:!0},{name:"rat.utils.r_utils",processBefore:!0}],function(a){a.fileAccess={save:function(d,c,b){if("undefined"===typeof Blob)a.console.log("Unable to save.   Not supported");else if("string"!==typeof d&&(d=JSON.stringify(d)),d=new Blob([d],{type:"text/plain"}),a.system.has.IEBrowser&&10<=a.system.has.IEVersion)window.navigator.msSaveBlob(d,c||"file");else{var e=document.createElement("a");e.href=window.URL.createObjectURL(d);
e.download=c;e.click()}b&&b()},openFile:function(a,c){var b=document.createElement("input");b.type="file";document.body.appendChild(b);b.onchange=function(){b.parentNode.removeChild(b);var e=b.files;b=void 0;var f=new FileReader,g="";f.onload=function(){g+=f.result};for(var h=0;h<e.length;++h)f.readAsText(e[h]);f.onloadend=function(){f.onload=void 0;f.onloadend=void 0;f.error?(alert("error: "+f.error.message),c&&c(f.error)):a&&a(g)}};b.click()},selectFile:function(a,c,b){var e=document.createElement("input");
e.type="file";void 0!==b&&(e.multiple=b);document.body.appendChild(e);e.onchange=function(){e.parentNode.removeChild(e);var b=e.files;e=void 0;a&&a(b)};e.click()}}});
rat.modules.add("rat.os.r_clipboard",["rat.storage.r_storage"],function(a){var d={blobs:{},init:function(){d.localSave=a.storage.getStorage(a.storage.permanentLocal,"rat");if(d.localSave){var c=d.localSave.getObject("rat_clipboard");c&&2===c.version&&(d.blobs=c.blobs)}},cache:function(){d.localSave&&d.localSave.setObject("rat_clipboard",{version:2,blobs:d.blobs})},store:function(a,b){"string"===typeof a&&(a={type:a,value:b});Array.isArray(a)||(a=[a]);d.blobs={};for(var e=0;e<a.length;e++){var f=a[e];
d.blobs[f.type]={type:f.type,value:f.value}}d.cache()},retrieve:function(a){return d.blobs[a]?d.blobs[a].value:null},getData:function(){return d.blobs?d.blobs:null}};a.clipboard=d});rat.load({skipLoad:!0,async:!1});
